(()=>{var t,e,n,r,o,s={3:function(t,e){var n,r;void 0===(r="function"==typeof(n=function(){return function t(e,n,r){var o,s,i=window,l="application/octet-stream",c=r||l,a=e,u=!n&&!r&&a,d=document.createElement("a"),p=function(t){return String(t)},f=i.Blob||i.MozBlob||i.WebKitBlob||p,h=n||"download";if(f=f.call?f.bind(i):Blob,"true"===String(this)&&(c=(a=[a,c])[0],a=a[1]),u&&u.length<2048&&(h=u.split("/").pop().split("?")[0],d.href=u,-1!==d.href.indexOf(u))){var m=new XMLHttpRequest;return m.open("GET",u,!0),m.responseType="blob",m.onload=function(e){t(e.target.response,h,l)},setTimeout(function(){m.send()},0),m}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(a)){if(!(a.length>2096103.424&&f!==p))return navigator.msSaveBlob?navigator.msSaveBlob(b(a),h):y(a);c=(a=b(a)).type||l}else if(/([\x80-\xff])/.test(a)){for(var g=0,$=new Uint8Array(a.length),v=$.length;g<v;++g)$[g]=a.charCodeAt(g);a=new f([$],{type:c})}function b(t){for(var e=t.split(/[:;,]/),n=e[1],r=("base64"==e[2]?atob:decodeURIComponent)(e.pop()),o=r.length,s=0,i=new Uint8Array(o);s<o;++s)i[s]=r.charCodeAt(s);return new f([i],{type:n})}function y(t,e){if("download"in d)return d.href=t,d.setAttribute("download",h),d.className="download-js-link",d.innerHTML="downloading...",d.style.display="none",document.body.appendChild(d),setTimeout(function(){d.click(),document.body.removeChild(d),!0===e&&setTimeout(function(){i.URL.revokeObjectURL(d.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,l)),window.open(t)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=t),!0;var n=document.createElement("iframe");document.body.appendChild(n),!e&&/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,l)),n.src=t,setTimeout(function(){document.body.removeChild(n)},333)}if(o=a instanceof f?a:new f([a],{type:c}),navigator.msSaveBlob)return navigator.msSaveBlob(o,h);if(i.URL)y(i.URL.createObjectURL(o),!0);else{if("string"==typeof o||o.constructor===p)try{return y("data:"+c+";base64,"+i.btoa(o))}catch(t){return y("data:"+c+","+encodeURIComponent(o))}(s=new FileReader).onload=function(t){y(this.result)},s.readAsDataURL(o)}return!0}})?n.apply(e,[]):n)||(t.exports=r)}},i={};function l(t){var e=i[t];if(void 0!==e)return e.exports;var n=i[t]={exports:{}};return s[t].call(n.exports,n,n.exports,l),n.exports}l.m=s,t=[],l.O=(e,n,r,o)=>{if(!n){var s=1/0;for(u=0;u<t.length;u++){for(var[n,r,o]=t[u],i=!0,c=0;c<n.length;c++)(!1&o||s>=o)&&Object.keys(l.O).every(t=>l.O[t](n[c]))?n.splice(c--,1):(i=!1,o<s&&(s=o));if(i){t.splice(u--,1);var a=r();void 0!==a&&(e=a)}}return e}o=o||0;for(var u=t.length;u>0&&t[u-1][2]>o;u--)t[u]=t[u-1];t[u]=[n,r,o]},l.F={},l.E=t=>{Object.keys(l.F).map(e=>{l.F[e](t)})},l.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return l.d(e,{a:e}),e},n=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,l.t=function(t,r){if(1&r&&(t=this(t)),8&r)return t;if("object"==typeof t&&t){if(4&r&&t.__esModule)return t;if(16&r&&"function"==typeof t.then)return t}var o=Object.create(null);l.r(o);var s={};e=e||[null,n({}),n([]),n(n)];for(var i=2&r&&t;("object"==typeof i||"function"==typeof i)&&!~e.indexOf(i);i=n(i))Object.getOwnPropertyNames(i).forEach(e=>s[e]=()=>t[e]);return s.default=()=>t,l.d(o,s),o},l.d=(t,e)=>{for(var n in e)l.o(e,n)&&!l.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},l.f={},l.e=t=>Promise.all(Object.keys(l.f).reduce((e,n)=>(l.f[n](t,e),e),[])),l.u=t=>t+"-"+{299:"99982dcf2aa1cc2d619f",305:"88200226cf13034a1e7e"}[t]+".js",l.miniCssF=t=>{},l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),l.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r={},o="hfy-epub:",l.l=(t,e,n,s)=>{if(r[t])r[t].push(e);else{var i,c;if(void 0!==n)for(var a=document.getElementsByTagName("script"),u=0;u<a.length;u++){var d=a[u];if(d.getAttribute("src")==t||d.getAttribute("data-webpack")==o+n){i=d;break}}i||(c=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,l.nc&&i.setAttribute("nonce",l.nc),i.setAttribute("data-webpack",o+n),i.src=t),r[t]=[e];var p=(e,n)=>{i.onerror=i.onload=null,clearTimeout(f);var o=r[t];if(delete r[t],i.parentNode&&i.parentNode.removeChild(i),o&&o.forEach(t=>t(n)),e)return e(n)},f=setTimeout(p.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=p.bind(null,i.onerror),i.onload=p.bind(null,i.onload),c&&document.head.appendChild(i)}},l.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},l.p="/hfy-epub/",(()=>{var t={792:0};l.f.j=(e,n)=>{var r=l.o(t,e)?t[e]:void 0;if(0!==r)if(r)n.push(r[2]);else{var o=new Promise((n,o)=>r=t[e]=[n,o]);n.push(r[2]=o);var s=l.p+l.u(e),i=new Error;l.l(s,n=>{if(l.o(t,e)&&(0!==(r=t[e])&&(t[e]=void 0),r)){var o=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.src;i.message="Loading chunk "+e+" failed.\n("+o+": "+s+")",i.name="ChunkLoadError",i.type=o,i.request=s,r[1](i)}},"chunk-"+e,e)}},l.F.j=e=>{if(!l.o(t,e)||void 0===t[e]){t[e]=null;var n=document.createElement("link");n.charset="utf-8",l.nc&&n.setAttribute("nonce",l.nc),n.rel="prefetch",n.as="script",n.href=l.p+l.u(e),document.head.appendChild(n)}},l.O.j=e=>0===t[e];var e=(e,n)=>{var r,o,[s,i,c]=n,a=0;if(s.some(e=>0!==t[e])){for(r in i)l.o(i,r)&&(l.m[r]=i[r]);if(c)var u=c(l)}for(e&&e(n);a<s.length;a++)o=s[a],l.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return l.O(u)},n=self.webpackChunkhfy_epub=self.webpackChunkhfy_epub||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})(),l.O(0,[792],()=>{l.E(299),l.E(305)},5);var c={};(()=>{"use strict";function t(){}const e=t=>t;function n(t){return t()}function r(){return Object.create(null)}function o(t){t.forEach(n)}function s(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}let c;function a(t,e){return t===e||(c||(c=document.createElement("a")),c.href=e,t===c.href)}function u(e,n,r){e.$$.on_destroy.push(function(e,...n){if(null==e){for(const t of n)t(void 0);return t}const r=e.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}(n,r))}function d(t,e,n,r){if(t){const o=p(t,e,n,r);return t[0](o)}}function p(t,e,n,r){return t[1]&&r?function(t,e){for(const n in e)t[n]=e[n];return t}(n.ctx.slice(),t[1](r(e))):n.ctx}function f(t,e,n,r){if(t[2]&&r){const o=t[2](r(n));if(void 0===e.dirty)return o;if("object"==typeof o){const t=[],n=Math.max(e.dirty.length,o.length);for(let r=0;r<n;r+=1)t[r]=e.dirty[r]|o[r];return t}return e.dirty|o}return e.dirty}function h(t,e,n,r,o,s){if(o){const i=p(e,n,r,s);t.p(i,o)}}function m(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let t=0;t<n;t++)e[t]=-1;return e}return-1}function g(e){return e&&s(e.destroy)?e.destroy:t}function $(t){const e="string"==typeof t&&t.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return e?[parseFloat(e[1]),e[2]||"px"]:[t,"px"]}const v="undefined"!=typeof window;let b=v?()=>window.performance.now():()=>Date.now(),y=v?t=>requestAnimationFrame(t):t;const w=new Set;function x(t){w.forEach(e=>{e.c(t)||(w.delete(e),e.f())}),0!==w.size&&y(x)}const E="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;class k{_listeners="WeakMap"in E?new WeakMap:void 0;_observer=void 0;options;constructor(t){this.options=t}observe(t,e){return this._listeners.set(t,e),this._getObserver().observe(t,this.options),()=>{this._listeners.delete(t),this._observer.unobserve(t)}}_getObserver(){return this._observer??(this._observer=new ResizeObserver(t=>{for(const e of t)k.entries.set(e.target,e),this._listeners.get(e.target)?.(e)}))}}k.entries="WeakMap"in E?new WeakMap:void 0;let C=!1;function T(t,e){t.appendChild(e)}function S(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function O(t){const e=D("style");return e.textContent="/* empty */",function(t,e){T(t.head||t,e),e.sheet}(S(t),e),e.sheet}function A(t,e,n){t.insertBefore(e,n||null)}function _(t){t.parentNode&&t.parentNode.removeChild(t)}function N(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function D(t){return document.createElement(t)}function L(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function R(t){return document.createTextNode(t)}function U(){return R(" ")}function F(){return R("")}function I(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function M(t){return function(e){return e.preventDefault(),t.call(this,e)}}function j(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function P(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function z(t,e){e=""+e,t.data!==e&&(t.data=e)}function B(t,e){t.value=null==e?"":e}function q(t,e,n){t.classList.toggle(e,!!n)}function H(t,e,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:r})}class G{is_svg=!1;e=void 0;n=void 0;t=void 0;a=void 0;constructor(t=!1){this.is_svg=t,this.e=this.n=null}c(t){this.h(t)}m(t,e,n=null){this.e||(this.is_svg?this.e=L(e.nodeName):this.e=D(11===e.nodeType?"TEMPLATE":e.nodeName),this.t="TEMPLATE"!==e.tagName?e:e.content,this.c(t)),this.i(n)}h(t){this.e.innerHTML=t,this.n=Array.from("TEMPLATE"===this.e.nodeName?this.e.content.childNodes:this.e.childNodes)}i(t){for(let e=0;e<this.n.length;e+=1)A(this.t,this.n[e],t)}p(t){this.d(),this.h(t),this.i(this.a)}d(){this.n.forEach(_)}}const W=new Map;let Y,X=0;function K(t,e,n,r,o,s,i,l=0){const c=16.666/r;let a="{\n";for(let t=0;t<=1;t+=c){const r=e+(n-e)*s(t);a+=100*t+`%{${i(r,1-r)}}\n`}const u=a+`100% {${i(n,1-n)}}\n}`,d=`__svelte_${function(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}(u)}_${l}`,p=S(t),{stylesheet:f,rules:h}=W.get(p)||function(t,e){const n={stylesheet:O(e),rules:{}};return W.set(t,n),n}(p,t);h[d]||(h[d]=!0,f.insertRule(`@keyframes ${d} ${u}`,f.cssRules.length));const m=t.style.animation||"";return t.style.animation=`${m?`${m}, `:""}${d} ${r}ms linear ${o}ms 1 both`,X+=1,d}function J(t){Y=t}function V(){if(!Y)throw new Error("Function called outside component initialization");return Y}function Z(t){V().$$.on_mount.push(t)}function Q(t){V().$$.on_destroy.push(t)}function tt(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(t=>t.call(this,e))}const et=[],nt=[];let rt=[];const ot=[],st=Promise.resolve();let it=!1;function lt(t){rt.push(t)}function ct(t){ot.push(t)}const at=new Set;let ut,dt=0;function pt(){if(0!==dt)return;const t=Y;do{try{for(;dt<et.length;){const t=et[dt];dt++,J(t),ft(t.$$)}}catch(t){throw et.length=0,dt=0,t}for(J(null),et.length=0,dt=0;nt.length;)nt.pop()();for(let t=0;t<rt.length;t+=1){const e=rt[t];at.has(e)||(at.add(e),e())}rt.length=0}while(et.length);for(;ot.length;)ot.pop()();it=!1,at.clear(),J(t)}function ft(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(lt)}}function ht(t,e,n){t.dispatchEvent(H(`${e?"intro":"outro"}${n}`))}const mt=new Set;let gt;function $t(){gt={r:0,c:[],p:gt}}function vt(){gt.r||o(gt.c),gt=gt.p}function bt(t,e){t&&t.i&&(mt.delete(t),t.i(e))}function yt(t,e,n,r){if(t&&t.o){if(mt.has(t))return;mt.add(t),gt.c.push(()=>{mt.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}const wt={duration:0};function xt(n,r,i,l){let c,a=r(n,i,{direction:"both"}),u=l?0:1,d=null,p=null,f=null;function h(){f&&function(t,e){const n=(t.style.animation||"").split(", "),r=n.filter(e?t=>t.indexOf(e)<0:t=>-1===t.indexOf("__svelte")),o=n.length-r.length;o&&(t.style.animation=r.join(", "),X-=o,X||y(()=>{X||(W.forEach(t=>{const{ownerNode:e}=t.stylesheet;e&&_(e)}),W.clear())}))}(n,f)}function m(t,e){const n=t.b-u;return e*=Math.abs(n),{a:u,b:t.b,d:n,duration:e,start:t.start,end:t.start+e,group:t.group}}function g(r){const{delay:s=0,duration:i=300,easing:l=e,tick:g=t,css:$}=a||wt,v={start:b()+s,b:r};r||(v.group=gt,gt.r+=1),"inert"in n&&(r?void 0!==c&&(n.inert=c):(c=n.inert,n.inert=!0)),d||p?p=v:($&&(h(),f=K(n,u,r,i,s,l,$)),r&&g(0,1),d=m(v,i),lt(()=>ht(n,r,"start")),function(t){let e;0===w.size&&y(x),new Promise(n=>{w.add(e={c:t,f:n})})}(t=>{if(p&&t>p.start&&(d=m(p,i),p=null,ht(n,d.b,"start"),$&&(h(),f=K(n,u,d.b,d.duration,0,l,a.css))),d)if(t>=d.end)g(u=d.b,1-u),ht(n,d.b,"end"),p||(d.b?h():--d.group.r||o(d.group.c)),d=null;else if(t>=d.start){const e=t-d.start;u=d.a+d.d*l(e/d.duration),g(u,1-u)}return!(!d&&!p)}))}return{run(t){s(a)?(ut||(ut=Promise.resolve(),ut.then(()=>{ut=null})),ut).then(()=>{a=a({direction:t?"in":"out"}),g(t)}):g(t)},end(){h(),d=p=null}}}function Et(t,e){const n=e.token={};function r(t,r,o,s){if(e.token!==n)return;e.resolved=s;let i=e.ctx;void 0!==o&&(i=i.slice(),i[o]=s);const l=t&&(e.current=t)(i);let c=!1;e.block&&(e.blocks?e.blocks.forEach((t,n)=>{n!==r&&t&&($t(),yt(t,1,1,()=>{e.blocks[n]===t&&(e.blocks[n]=null)}),vt())}):e.block.d(1),l.c(),bt(l,1),l.m(e.mount(),e.anchor),c=!0),e.block=l,e.blocks&&(e.blocks[r]=l),c&&pt()}if(!(o=t)||"object"!=typeof o&&"function"!=typeof o||"function"!=typeof o.then){if(e.current!==e.then)return r(e.then,1,e.value,t),!0;e.resolved=t}else{const n=V();if(t.then(t=>{J(n),r(e.then,1,e.value,t),J(null)},t=>{if(J(n),r(e.catch,2,e.error,t),J(null),!e.hasCatch)throw t}),e.current!==e.pending)return r(e.pending,0),!0}var o}function kt(t,e,n){const r=e.slice(),{resolved:o}=t;t.current===t.then&&(r[t.value]=o),t.current===t.catch&&(r[t.error]=o),t.block.p(r,n)}function Ct(t){return void 0!==t?.length?t:Array.from(t)}function Tt(t,e){t.d(1),e.delete(t.key)}function St(t,e){yt(t,1,1,()=>{e.delete(t.key)})}function Ot(t,e,n,r,s,i,l,c,a,u,d,p){let f=t.length,h=i.length,m=f;const g={};for(;m--;)g[t[m].key]=m;const $=[],v=new Map,b=new Map,y=[];for(m=h;m--;){const t=p(s,i,m),o=n(t);let c=l.get(o);c?r&&y.push(()=>c.p(t,e)):(c=u(o,t),c.c()),v.set(o,$[m]=c),o in g&&b.set(o,Math.abs(m-g[o]))}const w=new Set,x=new Set;function E(t){bt(t,1),t.m(c,d),l.set(t.key,t),d=t.first,h--}for(;f&&h;){const e=$[h-1],n=t[f-1],r=e.key,o=n.key;e===n?(d=e.first,f--,h--):v.has(o)?!l.has(r)||w.has(r)?E(e):x.has(o)?f--:b.get(r)>b.get(o)?(x.add(r),E(e)):(w.add(o),f--):(a(n,l),f--)}for(;f--;){const e=t[f];v.has(e.key)||a(e,l)}for(;h;)E($[h-1]);return o(y),$}let At;function _t(t,e,n){const r=t.$$.props[e];void 0!==r&&(t.$$.bound[r]=n,n(t.$$.ctx[r]))}function Nt(t){t&&t.c()}function Dt(t,e,r){const{fragment:i,after_update:l}=t.$$;i&&i.m(e,r),lt(()=>{const e=t.$$.on_mount.map(n).filter(s);t.$$.on_destroy?t.$$.on_destroy.push(...e):o(e),t.$$.on_mount=[]}),l.forEach(lt)}function Lt(t,e){const n=t.$$;null!==n.fragment&&(function(t){const e=[],n=[];rt.forEach(r=>-1===t.indexOf(r)?e.push(r):n.push(r)),n.forEach(t=>t()),rt=e}(n.after_update),o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Rt(e,n,s,i,l,c,a=null,u=[-1]){const d=Y;J(e);const p=e.$$={fragment:null,ctx:[],props:c,update:t,not_equal:l,bound:r(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(d?d.$$.context:[])),callbacks:r(),dirty:u,skip_bound:!1,root:n.target||d.$$.root};a&&a(p.root);let f=!1;if(p.ctx=s?s(e,n.props||{},(t,n,...r)=>{const o=r.length?r[0]:n;return p.ctx&&l(p.ctx[t],p.ctx[t]=o)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](o),f&&function(t,e){-1===t.$$.dirty[0]&&(et.push(t),it||(it=!0,st.then(pt)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}(e,t)),n}):[],p.update(),f=!0,o(p.before_update),p.fragment=!!i&&i(p.ctx),n.target){if(n.hydrate){C=!0;const t=(h=n.target,Array.from(h.childNodes));p.fragment&&p.fragment.l(t),t.forEach(_)}else p.fragment&&p.fragment.c();n.intro&&bt(e.$$.fragment),Dt(e,n.target,n.anchor),C=!1,pt()}var h;J(d)}function Ut(t,e,n,r){const o=n[t]?.type;if(e="Boolean"===o&&"boolean"!=typeof e?null!=e:e,!r||!n[t])return e;if("toAttribute"===r)switch(o){case"Object":case"Array":return null==e?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return null==e?null:e;default:return e}else switch(o){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":default:return e;case"Number":return null!=e?+e:e}}new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]),"function"==typeof HTMLElement&&(At=class extends HTMLElement{$$ctor;$$s;$$c;$$cn=!1;$$d={};$$r=!1;$$p_d={};$$l={};$$l_u=new Map;constructor(t,e,n){super(),this.$$ctor=t,this.$$s=e,n&&this.attachShadow({mode:"open"})}addEventListener(t,e,n){if(this.$$l[t]=this.$$l[t]||[],this.$$l[t].push(e),this.$$c){const n=this.$$c.$on(t,e);this.$$l_u.set(e,n)}super.addEventListener(t,e,n)}removeEventListener(t,e,n){if(super.removeEventListener(t,e,n),this.$$c){const t=this.$$l_u.get(e);t&&(t(),this.$$l_u.delete(e))}if(this.$$l[t]){const n=this.$$l[t].indexOf(e);n>=0&&this.$$l[t].splice(n,1)}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){if(await Promise.resolve(),!this.$$cn||this.$$c)return;function t(t){return()=>{let e;return{c:function(){e=D("slot"),"default"!==t&&P(e,"name",t)},m:function(t,n){A(t,e,n)},d:function(t){t&&_(e)}}}}const e={},n=function(t){const e={};return t.childNodes.forEach(t=>{e[t.slot||"default"]=!0}),e}(this);for(const o of this.$$s)o in n&&(e[o]=[t(o)]);for(const s of this.attributes){const i=this.$$g_p(s.name);i in this.$$d||(this.$$d[i]=Ut(i,s.value,this.$$p_d,"toProp"))}for(const l in this.$$p_d)l in this.$$d||void 0===this[l]||(this.$$d[l]=this[l],delete this[l]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:e,$$scope:{ctx:[]}}});const r=()=>{this.$$r=!0;for(const t in this.$$p_d)if(this.$$d[t]=this.$$c.$$.ctx[this.$$c.$$.props[t]],this.$$p_d[t].reflect){const e=Ut(t,this.$$d[t],this.$$p_d,"toAttribute");null==e?this.removeAttribute(this.$$p_d[t].attribute||t):this.setAttribute(this.$$p_d[t].attribute||t,e)}this.$$r=!1};this.$$c.$$.after_update.push(r),r();for(const c in this.$$l)for(const a of this.$$l[c]){const u=this.$$c.$on(c,a);this.$$l_u.set(a,u)}this.$$l={}}}attributeChangedCallback(t,e,n){this.$$r||(t=this.$$g_p(t),this.$$d[t]=Ut(t,n,this.$$p_d,"toProp"),this.$$c?.$set({[t]:this.$$d[t]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(t){return Object.keys(this.$$p_d).find(e=>this.$$p_d[e].attribute===t||!this.$$p_d[e].attribute&&e.toLowerCase()===t)||t}});class Ft{$$=void 0;$$set=void 0;$destroy(){Lt(this,1),this.$destroy=t}$on(e,n){if(!s(n))return t;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const t=r.indexOf(n);-1!==t&&r.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function It(t){let e,n,r,o;const i=t[2].default,l=d(i,t,t[1],null);return{c(){e=D("form"),l&&l.c(),P(e,"class","column-card svelte-y86hrj")},m(i,c){A(i,e,c),l&&l.m(e,null),n=!0,r||(o=I(e,"submit",M(function(){s(t[0])&&t[0].apply(this,arguments)})),r=!0)},p(e,[r]){t=e,l&&l.p&&(!n||2&r)&&h(l,i,t,t[1],n?f(i,t[1],r,null):m(t[1]),null)},i(t){n||(bt(l,t),n=!0)},o(t){yt(l,t),n=!1},d(t){t&&_(e),l&&l.d(t),r=!1,o()}}}function Mt(t,e,n){let{$$slots:r={},$$scope:o}=e,{onSubmit:s}=e;return t.$$set=t=>{"onSubmit"in t&&n(0,s=t.onSubmit),"$$scope"in t&&n(1,o=t.$$scope)},[s,o,r]}"undefined"!=typeof window&&(window.__svelte||(window.__svelte={v:new Set})).v.add("4");const jt=class extends Ft{constructor(t){super(),Rt(this,t,Mt,It,i,{onSubmit:0})}};function Pt(t,e,n){const r=t.slice();return r[6]=e[n],r}function zt(t,e){let n,r,o,s,i,l,c,a,u,d=!1,p=e[6].label+"";return c=function(t){let e;return{p(...n){e=n,e.forEach(e=>t.push(e))},r(){e.forEach(e=>t.splice(t.indexOf(e),1))}}}(e[5][0]),{key:t,first:null,c(){n=D("label"),r=D("input"),i=U(),l=R(p),P(r,"type","radio"),P(r,"name",e[2]),r.__value=o=e[6].value,B(r,r.__value),r.checked=s=e[0]===e[6].value,P(n,"class","svelte-1tapr9t"),q(n,"selected",e[0]===e[6].value),c.p(r),this.first=n},m(t,o){A(t,n,o),T(n,r),r.checked=r.__value===e[0],T(n,i),T(n,l),a||(u=I(r,"change",e[4]),a=!0)},p(t,i){e=t,4&i&&P(r,"name",e[2]),2&i&&o!==(o=e[6].value)&&(r.__value=o,B(r,r.__value),d=!0),3&i&&s!==(s=e[0]===e[6].value)&&(r.checked=s),(d||3&i)&&(r.checked=r.__value===e[0]),2&i&&p!==(p=e[6].label+"")&&z(l,p),3&i&&q(n,"selected",e[0]===e[6].value)},d(t){t&&_(n),c.r(),a=!1,u()}}}function Bt(e){let n,r=[],o=new Map,s=Ct(e[1]);const i=t=>t[6].value;for(let t=0;t<s.length;t+=1){let n=Pt(e,s,t),l=i(n);o.set(l,r[t]=zt(l,n))}return{c(){n=D("div");for(let t=0;t<r.length;t+=1)r[t].c();P(n,"role","radiogroup"),P(n,"class",e[3])},m(t,e){A(t,n,e);for(let t=0;t<r.length;t+=1)r[t]&&r[t].m(n,null)},p(t,[e]){7&e&&(s=Ct(t[1]),r=Ot(r,e,i,1,t,s,o,n,Tt,zt,null,Pt)),8&e&&P(n,"class",t[3])},i:t,o:t,d(t){t&&_(n);for(let t=0;t<r.length;t+=1)r[t].d()}}}function qt(t,e,n){let{options:r}=e,{selected:o}=e,{name:s=`radio-${Math.random().toString().slice(2)}`}=e,{class:i}=e;return t.$$set=t=>{"options"in t&&n(1,r=t.options),"selected"in t&&n(0,o=t.selected),"name"in t&&n(2,s=t.name),"class"in t&&n(3,i=t.class)},[o,r,s,i,function(){o=this.__value,n(0,o)},[[]]]}const Ht=class extends Ft{constructor(t){super(),Rt(this,t,qt,Bt,i,{options:1,selected:0,name:2,class:3})}},Gt=[];function Wt(e,n=t){let r;const o=new Set;function s(t){if(i(e,t)&&(e=t,r)){const t=!Gt.length;for(const t of o)t[1](),Gt.push(t,e);if(t){for(let t=0;t<Gt.length;t+=2)Gt[t][0](Gt[t+1]);Gt.length=0}}}function l(t){s(t(e))}return{set:s,update:l,subscribe:function(i,c=t){const a=[i,c];return o.add(a),1===o.size&&(r=n(s,l)||t),i(e),()=>{o.delete(a),0===o.size&&r&&(r(),r=null)}}}}var Yt,Xt;!function(t){t[t.DEFAULT=0]="DEFAULT",t[t.REGEXP=1]="REGEXP",t[t.FUNCTION=2]="FUNCTION"}(Yt||(Yt={})),function(t){t[t.NONE=0]="NONE",t[t.REGEXP=1]="REGEXP",t[t.SELECTOR=2]="SELECTOR",t[t.FUNCTION=3]="FUNCTION"}(Xt||(Xt={}));const Kt={useTiny:!1,nextLink:Yt.DEFAULT,nextLinkRegex:'href="([^"]+)"[^>]*>\\s*Next',nextLinkFn:'return "https://www.reddit.com/r/HFY/comments/f94rak/oc_pthok_eats_an_ice_cream_cone/" // use `document` or `html` to extract',transform:Xt.SELECTOR,transformRegex:".md",transformSelector:".chapter-content, #content, .wp-content, main, body",transformFn:'title = "P\'Thok Eats an Ice Cream Cone" // or read from `title`\nhtml = "https://www.reddit.com/r/HFY/comments/f94rak/oc_pthok_eats_an_ice_cream_cone/" // use `document`, `html`, `url`'},Jt=Wt(Kt),Vt=t=>{const e=new Function("sandbox",`with (sandbox) {${t}\n}`),n=Object.create(null);n.console={log:console.log,table:console.table,error:console.error,assert:console.assert};const r=new Proxy(n,{has:Zt,get:Qt});return t=>(t&&Object.defineProperties(r,t),{proxy:r,ret:e(r)})};function Zt(t,e){return!0}function Qt(t,e){if(e!==Symbol.unscopables)return t[e]}function te(t){let e,n,r,o,s,i,l,c,a,u;return{c(){e=D("label"),n=R("Function: "),r=D("span"),r.textContent="Only input code you trust!",o=U(),s=D("textarea"),l=U(),c=D("span"),c.innerHTML="Globals <code>document</code> and <code>html</code> are available; Must produce the url as <code>return</code>",P(r,"class","small warning svelte-5v9ihf"),P(s,"rows","5"),P(s,"placeholder",i=Kt.nextLinkFn),P(s,"class","svelte-5v9ihf"),P(c,"class","small svelte-5v9ihf"),P(e,"class","field svelte-5v9ihf")},m(i,d){A(i,e,d),T(e,n),T(e,r),T(e,o),T(e,s),B(s,t[0].nextLinkFn),T(e,l),T(e,c),a||(u=I(s,"input",t[7]),a=!0)},p(t,e){1&e&&B(s,t[0].nextLinkFn)},d(t){t&&_(e),a=!1,u()}}}function ee(t){let e,n,r,o,s,i,l,c;return{c(){e=D("label"),n=R("Regex:\n          "),r=D("input"),s=U(),i=D("span"),i.textContent="Must produce the url in the first group",P(r,"type","text"),P(r,"placeholder",o=Kt.nextLinkRegex),P(r,"class","svelte-5v9ihf"),P(i,"class","small svelte-5v9ihf"),P(e,"class","field svelte-5v9ihf")},m(o,a){A(o,e,a),T(e,n),T(e,r),B(r,t[0].nextLinkRegex),T(e,s),T(e,i),l||(c=I(r,"input",t[6]),l=!0)},p(t,e){1&e&&r.value!==t[0].nextLinkRegex&&B(r,t[0].nextLinkRegex)},d(t){t&&_(e),l=!1,c()}}}function ne(e){let n;return{c(){n=D("span"),n.textContent='Finds a "First" link, with fallback to other links that aren\'t "Previous" or "Index" or "First"',P(n,"class","small svelte-5v9ihf")},m(t,e){A(t,n,e)},p:t,d(t){t&&_(n)}}}function re(t){let e,n,r,o,s,i,l,c,a,u;return{c(){e=D("label"),n=R("Function: "),r=D("span"),r.textContent="Only input code you trust!",o=U(),s=D("textarea"),l=U(),c=D("span"),c.innerHTML="Globals <code>document</code>, <code>html</code>, <code>title</code> and <code>url</code> are available; Modify the latter three to transform",P(r,"class","small warning svelte-5v9ihf"),P(s,"rows","5"),P(s,"placeholder",i=Kt.transformFn),P(s,"class","svelte-5v9ihf"),P(c,"class","small svelte-5v9ihf"),P(e,"class","field svelte-5v9ihf")},m(i,d){A(i,e,d),T(e,n),T(e,r),T(e,o),T(e,s),B(s,t[0].transformFn),T(e,l),T(e,c),a||(u=I(s,"input",t[11]),a=!0)},p(t,e){1&e&&B(s,t[0].transformFn)},d(t){t&&_(e),a=!1,u()}}}function oe(t){let e,n,r,o,s,i;return{c(){e=D("label"),n=R("Selector:\n          "),r=D("input"),P(r,"type","text"),P(r,"placeholder",o=Kt.transformSelector),P(r,"class","svelte-5v9ihf"),P(e,"class","field svelte-5v9ihf")},m(o,l){A(o,e,l),T(e,n),T(e,r),B(r,t[0].transformSelector),s||(i=I(r,"input",t[10]),s=!0)},p(t,e){1&e&&r.value!==t[0].transformSelector&&B(r,t[0].transformSelector)},d(t){t&&_(e),s=!1,i()}}}function se(t){let e,n,r,o,s,i,l,c;return{c(){e=D("label"),n=R("Regex:\n          "),r=D("input"),s=U(),i=D("span"),i.textContent="Must produce the new html in the first group",P(r,"type","text"),P(r,"placeholder",o=Kt.transformRegex),P(r,"class","svelte-5v9ihf"),P(i,"class","small svelte-5v9ihf"),P(e,"class","field svelte-5v9ihf")},m(o,a){A(o,e,a),T(e,n),T(e,r),B(r,t[0].transformRegex),T(e,s),T(e,i),l||(c=I(r,"input",t[9]),l=!0)},p(t,e){1&e&&r.value!==t[0].transformRegex&&B(r,t[0].transformRegex)},d(t){t&&_(e),l=!1,c()}}}function ie(t){let e,n,r,o,s,i,l,c,a,u,d,p,f,h,m,g,$,v,b,y,w,x,E,k,C,S,O;function N(e){t[5](e)}let L={options:[{value:Yt.DEFAULT,label:"Default"},{value:Yt.REGEXP,label:"Regex"},{value:Yt.FUNCTION,label:"Function"}],name:"radio-next-type"};function F(t,e){return t[0].nextLink===Yt.DEFAULT?ne:t[0].nextLink===Yt.REGEXP?ee:t[0].nextLink===Yt.FUNCTION?te:void 0}void 0!==t[0].nextLink&&(L.selected=t[0].nextLink),f=new Ht({props:L}),nt.push(()=>_t(f,"selected",N));let M=F(t),j=M&&M(t);function z(e){t[8](e)}let B={options:[{value:Xt.NONE,label:"No transform"},{value:Xt.REGEXP,label:"Regex"},{value:Xt.SELECTOR,label:"Query-Selector"},{value:Xt.FUNCTION,label:"Function"}],name:"radio-transform"};function q(t,e){return t[0].transform===Xt.REGEXP?se:t[0].transform===Xt.SELECTOR?oe:t[0].transform===Xt.FUNCTION?re:void 0}void 0!==t[0].transform&&(B.selected=t[0].transform),x=new Ht({props:B}),nt.push(()=>_t(x,"selected",z));let H=q(t),G=H&&H(t);return{c(){e=D("h3"),e.textContent="Editor",n=U(),r=D("div"),o=D("label"),s=D("input"),i=R("\n        Use TinyMCE, a powerful HTML editor, for editing chapters"),l=U(),c=D("h3"),c.textContent="Next chapter",a=U(),u=D("div"),d=D("p"),d.textContent="Specify how next chapter links are extracted.",p=U(),Nt(f.$$.fragment),m=U(),j&&j.c(),g=U(),$=D("h3"),$.textContent="Chapter transform",v=U(),b=D("div"),y=D("p"),y.textContent="Automatically transform chapter contents.",w=U(),Nt(x.$$.fragment),k=U(),G&&G.c(),P(s,"type","checkbox"),P(s,"class","svelte-5v9ihf"),P(o,"class","field svelte-5v9ihf")},m(h,E){A(h,e,E),A(h,n,E),A(h,r,E),T(r,o),T(o,s),s.checked=t[0].useTiny,T(o,i),A(h,l,E),A(h,c,E),A(h,a,E),A(h,u,E),T(u,d),T(u,p),Dt(f,u,null),T(u,m),j&&j.m(u,null),A(h,g,E),A(h,$,E),A(h,v,E),A(h,b,E),T(b,y),T(b,w),Dt(x,b,null),T(b,k),G&&G.m(b,null),C=!0,S||(O=I(s,"change",t[4]),S=!0)},p(t,e){1&e&&(s.checked=t[0].useTiny);const n={};!h&&1&e&&(h=!0,n.selected=t[0].nextLink,ct(()=>h=!1)),f.$set(n),M===(M=F(t))&&j?j.p(t,e):(j&&j.d(1),j=M&&M(t),j&&(j.c(),j.m(u,null)));const r={};!E&&1&e&&(E=!0,r.selected=t[0].transform,ct(()=>E=!1)),x.$set(r),H===(H=q(t))&&G?G.p(t,e):(G&&G.d(1),G=H&&H(t),G&&(G.c(),G.m(b,null)))},i(t){C||(bt(f.$$.fragment,t),bt(x.$$.fragment,t),C=!0)},o(t){yt(f.$$.fragment,t),yt(x.$$.fragment,t),C=!1},d(t){t&&(_(e),_(n),_(r),_(l),_(c),_(a),_(u),_(g),_($),_(v),_(b)),Lt(f),j&&j.d(),Lt(x),G&&G.d(),S=!1,O()}}}function le(t){let e,n,r,o;return{c(){e=D("span"),n=R("Transform Function invalid: "),r=D("code"),o=R(t[3]),P(e,"class","small error svelte-5v9ihf")},m(t,s){A(t,e,s),T(e,n),T(e,r),T(r,o)},p(t,e){8&e&&z(o,t[3])},d(t){t&&_(e)}}}function ce(t){let e,n,r,o;return{c(){e=D("span"),n=R("Transform Selector invalid: "),r=D("code"),o=R(t[3]),P(e,"class","small error svelte-5v9ihf")},m(t,s){A(t,e,s),T(e,n),T(e,r),T(r,o)},p(t,e){8&e&&z(o,t[3])},d(t){t&&_(e)}}}function ae(t){let e,n,r,o;return{c(){e=D("span"),n=R("Transform Regex invalid: "),r=D("code"),o=R(t[3]),P(e,"class","small error svelte-5v9ihf")},m(t,s){A(t,e,s),T(e,n),T(e,r),T(r,o)},p(t,e){8&e&&z(o,t[3])},d(t){t&&_(e)}}}function ue(t){let e,n,r,o;return{c(){e=D("span"),n=R("Chapter Function invalid: "),r=D("code"),o=R(t[2]),P(e,"class","small error svelte-5v9ihf")},m(t,s){A(t,e,s),T(e,n),T(e,r),T(r,o)},p(t,e){4&e&&z(o,t[2])},d(t){t&&_(e)}}}function de(t){let e,n,r,o;return{c(){e=D("span"),n=R("Chapter Regex invalid: "),r=D("code"),o=R(t[2]),P(e,"class","small error svelte-5v9ihf")},m(t,s){A(t,e,s),T(e,n),T(e,r),T(r,o)},p(t,e){4&e&&z(o,t[2])},d(t){t&&_(e)}}}function pe(t){let e,n,r,o,s,i,l,c,a,u;function d(t,e){return t[1]&&t[0].nextLink===Yt.REGEXP&&t[2]?de:t[1]&&t[0].nextLink===Yt.FUNCTION&&t[2]?ue:t[1]&&t[0].transform===Xt.REGEXP&&t[3]?ae:t[1]&&t[0].transform===Xt.SELECTOR&&t[3]?ce:t[1]&&t[0].transform===Xt.FUNCTION&&t[3]?le:void 0}n=new jt({props:{$$slots:{default:[ie]},$$scope:{ctx:t}}});let p=d(t),f=p&&p(t);return{c(){e=D("div"),Nt(n.$$.fragment),r=U(),o=D("button"),s=R("Save"),i=U(),f&&f.c(),l=F(),P(e,"class","settings svelte-5v9ihf"),P(o,"type","submit"),o.disabled=t[1]},m(d,p){A(d,e,p),Dt(n,e,null),A(d,r,p),A(d,o,p),T(o,s),A(d,i,p),f&&f.m(d,p),A(d,l,p),c=!0,a||(u=I(o,"click",t[12]),a=!0)},p(t,[e]){const r={};262145&e&&(r.$$scope={dirty:e,ctx:t}),n.$set(r),(!c||2&e)&&(o.disabled=t[1]),p===(p=d(t))&&f?f.p(t,e):(f&&f.d(1),f=p&&p(t),f&&(f.c(),f.m(l.parentNode,l)))},i(t){c||(bt(n.$$.fragment,t),c=!0)},o(t){yt(n.$$.fragment,t),c=!1},d(t){t&&(_(e),_(r),_(o),_(i),_(l)),Lt(n),f&&f.d(t),a=!1,u()}}}function fe(t,e,n){let r;u(t,Jt,t=>n(13,r=t));const o=Object.assign({},r),s=Object.assign({},r),i=(t,e)=>{if(!t.trim().length)return{error:"Must specify a regular expression",disableSave:!0};try{return new RegExp(t,"i"),{error:void 0,disableSave:e}}catch(t){return{error:t,disableSave:!0}}},l=(t,e)=>{if(!t.trim().length)return{error:"Must specify a function",disableSave:!0};try{return Vt(t),{error:void 0,disableSave:e}}catch(t){return{error:t,disableSave:!0}}};let c,a,d=!1;return Z(()=>n(1,d=!0)),t.$$.update=()=>{1&t.$$.dirty&&n(1,d=o.nextLink===s.nextLink&&o.nextLinkRegex===s.nextLinkRegex&&o.nextLinkFn===s.nextLinkFn&&o.transform===s.transform&&o.transformRegex===s.transformRegex&&o.transformSelector===s.transformSelector&&o.transformFn===s.transformFn&&o.useTiny===s.useTiny),3&t.$$.dirty&&o.nextLink===Yt.REGEXP&&n(1,({disableSave:d,error:c}=i(o.nextLinkRegex,d)),d,(n(2,c),n(0,o),n(1,d))),3&t.$$.dirty&&o.nextLink===Yt.FUNCTION&&n(1,({disableSave:d,error:c}=l(o.nextLinkFn,d)),d,(n(2,c),n(0,o),n(1,d))),3&t.$$.dirty&&o.transform===Xt.REGEXP&&n(1,({disableSave:d,error:a}=i(o.transformRegex,d)),d,(n(3,a),n(0,o),n(1,d))),3&t.$$.dirty&&o.transform===Xt.SELECTOR&&n(1,({disableSave:d,error:a}=((t,e)=>{if(!t.trim().length)return{error:"Must specify a selector",disableSave:!0};try{return document.querySelector(t),{error:void 0,disableSave:e}}catch(t){return{error:t,disableSave:!0}}})(o.transformSelector,d)),d,(n(3,a),n(0,o),n(1,d))),3&t.$$.dirty&&o.transform===Xt.FUNCTION&&n(1,({disableSave:d,error:a}=l(o.transformFn,d)),d,(n(3,a),n(0,o),n(1,d)))},[o,d,c,a,function(){o.useTiny=this.checked,n(0,o)},function(e){t.$$.not_equal(o.nextLink,e)&&(o.nextLink=e,n(0,o))},function(){o.nextLinkRegex=this.value,n(0,o)},function(){o.nextLinkFn=this.value,n(0,o)},function(e){t.$$.not_equal(o.transform,e)&&(o.transform=e,n(0,o))},function(){o.transformRegex=this.value,n(0,o)},function(){o.transformSelector=this.value,n(0,o)},function(){o.transformFn=this.value,n(0,o)},()=>{Jt.set(o),n(1,d=!0)}]}const he=class extends Ft{constructor(t){super(),Rt(this,t,fe,pe,i,{})}};var me=l(3),ge=l.n(me);function $e(t){let e,n,r;return{c(){e=D("a"),e.textContent="Back to Search",P(e,"href","#search"),P(e,"class","small")},m(o,i){A(o,e,i),n||(r=I(e,"click",M(function(){s(t[0])&&t[0].apply(this,arguments)})),n=!0)},p(e,n){t=e},d(t){t&&_(e),n=!1,r()}}}function ve(e){let n,r=e[0]&&$e(e);return{c(){r&&r.c(),n=F()},m(t,e){r&&r.m(t,e),A(t,n,e)},p(t,[e]){t[0]?r?r.p(t,e):(r=$e(t),r.c(),r.m(n.parentNode,n)):r&&(r.d(1),r=null)},i:t,o:t,d(t){t&&_(n),r&&r.d(t)}}}function be(t,e,n){let{backToSearch:r}=e;return t.$$set=t=>{"backToSearch"in t&&n(0,r=t.backToSearch)},[r]}const ye=class extends Ft{constructor(t){super(),Rt(this,t,be,ve,i,{backToSearch:0})}};function we(t,e,n){const r=t.slice();return r[4]=e[n],r}function xe(e){let n;return{c(){n=D("span"),n.textContent=`Sorry, can't process that${e[4]?": ":""}${e[4]?.message||e[4]||""}`,P(n,"class","error svelte-m4i2yw")},m(t,e){A(t,n,e)},p:t,d(t){t&&_(n)}}}function Ee(t){let e,n,r;return{c(){e=D("button"),e.textContent="Retry"},m(o,i){A(o,e,i),n||(r=I(e,"click",function(){s(t[0])&&t[0].apply(this,arguments)}),n=!0)},p(e,n){t=e},d(t){t&&_(e),n=!1,r()}}}function ke(t){let e,n,r;return{c(){e=D("a"),e.textContent="back",P(e,"href","#back")},m(o,i){A(o,e,i),n||(r=I(e,"click",M(function(){s(t[1])&&t[1].apply(this,arguments)})),n=!0)},p(e,n){t=e},d(t){t&&_(e),n=!1,r()}}}function Ce(e){let n,r,o,s,i=Ct(e[2]),l=[];for(let t=0;t<i.length;t+=1)l[t]=xe(we(e,i,t));let c=e[0]&&Ee(e),a=e[1]&&ke(e);return{c(){n=D("p");for(let t=0;t<l.length;t+=1)l[t].c();r=U(),c&&c.c(),o=U(),a&&a.c(),s=F()},m(t,e){A(t,n,e);for(let t=0;t<l.length;t+=1)l[t]&&l[t].m(n,null);A(t,r,e),c&&c.m(t,e),A(t,o,e),a&&a.m(t,e),A(t,s,e)},p(t,[e]){if(4&e){let r;for(i=Ct(t[2]),r=0;r<i.length;r+=1){const o=we(t,i,r);l[r]?l[r].p(o,e):(l[r]=xe(o),l[r].c(),l[r].m(n,null))}for(;r<l.length;r+=1)l[r].d(1);l.length=i.length}t[0]?c?c.p(t,e):(c=Ee(t),c.c(),c.m(o.parentNode,o)):c&&(c.d(1),c=null),t[1]?a?a.p(t,e):(a=ke(t),a.c(),a.m(s.parentNode,s)):a&&(a.d(1),a=null)},i:t,o:t,d(t){t&&(_(n),_(r),_(o),_(s)),N(l,t),c&&c.d(t),a&&a.d(t)}}}function Te(t,e,n){let{error:r}=e,{retry:o}=e,{back:s}=e,i=Array.isArray(r)?r:[r];return t.$$set=t=>{"error"in t&&n(3,r=t.error),"retry"in t&&n(0,o=t.retry),"back"in t&&n(1,s=t.back)},[o,s,i,r]}const Se=class extends Ft{constructor(t){super(),Rt(this,t,Te,Ce,i,{error:3,retry:0,back:1})}};function Oe(t){let e,n,r,o,s;const i=t[1].default,l=d(i,t,t[0],null),c=l||function(){let t;return{c(){t=R("Loading...")},m(e,n){A(e,t,n)},d(e){e&&_(t)}}}();return{c(){e=D("div"),n=D("div"),n.innerHTML='<span class="loading-slider svelte-w1n7v1">•</span>',r=U(),o=D("p"),c&&c.c(),P(n,"class","loading-slider-container svelte-w1n7v1"),P(o,"class","loading svelte-w1n7v1"),P(e,"class","loading-container svelte-w1n7v1")},m(t,i){A(t,e,i),T(e,n),T(e,r),T(e,o),c&&c.m(o,null),s=!0},p(t,[e]){l&&l.p&&(!s||1&e)&&h(l,i,t,t[0],s?f(i,t[0],e,null):m(t[0]),null)},i(t){s||(bt(c,t),s=!0)},o(t){yt(c,t),s=!1},d(t){t&&_(e),c&&c.d(t)}}}function Ae(t,e,n){let{$$slots:r={},$$scope:o}=e;return t.$$set=t=>{"$$scope"in t&&n(0,o=t.$$scope)},[o,r]}const _e=class extends Ft{constructor(t){super(),Rt(this,t,Ae,Oe,i,{})}};let Ne=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t|=0));for(;t--;)e+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&n[t]];return e};const De=Wt({authorize:void 0,fetch:void 0});window.registerFetch=({authorize:t,fetch:e})=>{if(!t||!t.apply)throw new Error("authorize does not look like a function");if(!e||!e.apply)throw new Error("fetch does not look like a function");console.log("Extension connected"),De.set({authorize:t,fetch:e})};const Le=async(t,e)=>{const n="undefined"!=typeof AbortController?new AbortController:{},r=setTimeout(()=>n.abort&&n.abort(),e);try{return await fetch(t,{signal:n.signal})}finally{clearTimeout(r)}},Re=async(t,e=1e4,n=3)=>{for(let r=0;r<n-1;r++)try{return await Le(t,e)}catch(e){console.log(`Failed to fetch \`${t}\` ${r+1} ${0===r?"time":"times"}. Retrying...`)}return Le(t,e)},Ue=async(t,e,n=1e4,r=3)=>{if(t.authorize&&!await t.authorize(e.origin))throw new Error("Extension did not authorize");for(let o=0;o<r-1;o++)try{return t.fetch?await t.fetch(e.toString()):await Le(e,n).then(t=>{var e;if(!t.ok)throw""+(null!==(e=t.statusText)&&void 0!==e?e:t.status);return t}).then(t=>t.text())}catch(t){console.log(`Failed to fetch \`${e}\` ${o+1} ${0===o?"time":"times"}. Retrying...`)}return t.fetch?await t.fetch(e.toString()):Le(e,n).then(t=>{var e;if(!t.ok)throw""+(null!==(e=t.statusText)&&void 0!==e?e:t.status);return t}).then(t=>t.text())},Fe=async(t,e,n,r=1e4,o=3)=>{var s,i;if(e.type===Ze.GENERIC)return await Ue(t,new URL(n,new URL(e.url).origin),r,o);const l=await(async(t,e,n=1e4,r=3)=>{const o=new URL(t,e);return Re(o,n,r)})(n,new URL(e.url).origin),c=await en(e,l);if(!l.ok)throw""+(null!==(i=null!==(s=c.message)&&void 0!==s?s:l.statusText)&&void 0!==i?i:l.status);return c};function Ie(t){const e=t-1;return e*e*e+1}const Me="www.reddit.com",je=t=>(t instanceof URL||(t=new URL(t)),t.hostname=Me,t.pathname.endsWith("/")?t.pathname=`${t.pathname.slice(0,t.pathname.length-1)}.json`:t.pathname.endsWith(".json")||(t.pathname+=".json"),t.protocol="https",t.search="",t.hash="",t.toString()),Pe=t=>{const e=new URL(t);return("reddit.com"===e.host||e.host.match(/\.reddit\.com$/))&&t.match(".json$")?t.slice(0,-5).replace("https://api","https://www"):t},ze=(()=>{const t=new DOMParser;return e=>{var n;return null!==(n=t.parseFromString(e,"text/html").documentElement.textContent)&&void 0!==n?n:""}})(),Be=(()=>{const t=new DOMParser;return e=>t.parseFromString(e,"text/html")})();function qe(t){return"string"==typeof t||t instanceof String}function He(t,{delay:e=0,duration:n=200,prop:r="height",easing:o=Ie}={}){const s=getComputedStyle(t)[r];if(!qe(s)||!s.endsWith("px"))throw new Error(`invalid property '${r}' does not return pixels`);const i=+s.slice(0,-2);return{delay:e,duration:n,easing:o,css:t=>`overflow: hidden; ${r}: ${t*i}px`}}const Ge=/(?:https?:\/\/(?:[^.]+\.)?reddit\.com)?\/r\/([^\/]+)\/comments\/.+/i,We=/href="((?:https?:\/\/(?:[^.]+\.)?reddit\.com)?\/r\/([^\/]+)\/comments\/[^"]+)"[^>]*>\s*([^<]+)/gim,Ye=/href="([^"]+)"[^>]*>\s*(.+)<\/a>/gim,Xe=/^https?:\/\/(?:[^.]+\.)?reddit\.com\/r\/hfy\/wiki\/series\//i,Ke=async t=>{const e=await Re(new URL(`https://${Me}/r/hfy/wiki/series.json`)),n=await e.json();if(!e.ok)throw n.message;const r=[...n.data.content_md.matchAll(/\[([^\]]+)\]\s*\(((?:https?:\/\/(?:[^.]+\.)?reddit\.com)?\/r\/hfy\/wiki\/series\/[^)]+)\)\s*(?:\[\*([^\]]+)\*\])?/gim)].map(t=>({title:t[1],author:t[3],url:je(t[2].startsWith("http")?t[2]:`https://${Me}${t[2]}`)}));if(!t)return r;const o=t.toLowerCase();return r.filter(t=>-1!==t.title.toLowerCase().indexOf(o))},Je=/^https?:\/\/(?:[^.]+\.)?reddit\.com\/r\/([^/]+)\/comments\//i,Ve=t=>({id:t[0].data.children[0].data.id,title:t[0].data.children[0].data.title,content:ze(t[0].data.children[0].data.selftext_html),apiUrl:je(t[0].data.children[0].data.url),displayUrl:t[0].data.children[0].data.url,needsFetching:!1});var Ze;!function(t){t[t.HFY_SERIES=0]="HFY_SERIES",t[t.POST=1]="POST",t[t.GENERIC=2]="GENERIC",t[t.SEARCH=3]="SEARCH"}(Ze||(Ze={}));const Qe=new DOMParser,tn=(t,e)=>t===Ze.GENERIC?e:je(e),en=(t,e)=>t.type===Ze.GENERIC?e.text():e.json(),nn=(t,e)=>{switch(t){case Ze.HFY_SERIES:return(({data:{content_md:t,content_html:e}})=>{var n,r,o,s,i,l;const c=(new DOMParser).parseFromString(ze(e),"text/html").querySelectorAll("a[href]");return{author:null!==(o=null===(r=null===(n=t.match(/\[\*\*(?:Author\s*[-:]\s*)?([^*\]]+)\*\*\]|A Story By \[(?:\*\*)?([^\]]+?)(?:\*\*)?\]/i))||void 0===n?void 0:n.slice(1).find(Boolean))||void 0===r?void 0:r.trim())&&void 0!==o?o:"unknown",title:null!==(l=null===(i=null===(s=t.match(/##?\s*\*\*(.+)\*\*/))||void 0===s?void 0:s[1])||void 0===i?void 0:i.trim())&&void 0!==l?l:"unknown",chapters:Array.from(c).filter(t=>t.getAttribute("href").match(Ge)).map((t,e)=>{var n,r;const o=t.getAttribute("href").startsWith("http")?t.getAttribute("href"):`https://www.reddit.com${t.getAttribute("href")}`;return{id:Ne(),title:null!==(r=null===(n=t.textContent)||void 0===n?void 0:n.trim())&&void 0!==r?r:`Chapter ${e}`,apiUrl:je(o),displayUrl:o}})}})(e);case Ze.POST:return(t=>({author:t[0].data.children[0].data.author,title:t[0].data.children[0].data.title,chapters:[Ve(t)]}))(e);case Ze.GENERIC:return(t=>{const e=Be(t);return{title:e.title,author:"unknown",chapters:Array.from(e.querySelectorAll("ul a, ol a")).map(t=>({displayUrl:t.href,apiUrl:t.href,id:Ne(),title:t.innerHTML}))}})(e)}throw new Error(`Getting data from source type \`${Ze[t]}\` not supported, this should never happen`)},rn=(t,e,n)=>{switch(t){case Ze.POST:case Ze.HFY_SERIES:return Ve(e);case Ze.GENERIC:return((t,e)=>{const n=Be(t);return{id:Ne(),apiUrl:e,displayUrl:e,title:n.title,content:n.body.innerHTML,needsFetching:!1}})(e,n)}throw new Error(`Getting data from source type \`${Ze[t]}\` not supported, this should never happen`)};let on,sn;const ln=(t,e)=>{switch(t.nextLink){case Yt.DEFAULT:return(t=>{const e=t.match(/href="([^"]+)"[^>]*>\s*Next/i);if(e)return e[1];const n=[...t.matchAll(We)].reverse().find(t=>{const e=t[3].toLowerCase();return!e.startsWith("first")&&!e.startsWith("prev")&&!e.startsWith("index")});if(n)return n[1];const r=[...t.matchAll(Ye)],o=r.find(t=>-1!==t[2].toLowerCase().indexOf("next"));if(o)return o[1];const s=r.reverse().find(t=>{const e=t[2].toLowerCase();return!e.startsWith("first")&&!e.startsWith("prev")&&!e.startsWith("index")});return s?s[1]:void 0})(e);case Yt.REGEXP:return(t=>{const e=t.match(on);if(e&&e.length>1)return e[1]})(e);case Yt.FUNCTION:return(t=>{let e;return sn({document:{get:()=>e=null!=e?e:Qe.parseFromString(t,"text/html"),configurable:!0},html:{writable:!1,value:t,configurable:!0}}).ret})(e)}};let cn;const an=t=>{const e=t.match(cn);return e&&e.length>1&&(t=e[1]),t};let un;const dn=(t,e)=>{switch(t.transform){case Xt.NONE:return Object.assign(Object.assign({},e),{transformedContent:e.content});case Xt.REGEXP:return Object.assign(Object.assign({},e),{transformedContent:an(e.content||"")});case Xt.SELECTOR:return Object.assign(Object.assign({},e),{transformedContent:(n=t.transformSelector,r=e.content||"",null!==(s=null===(o=Qe.parseFromString(r,"text/html").querySelector(n))||void 0===o?void 0:o.innerHTML)&&void 0!==s?s:r)});case Xt.FUNCTION:return(t=>{let e;const n={document:{get:()=>e=null!=e?e:Qe.parseFromString(t.content||"","text/html"),configurable:!0},title:{writable:!0,value:t.title,configurable:!0},html:{writable:!0,value:t.content,configurable:!0},url:{writable:!0,value:t.displayUrl,configurable:!0}},{proxy:r}=un(n);return Object.assign(Object.assign({},t),{title:qe(r.title)?r.title:t.title,transformedContent:qe(r.html)?r.html:t.content,displayUrl:qe(r.url)?r.url:t.displayUrl})})(e)}var n,r,o,s},pn=(t,e)=>e.map(dn.bind(null,t));var fn;Jt.subscribe(t=>{try{on=new RegExp(t.nextLinkRegex,"i"),cn=new RegExp(t.transformRegex,"i"),sn=Vt(t.nextLinkFn),un=Vt(t.transformFn)}catch(t){console.error(t)}}),function(t){t[t.INPUT=0]="INPUT",t[t.SEARCH=1]="SEARCH",t[t.BOOK_DATA=2]="BOOK_DATA",t[t.EDIT_DATA=3]="EDIT_DATA",t[t.FIND_CHAPTERS=4]="FIND_CHAPTERS",t[t.DOWNLOAD_CHAPTERS=5]="DOWNLOAD_CHAPTERS",t[t.RESULT=6]="RESULT",t[t.SETTINGS=7]="SETTINGS",t[t._404=8]="_404"}(fn||(fn={}));const hn=t=>t===fn.INPUT?l.p:`${l.p}${fn[t].toLowerCase().replace(/_/g,"-")}`;class mn{constructor(){this.stage=fn.INPUT}dump(){return[]}}class gn extends mn{constructor(){super(...arguments),this.stage=fn.INPUT}next(t){const e=(t=>{try{return new URL(t),(t=>!!t.match(Xe))(t)?Ze.HFY_SERIES:(t=>!!t.match(Je))(t)?Ze.POST:Ze.GENERIC}catch(t){}return Ze.SEARCH})(t);return console.debug("Input",t,"resulted in type",e),An.update(n=>Object.assign(Object.assign({},n),{search:t,series:e!==Ze.SEARCH?{url:tn(e,t),type:e}:n.series})),_n.update(()=>{}),e===Ze.SEARCH?Cn($n):Cn(vn)}fromList(t){const e=t.split("\n").map(t=>t.trim()).filter(t=>!!t);return e.forEach(t=>{try{new URL(t)}catch(e){throw new Error(`${t}: ${e.message||e}`)}}),An.update(t=>Object.assign(Object.assign({},t),{series:{url:e[0],type:Ze.GENERIC}})),_n.update(()=>({author:"unknown",title:"unknown",chapters:e.map((t,e)=>({apiUrl:t,id:Ne(),title:`Chapter ${e}`,displayUrl:t}))})),Cn(vn)}fromJSON({series:t,bookData:e}){return An.update(e=>Object.assign(Object.assign({},e),{series:t})),_n.update(()=>e),Cn(vn)}}class $n extends mn{constructor(){super(...arguments),this.stage=fn.SEARCH}next(t){return An.update(e=>Object.assign(Object.assign({},e),{series:t})),_n.update(()=>{}),Cn(vn)}}class vn extends mn{constructor(t=void 0){super(),this.newChapters=t,this.stage=fn.BOOK_DATA}next(){return Cn(xn)}edit(){return Cn(bn)}findMore(){return Cn(yn)}downloadAll(){return Cn(wn)}dump(){return[this.newChapters]}}class bn extends mn{constructor(){super(...arguments),this.stage=fn.EDIT_DATA,this.needsSaving=!0}next(t){return _n.update(()=>t),Cn(vn)}fetch(t){return _n.update(()=>t),Cn(wn)}}class yn extends mn{constructor(){super(...arguments),this.stage=fn.FIND_CHAPTERS,this.needsSaving=!0}next(t,e){return _n.update(()=>t),Cn(vn,e)}}class wn extends mn{constructor(){super(...arguments),this.stage=fn.DOWNLOAD_CHAPTERS,this.needsSaving=!0}next(t){return _n.update(()=>t),Cn(vn)}}class xn extends mn{constructor(){super(...arguments),this.stage=fn.RESULT}next(){return Cn(vn)}}class En extends mn{constructor(){super(...arguments),this.stage=fn.SETTINGS}next(){return Sn()}}const kn={[fn.INPUT]:gn,[fn.SEARCH]:$n,[fn.BOOK_DATA]:vn,[fn.EDIT_DATA]:bn,[fn.FIND_CHAPTERS]:yn,[fn.DOWNLOAD_CHAPTERS]:wn,[fn.RESULT]:xn,[fn.SETTINGS]:En,[fn._404]:class extends mn{constructor(){super(...arguments),this.stage=fn._404}next(){return Sn()}}};function Cn(t,...e){An.update(n=>{const r=new t(...e);r.from=n.stage;const o=r.dump();try{r.stage===fn.SETTINGS?history.pushState({data:o,search:n.search,series:n.series},"",hn(r.stage)):history.replaceState({data:o,search:n.search,series:n.series},"",hn(r.stage))}catch(t){console.error("Data too large! Caution, forwards/backwards won't work as expected!"),o.length>0&&(o[0]=void 0),r.stage===fn.SETTINGS?history.pushState({data:o,search:n.search,series:n.series},"",hn(r.stage)):history.replaceState({data:o,search:n.search,series:n.series},"",hn(r.stage))}return Object.assign(Object.assign({},n),{stage:r,lastBookData:t.usesBookData?r.bookData:n.lastBookData})})}function Tn(t,{data:e,search:n,series:r}={series:{type:Ze.GENERIC,url:""}}){e=e||[],An.update(o=>{try{const s=new kn[t](...e);return s.stage===o.stage.stage?o:(s.from=o.stage,Object.assign(Object.assign({},o),{search:n,series:r,stage:s}))}catch(r){return console.group("Failed to update page"),console.error(r),console.log("Parameters:",t,e,n),console.groupEnd(),history.pushState({data:[],search:o.search,series:o.series},"","/"),o}})}function Sn(){history.back()}function On(t,e){return!!t&&t.stage===e}const An=Wt({stage:new gn,series:{type:Ze.GENERIC,url:""}}),_n=Wt(void 0),Nn=new RegExp("^"+l.p.replace("/","/")),Dn=()=>{const t=location.pathname.replace(Nn,"").split("/")[0]||"";if(t.length>60)return;if(""===t)return Tn(fn.INPUT);const e=t.toUpperCase().replace(/-/g,"_"),n=(()=>{var t;try{return JSON.parse(null!==(t=localStorage.getItem("state"))&&void 0!==t?t:"")}catch(t){return}})(),r=Object.assign(Object.assign({},n),history.state||{});return e in fn?Tn(fn[e],r):Tn(fn._404)},Ln=t=>{const e=Object.assign(Object.assign({},t),{cover:void 0});return t.cover&&(e.cover=new File([new Uint8Array(t.cover.data)],t.cover.name)),e},Rn=async t=>{const e=Object.assign(Object.assign({},t),{cover:void 0});if(t.cover){const n=await t.cover.arrayBuffer();e.cover={name:t.cover.name,data:Array.from(new Uint8Array(n))}}return e};function Un(t,e,n){const r=t.slice();return r[9]=e[n][0],r[10]=e[n][1],r[11]=e[n][2],r}function Fn(t,e,n){const r=t.slice();return r[9]=e[n][0],r[10]=e[n][1],r[11]=e[n][2],r}function In(t){let e,n,r,o,i,l,c,a;return e=new Se({props:{error:t[17],retry:t[7]}}),i=new ye({props:{backToSearch:t[1]}}),{c(){Nt(e.$$.fragment),n=U(),r=D("button"),r.textContent="Back to book",o=U(),Nt(i.$$.fragment)},m(u,d){Dt(e,u,d),A(u,n,d),A(u,r,d),A(u,o,d),Dt(i,u,d),l=!0,c||(a=I(r,"click",function(){s(t[0].next.bind(t[0]))&&t[0].next.bind(t[0]).apply(this,arguments)}),c=!0)},p(n,r){t=n;const o={};8&r&&(o.error=t[17]),8&r&&(o.retry=t[7]),e.$set(o);const s={};2&r&&(s.backToSearch=t[1]),i.$set(s)},i(t){l||(bt(e.$$.fragment,t),bt(i.$$.fragment,t),l=!0)},o(t){yt(e.$$.fragment,t),yt(i.$$.fragment,t),l=!1},d(t){t&&(_(n),_(r),_(o)),Lt(e,t),Lt(i,t),c=!1,a()}}}function Mn(t){let e,n,r,i,l,c,a,u,d,p,f,h,m=t[2].find(Xn);function g(){return t[6](t[14])}a=new ye({props:{backToSearch:t[1]}});let $=m&&jn(t);return{c(){e=D("h3"),e.textContent="Your e-book is ready!",n=U(),r=D("button"),r.textContent="Download",i=U(),l=D("button"),l.textContent="Back to book",c=U(),Nt(a.$$.fragment),u=U(),$&&$.c(),d=F(),P(e,"class","valid svelte-ardw9p")},m(o,m){A(o,e,m),A(o,n,m),A(o,r,m),A(o,i,m),A(o,l,m),A(o,c,m),Dt(a,o,m),A(o,u,m),$&&$.m(o,m),A(o,d,m),p=!0,f||(h=[I(r,"click",g),I(l,"click",function(){s(t[0].next.bind(t[0]))&&t[0].next.bind(t[0]).apply(this,arguments)})],f=!0)},p(e,n){t=e;const r={};2&n&&(r.backToSearch=t[1]),a.$set(r),4&n&&(m=t[2].find(Xn)),m?$?$.p(t,n):($=jn(t),$.c(),$.m(d.parentNode,d)):$&&($.d(1),$=null)},i(t){p||(bt(a.$$.fragment,t),p=!0)},o(t){yt(a.$$.fragment,t),p=!1},d(t){t&&(_(e),_(n),_(r),_(i),_(l),_(c),_(u),_(d)),Lt(a,t),$&&$.d(t),f=!1,o(h)}}}function jn(t){let e,n=Ct(t[2]),r=[];for(let e=0;e<n.length;e+=1)r[e]=Bn(Un(t,n,e));return{c(){e=D("div");for(let t=0;t<r.length;t+=1)r[t].c();P(e,"class","logs svelte-ardw9p")},m(t,n){A(t,e,n);for(let t=0;t<r.length;t+=1)r[t]&&r[t].m(e,null)},p(t,o){if(4&o){let s;for(n=Ct(t[2]),s=0;s<n.length;s+=1){const i=Un(t,n,s);r[s]?r[s].p(i,o):(r[s]=Bn(i),r[s].c(),r[s].m(e,null))}for(;s<r.length;s+=1)r[s].d(1);r.length=n.length}},d(t){t&&_(e),N(r,t)}}}function Pn(t){let e,n,r=t[10]+"",o=t[11]>1&&zn(t);return{c(){e=D("p"),n=R(r),o&&o.c(),P(e,"class","small warning svelte-ardw9p")},m(t,r){A(t,e,r),T(e,n),o&&o.m(e,null)},p(t,s){4&s&&r!==(r=t[10]+"")&&z(n,r),t[11]>1?o?o.p(t,s):(o=zn(t),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},d(t){t&&_(e),o&&o.d()}}}function zn(t){let e,n,r,o=t[11]+"";return{c(){e=R(" ("),n=R(o),r=R(" times)")},m(t,o){A(t,e,o),A(t,n,o),A(t,r,o)},p(t,e){4&e&&o!==(o=t[11]+"")&&z(n,o)},d(t){t&&(_(e),_(n),_(r))}}}function Bn(t){let e,n="warn"===t[9]&&Pn(t);return{c(){n&&n.c(),e=F()},m(t,r){n&&n.m(t,r),A(t,e,r)},p(t,r){"warn"===t[9]?n?n.p(t,r):(n=Pn(t),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},d(t){t&&_(e),n&&n.d(t)}}}function qn(t){let e,n,r,o;e=new _e({props:{$$slots:{default:[Hn]},$$scope:{ctx:t}}});let s=Ct(t[2]),i=[];for(let e=0;e<s.length;e+=1)i[e]=Wn(Fn(t,s,e));return{c(){Nt(e.$$.fragment),n=U(),r=D("div");for(let t=0;t<i.length;t+=1)i[t].c();P(r,"class","logs svelte-ardw9p")},m(t,s){Dt(e,t,s),A(t,n,s),A(t,r,s);for(let t=0;t<i.length;t+=1)i[t]&&i[t].m(r,null);o=!0},p(t,n){const o={};if(262144&n&&(o.$$scope={dirty:n,ctx:t}),e.$set(o),4&n){let e;for(s=Ct(t[2]),e=0;e<s.length;e+=1){const o=Fn(t,s,e);i[e]?i[e].p(o,n):(i[e]=Wn(o),i[e].c(),i[e].m(r,null))}for(;e<i.length;e+=1)i[e].d(1);i.length=s.length}},i(t){o||(bt(e.$$.fragment,t),o=!0)},o(t){yt(e.$$.fragment,t),o=!1},d(t){t&&(_(n),_(r)),Lt(e,t),N(i,t)}}}function Hn(t){let e;return{c(){e=R("Please wait, generating e-book...")},m(t,n){A(t,e,n)},d(t){t&&_(e)}}}function Gn(t){let e,n,r,o=t[11]+"";return{c(){e=R(" ("),n=R(o),r=R(" times)")},m(t,o){A(t,e,o),A(t,n,o),A(t,r,o)},p(t,e){4&e&&o!==(o=t[11]+"")&&z(n,o)},d(t){t&&(_(e),_(n),_(r))}}}function Wn(t){let e,n,r=t[10]+"",o=t[11]>1&&Gn(t);return{c(){e=D("p"),n=R(r),o&&o.c(),P(e,"class","small svelte-ardw9p"),q(e,"warning","warn"===t[9])},m(t,r){A(t,e,r),T(e,n),o&&o.m(e,null)},p(t,s){4&s&&r!==(r=t[10]+"")&&z(n,r),t[11]>1?o?o.p(t,s):(o=Gn(t),o.c(),o.m(e,null)):o&&(o.d(1),o=null),4&s&&q(e,"warning","warn"===t[9])},d(t){t&&_(e),o&&o.d()}}}function Yn(t){let e,n,r,o={ctx:t,current:null,token:null,hasCatch:!0,pending:qn,then:Mn,catch:In,value:14,error:17,blocks:[,,,]};return Et(n=t[3],o),{c(){e=F(),o.block.c()},m(t,n){A(t,e,n),o.block.m(t,o.anchor=n),o.mount=()=>e.parentNode,o.anchor=e,r=!0},p(e,[r]){t=e,o.ctx=t,8&r&&n!==(n=t[3])&&Et(n,o)||kt(o,t,r)},i(t){r||(bt(o.block),r=!0)},o(t){for(let t=0;t<3;t+=1)yt(o.blocks[t]);r=!1},d(t){t&&_(e),o.block.d(t),o.token=null,o=null}}}const Xn=([t])=>"warn"===t;function Kn(t,e,n){let r;u(t,_n,t=>n(4,r=t));let{stage:o}=e,{backToSearch:s}=e;const i=Promise.all([l.e(299),l.e(305)]).then(l.t.bind(l,299,23));if(!r)throw new Error("Inconsistent state, expected to have book data");let c=[];const a=async()=>{n(2,c=[]);const{default:t}=await i;return await t({title:r.title,author:r.author,description:r.description,cover:r.cover,ignoreFailedDownloads:!0,verbose:(t,e,...r)=>{const o=[e,...r].join(" "),s=c.find(t=>t[1]===o);s?++s[2]:c.push([t,o,1]),n(2,c)}},r.chapters.map(t=>{var e;return{title:t.title,content:null!==(e=t.transformedContent)&&void 0!==e?e:"<i>Content missing</i>",url:t.displayUrl}}))};let d=a();return t.$$set=t=>{"stage"in t&&n(0,o=t.stage),"backToSearch"in t&&n(1,s=t.backToSearch)},[o,s,c,d,r,a,t=>ge()(t,`${r.author} - ${r.title}.epub`,"application/epub+zip"),()=>n(3,d=a())]}const Jn=class extends Ft{constructor(t){super(),Rt(this,t,Kn,Yn,i,{stage:0,backToSearch:1})}};function Vn(t){let e,n;const r=t[1].default,o=d(r,t,t[0],null);return{c(){e=D("p"),o&&o.c(),P(e,"class","info alert svelte-1mwdlru")},m(t,r){A(t,e,r),o&&o.m(e,null),n=!0},p(t,[e]){o&&o.p&&(!n||1&e)&&h(o,r,t,t[0],n?f(r,t[0],e,null):m(t[0]),null)},i(t){n||(bt(o,t),n=!0)},o(t){yt(o,t),n=!1},d(t){t&&_(e),o&&o.d(t)}}}function Zn(t,e,n){let{$$slots:r={},$$scope:o}=e;return t.$$set=t=>{"$$scope"in t&&n(0,o=t.$$scope)},[o,r]}const Qn=class extends Ft{constructor(t){super(),Rt(this,t,Zn,Vn,i,{})}};function tr(t){let e,n;return e=new Qn({props:{$$slots:{default:[er]},$$scope:{ctx:t}}}),{c(){Nt(e.$$.fragment)},m(t,r){Dt(e,t,r),n=!0},i(t){n||(bt(e.$$.fragment,t),n=!0)},o(t){yt(e.$$.fragment,t),n=!1},d(t){Lt(e,t)}}}function er(e){let n,r,o;return{c(){n=R("Due to "),r=D("a"),r.textContent="recent API changes on reddit",o=R(', creating ebooks has become limited. If you run into a "Too many requests" error, please wait 10 minutes before trying again.'),P(r,"href","https://www.redditinc.com/blog/apifacts"),P(r,"target","_blank")},m(t,e){A(t,n,e),A(t,r,e),A(t,o,e)},p:t,d(t){t&&(_(n),_(r),_(o))}}}function nr(t){let e,n;return e=new Qn({props:{$$slots:{default:[rr]},$$scope:{ctx:t}}}),{c(){Nt(e.$$.fragment)},m(t,r){Dt(e,t,r),n=!0},i(t){n||(bt(e.$$.fragment,t),n=!0)},o(t){yt(e.$$.fragment,t),n=!1},d(t){Lt(e,t)}}}function rr(e){let n,r,o,s,i;return{c(){n=R("You are using non-reddit URLs. Please be aware of "),r=D("code"),r.textContent="NetworkError",o=R("s, see "),s=D("a"),s.textContent="CORS",i=R(". This is a security feature of the browser."),P(s,"href","https://github.com/cpiber/hfy-epub/blob/master/docs/other/cors.md"),P(s,"target","_blank")},m(t,e){A(t,n,e),A(t,r,e),A(t,o,e),A(t,s,e),A(t,i,e)},p:t,d(t){t&&(_(n),_(r),_(o),_(s),_(i))}}}function or(t){let e,n,r,o=t[0]&&tr(t),s=t[1]&&!t[2].authorize&&nr(t);return{c(){o&&o.c(),e=U(),s&&s.c(),n=F()},m(t,i){o&&o.m(t,i),A(t,e,i),s&&s.m(t,i),A(t,n,i),r=!0},p(t,[r]){t[0]?o?1&r&&bt(o,1):(o=tr(t),o.c(),bt(o,1),o.m(e.parentNode,e)):o&&($t(),yt(o,1,1,()=>{o=null}),vt()),t[1]&&!t[2].authorize?s?6&r&&bt(s,1):(s=nr(t),s.c(),bt(s,1),s.m(n.parentNode,n)):s&&($t(),yt(s,1,1,()=>{s=null}),vt())},i(t){r||(bt(o),bt(s),r=!0)},o(t){yt(o),yt(s),r=!1},d(t){t&&(_(e),_(n)),o&&o.d(t),s&&s.d(t)}}}function sr(t,e,n){let r;u(t,De,t=>n(2,r=t));let{hasReddit:o=!1}=e,{hasOther:s=!1}=e;return t.$$set=t=>{"hasReddit"in t&&n(0,o=t.hasReddit),"hasOther"in t&&n(1,s=t.hasOther)},[o,s,r]}const ir=class extends Ft{constructor(t){super(),Rt(this,t,sr,or,i,{hasReddit:0,hasOther:1})}};function lr(t,e,n){const r=t.slice();return r[13]=e[n],r}function cr(t,e,n){const r=t.slice();return r[13]=e[n],r}function ar(e){return{c:t,m:t,p:t,i:t,o:t,d:t}}function ur(t){let e,n,r,o,s,i=!t[3].length&&dr(t),l=Ct(t[1]),c=[];for(let e=0;e<l.length;e+=1)c[e]=fr(lr(t,l,e));let a=t[3].length&&hr(t);return{c(){i&&i.c(),e=U(),n=D("div");for(let t=0;t<c.length;t+=1)c[t].c();r=U(),a&&a.c(),o=F(),P(n,"class","chapters svelte-1rrnlr6")},m(t,l){i&&i.m(t,l),A(t,e,l),A(t,n,l);for(let t=0;t<c.length;t+=1)c[t]&&c[t].m(n,null);A(t,r,l),a&&a.m(t,l),A(t,o,l),s=!0},p(t,r){if(t[3].length?i&&(i.d(1),i=null):i?i.p(t,r):(i=dr(t),i.c(),i.m(e.parentNode,e)),2&r){let e;for(l=Ct(t[1]),e=0;e<l.length;e+=1){const o=lr(t,l,e);c[e]?c[e].p(o,r):(c[e]=fr(o),c[e].c(),c[e].m(n,null))}for(;e<c.length;e+=1)c[e].d(1);c.length=l.length}t[3].length?a?(a.p(t,r),8&r&&bt(a,1)):(a=hr(t),a.c(),bt(a,1),a.m(o.parentNode,o)):a&&($t(),yt(a,1,1,()=>{a=null}),vt())},i(t){s||(bt(a),s=!0)},o(t){yt(a),s=!1},d(t){t&&(_(e),_(n),_(r),_(o)),i&&i.d(t),N(c,t),a&&a.d(t)}}}function dr(t){let e,n=t[0].next(t[16])+"";return{c(){e=R(n)},m(t,n){A(t,e,n)},p(t,r){17&r&&n!==(n=t[0].next(t[16])+"")&&z(e,n)},d(t){t&&_(e)}}}function pr(t){let e,n,r=t[13].title+"";return{c(){e=D("p"),n=R(r),P(e,"class","valid small svelte-1rrnlr6")},m(t,r){A(t,e,r),T(e,n)},p(t,e){2&e&&r!==(r=t[13].title+"")&&z(n,r)},d(t){t&&_(e)}}}function fr(t){let e,n=t[13]&&!0===t[13].new&&pr(t);return{c(){n&&n.c(),e=F()},m(t,r){n&&n.m(t,r),A(t,e,r)},p(t,r){t[13]&&!0===t[13].new?n?n.p(t,r):(n=pr(t),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},d(t){t&&_(e),n&&n.d(t)}}}function hr(e){let n,r,o=e[3],s=mr(e);return{c(){s.c(),n=F()},m(t,e){s.m(t,e),A(t,n,e),r=!0},p(e,r){8&r&&i(o,o=e[3])?($t(),yt(s,1,1,t),vt(),s=mr(e),s.c(),bt(s,1),s.m(n.parentNode,n)):s.p(e,r)},i(t){r||(bt(s),r=!0)},o(t){yt(s),r=!1},d(t){t&&_(n),s.d(t)}}}function mr(t){let e,n;return e=new Se({props:{error:t[3],retry:t[8],back:t[9]}}),{c(){Nt(e.$$.fragment)},m(t,r){Dt(e,t,r),n=!0},p(t,n){const r={};8&n&&(r.error=t[3]),16&n&&(r.retry=t[8]),35&n&&(r.back=t[9]),e.$set(r)},i(t){n||(bt(e.$$.fragment,t),n=!0)},o(t){yt(e.$$.fragment,t),n=!1},d(t){Lt(e,t)}}}function gr(t){let e,n,r,o,s,i,l,c,a,u,d;e=new _e({props:{$$slots:{default:[$r]},$$scope:{ctx:t}}});let p=Ct(t[1]),f=[];for(let e=0;e<p.length;e+=1)f[e]=br(cr(t,p,e));let h=t[3].length&&yr(t);return{c(){Nt(e.$$.fragment),n=U(),r=D("button"),o=R("Cancel"),s=U(),i=D("div");for(let t=0;t<f.length;t+=1)f[t].c();l=U(),h&&h.c(),c=F(),r.disabled=t[2],P(i,"class","chapters svelte-1rrnlr6")},m(p,m){Dt(e,p,m),A(p,n,m),A(p,r,m),T(r,o),A(p,s,m),A(p,i,m);for(let t=0;t<f.length;t+=1)f[t]&&f[t].m(i,null);A(p,l,m),h&&h.m(p,m),A(p,c,m),a=!0,u||(d=I(r,"click",M(t[7])),u=!0)},p(t,n){const o={};if(524288&n&&(o.$$scope={dirty:n,ctx:t}),e.$set(o),(!a||4&n)&&(r.disabled=t[2]),2&n){let e;for(p=Ct(t[1]),e=0;e<p.length;e+=1){const r=cr(t,p,e);f[e]?f[e].p(r,n):(f[e]=br(r),f[e].c(),f[e].m(i,null))}for(;e<f.length;e+=1)f[e].d(1);f.length=p.length}t[3].length?h?(h.p(t,n),8&n&&bt(h,1)):(h=yr(t),h.c(),bt(h,1),h.m(c.parentNode,c)):h&&($t(),yt(h,1,1,()=>{h=null}),vt())},i(t){a||(bt(e.$$.fragment,t),bt(h),a=!0)},o(t){yt(e.$$.fragment,t),yt(h),a=!1},d(t){t&&(_(n),_(r),_(s),_(i),_(l),_(c)),Lt(e,t),N(f,t),h&&h.d(t),u=!1,d()}}}function $r(t){let e;return{c(){e=R("Please wait, fetching chapters...")},m(t,n){A(t,e,n)},d(t){t&&_(e)}}}function vr(t){let e,n,r=t[13].title+"";return{c(){e=D("p"),n=R(r),P(e,"class","valid small svelte-1rrnlr6")},m(t,r){A(t,e,r),T(e,n)},p(t,e){2&e&&r!==(r=t[13].title+"")&&z(n,r)},d(t){t&&_(e)}}}function br(t){let e,n=t[13]&&!0===t[13].new&&vr(t);return{c(){n&&n.c(),e=F()},m(t,r){n&&n.m(t,r),A(t,e,r)},p(t,r){t[13]&&!0===t[13].new?n?n.p(t,r):(n=vr(t),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},d(t){t&&_(e),n&&n.d(t)}}}function yr(e){let n,r,o=e[3],s=wr(e);return{c(){s.c(),n=F()},m(t,e){s.m(t,e),A(t,n,e),r=!0},p(e,r){8&r&&i(o,o=e[3])?($t(),yt(s,1,1,t),vt(),s=wr(e),s.c(),bt(s,1),s.m(n.parentNode,n)):s.p(e,r)},i(t){r||(bt(s),r=!0)},o(t){yt(s),r=!1},d(t){t&&_(n),s.d(t)}}}function wr(t){let e,n;return e=new Se({props:{error:t[3]}}),{c(){Nt(e.$$.fragment)},m(t,r){Dt(e,t,r),n=!0},p(t,n){const r={};8&n&&(r.error=t[3]),e.$set(r)},i(t){n||(bt(e.$$.fragment,t),n=!0)},o(t){yt(e.$$.fragment,t),n=!1},d(t){Lt(e,t)}}}function xr(t){let e,n,r,o,s;e=new ir({props:{hasReddit:!!t[5].chapters.find(Er),hasOther:!!t[5].chapters.find(kr)}});let i={ctx:t,current:null,token:null,hasCatch:!1,pending:gr,then:ur,catch:ar,value:16,blocks:[,,,]};return Et(o=t[4],i),{c(){Nt(e.$$.fragment),n=U(),r=F(),i.block.c()},m(t,o){Dt(e,t,o),A(t,n,o),A(t,r,o),i.block.m(t,i.anchor=o),i.mount=()=>r.parentNode,i.anchor=r,s=!0},p(n,[r]){t=n;const s={};32&r&&(s.hasReddit=!!t[5].chapters.find(Er)),32&r&&(s.hasOther=!!t[5].chapters.find(kr)),e.$set(s),i.ctx=t,16&r&&o!==(o=t[4])&&Et(o,i)||kt(i,t,r)},i(t){s||(bt(e.$$.fragment,t),bt(i.block),s=!0)},o(t){yt(e.$$.fragment,t);for(let t=0;t<3;t+=1)yt(i.blocks[t]);s=!1},d(t){t&&(_(n),_(r)),Lt(e,t),i.block.d(t),i.token=null,i=null}}}const Er=t=>t.apiUrl.indexOf("reddit.com")>=0,kr=t=>t.apiUrl.indexOf("reddit.com")<0;function Cr(t,e,n){let r,o,s,i;u(t,_n,t=>n(5,r=t)),u(t,An,t=>n(10,o=t)),u(t,Jt,t=>n(11,s=t)),u(t,De,t=>n(12,i=t));let{stage:l}=e;if(!r)throw new Error("Inconsistent state, expected to have book data");let c=[...r.chapters.map(t=>Object.assign(Object.assign({},t),{new:!1}))],a=!1,d=[];const p=async()=>{let t,e=c;for(n(1,c=new Array(c.length)),n(3,d=[]),t=0;t<e.length&&!a;t+=10)await Promise.all(e.slice(t,t+10).map(async(r,l)=>{if(n(1,c[l+t]=Object.assign({},e[l+t]),c),!1!==r.needsFetching)try{const e=await Fe(i,o.series,r.apiUrl);n(1,c[l+t]=Object.assign(Object.assign({},dn(s,rn(o.series.type,e,r.apiUrl))),{new:!0}),c),n(1,c)}catch(t){d.push(t),n(3,d)}}));for(;t<e.length;t++)n(1,c[t]=Object.assign({},e[t]),c);return Object.assign(Object.assign({},r),{chapters:c})};let f=p();return t.$$set=t=>{"stage"in t&&n(0,l=t.stage)},[l,c,a,d,f,r,p,()=>n(2,a=!0),()=>n(4,f=p()),()=>l.next({...r,chapters:c})]}const Tr=class extends Ft{constructor(t){super(),Rt(this,t,Cr,xr,i,{stage:0})}};function Sr(t,e,n){const r=t.slice();return r[16]=e[n],r}function Or(t){let e,n;return e=new Se({props:{error:t[20],retry:t[10],back:t[11]}}),{c(){Nt(e.$$.fragment)},m(t,r){Dt(e,t,r),n=!0},p(t,n){const r={};16&n&&(r.error=t[20]),16&n&&(r.retry=t[10]),71&n&&(r.back=t[11]),e.$set(r)},i(t){n||(bt(e.$$.fragment,t),n=!0)},o(t){yt(e.$$.fragment,t),n=!1},d(t){Lt(e,t)}}}function Ar(e){let n,r=e[0].next(e[19],e[1].length)+"";return{c(){n=R(r)},m(t,e){A(t,n,e)},p(t,e){19&e&&r!==(r=t[0].next(t[19],t[1].length)+"")&&z(n,r)},i:t,o:t,d(t){t&&_(n)}}}function _r(t){let e,n,r,i,l,c,a,u,d,p;e=new _e({props:{$$slots:{default:[Nr]},$$scope:{ctx:t}}});let f=Ct(t[1]),h=[];for(let e=0;e<f.length;e+=1)h[e]=Dr(Sr(t,f,e));return{c(){Nt(e.$$.fragment),n=U(),r=D("div");for(let t=0;t<h.length;t+=1)h[t].c();l=U(),c=D("button"),a=R("Cancel"),P(r,"class","chapters"),c.disabled=t[3]},m(o,s){Dt(e,o,s),A(o,n,s),A(o,r,s);for(let t=0;t<h.length;t+=1)h[t]&&h[t].m(r,null);A(o,l,s),A(o,c,s),T(c,a),u=!0,d||(p=[g(i=t[8].call(null,r,{newchapters:t[1],scroll:t[5]})),I(c,"click",M(t[9]))],d=!0)},p(t,n){const o={};if(2097152&n&&(o.$$scope={dirty:n,ctx:t}),e.$set(o),2&n){let e;for(f=Ct(t[1]),e=0;e<f.length;e+=1){const o=Sr(t,f,e);h[e]?h[e].p(o,n):(h[e]=Dr(o),h[e].c(),h[e].m(r,null))}for(;e<h.length;e+=1)h[e].d(1);h.length=f.length}i&&s(i.update)&&34&n&&i.update.call(null,{newchapters:t[1],scroll:t[5]}),(!u||8&n)&&(c.disabled=t[3])},i(t){u||(bt(e.$$.fragment,t),u=!0)},o(t){yt(e.$$.fragment,t),u=!1},d(t){t&&(_(n),_(r),_(l),_(c)),Lt(e,t),N(h,t),d=!1,o(p)}}}function Nr(t){let e;return{c(){e=R("Please wait, fetching chapters...")},m(t,n){A(t,e,n)},d(t){t&&_(e)}}}function Dr(t){let e,n,r,o,s,i,l=t[16].from+"",c=t[16].url+"";return{c(){e=D("p"),n=R(l),r=R(": Found "),o=D("a"),s=R(c),P(o,"href",i=t[16].url),P(e,"class","valid small svelte-tsai6h")},m(t,i){A(t,e,i),T(e,n),T(e,r),T(e,o),T(o,s)},p(t,e){2&e&&l!==(l=t[16].from+"")&&z(n,l),2&e&&c!==(c=t[16].url+"")&&z(s,c),2&e&&i!==(i=t[16].url)&&P(o,"href",i)},d(t){t&&_(e)}}}function Lr(t){let e,n,r,o,s;e=new ir({props:{hasReddit:!!t[6].chapters.find(Rr)||!!t[1].find(Ur),hasOther:!!t[6].chapters.find(Fr)||!!t[1].find(Ir)}});let i={ctx:t,current:null,token:null,hasCatch:!0,pending:_r,then:Ar,catch:Or,value:19,error:20,blocks:[,,,]};return Et(o=t[4],i),{c(){Nt(e.$$.fragment),n=U(),r=F(),i.block.c()},m(t,o){Dt(e,t,o),A(t,n,o),A(t,r,o),i.block.m(t,i.anchor=o),i.mount=()=>r.parentNode,i.anchor=r,s=!0},p(n,[r]){t=n;const s={};66&r&&(s.hasReddit=!!t[6].chapters.find(Rr)||!!t[1].find(Ur)),66&r&&(s.hasOther=!!t[6].chapters.find(Fr)||!!t[1].find(Ir)),e.$set(s),i.ctx=t,16&r&&o!==(o=t[4])&&Et(o,i)||kt(i,t,r)},i(t){s||(bt(e.$$.fragment,t),bt(i.block),s=!0)},o(t){yt(e.$$.fragment,t);for(let t=0;t<3;t+=1)yt(i.blocks[t]);s=!1},d(t){t&&(_(n),_(r)),Lt(e,t),i.block.d(t),i.token=null,i=null}}}const Rr=t=>t.apiUrl.indexOf("reddit.com")>=0,Ur=t=>t.url.indexOf("reddit.com")>=0,Fr=t=>t.apiUrl.indexOf("reddit.com")<0,Ir=t=>t.url.indexOf("reddit.com")<0;function Mr(t,e,n){let r,o,s,i;u(t,_n,t=>n(6,r=t)),u(t,An,t=>n(12,o=t)),u(t,Jt,t=>n(13,s=t)),u(t,De,t=>n(14,i=t));let{stage:l}=e;if(!r)throw new Error("Inconsistent state, expected to have book data");let c,a=[],d=!1;const p=async()=>{var t,e;for(n(2,c=r.chapters.map(t=>Object.assign({},t)));!d;){let r=c[c.length-1];if(!1!==r.needsFetching){const t=await Fe(i,o.series,r.apiUrl);c.splice(-1,1,r=dn(s,rn(o.series.type,t,r.apiUrl)))}let l=ln(s,null!==(t=r.transformedContent)&&void 0!==t?t:"");if(l||(l=ln(s,null!==(e=r.content)&&void 0!==e?e:"")),!l)break;const u=tn(o.series.type,l);if(c.find(t=>t.apiUrl===u))break;a.push({from:r.title,url:l}),n(1,a);const d=await Fe(i,o.series,u);c.push(dn(s,rn(o.series.type,d,u)))}return Object.assign(Object.assign({},r),{chapters:c})};let f=p(),h=!0;function m(){const t=document.documentElement.scrollHeight-document.documentElement.scrollTop;n(5,h=Math.abs(document.documentElement.clientHeight-t)<1)}return window.addEventListener("scroll",m),Q(()=>{window.removeEventListener("scroll",m)}),t.$$set=t=>{"stage"in t&&n(0,l=t.stage)},[l,a,c,d,f,h,r,p,(t,e)=>({update:({scroll:t})=>{t&&document.querySelector("footer").scrollIntoView()}}),()=>n(3,d=!0),()=>n(4,f=p()),()=>l.next({...r,chapters:c},a.length)]}const jr=class extends Ft{constructor(t){super(),Rt(this,t,Mr,Lr,i,{stage:0})}};function Pr(t,e,n){t.dispatchEvent(new CustomEvent("finalize",{detail:{items:e,info:n}}))}function zr(t,e,n){t.dispatchEvent(new CustomEvent("consider",{detail:{items:e,info:n}}))}const Br="draggedEntered",qr="draggedLeft",Hr="draggedOverIndex",Gr="draggedLeftDocument",Wr="leftForAnother",Yr="outsideOfAny";function Xr(t,e,n){t.dispatchEvent(new CustomEvent(Br,{detail:{indexObj:e,draggedEl:n}}))}function Kr(t,e,n){t.dispatchEvent(new CustomEvent(qr,{detail:{draggedEl:e,type:Wr,theOtherDz:n}}))}function Jr(t,e,n){t.dispatchEvent(new CustomEvent(Hr,{detail:{indexObj:e,draggedEl:n}}))}const Vr="dragStarted",Zr=Br,Qr=Hr,to=qr,eo="droppedIntoZone",no="droppedIntoAnother",ro="pointer",oo="keyboard",so="isDndShadowItem",io="data-is-dnd-shadow-item-internal";let lo="id",co=0;function ao(){co++}function uo(){if(0===co)throw new Error("Bug! trying to decrement when there are no dropzones");co--}const po="undefined"==typeof window;let fo,ho,mo=()=>{};function go(t,e=!0){let n;const r=e?function(t){let e=t.getBoundingClientRect(),n={top:e.top,bottom:e.bottom,left:e.left,right:e.right},r=t.parentElement;for(;r&&r!==document.body;){let t=r.getBoundingClientRect();const e=window.getComputedStyle(r).overflowY,o=window.getComputedStyle(r).overflowX,s="scroll"===o||"auto"===o;("scroll"===e||"auto"===e)&&(n.top=Math.max(n.top,t.top),n.bottom=Math.min(n.bottom,t.bottom)),s&&(n.left=Math.max(n.left,t.left),n.right=Math.min(n.right,t.right)),r=r.parentElement}return n.top=Math.max(n.top,0),n.bottom=Math.min(n.bottom,window.innerHeight),n.left=Math.max(n.left,0),n.right=Math.min(n.right,window.innerWidth),{top:n.top,bottom:n.bottom,left:n.left,right:n.right,width:Math.max(0,n.right-n.left),height:Math.max(0,n.bottom-n.top)}}(t):t.getBoundingClientRect(),o=getComputedStyle(t),s=o.transform;if(s){let e,i,l,c;if(s.startsWith("matrix3d("))n=s.slice(9,-1).split(/, /),e=+n[0],i=+n[5],l=+n[12],c=+n[13];else{if(!s.startsWith("matrix("))return r;n=s.slice(7,-1).split(/, /),e=+n[0],i=+n[3],l=+n[4],c=+n[5]}const a=o.transformOrigin,u=r.x-l-(1-e)*parseFloat(a),d=r.y-c-(1-i)*parseFloat(a.slice(a.indexOf(" ")+1)),p=e?r.width/e:t.offsetWidth,f=i?r.height/i:t.offsetHeight;return{x:u,y:d,width:p,height:f,top:d,right:u+p,bottom:d+f,left:u}}return r}function $o(t){const e=go(t);return{top:e.top+window.scrollY,bottom:e.bottom+window.scrollY,left:e.left+window.scrollX,right:e.right+window.scrollX}}function vo(t){const e=t.getBoundingClientRect();return{top:e.top+window.scrollY,bottom:e.bottom+window.scrollY,left:e.left+window.scrollX,right:e.right+window.scrollX}}function bo(t){return{x:(t.left+t.right)/2,y:(t.top+t.bottom)/2}}function yo(t,e){return t.y<=e.bottom&&t.y>=e.top&&t.x>=e.left&&t.x<=e.right}function wo(t){return bo(vo(t))}function xo(t,e){return yo(wo(t),$o(e))}function Eo(t,e){return n=wo(t),r=wo(e),Math.sqrt(Math.pow(n.x-r.x,2)+Math.pow(n.y-r.y,2));var n,r}function ko(){fo=new Map}function Co(t,e){if(!xo(t,e))return null;const n=e.children;if(0===n.length)return{index:0,isProximityBased:!0};const r=function(t){const e=Array.from(t.children).findIndex(t=>t.getAttribute(io));if(e>=0)return fo.has(t)||fo.set(t,new Map),fo.get(t).set(e,$o(t.children[e])),e}(e);for(let o=0;o<n.length;o++)if(xo(t,n[o])){const n=fo.has(e)&&fo.get(e).get(o);return n&&!yo(wo(t),n)?{index:r,isProximityBased:!1}:{index:o,isProximityBased:!1}}let o,s=Number.MAX_VALUE;for(let e=0;e<n.length;e++){const r=Eo(t,n[e]);r<s&&(s=r,o=e)}if(n.length>0){const r=n.length,i=n[r-1].cloneNode(!1);i.style.visibility="hidden",i.style.pointerEvents="none",e.appendChild(i),Eo(t,i)<s&&(o=r),e.removeChild(i)}return{index:o,isProximityBased:!0}}function To(t){return JSON.stringify(t,null,2)}function So(t){if(!t)throw new Error("cannot get depth of a falsy node");return Oo(t,0)}function Oo(t,e=0){return t.parentElement?Oo(t.parentElement,e+1):e-1}function Ao(){let t;function e(){t={directionObj:void 0,stepPx:0}}function n(e){const{directionObj:r,stepPx:o}=t;r&&(e.scrollBy(r.x*o,r.y*o),window.requestAnimationFrame(()=>n(e)))}function r(t){return 30-t}return e(),{scrollIfNeeded:function(o,s){if(!s)return!1;const i=function(t,e){const n=e===document.scrollingElement?{top:0,bottom:window.innerHeight,left:0,right:window.innerWidth}:e.getBoundingClientRect();return yo(t,n)?{top:t.y-n.top,bottom:n.bottom-t.y,left:t.x-n.left,right:n.right-t.x}:null}(o,s),l=!!t.directionObj;if(null===i)return l&&e(),!1;let[c,a]=[!1,!1];return s.scrollHeight>s.clientHeight&&(i.bottom<30?(c=!0,t.directionObj={x:0,y:1},t.stepPx=r(i.bottom)):i.top<30&&(c=!0,t.directionObj={x:0,y:-1},t.stepPx=r(i.top)),!l&&c)||s.scrollWidth>s.clientWidth&&(i.right<30?(a=!0,t.directionObj={x:1,y:0},t.stepPx=r(i.right)):i.left<30&&(a=!0,t.directionObj={x:-1,y:0},t.stepPx=r(i.left)),!l&&a)?(n(s),!0):(e(),!1)},resetScrolling:e}}function _o(t){if(!t)return[];const e=[];let n=t;for(;n;){const{overflow:t}=window.getComputedStyle(n);t.split(" ").some(t=>t.includes("auto")||t.includes("scroll"))&&e.push(n),n=n.parentElement}return e}ko();const No=Object.freeze({USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT:"USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT"}),Do={[No.USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT]:!1};function Lo(t){if(!No[t])throw new Error(`Can't get non existing feature flag ${t}! Supported flags: ${Object.keys(No)}`);return Do[t]}function Ro(t){return`${t} 0.2s ease`}function Uo(t,e,n,r){Fo(e,t);const o=e.getBoundingClientRect(),s=t.getBoundingClientRect(),i=o.width-s.width,l=o.height-s.height;if(i||l){const e={left:(n-s.left)/s.width,top:(r-s.top)/s.height};Lo(No.USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT)||(t.style.height=`${o.height}px`,t.style.width=`${o.width}px`),t.style.left=parseFloat(t.style.left)-e.left*i+"px",t.style.top=parseFloat(t.style.top)-e.top*l+"px"}}function Fo(t,e){const n=window.getComputedStyle(t);Array.from(n).filter(t=>t.startsWith("background")||t.startsWith("padding")||t.startsWith("font")||t.startsWith("text")||t.startsWith("align")||t.startsWith("justify")||t.startsWith("display")||t.startsWith("flex")||t.startsWith("border")||"opacity"===t||"color"===t||"list-style-type"===t||Lo(No.USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT)&&("width"===t||"height"===t)).forEach(t=>e.style.setProperty(t,n.getPropertyValue(t),n.getPropertyPriority(t)))}function Io(t,e){t.draggable=!1,t.ondragstart=()=>!1,e?(t.style.userSelect="",t.style.WebkitUserSelect="",t.style.cursor=""):(t.style.userSelect="none",t.style.WebkitUserSelect="none",t.style.cursor="grab")}function Mo(t){t.style.display="none",t.style.position="fixed",t.style.zIndex="-5"}function jo(t){t.style.visibility="hidden",t.setAttribute(io,"true")}function Po(t,e=()=>{},n=()=>[]){t.forEach(t=>{const r=e(t);Object.keys(r).forEach(e=>{t.style[e]=r[e]}),n(t).forEach(e=>t.classList.add(e))})}function zo(t,e=()=>{},n=()=>[]){t.forEach(t=>{const r=e(t);Object.keys(r).forEach(e=>{t.style[e]=""}),n(t).forEach(e=>t.classList.contains(e)&&t.classList.remove(e))})}const Bo={outline:"rgba(255, 255, 102, 0.7) solid 2px"},qo="data-is-dnd-original-dragged-item";let Ho,Go,Wo,Yo,Xo,Ko,Jo,Vo,Zo,Qo,ts,es,ns,rs=!1,os=!1,ss=!1,is=[],ls=!1;const cs=new Map,as=new Map,us=new WeakMap;function ds(t,e){cs.get(e).delete(t),uo(),0===cs.get(e).size&&cs.delete(e)}function ps(t){return t.findIndex(t=>!!t[so])}function fs(t){let{items:e,dropFromOthersDisabled:n}=as.get(t.currentTarget);if(n&&t.currentTarget!==Xo)return;if(ss=!1,e=e.filter(t=>t[lo]!==Jo[lo]),Xo!==t.currentTarget){const t=as.get(Xo).items.filter(t=>!t[so]);zr(Xo,t,{trigger:"dragEnteredAnother",id:Wo[lo],source:ro})}const{index:r}=t.detail.indexObj;Vo=t.currentTarget,e.splice(r,0,Jo),zr(t.currentTarget,e,{trigger:Zr,id:Wo[lo],source:ro})}function hs(t){if(!rs)return;const{items:e,dropFromOthersDisabled:n}=as.get(t.currentTarget);if(n&&t.currentTarget!==Xo&&t.currentTarget!==Vo)return;const r=[...e],o=ps(r);-1!==o&&r.splice(o,1);const s=Vo;Vo=void 0;const{type:i,theOtherDz:l}=t.detail;if(i===Yr||i===Wr&&l!==Xo&&as.get(l).dropFromOthersDisabled){ss=!0,Vo=Xo;const t=s===Xo?r:[...as.get(Xo).items];t.splice(Ko,0,Jo),zr(Xo,t,{trigger:"draggedLeftAll",id:Wo[lo],source:ro})}zr(t.currentTarget,r,{trigger:to,id:Wo[lo],source:ro})}function ms(t){const{items:e,dropFromOthersDisabled:n}=as.get(t.currentTarget);if(n&&t.currentTarget!==Xo)return;const r=[...e];ss=!1;const{index:o}=t.detail.indexObj,s=ps(r);-1!==s&&r.splice(s,1),r.splice(o,0,Jo),zr(t.currentTarget,r,{trigger:Qr,id:Wo[lo],source:ro})}function gs(t){t.preventDefault();const e=t.touches?t.touches[0]:t;Qo={x:e.clientX,y:e.clientY},Go.style.transform=`translate3d(${Qo.x-Zo.x}px, ${Qo.y-Zo.y}px, 0)`}function $s(){os=!0,window.removeEventListener("mousemove",gs),window.removeEventListener("touchmove",gs),window.removeEventListener("mouseup",$s),window.removeEventListener("touchend",$s),function(){const t=cs.get(Yo);for(const e of t)e.removeEventListener(Br,fs),e.removeEventListener(qr,hs),e.removeEventListener(Hr,ms);window.removeEventListener(Gr,$s),es&&(es.destroy(),es=void 0),clearTimeout(ho),ko()}(),function(t){t.style.cursor="grab"}(Go),Vo||(Vo=Xo);let{items:t,type:e}=as.get(Vo);zo(cs.get(e),t=>as.get(t).dropTargetStyle,t=>as.get(t).dropTargetClasses);let n=ps(t);function r(){ts(),Pr(Vo,t,{trigger:ss?"droppedOutsideOfAny":eo,id:Wo[lo],source:ro}),Vo!==Xo&&Pr(Xo,as.get(Xo).items,{trigger:no,id:Wo[lo],source:ro});const e=Array.from(Vo.children).find(t=>t.getAttribute(io));var n;e&&((n=e).style.visibility="",n.removeAttribute(io)),Go&&Go.remove&&Go.remove(),Ho&&Ho.remove&&Ho.remove(),Go=void 0,Ho=void 0,Wo=void 0,Yo=void 0,Xo=void 0,Ko=void 0,Jo=void 0,Vo=void 0,Zo=void 0,Qo=void 0,rs=!1,os=!1,ts=void 0,ss=!1,ns&&clearTimeout(ns),ns=void 0,ls=!1,is.length&&(is.forEach(({dz:t,destroy:e})=>{e(),t.remove()}),is=[])}-1===n&&Vo===Xo&&(n=Ko),t=t.map(t=>t[so]?Wo:t),as.get(Vo).dropAnimationDisabled?r():function(t,e){const n=go(t>-1?Vo.children[t]:Vo,!1),r=n.left-parseFloat(Go.style.left),o=n.top-parseFloat(Go.style.top),{dropAnimationDurationMs:s}=as.get(Vo),i=`transform ${s}ms ease`;Go.style.transition=Go.style.transition?Go.style.transition+","+i:i,Go.style.transform=`translate3d(${r}px, ${o}px, 0)`,window.setTimeout(e,s)}(n,r)}function vs(t,e){let n=!1;const r={items:void 0,type:void 0,flipDurationMs:0,dragDisabled:!1,morphDisabled:!1,dropFromOthersDisabled:!1,dropTargetStyle:Bo,dropTargetClasses:[],transformDraggedElement:()=>{},centreDraggedOnCursor:!1,dropAnimationDisabled:!1,delayTouchStartMs:0};let o=new Map;function s(){window.removeEventListener("mousemove",l),window.removeEventListener("touchmove",l),window.removeEventListener("mouseup",i),window.removeEventListener("touchend",i),ns&&(clearTimeout(ns),ns=void 0,ls=!1)}function i(t){if(s(),Ho=void 0,Zo=void 0,Qo=void 0,"touchend"===t.type){const e=new Event("click",{bubbles:!0,cancelable:!0});t.target.dispatchEvent(e)}}function l(t){const e=!!t.touches,n=e?t.touches[0]:t;if(e&&r.delayTouchStartMs>0&&!ls)return Qo={x:n.clientX,y:n.clientY},void((Math.abs(Qo.x-Zo.x)>=3||Math.abs(Qo.y-Zo.y)>=3)&&(ns&&(clearTimeout(ns),ns=void 0),i(t)));t.preventDefault(),Qo={x:n.clientX,y:n.clientY},(Math.abs(Qo.x-Zo.x)>=3||Math.abs(Qo.y-Zo.y)>=3)&&(s(),a())}function c(t){if(t.target!==t.currentTarget&&(void 0!==t.target.value||t.target.isContentEditable))return;if(t.button)return;if(rs)return;const e=!!t.touches,n=e&&r.delayTouchStartMs>0;n||t.preventDefault(),t.stopPropagation();const o=e?t.touches[0]:t;Zo={x:o.clientX,y:o.clientY},Qo={...Zo},Ho=t.currentTarget,n&&(ls=!1,ns=window.setTimeout(()=>{Ho&&(ls=!0,s(),a())},r.delayTouchStartMs)),window.addEventListener("mousemove",l,{passive:!1}),window.addEventListener("touchmove",l,{passive:!1,capture:!1}),window.addEventListener("mouseup",i,{passive:!1}),window.addEventListener("touchend",i,{passive:!1})}function a(){rs=!0;const t=o.get(Ho);Ko=t,Xo=Ho.parentElement;const e=Xo.closest("dialog")||Xo.closest("[popover]")||Xo.getRootNode(),n=e.body||e,{items:s,type:i,centreDraggedOnCursor:l}=r,c=[...s];Wo=c[t],Yo=i,Jo=function(t){return{...t,[so]:!0,[lo]:"id:dnd-shadow-placeholder-0000"}}(Wo),Go=function(t,e){const n=t.getBoundingClientRect(),r=function(t){const e=t.cloneNode(!0),n=[],r="SELECT"===t.tagName,o=r?[t]:[...t.querySelectorAll("select")];for(const t of o)n.push(t.value);if(o.length>0){const t=r?[e]:[...e.querySelectorAll("select")];for(let e=0;e<t.length;e++){const r=t[e],o=n[e],s=r.querySelector(`option[value="${o}"`);s&&s.setAttribute("selected",!0)}}const s="CANVAS"===t.tagName,i=s?[t]:[...t.querySelectorAll("canvas")];if(i.length>0){const t=s?[e]:[...e.querySelectorAll("canvas")];for(let e=0;e<t.length;e++){const n=i[e],r=t[e];r.width=n.width,r.height=n.height,n.width>0&&n.height>0&&r.getContext("2d").drawImage(n,0,0)}}return e}(t);Fo(t,r),r.id="dnd-action-dragged-el",r.style.position="fixed";let o=n.top,s=n.left;if(r.style.top=`${o}px`,r.style.left=`${s}px`,e){const t=bo(n);o-=t.y-e.y,s-=t.x-e.x,window.setTimeout(()=>{r.style.top=`${o}px`,r.style.left=`${s}px`},0)}return r.style.margin="0",r.style.boxSizing="border-box",r.style.height=`${n.height}px`,r.style.width=`${n.width}px`,r.style.transition=`${Ro("top")}, ${Ro("left")}, ${Ro("background-color")}, ${Ro("opacity")}, ${Ro("color")} `,window.setTimeout(()=>r.style.transition+=`, ${Ro("width")}, ${Ro("height")}`,0),r.style.zIndex="9999",r.style.cursor="grabbing",r}(Ho,l&&Qo),n.appendChild(Go),window.requestAnimationFrame(function t(){Ho.parentElement?window.requestAnimationFrame(t):(Ho.setAttribute(qo,!0),n.appendChild(Ho),function(){const t=cs.get(Yo);for(const e of t)e.addEventListener(Br,fs),e.addEventListener(qr,hs),e.addEventListener(Hr,ms);window.addEventListener(Gr,$s);const e=Math.max(...Array.from(t.keys()).map(t=>as.get(t).dropAnimationDurationMs)),n=0===e?20:Math.max(e,100);es=function(t=[],e){const n=function(t){const e=new Set;for(let n of t)_o(n).forEach(t=>e.add(t));return(document.scrollingElement.scrollHeight>document.scrollingElement.clientHeight||document.scrollingElement.scrollWidth>document.scrollingElement.clientHeight)&&e.add(document.scrollingElement),e}(t),r=Array.from(n).sort((t,e)=>So(e)-So(t)),{scrollIfNeeded:o,resetScrolling:s}=Ao();return{multiScrollIfNeeded:n.size>0?function(){const t=e();if(!t||!r)return!1;const n=r.filter(e=>yo(t,e.getBoundingClientRect())||e===document.scrollingElement);for(let e=0;e<n.length;e++)if(o(t,n[e]))return!0;return!1}:()=>!1,destroy:()=>s()}}(t,()=>Qo),function(t,e,n=200,r){let o,s,i,l=!1;const c=Array.from(e).sort((t,e)=>So(e)-So(t));!function e(){const a=wo(t),u=r.multiScrollIfNeeded();if(!u&&i&&Math.abs(i.x-a.x)<10&&Math.abs(i.y-a.y)<10)return void(ho=window.setTimeout(e,n));if(function(t){const e=vo(t);return e.right<0||e.left>document.documentElement.scrollWidth||e.bottom<0||e.top>document.documentElement.scrollHeight}(t))return void function(t){window.dispatchEvent(new CustomEvent(Gr,{detail:{draggedEl:t}}))}(t);i=a;let d=!1;for(const e of c){u&&ko();const n=Co(t,e);if(null===n)continue;const{index:r}=n;d=!0,e!==o?(o&&Kr(o,t,e),Xr(e,n,t),o=e):r!==s&&(Jr(e,n,t),s=r);break}!d&&l&&o?(function(t,e){t.dispatchEvent(new CustomEvent(qr,{detail:{draggedEl:e,type:Yr}}))}(o,t),o=void 0,s=void 0,l=!1):l=!0,ho=window.setTimeout(e,n)}()}(Go,t,1.07*n,es)}(),Mo(Ho),Jo[lo]=Wo[lo],Go.focus())}),Po(Array.from(cs.get(r.type)).filter(t=>t===Xo||!as.get(t).dropFromOthersDisabled),t=>as.get(t).dropTargetStyle,t=>as.get(t).dropTargetClasses),c.splice(t,1,Jo),ts=function(t){const e=t.style.minHeight;t.style.minHeight=window.getComputedStyle(t).getPropertyValue("height");const n=t.style.minWidth;return t.style.minWidth=window.getComputedStyle(t).getPropertyValue("width"),function(){t.style.minHeight=e,t.style.minWidth=n}}(Xo),zr(Xo,c,{trigger:Vr,id:Wo[lo],source:ro}),window.addEventListener("mousemove",gs,{passive:!1}),window.addEventListener("touchmove",gs,{passive:!1,capture:!1}),window.addEventListener("mouseup",$s,{passive:!1}),window.addEventListener("touchend",$s,{passive:!1})}function u({items:e,flipDurationMs:s=0,type:i="--any--",dragDisabled:l=!1,morphDisabled:a=!1,dropFromOthersDisabled:u=!1,dropTargetStyle:d=Bo,dropTargetClasses:p=[],transformDraggedElement:f=()=>{},centreDraggedOnCursor:h=!1,dropAnimationDisabled:m=!1,delayTouchStart:g=!1}){r.dropAnimationDurationMs=s;let $=0;function v(t,e){return as.get(t)?as.get(t)[e]:r[e]}var b,y;!0===g?$=80:"number"==typeof g&&isFinite(g)&&g>=0&&($=g),r.delayTouchStartMs=$,r.type&&i!==r.type&&ds(t,r.type),r.type=i,r.items=[...e],r.dragDisabled=l,r.morphDisabled=a,r.transformDraggedElement=f,r.centreDraggedOnCursor=h,r.dropAnimationDisabled=m,!n||!rs||os||function(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(!{}.hasOwnProperty.call(e,n)||e[n]!==t[n])return!1;return!0}(d,r.dropTargetStyle)&&function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}(p,r.dropTargetClasses)||(zo([t],()=>r.dropTargetStyle,()=>p),Po([t],()=>d,()=>p)),r.dropTargetStyle=d,r.dropTargetClasses=[...p],n&&rs&&r.dropFromOthersDisabled!==u&&(u?zo([t],t=>v(t,"dropTargetStyle"),t=>v(t,"dropTargetClasses")):Po([t],t=>v(t,"dropTargetStyle"),t=>v(t,"dropTargetClasses"))),r.dropFromOthersDisabled=u,as.set(t,r),b=t,y=i,cs.has(y)||cs.set(y,new Set),cs.get(y).has(b)||(cs.get(y).add(b),ao());const w=rs?ps(r.items):-1;for(let e=0;e<t.children.length;e++){const s=t.children[e];Io(s,l),e!==w?(s.removeEventListener("mousedown",us.get(s)),s.removeEventListener("touchstart",us.get(s)),l||(s.addEventListener("mousedown",c),s.addEventListener("touchstart",c),us.set(s,c)),o.set(s,e),n||(n=!0)):(a||Uo(Go,s,Qo.x,Qo.y),r.transformDraggedElement(Go,Wo,e),jo(s))}}return u(e),{update:t=>{u(t)},destroy:()=>{function e(){ds(t,as.get(t).type),as.delete(t)}var n,r;rs&&!t.closest(`[${qo}]`)?(n=t,r=e,is.push({dz:n,destroy:r}),window.requestAnimationFrame(()=>{Mo(n),document.body.appendChild(n)})):e()}}}const bs={DND_ZONE_ACTIVE:"dnd-zone-active",DND_ZONE_DRAG_DISABLED:"dnd-zone-drag-disabled"},ys={[bs.DND_ZONE_ACTIVE]:"Tab to one the items and press space-bar or enter to start dragging it",[bs.DND_ZONE_DRAG_DISABLED]:"This is a disabled drag and drop list"};let ws;function xs(){ws||(ws=document.createElement("div"),ws.id="dnd-action-aria-alert",ws.style.position="fixed",ws.style.bottom="0",ws.style.left="0",ws.style.zIndex="-5",ws.style.opacity="0",ws.style.height="0",ws.style.width="0",ws.setAttribute("role","alert"),document.body.prepend(ws),Object.entries(ys).forEach(([t,e])=>document.body.prepend(function(t,e){const n=document.createElement("div");return n.id=t,n.innerHTML=`<p>${e}</p>`,n.style.display="none",n.style.position="fixed",n.style.zIndex="-5",n}(t,e))))}function Es(t){if(po)return;ws||xs(),ws.innerHTML="";const e=document.createTextNode(t);ws.appendChild(e),ws.style.display="none",ws.style.display="inline"}const ks={outline:"rgba(255, 255, 102, 0.7) solid 2px"};let Cs,Ts,Ss,Os,As=!1,_s="",Ns="";const Ds=new WeakSet,Ls=new WeakMap,Rs=new WeakMap,Us=new Map,Fs=new Map,Is=new Map;let Ms;function js(t,e){Ts===t&&Hs(),Is.get(e).delete(t),uo(),0===Is.get(e).size&&Is.delete(e),0===Is.size&&(window.removeEventListener("keydown",Ps),window.removeEventListener("click",zs),Ms=void 0,!po&&ws&&(Object.keys(ys).forEach(t=>document.getElementById(t)?.remove()),ws.remove(),ws=void 0))}function Ps(t){As&&"Escape"===t.key&&Hs()}function zs(){As&&(Ds.has(document.activeElement)||Hs())}function Bs(t){if(!As)return;const e=t.currentTarget;if(e===Ts)return;_s=e.getAttribute("aria-label")||"";const{items:n}=Fs.get(Ts),r=n.find(t=>t[lo]===Os),o=n.indexOf(r),s=n.splice(o,1)[0],{items:i,autoAriaDisabled:l}=Fs.get(e);e.getBoundingClientRect().top<Ts.getBoundingClientRect().top||e.getBoundingClientRect().left<Ts.getBoundingClientRect().left?(i.push(s),l||Es(`Moved item ${Ns} to the end of the list ${_s}`)):(i.unshift(s),l||Es(`Moved item ${Ns} to the beginning of the list ${_s}`)),Pr(Ts,n,{trigger:no,id:Os,source:oo}),Pr(e,i,{trigger:eo,id:Os,source:oo}),Ts=e}function qs(){Us.forEach(({update:t},e)=>t(Fs.get(e)))}function Hs(t=!0){Fs.get(Ts).autoAriaDisabled||Es(`Stopped dragging item ${Ns}`),Ds.has(document.activeElement)&&document.activeElement.blur(),t&&zr(Ts,Fs.get(Ts).items,{trigger:"dragStopped",id:Os,source:oo}),zo(Is.get(Cs),t=>Fs.get(t).dropTargetStyle,t=>Fs.get(t).dropTargetClasses),Ss=null,Os=null,Ns="",Cs=null,Ts=null,_s="",As=!1,qs()}function Gs(t,e){const n={items:void 0,type:void 0,dragDisabled:!1,zoneTabIndex:0,zoneItemTabIndex:0,dropFromOthersDisabled:!1,dropTargetStyle:ks,dropTargetClasses:[],autoAriaDisabled:!1};function r(t,e,n){t.length<=1||t.splice(n,1,t.splice(e,1,t[n])[0])}function o(e){switch(e.key){case"Enter":case" ":if((void 0!==e.target.disabled||e.target.href||e.target.isContentEditable)&&!Ds.has(e.target))return;e.preventDefault(),e.stopPropagation(),As?Hs():s(e);break;case"ArrowDown":case"ArrowRight":{if(!As)return;e.preventDefault(),e.stopPropagation();const{items:o}=Fs.get(t),s=Array.from(t.children),i=s.indexOf(e.currentTarget);i<s.length-1&&(n.autoAriaDisabled||Es(`Moved item ${Ns} to position ${i+2} in the list ${_s}`),r(o,i,i+1),Pr(t,o,{trigger:eo,id:Os,source:oo}));break}case"ArrowUp":case"ArrowLeft":{if(!As)return;e.preventDefault(),e.stopPropagation();const{items:o}=Fs.get(t),s=Array.from(t.children).indexOf(e.currentTarget);s>0&&(n.autoAriaDisabled||Es(`Moved item ${Ns} to position ${s} in the list ${_s}`),r(o,s,s-1),Pr(t,o,{trigger:eo,id:Os,source:oo}));break}}}function s(e){(function(e){const{items:r}=Fs.get(t),o=Array.from(t.children),s=o.indexOf(e);Ss=e,Ss.tabIndex=n.zoneItemTabIndex,Os=r[s][lo],Ns=o[s].getAttribute("aria-label")||""})(e.currentTarget),Ts=t,Cs=n.type,As=!0;const r=Array.from(Is.get(n.type)).filter(t=>t===Ts||!Fs.get(t).dropFromOthersDisabled);if(Po(r,t=>Fs.get(t).dropTargetStyle,t=>Fs.get(t).dropTargetClasses),!n.autoAriaDisabled){let t=`Started dragging item ${Ns}. Use the arrow keys to move it within its list ${_s}`;r.length>1&&(t+=", or tab to another list in order to move the item into it"),Es(t)}zr(t,Fs.get(t).items,{trigger:Vr,id:Os,source:oo}),qs()}function i(t){As&&t.currentTarget!==Ss&&(t.stopPropagation(),Hs(!1),s(t))}function l({items:e=[],type:r="--any--",dragDisabled:s=!1,zoneTabIndex:l=0,zoneItemTabIndex:c=0,dropFromOthersDisabled:a=!1,dropTargetStyle:u=ks,dropTargetClasses:d=[],autoAriaDisabled:p=!1}){var f,h;n.items=[...e],n.dragDisabled=s,n.dropFromOthersDisabled=a,n.zoneTabIndex=l,n.zoneItemTabIndex=c,n.dropTargetStyle=u,n.dropTargetClasses=d,n.autoAriaDisabled=p,n.type&&r!==n.type&&js(t,n.type),n.type=r,f=t,h=r,0===Is.size&&(Ms=po?null:("complete"===document.readyState?xs():window.addEventListener("DOMContentLoaded",xs),{...bs}),window.addEventListener("keydown",Ps),window.addEventListener("click",zs)),Is.has(h)||Is.set(h,new Set),Is.get(h).has(f)||(Is.get(h).add(f),ao()),p||(t.setAttribute("aria-disabled",s),t.setAttribute("role","list"),t.setAttribute("aria-describedby",s?Ms.DND_ZONE_DRAG_DISABLED:Ms.DND_ZONE_ACTIVE)),Fs.set(t,n),t.tabIndex=As?t===Ts||Ss.contains(t)||n.dropFromOthersDisabled||Ts&&n.type!==Fs.get(Ts).type?-1:0:n.zoneTabIndex,t.addEventListener("focus",Bs);for(let e=0;e<t.children.length;e++){const r=t.children[e];Ds.add(r),r.tabIndex=As?-1:n.zoneItemTabIndex,p||r.setAttribute("role","listitem"),r.removeEventListener("keydown",Ls.get(r)),r.removeEventListener("click",Rs.get(r)),s||(r.addEventListener("keydown",o),Ls.set(r,o),r.addEventListener("click",i),Rs.set(r,i)),As&&n.items[e][lo]===Os&&(mo(),Ss=r,Ss.tabIndex=n.zoneItemTabIndex,r.focus())}}l(e);const c={update:t=>{l(t)},destroy:()=>{js(t,n.type),Fs.delete(t),Us.delete(t)}};return Us.set(t,c),c}function Ws(t,e){if(function(t){return!!t.closest('[data-is-dnd-shadow-item-hint="true"]')}(t))return{update:()=>{},destroy:()=>{}};Ys(e);const n=vs(t,e),r=Gs(t,e);return{update:t=>{Ys(t),n.update(t),r.update(t)},destroy:()=>{n.destroy(),r.destroy()}}}function Ys(t){const{items:e,flipDurationMs:n,type:r,dragDisabled:o,morphDisabled:s,dropFromOthersDisabled:i,zoneTabIndex:l,zoneItemTabIndex:c,dropTargetStyle:a,dropTargetClasses:u,transformDraggedElement:d,autoAriaDisabled:p,centreDraggedOnCursor:f,delayTouchStart:h,dropAnimationDisabled:m,...g}=t;if(Object.keys(g).length>0&&console.warn("dndzone will ignore unknown options",g),!e)throw new Error("no 'items' key provided to dndzone");const $=e.find(t=>!{}.hasOwnProperty.call(t,lo));if($)throw new Error(`missing '${lo}' property for item ${To($)}`);if(u&&!Array.isArray(u))throw new Error(`dropTargetClasses should be an array but instead it is a ${typeof u}, ${To(u)}`);if(l&&!Xs(l))throw new Error(`zoneTabIndex should be a number but instead it is a ${typeof l}, ${To(l)}`);if(c&&!Xs(c))throw new Error(`zoneItemTabIndex should be a number but instead it is a ${typeof c}, ${To(c)}`);if(void 0!==h&&!1!==h){const t=!0===h,e="number"==typeof h&&isFinite(h)&&h>=0;if(!t&&!e)throw new Error(`delayTouchStart should be a boolean (true/false) or a non-negative number but instead it is a ${typeof h}, ${To(h)}`)}}function Xs(t){return!isNaN(t)&&(0|(e=parseFloat(t)))===e;var e}function Ks(t){let e=t;const n=new Set;return{get:()=>e,set:t=>{e=t,Array.from(n).forEach(t=>t(e))},subscribe:t=>{n.add(t),t(e)},unsubscribe:t=>{n.delete(t)}}}function Js(t,{delay:n=0,duration:r=400,easing:o=e}={}){const s=+getComputedStyle(t).opacity;return{delay:n,duration:r,easing:o,css:t=>"opacity: "+t*s}}function Vs(t,{delay:e=0,duration:n=400,easing:r=Ie,x:o=0,y:s=0,opacity:i=0}={}){const l=getComputedStyle(t),c=+l.opacity,a="none"===l.transform?"":l.transform,u=c*(1-i),[d,p]=$(o),[f,h]=$(s);return{delay:e,duration:n,easing:r,css:(t,e)=>`\n\t\t\ttransform: ${a} translate(${(1-t)*d}${p}, ${(1-t)*f}${h});\n\t\t\topacity: ${c-u*e}`}}function Zs(e){let n,r,o;return{c(){n=L("svg"),r=L("g"),o=L("path"),P(o,"d","M38,52a2,2,0,0,1-1.41-.59l-24-24a2,2,0,0,1,0-2.82l24-24a2,2,0,0,1,2.82,0,2,2,0,0,1,0,2.82L16.83,26,39.41,48.59A2,2,0,0,1,38,52Z"),P(n,"version","1.1"),P(n,"xmlns","http://www.w3.org/2000/svg"),P(n,"xmlns:xlink","http://www.w3.org/1999/xlink"),P(n,"x","0px"),P(n,"y","0px"),P(n,"viewBox","0 0 52 52"),P(n,"xml:space","preserve")},m(t,e){A(t,n,e),T(n,r),T(r,o)},p:t,i:t,o:t,d(t){t&&_(n)}}}Ks(!0),Ks(!1);const Qs=class extends Ft{constructor(t){super(),Rt(this,t,null,Zs,i,{})}};function ti(e){let n,r;return{c(){n=L("svg"),r=L("polygon"),P(r,"points","0,490 490,490 245,0"),P(n,"version","1.1"),P(n,"xmlns","http://www.w3.org/2000/svg"),P(n,"xmlns:xlink","http://www.w3.org/1999/xlink"),P(n,"x","0px"),P(n,"y","0px"),P(n,"viewBox","0 0 490 490"),P(n,"xml:space","preserve")},m(t,e){A(t,n,e),T(n,r)},p:t,i:t,o:t,d(t){t&&_(n)}}}const ei=class extends Ft{constructor(t){super(),Rt(this,t,null,ti,i,{})}};function ni(t){let e,n,r,i,l,c,a,u,d,p,f,h,m;return r=new ei({}),a=new ei({}),{c(){e=D("div"),n=D("a"),Nt(r.$$.fragment),i=R(" move up"),l=U(),c=D("a"),Nt(a.$$.fragment),u=R(" move down"),d=U(),p=D("a"),p.textContent="remove",P(n,"href","#up"),P(n,"class","small up svelte-1uea1m1"),q(n,"control-disabled",!t[0]),P(c,"href","#dowm"),P(c,"class","small down svelte-1uea1m1"),q(c,"control-disabled",!t[1]),P(p,"href","#remove"),P(p,"class","small remove svelte-1uea1m1"),q(p,"control-disabled",!t[2]),P(e,"class","controls svelte-1uea1m1")},m(o,g){A(o,e,g),T(e,n),Dt(r,n,null),T(n,i),T(e,l),T(e,c),Dt(a,c,null),T(c,u),T(e,d),T(e,p),f=!0,h||(m=[I(n,"click",j(M(function(){s(t[0])&&t[0].apply(this,arguments)}))),I(c,"click",j(M(function(){s(t[1])&&t[1].apply(this,arguments)}))),I(p,"click",j(M(function(){s(t[2])&&t[2].apply(this,arguments)})))],h=!0)},p(e,[r]){t=e,(!f||1&r)&&q(n,"control-disabled",!t[0]),(!f||2&r)&&q(c,"control-disabled",!t[1]),(!f||4&r)&&q(p,"control-disabled",!t[2])},i(t){f||(bt(r.$$.fragment,t),bt(a.$$.fragment,t),f=!0)},o(t){yt(r.$$.fragment,t),yt(a.$$.fragment,t),f=!1},d(t){t&&_(e),Lt(r),Lt(a),h=!1,o(m)}}}function ri(t,e,n){let{moveUp:r}=e,{moveDown:o}=e,{remove:s}=e;return t.$$set=t=>{"moveUp"in t&&n(0,r=t.moveUp),"moveDown"in t&&n(1,o=t.moveDown),"remove"in t&&n(2,s=t.remove)},[r,o,s]}const oi=class extends Ft{constructor(t){super(),Rt(this,t,ri,ni,i,{moveUp:0,moveDown:1,remove:2})}},si=["Activate","AddUndo","BeforeAddUndo","BeforeExecCommand","BeforeGetContent","BeforeRenderUI","BeforeSetContent","BeforePaste","Blur","Change","ClearUndos","Click","CommentChange","CompositionEnd","CompositionStart","CompositionUpdate","ContextMenu","Copy","Cut","Dblclick","Deactivate","Dirty","Drag","DragDrop","DragEnd","DragGesture","DragOver","Drop","ExecCommand","Focus","FocusIn","FocusOut","GetContent","Hide","Init","Input","KeyDown","KeyPress","KeyUp","LoadContent","MouseDown","MouseEnter","MouseLeave","MouseMove","MouseOut","MouseOver","MouseUp","NodeChange","ObjectResizeStart","ObjectResized","ObjectSelected","Paste","PostProcess","PostRender","PreProcess","ProgressState","Redo","Remove","Reset","ResizeEditor","SaveContent","SelectionChange","SetAttrib","SetContent","Show","Submit","Undo","VisualAid"];function ii(t){let e;return{c(){var n,r;e=D("textarea"),P(e,"id",t[0]),n=e,r="visibility",null=="hidden"?n.style.removeProperty(r):n.style.setProperty(r,"hidden","")},m(n,r){A(n,e,r),t[20](e)},p(t,n){1&n&&P(e,"id",t[0])},d(n){n&&_(e),t[20](null)}}}function li(t){let e;return{c(){e=D("div"),P(e,"id",t[0])},m(n,r){A(n,e,r),t[19](e)},p(t,n){1&n&&P(e,"id",t[0])},d(n){n&&_(e),t[19](null)}}}function ci(e){let n;function r(t,e){return t[1]?li:ii}let o=r(e),s=o(e);return{c(){n=D("div"),s.c(),P(n,"class",e[2])},m(t,r){A(t,n,r),s.m(n,null),e[21](n)},p(t,[e]){o===(o=r(t))&&s?s.p(t,e):(s.d(1),s=o(t),s&&(s.c(),s.m(n,null))),4&e&&P(n,"class",t[2])},i:t,o:t,d(t){t&&_(n),s.d(),e[21](null)}}}const ai=t=>t+"_"+Math.floor(1e9*Math.random())+String(Date.now());let ui=(()=>{let t={listeners:[],scriptId:ai("tiny-script"),scriptLoaded:!1,injected:!1};return{load:(e,n,r)=>{t.scriptLoaded?r():(t.listeners.push(r),t.injected||((e,n,r)=>{t.injected=!0;const o=n.createElement("script");o.referrerPolicy="origin",o.type="application/javascript",o.src=r,o.onload=()=>{t.listeners.forEach(t=>t()),t.scriptLoaded=!0},n.head&&n.head.appendChild(o)})(t.scriptId,e,n))}}})();function di(t,e,n){let r,o,s,{id:i=ai("tinymce-svelte")}=e,{inline:c}=e,{disabled:a=!1}=e,{readonly:u=!1}=e,{apiKey:d="no-api-key"}=e,{licenseKey:p}=e,{channel:f="8"}=e,{scriptSrc:h}=e,{conf:m={}}=e,{modelEvents:g="change input undo redo"}=e,{value:$=""}=e,{text:v=""}=e,{cssClass:b="tinymce-wrapper"}=e,y=$,w=a,x=u;const E=(t,e)=>{var n;"function"==typeof(null===(n=t.mode)||void 0===n?void 0:n.set)&&t.mode.set(e?"readonly":"design")},k=(t,e)=>{(t=>"function"==typeof t.options.set&&t.options.isRegistered("disabled"))(t)?t.options.set("disabled",e):t.mode.set(e?"readonly":"design")},C=function(){const t=V();return(e,n,{cancelable:r=!1}={})=>{const o=t.$$.callbacks[e];if(o){const s=H(e,n,{cancelable:r});return o.slice().forEach(e=>{e.call(t,s)}),!s.defaultPrevented}return!0}}(),T=()=>{const t="undefined"!=typeof window?window:l.g;return t&&t.tinymce?t.tinymce:null},S=()=>{var t;const e=Object.assign(Object.assign({},m),{target:o,inline:void 0!==c?c:void 0!==m.inline&&m.inline,license_key:p,setup:t=>{t.on("PreInit",()=>{k(t,a),E(t,u)}),n(15,s=t),t.on("init",()=>{t.setContent($),t.on(g,()=>{n(16,y=t.getContent()),y!==$&&(n(5,$=y),n(6,v=t.getContent({format:"text"})))})}),((t,e)=>{si.forEach(n=>{t.on(n,r=>{e(n.toLowerCase(),{eventName:n,event:r,editor:t})})})})(t,C),"function"==typeof m.setup&&m.setup(t)}});n(4,o.style.visibility="",o),null===(t=T())||void 0===t||t.init(e)};return Z(()=>{if(null!==T())setTimeout(S,0);else{const t=h||`https://cdn.tiny.cloud/1/${d}/tinymce/${f}/tinymce.min.js`;ui.load(r.ownerDocument,t,()=>{S()})}}),Q(()=>{var t;s&&(null===(t=T())||void 0===t||t.remove(s))}),t.$$set=t=>{"id"in t&&n(0,i=t.id),"inline"in t&&n(1,c=t.inline),"disabled"in t&&n(7,a=t.disabled),"readonly"in t&&n(8,u=t.readonly),"apiKey"in t&&n(9,d=t.apiKey),"licenseKey"in t&&n(10,p=t.licenseKey),"channel"in t&&n(11,f=t.channel),"scriptSrc"in t&&n(12,h=t.scriptSrc),"conf"in t&&n(13,m=t.conf),"modelEvents"in t&&n(14,g=t.modelEvents),"value"in t&&n(5,$=t.value),"text"in t&&n(6,v=t.text),"cssClass"in t&&n(2,b=t.cssClass)},t.$$.update=()=>{491936&t.$$.dirty&&(s&&y!==$&&(s.setContent($),n(6,v=s.getContent({format:"text"}))),s&&u!==x&&(n(18,x=u),E(s,u)),s&&a!==w&&(n(17,w=a),k(s,a)))},[i,c,b,r,o,$,v,a,u,d,p,f,h,m,g,s,y,w,x,function(t){nt[t?"unshift":"push"](()=>{o=t,n(4,o)})},function(t){nt[t?"unshift":"push"](()=>{o=t,n(4,o)})},function(t){nt[t?"unshift":"push"](()=>{r=t,n(3,r)})}]}const pi=class extends Ft{constructor(t){super(),Rt(this,t,di,ci,i,{id:0,inline:1,disabled:7,readonly:8,apiKey:9,licenseKey:10,channel:11,scriptSrc:12,conf:13,modelEvents:14,value:5,text:6,cssClass:2})}};function fi(t){let e,n,r;function o(e){t[4](e)}let s={apiKey:"okcf1pz4foebbixgcdydveaavknj41e62etldhxguuyug0v3",scriptSrc:t[3],conf:t[2],disabled:t[1]};return void 0!==t[0]&&(s.value=t[0]),e=new pi({props:s}),nt.push(()=>_t(e,"value",o)),{c(){Nt(e.$$.fragment)},m(t,n){Dt(e,t,n),r=!0},p(t,[r]){const o={};2&r&&(o.disabled=t[1]),!n&&1&r&&(n=!0,o.value=t[0],ct(()=>n=!1)),e.$set(o)},i(t){r||(bt(e.$$.fragment,t),r=!0)},o(t){yt(e.$$.fragment,t),r=!1},d(t){Lt(e,t)}}}function hi(t,e,n){let{value:r}=e,{disabled:o=!1}=e;return t.$$set=t=>{"value"in t&&n(0,r=t.value),"disabled"in t&&n(1,o=t.disabled)},[r,o,{plugins:"code",toolbar:"undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | outdent indent | code",promotion:!1},"tinymce/tinymce.min.js",function(t){r=t,n(0,r)}]}const mi=class extends Ft{constructor(t){super(),Rt(this,t,hi,fi,i,{value:0,disabled:1})}};function gi(t){let e,n,r,s,i,l;return{c(){e=D("div"),n=D("span"),n.textContent="URL",r=U(),s=D("span"),P(n,"class","label svelte-1bcq7l1"),P(s,"class","url svelte-1bcq7l1"),P(s,"aria-label","URL"),P(s,"contenteditable",""),P(s,"role","textbox"),P(s,"tabindex","0"),void 0===t[3]&&lt(()=>t[13].call(s)),P(e,"class","field svelte-1bcq7l1")},m(o,c){A(o,e,c),T(e,n),T(e,r),T(e,s),void 0!==t[3]&&(s.innerText=t[3]),i||(l=[I(s,"input",t[13]),I(s,"keydown",t[11])],i=!0)},p(t,e){8&e&&t[3]!==s.innerText&&(s.innerText=t[3])},d(t){t&&_(e),i=!1,o(l)}}}function $i(e){let n,r,o,s;return{c(){n=D("textarea"),n.disabled=r=e[2]&&e[4],P(n,"class","svelte-1bcq7l1")},m(t,r){A(t,n,r),B(n,e[1]),o||(s=I(n,"input",e[15]),o=!0)},p(t,e){20&e&&r!==(r=t[2]&&t[4])&&(n.disabled=r),2&e&&B(n,t[1])},i:t,o:t,d(t){t&&_(n),o=!1,s()}}}function vi(t){let e,n,r;function o(e){t[14](e)}let s={disabled:t[2]&&t[4]};return void 0!==t[1]&&(s.value=t[1]),e=new mi({props:s}),nt.push(()=>_t(e,"value",o)),{c(){Nt(e.$$.fragment)},m(t,n){Dt(e,t,n),r=!0},p(t,r){const o={};20&r&&(o.disabled=t[2]&&t[4]),!n&&2&r&&(n=!0,o.value=t[1],ct(()=>n=!1)),e.$set(o)},i(t){r||(bt(e.$$.fragment,t),r=!0)},o(t){yt(e.$$.fragment,t),r=!1},d(t){Lt(e,t)}}}function bi(t){let e,n,r,o,s;return{c(){e=D("label"),n=D("input"),r=R(" Fetch contents"),P(n,"type","checkbox"),P(n,"class","svelte-1bcq7l1"),P(e,"class","svelte-1bcq7l1")},m(i,l){A(i,e,l),T(e,n),n.checked=t[2],T(e,r),o||(s=I(n,"change",t[16]),o=!0)},p(t,e){4&e&&(n.checked=t[2])},d(t){t&&_(e),o=!1,s()}}}function yi(t){let e,n,r,o;return r=new oi({props:{moveUp:t[6],moveDown:t[7],remove:t[8]}}),{c(){e=D("span"),n=U(),Nt(r.$$.fragment)},m(t,s){A(t,e,s),A(t,n,s),Dt(r,t,s),o=!0},p(t,e){const n={};64&e&&(n.moveUp=t[6]),128&e&&(n.moveDown=t[7]),256&e&&(n.remove=t[8]),r.$set(n)},i(t){o||(bt(r.$$.fragment,t),o=!0)},o(t){yt(r.$$.fragment,t),o=!1},d(t){t&&(_(e),_(n)),Lt(r,t)}}}function wi(t){let e,n,r,i,l,c,a,u,d,p,f,h,m,g,$,v,b,y,w,x;r=new Qs({});let E=void 0!==t[3]&&gi(t);const k=[vi,$i],C=[];function S(t,e){return t[10].useTiny?0:1}m=S(t),g=C[m]=k[m](t);let O=t[4]&&bi(t),N=!t[9]&&yi(t);return{c(){e=D("h3"),n=D("a"),Nt(r.$$.fragment),i=R(" back"),l=U(),c=D("div"),a=D("div"),u=D("span"),u.textContent="Title",d=U(),p=D("span"),f=U(),E&&E.c(),h=U(),g.c(),$=U(),O&&O.c(),v=U(),N&&N.c(),b=F(),P(n,"href","#home"),P(n,"class","homelink svelte-1bcq7l1"),P(e,"class","back svelte-1bcq7l1"),P(u,"class","label svelte-1bcq7l1"),P(p,"class","title svelte-1bcq7l1"),P(p,"aria-label","Title"),P(p,"contenteditable",""),P(p,"role","textbox"),P(p,"tabindex","0"),void 0===t[0]&&lt(()=>t[12].call(p)),P(a,"class","field svelte-1bcq7l1"),P(c,"class","chapter edit svelte-1bcq7l1")},m(o,g){A(o,e,g),T(e,n),Dt(r,n,null),T(n,i),A(o,l,g),A(o,c,g),T(c,a),T(a,u),T(a,d),T(a,p),void 0!==t[0]&&(p.innerText=t[0]),T(c,f),E&&E.m(c,null),T(c,h),C[m].m(c,null),T(c,$),O&&O.m(c,null),A(o,v,g),N&&N.m(o,g),A(o,b,g),y=!0,w||(x=[I(n,"click",M(function(){s(t[5])&&t[5].apply(this,arguments)})),I(p,"input",t[12]),I(p,"keydown",t[11])],w=!0)},p(e,n){t=e,1&n&&t[0]!==p.innerText&&(p.innerText=t[0]),void 0!==t[3]?E?E.p(t,n):(E=gi(t),E.c(),E.m(c,h)):E&&(E.d(1),E=null);let r=m;m=S(t),m===r?C[m].p(t,n):($t(),yt(C[r],1,1,()=>{C[r]=null}),vt(),g=C[m],g?g.p(t,n):(g=C[m]=k[m](t),g.c()),bt(g,1),g.m(c,$)),t[4]?O?O.p(t,n):(O=bi(t),O.c(),O.m(c,null)):O&&(O.d(1),O=null),t[9]?N&&($t(),yt(N,1,1,()=>{N=null}),vt()):N?(N.p(t,n),512&n&&bt(N,1)):(N=yi(t),N.c(),bt(N,1),N.m(b.parentNode,b))},i(t){y||(bt(r.$$.fragment,t),bt(g),bt(N),y=!0)},o(t){yt(r.$$.fragment,t),yt(g),yt(N),y=!1},d(t){t&&(_(e),_(l),_(c),_(v),_(b)),Lt(r),E&&E.d(),C[m].d(),O&&O.d(),N&&N.d(t),w=!1,o(x)}}}function xi(t){let e,n;return e=new jt({props:{onSubmit:t[5],$$slots:{default:[wi]},$$scope:{ctx:t}}}),{c(){Nt(e.$$.fragment)},m(t,r){Dt(e,t,r),n=!0},p(t,[n]){const r={};32&n&&(r.onSubmit=t[5]),133119&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(bt(e.$$.fragment,t),n=!0)},o(t){yt(e.$$.fragment,t),n=!1},d(t){Lt(e,t)}}}function Ei(t,e,n){let r;u(t,Jt,t=>n(10,r=t));let{title:o}=e,{content:s}=e,{needsFetching:i}=e,{url:l}=e,{canFetch:c=!1}=e,{close:a}=e,{moveUp:d}=e,{moveDown:p}=e,{remove:f}=e,{hideControls:h=!1}=e;return i=null==i||i,s=null!=s?s:"",t.$$set=t=>{"title"in t&&n(0,o=t.title),"content"in t&&n(1,s=t.content),"needsFetching"in t&&n(2,i=t.needsFetching),"url"in t&&n(3,l=t.url),"canFetch"in t&&n(4,c=t.canFetch),"close"in t&&n(5,a=t.close),"moveUp"in t&&n(6,d=t.moveUp),"moveDown"in t&&n(7,p=t.moveDown),"remove"in t&&n(8,f=t.remove),"hideControls"in t&&n(9,h=t.hideControls)},[o,s,i,l,c,a,d,p,f,h,r,t=>{"Enter"!==t.key&&13!==t.keyCode||t.preventDefault()},function(){o=this.innerText,n(0,o)},function(){l=this.innerText,n(3,l)},function(t){s=t,n(1,s)},function(){s=this.value,n(1,s)},function(){i=this.checked,n(2,i)}]}const ki=class extends Ft{constructor(t){super(),Rt(this,t,Ei,xi,i,{title:0,content:1,needsFetching:2,url:3,canFetch:4,close:5,moveUp:6,moveDown:7,remove:8,hideControls:9})}};function Ci(t){let e,n;return{c(){e=D("span"),n=R(t[5]),P(e,"class","content svelte-1peomaw")},m(t,r){A(t,e,r),T(e,n)},p(t,e){32&e&&z(n,t[5])},d(t){t&&_(e)}}}function Ti(t){let e,n,r,i,l,c,a,u,d,p,f,h,m,g=!t[6]&&Ci(t);return p=new oi({props:{moveUp:t[2],moveDown:t[3],remove:t[4]}}),{c(){e=D("div"),n=D("div"),r=D("span"),i=R(t[0]),l=U(),g&&g.c(),c=U(),a=D("a"),a.textContent="×",u=U(),d=D("div"),Nt(p.$$.fragment),P(r,"class","title svelte-1peomaw"),P(r,"aria-label","Title"),P(a,"class","small remove svelte-1peomaw"),P(a,"href","#remove"),P(n,"class","preview svelte-1peomaw"),q(n,"empty",t[6]),P(d,"class","more svelte-1peomaw"),P(e,"class","chapter svelte-1peomaw"),P(e,"tabindex","0"),P(e,"title",t[0]),P(e,"role","button")},m(o,$){A(o,e,$),T(e,n),T(n,r),T(r,i),T(n,l),g&&g.m(n,null),T(n,c),T(n,a),T(e,u),T(e,d),Dt(p,d,null),f=!0,h||(m=[I(a,"click",M(function(){s(t[4])&&t[4].apply(this,arguments)})),I(e,"click",function(){s(t[1])&&t[1].apply(this,arguments)}),I(e,"keydown",t[7]),I(e,"contextmenu",M(t[9]))],h=!0)},p(r,[o]){t=r,(!f||1&o)&&z(i,t[0]),t[6]?g&&(g.d(1),g=null):g?g.p(t,o):(g=Ci(t),g.c(),g.m(n,c)),(!f||64&o)&&q(n,"empty",t[6]);const s={};4&o&&(s.moveUp=t[2]),8&o&&(s.moveDown=t[3]),16&o&&(s.remove=t[4]),p.$set(s),(!f||1&o)&&P(e,"title",t[0])},i(t){f||(bt(p.$$.fragment,t),f=!0)},o(t){yt(p.$$.fragment,t),f=!1},d(t){t&&_(e),g&&g.d(),Lt(p),h=!1,o(m)}}}function Si(t,e,n){let r,{title:o}=e,{content:s}=e,{select:i}=e,{moveUp:l}=e,{moveDown:c}=e,{remove:a}=e;s=null!=s?s:"";let u="";return t.$$set=t=>{"title"in t&&n(0,o=t.title),"content"in t&&n(8,s=t.content),"select"in t&&n(1,i=t.select),"moveUp"in t&&n(2,l=t.moveUp),"moveDown"in t&&n(3,c=t.moveDown),"remove"in t&&n(4,a=t.remove)},t.$$.update=()=>{256&t.$$.dirty&&n(6,r=!s||!s.trim().length),256&t.$$.dirty&&setTimeout(()=>n(5,u=ze(s||"")),0)},[o,i,l,c,a,u,r,t=>{"Enter"!==t.key&&13!==t.keyCode||i()},s,function(e){tt.call(this,t,e)}]}const Oi=class extends Ft{constructor(t){super(),Rt(this,t,Si,Ti,i,{title:0,content:8,select:1,moveUp:2,moveDown:3,remove:4})}};function Ai(t){let e,n,r;return{c(){e=D("span"),P(e,"class","edit svelte-3l8ef2"),P(e,"contenteditable",""),P(e,"role","textbox"),P(e,"tabindex","0"),void 0===t[0].title&&lt(()=>t[13].call(e))},m(o,s){A(o,e,s),void 0!==t[0].title&&(e.innerText=t[0].title),n||(r=[I(e,"input",t[13]),I(e,"keydown",t[8])],n=!0)},p(t,n){1&n&&t[0].title!==e.innerText&&(e.innerText=t[0].title)},d(t){t&&_(e),n=!1,o(r)}}}function _i(t){let e,n,r,o=t[0].title+"";return{c(){e=D("a"),n=R(o),P(e,"href",r=Pe(t[2])),P(e,"target","_blank")},m(t,r){A(t,e,r),T(e,n)},p(t,s){1&s&&o!==(o=t[0].title+"")&&z(n,o),4&s&&r!==(r=Pe(t[2]))&&P(e,"href",r)},d(t){t&&_(e)}}}function Ni(t){let e,n,r;return{c(){e=D("span"),P(e,"class","edit svelte-3l8ef2"),P(e,"contenteditable",""),P(e,"role","textbox"),P(e,"tabindex","0"),void 0===t[0].author&&lt(()=>t[14].call(e))},m(o,s){A(o,e,s),void 0!==t[0].author&&(e.innerText=t[0].author),n||(r=[I(e,"input",t[14]),I(e,"keydown",t[8])],n=!0)},p(t,n){1&n&&t[0].author!==e.innerText&&(e.innerText=t[0].author)},d(t){t&&_(e),n=!1,o(r)}}}function Di(t){let e,n=t[0].author+"";return{c(){e=R(n)},m(t,n){A(t,e,n)},p(t,r){1&r&&n!==(n=t[0].author+"")&&z(e,n)},d(t){t&&_(e)}}}function Li(e){let n;return{c(){n=D("i"),n.textContent="None set"},m(t,e){A(t,n,e)},p:t,d(t){t&&_(n)}}}function Ri(t){let e,n;return{c(){e=D("img"),a(e.src,n=t[6])||P(e,"src",n),P(e,"alt","cover"),P(e,"class","svelte-3l8ef2")},m(t,n){A(t,e,n)},p(t,r){64&r&&!a(e.src,n=t[6])&&P(e,"src",n)},d(t){t&&_(e)}}}function Ui(e){let n,r,s,i,l;return{c(){n=D("input"),r=U(),s=D("input"),P(n,"type","file"),P(n,"accept","image/*"),P(s,"type","button"),s.value="Clear"},m(t,o){A(t,n,o),A(t,r,o),A(t,s,o),i||(l=[I(n,"change",e[9]),I(s,"click",M(e[15]))],i=!0)},p:t,d(t){t&&(_(n),_(r),_(s)),i=!1,o(l)}}}function Fi(e){let n,r,o;return{c(){n=D("textarea")},m(t,s){A(t,n,s),B(n,e[0].description),r||(o=I(n,"input",e[17]),r=!0)},p(t,e){1&e&&B(n,t[0].description)},i:t,o:t,d(t){t&&_(n),r=!1,o()}}}function Ii(t){let e,n,r;function o(e){t[16](e)}let s={};return void 0!==t[0].description&&(s.value=t[0].description),e=new mi({props:s}),nt.push(()=>_t(e,"value",o)),{c(){Nt(e.$$.fragment)},m(t,n){Dt(e,t,n),r=!0},p(t,r){const o={};!n&&1&r&&(n=!0,o.value=t[0].description,ct(()=>n=!1)),e.$set(o)},i(t){r||(bt(e.$$.fragment,t),r=!0)},o(t){yt(e.$$.fragment,t),r=!1},d(t){Lt(e,t)}}}function Mi(e){let n;return{c(){n=D("i"),n.textContent="None set"},m(t,e){A(t,n,e)},p:t,i:t,o:t,d(t){t&&_(n)}}}function ji(e){let n,r,o=e[0].description+"";return{c(){n=new G(!1),r=F(),n.a=r},m(t,e){n.m(o,t,e),A(t,r,e)},p(t,e){1&e&&o!==(o=t[0].description+"")&&n.p(o)},i:t,o:t,d(t){t&&(_(r),n.d())}}}function Pi(t){let e,n,r,i,l,c,a,u;return{c(){e=D("h3"),e.textContent="Actions",n=U(),r=D("p"),i=D("button"),i.textContent="Transform all",l=U(),c=D("button"),c.textContent="Fetch all"},m(o,d){A(o,e,d),A(o,n,d),A(o,r,d),T(r,i),T(r,l),T(r,c),a||(u=[I(i,"click",M(function(){s(t[4])&&t[4].apply(this,arguments)})),I(c,"click",M(function(){s(t[5])&&t[5].apply(this,arguments)}))],a=!0)},p(e,n){t=e},d(t){t&&(_(e),_(n),_(r)),a=!1,o(u)}}}function zi(t){let e,n,r,o;const s=t[12].default,i=d(s,t,t[18],null);return{c(){e=D("h3"),e.textContent="Chapters",n=U(),r=D("div"),i&&i.c()},m(t,s){A(t,e,s),A(t,n,s),A(t,r,s),i&&i.m(r,null),o=!0},p(t,e){i&&i.p&&(!o||262144&e)&&h(i,s,t,t[18],o?f(s,t[18],e,null):m(t[18]),null)},i(t){o||(bt(i,t),o=!0)},o(t){yt(i,t),o=!1},d(t){t&&(_(e),_(n),_(r)),i&&i.d(t)}}}function Bi(t){let e,n,r,o,s,i,l,c,a,u,d,p,f,h,m,g,$,v,b,y,w,x;function E(t,e){return t[1]?Ai:_i}let k=E(t),C=k(t);function S(t,e){return t[1]?Ni:Di}let O=S(t),N=O(t);function L(t,e){return t[0].cover?Ri:Li}let R=L(t),I=R(t),M=t[1]&&Ui(t);const j=[ji,Mi,Ii,Fi],z=[];function B(t,e){return!t[1]&&t[0].description?0:t[1]?t[7].useTiny?2:3:1}$=B(t),v=z[$]=j[$](t);let q=t[1]&&Pi(t),H=t[10].default&&zi(t);return{c(){e=D("h3"),e.textContent="Title",n=U(),r=D("p"),C.c(),o=U(),s=D("h3"),s.textContent="Author",i=U(),l=D("p"),N.c(),c=U(),a=D("h3"),a.textContent="Cover",u=U(),d=D("p"),I.c(),p=U(),M&&M.c(),f=U(),h=D("h3"),h.textContent="Description",m=U(),g=D("div"),v.c(),b=U(),q&&q.c(),y=U(),H&&H.c(),w=F(),P(g,"class","wrap svelte-3l8ef2")},m(t,v){A(t,e,v),A(t,n,v),A(t,r,v),C.m(r,null),A(t,o,v),A(t,s,v),A(t,i,v),A(t,l,v),N.m(l,null),A(t,c,v),A(t,a,v),A(t,u,v),A(t,d,v),I.m(d,null),T(d,p),M&&M.m(d,null),A(t,f,v),A(t,h,v),A(t,m,v),A(t,g,v),z[$].m(g,null),A(t,b,v),q&&q.m(t,v),A(t,y,v),H&&H.m(t,v),A(t,w,v),x=!0},p(t,e){k===(k=E(t))&&C?C.p(t,e):(C.d(1),C=k(t),C&&(C.c(),C.m(r,null))),O===(O=S(t))&&N?N.p(t,e):(N.d(1),N=O(t),N&&(N.c(),N.m(l,null))),R===(R=L(t))&&I?I.p(t,e):(I.d(1),I=R(t),I&&(I.c(),I.m(d,p))),t[1]?M?M.p(t,e):(M=Ui(t),M.c(),M.m(d,null)):M&&(M.d(1),M=null);let n=$;$=B(t),$===n?z[$].p(t,e):($t(),yt(z[n],1,1,()=>{z[n]=null}),vt(),v=z[$],v?v.p(t,e):(v=z[$]=j[$](t),v.c()),bt(v,1),v.m(g,null)),t[1]?q?q.p(t,e):(q=Pi(t),q.c(),q.m(y.parentNode,y)):q&&(q.d(1),q=null),t[10].default?H?(H.p(t,e),1024&e&&bt(H,1)):(H=zi(t),H.c(),bt(H,1),H.m(w.parentNode,w)):H&&($t(),yt(H,1,1,()=>{H=null}),vt())},i(t){x||(bt(v),bt(H),x=!0)},o(t){yt(v),yt(H),x=!1},d(t){t&&(_(e),_(n),_(r),_(o),_(s),_(i),_(l),_(c),_(a),_(u),_(d),_(f),_(h),_(m),_(g),_(b),_(y),_(w)),C.d(),N.d(),I.d(),M&&M.d(),z[$].d(),q&&q.d(t),H&&H.d(t)}}}function qi(t){let e,n;return e=new jt({props:{onSubmit:t[3],$$slots:{default:[Bi]},$$scope:{ctx:t}}}),{c(){Nt(e.$$.fragment)},m(t,r){Dt(e,t,r),n=!0},p(t,[n]){const r={};8&n&&(r.onSubmit=t[3]),263415&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(bt(e.$$.fragment,t),n=!0)},o(t){yt(e.$$.fragment,t),n=!1},d(t){Lt(e,t)}}}function Hi(t,e,n){let r;u(t,Jt,t=>n(7,r=t));let{$$slots:o={},$$scope:s}=e;const i=function(t){const e={};for(const n in t)e[n]=!0;return e}(o);let l,{edit:c=!1}=e,{data:a}=e,{url:d=""}=e,{onSubmit:p}=e,{onTransformAll:f}=e,{onFetchAll:h}=e;const m=new FileReader;return m.onload=()=>n(6,l=m.result),t.$$set=t=>{"edit"in t&&n(1,c=t.edit),"data"in t&&n(0,a=t.data),"url"in t&&n(2,d=t.url),"onSubmit"in t&&n(3,p=t.onSubmit),"onTransformAll"in t&&n(4,f=t.onTransformAll),"onFetchAll"in t&&n(5,h=t.onFetchAll),"$$scope"in t&&n(18,s=t.$$scope)},t.$$.update=()=>{if(2049&t.$$.dirty&&(l&&URL.revokeObjectURL(l),a.cover))try{m.abort(),m.readAsDataURL(a.cover)}catch(t){console.error(t),n(0,a.cover=void 0,a)}},[a,c,d,p,f,h,l,r,t=>{"Enter"!==t.key&&13!==t.keyCode||t.preventDefault()},async t=>{t.currentTarget.files&&t.currentTarget.files.length?n(0,a.cover=t.currentTarget.files[0],a):n(0,a.cover=void 0,a)},i,m,o,function(){a.title=this.innerText,n(0,a),n(11,m)},function(){a.author=this.innerText,n(0,a),n(11,m)},()=>n(0,a.cover=void 0,a),function(e){t.$$.not_equal(a.description,e)&&(a.description=e,n(0,a),n(11,m))},function(){a.description=this.value,n(0,a),n(11,m)},s]}const Gi=class extends Ft{constructor(t){super(),Rt(this,t,Hi,qi,i,{edit:1,data:0,url:2,onSubmit:3,onTransformAll:4,onFetchAll:5})}};function Wi(t,e,n){const r=t.slice();return r[57]=e[n],r}function Yi(t,e,n){const r=t.slice();return r[60]=e[n],r[62]=n,r}function Xi(t,e){let n,r,o;function s(){return e[23](e[62])}return r=new Oi({props:{title:e[60].title,content:e[60].transformedContent,select:s,moveUp:e[2]>0||e[62]>0?e[14].bind(null,e[13](e[62])):void 0,moveDown:e[2]<e[3]||e[62]<e[8].length-1?e[15].bind(null,e[13](e[62])):void 0,remove:e[16].bind(null,e[13](e[62]))}}),{key:t,first:null,c(){n=F(),Nt(r.$$.fragment),this.first=n},m(t,e){A(t,n,e),Dt(r,t,e),o=!0},p(t,n){e=t;const o={};256&n[0]&&(o.title=e[60].title),256&n[0]&&(o.content=e[60].transformedContent),272&n[0]&&(o.select=s),260&n[0]&&(o.moveUp=e[2]>0||e[62]>0?e[14].bind(null,e[13](e[62])):void 0),268&n[0]&&(o.moveDown=e[2]<e[3]||e[62]<e[8].length-1?e[15].bind(null,e[13](e[62])):void 0),256&n[0]&&(o.remove=e[16].bind(null,e[13](e[62]))),r.$set(o)},i(t){o||(bt(r.$$.fragment,t),o=!0)},o(t){yt(r.$$.fragment,t),o=!1},d(t){t&&_(n),Lt(r,t)}}}function Ki(t){let e,n,r,i,l,c,a,u,d,p=null!==t[7].pre&&Ji(t),f=Ct(t[7].pages),h=[];for(let e=0;e<f.length;e+=1)h[e]=Vi(Wi(t,f,e));let m=null!==t[7].post&&Zi(t);return{c(){e=D("nav"),n=D("a"),n.textContent="Previous",r=R("\n          ::\n          "),p&&p.c(),i=U();for(let t=0;t<h.length;t+=1)h[t].c();l=U(),m&&m.c(),c=R("\n          ::\n          "),a=D("a"),a.textContent="Next",P(n,"class","small svelte-4zf6uq"),P(n,"href","#prevous"),q(n,"disabled",t[2]<=0),P(a,"class","small svelte-4zf6uq"),P(a,"href","#next"),q(a,"disabled",t[2]>=t[3]),P(e,"class","svelte-4zf6uq")},m(o,f){A(o,e,f),T(e,n),T(e,r),p&&p.m(e,null),T(e,i);for(let t=0;t<h.length;t+=1)h[t]&&h[t].m(e,null);T(e,l),m&&m.m(e,null),T(e,c),T(e,a),u||(d=[I(n,"click",M(function(){s(t[17].bind(null,t[2]-1))&&t[17].bind(null,t[2]-1).apply(this,arguments)})),I(a,"click",M(function(){s(t[17].bind(null,t[2]+1))&&t[17].bind(null,t[2]+1).apply(this,arguments)}))],u=!0)},p(r,o){if(t=r,4&o[0]&&q(n,"disabled",t[2]<=0),null!==t[7].pre?p?p.p(t,o):(p=Ji(t),p.c(),p.m(e,i)):p&&(p.d(1),p=null),131204&o[0]){let n;for(f=Ct(t[7].pages),n=0;n<f.length;n+=1){const r=Wi(t,f,n);h[n]?h[n].p(r,o):(h[n]=Vi(r),h[n].c(),h[n].m(e,l))}for(;n<h.length;n+=1)h[n].d(1);h.length=f.length}null!==t[7].post?m?m.p(t,o):(m=Zi(t),m.c(),m.m(e,c)):m&&(m.d(1),m=null),12&o[0]&&q(a,"disabled",t[2]>=t[3])},d(t){t&&_(e),p&&p.d(),N(h,t),m&&m.d(),u=!1,o(d)}}}function Ji(t){let e,n,r,o,i,l,c=t[7].pre+"";return{c(){e=D("a"),n=R(c),o=R("\n            ."),P(e,"class","small svelte-4zf6uq"),P(e,"href",r=`#page ${t[7].pre}`)},m(r,c){A(r,e,c),T(e,n),A(r,o,c),i||(l=I(e,"click",M(function(){s(t[17].bind(null,t[7].pre-1))&&t[17].bind(null,t[7].pre-1).apply(this,arguments)})),i=!0)},p(o,s){t=o,128&s[0]&&c!==(c=t[7].pre+"")&&z(n,c),128&s[0]&&r!==(r=`#page ${t[7].pre}`)&&P(e,"href",r)},d(t){t&&(_(e),_(o)),i=!1,l()}}}function Vi(t){let e,n,r,o,i,l=t[57]+1+"";return{c(){e=D("a"),n=R(l),P(e,"class","small svelte-4zf6uq"),P(e,"href",r=`#page ${t[57]+1}`),q(e,"current",t[57]==t[2])},m(r,l){A(r,e,l),T(e,n),o||(i=I(e,"click",M(function(){s(t[17].bind(null,t[57]))&&t[17].bind(null,t[57]).apply(this,arguments)})),o=!0)},p(o,s){t=o,128&s[0]&&l!==(l=t[57]+1+"")&&z(n,l),128&s[0]&&r!==(r=`#page ${t[57]+1}`)&&P(e,"href",r),132&s[0]&&q(e,"current",t[57]==t[2])},d(t){t&&_(e),o=!1,i()}}}function Zi(t){let e,n,r,o,i,l,c=t[7].post+"";return{c(){e=R(".\n            "),n=D("a"),r=R(c),P(n,"class","small svelte-4zf6uq"),P(n,"href",o=`#page ${t[7].post}`)},m(o,c){A(o,e,c),A(o,n,c),T(n,r),i||(l=I(n,"click",M(function(){s(t[17].bind(null,t[7].post-1))&&t[17].bind(null,t[7].post-1).apply(this,arguments)})),i=!0)},p(e,s){t=e,128&s[0]&&c!==(c=t[7].post+"")&&z(r,c),128&s[0]&&o!==(o=`#page ${t[7].post}`)&&P(n,"href",o)},d(t){t&&(_(e),_(n)),i=!1,l()}}}function Qi(t){let e,n,r,i,l,c,a,u,d,p,f,h,m=[],$=new Map,v=Ct(t[8]);const b=t=>t[60].id;for(let e=0;e<v.length;e+=1){let n=Yi(t,v,e),r=b(n);$.set(r,m[e]=Xi(r,n))}let y=t[1].chapters.length>0&&Ki(t);return{c(){e=D("div");for(let t=0;t<m.length;t+=1)m[t].c();r=U(),y&&y.c(),i=U(),l=D("button"),l.textContent="Add new",c=U(),a=D("button"),a.textContent="Add bulk",u=U(),d=D("a"),d.textContent="Remove all",P(e,"class","chapters svelte-4zf6uq"),P(d,"class","small remove svelte-4zf6uq"),P(d,"href","#clear")},m(o,s){A(o,e,s);for(let t=0;t<m.length;t+=1)m[t]&&m[t].m(e,null);A(o,r,s),y&&y.m(o,s),A(o,i,s),A(o,l,s),A(o,c,s),A(o,a,s),A(o,u,s),A(o,d,s),p=!0,f||(h=[g(n=Ws.call(null,e,{items:t[8],flipDurationMs:il})),I(e,"consider",t[18]),I(e,"finalize",t[18]),I(l,"click",M(t[24])),I(a,"click",M(t[25])),I(d,"click",M(t[26]))],f=!0)},p(t,r){123164&r[0]&&(v=Ct(t[8]),$t(),m=Ot(m,r,b,1,t,v,$,e,St,Xi,null,Yi),vt()),n&&s(n.update)&&256&r[0]&&n.update.call(null,{items:t[8],flipDurationMs:il}),t[1].chapters.length>0?y?y.p(t,r):(y=Ki(t),y.c(),y.m(i.parentNode,i)):y&&(y.d(1),y=null)},i(t){if(!p){for(let t=0;t<v.length;t+=1)bt(m[t]);p=!0}},o(t){for(let t=0;t<m.length;t+=1)yt(m[t]);p=!1},d(t){t&&(_(e),_(r),_(i),_(l),_(c),_(a),_(u),_(d));for(let t=0;t<m.length;t+=1)m[t].d();y&&y.d(t),f=!1,o(h)}}}function tl(t){let e,n,r,s,i,l,c,a,u,d;function p(e){t[29](e)}function f(e){t[30](e)}function h(e){t[31](e)}function m(e){t[32](e)}let g={canFetch:!!t[5].apiUrl,close:t[28],moveUp:t[2]>0||t[4]>0?t[14].bind(null,t[4]):void 0,moveDown:t[2]<t[3]||t[4]<t[8].length-1?t[15].bind(null,t[4]):void 0,remove:t[16].bind(null,t[4])};return void 0!==t[5].title&&(g.title=t[5].title),void 0!==t[5].transformedContent&&(g.content=t[5].transformedContent),void 0!==t[5].needsFetching&&(g.needsFetching=t[5].needsFetching),void 0!==t[5].displayUrl&&(g.url=t[5].displayUrl),n=new ki({props:g}),nt.push(()=>_t(n,"title",p)),nt.push(()=>_t(n,"content",f)),nt.push(()=>_t(n,"needsFetching",h)),nt.push(()=>_t(n,"url",m)),{c(){e=D("div"),Nt(n.$$.fragment),P(e,"class","svelte-4zf6uq"),q(e,"float",t[11])},m(r,o){A(r,e,o),Dt(n,e,null),a=!0,u||(d=[I(e,"introend",t[33]),I(e,"outrostart",t[34]),I(e,"outroend",t[35])],u=!0)},p(t,o){const c={};32&o[0]&&(c.canFetch=!!t[5].apiUrl),48&o[0]&&(c.close=t[28]),20&o[0]&&(c.moveUp=t[2]>0||t[4]>0?t[14].bind(null,t[4]):void 0),284&o[0]&&(c.moveDown=t[2]<t[3]||t[4]<t[8].length-1?t[15].bind(null,t[4]):void 0),16&o[0]&&(c.remove=t[16].bind(null,t[4])),!r&&32&o[0]&&(r=!0,c.title=t[5].title,ct(()=>r=!1)),!s&&32&o[0]&&(s=!0,c.content=t[5].transformedContent,ct(()=>s=!1)),!i&&32&o[0]&&(i=!0,c.needsFetching=t[5].needsFetching,ct(()=>i=!1)),!l&&32&o[0]&&(l=!0,c.url=t[5].displayUrl,ct(()=>l=!1)),n.$set(c),(!a||2048&o[0])&&q(e,"float",t[11])},i(t){a||(bt(n.$$.fragment,t),t&&lt(()=>{a&&(c||(c=xt(e,Vs,{x:50,duration:200},!0)),c.run(1))}),a=!0)},o(t){yt(n.$$.fragment,t),t&&(c||(c=xt(e,Vs,{x:50,duration:200},!1)),c.run(0)),a=!1},d(t){t&&_(e),Lt(n),t&&c&&c.end(),u=!1,o(d)}}}function el(t){let e,n,r,s,i,l,c,a,u,d;function p(e){t[37](e)}function f(e){t[38](e)}function h(e){t[39](e)}function m(e){t[40](e)}let g={canFetch:!!t[6].apiUrl,hideControls:!0,close:t[36]};return void 0!==t[6].title&&(g.title=t[6].title),void 0!==t[6].transformedContent&&(g.content=t[6].transformedContent),void 0!==t[6].needsFetching&&(g.needsFetching=t[6].needsFetching),void 0!==t[6].displayUrl&&(g.url=t[6].displayUrl),n=new ki({props:g}),nt.push(()=>_t(n,"title",p)),nt.push(()=>_t(n,"content",f)),nt.push(()=>_t(n,"needsFetching",h)),nt.push(()=>_t(n,"url",m)),{c(){e=D("div"),Nt(n.$$.fragment),P(e,"class","svelte-4zf6uq"),q(e,"float",t[11])},m(r,o){A(r,e,o),Dt(n,e,null),a=!0,u||(d=[I(e,"introend",t[41]),I(e,"outrostart",t[42]),I(e,"outroend",t[43])],u=!0)},p(t,o){const c={};64&o[0]&&(c.canFetch=!!t[6].apiUrl),66&o[0]&&(c.close=t[36]),!r&&64&o[0]&&(r=!0,c.title=t[6].title,ct(()=>r=!1)),!s&&64&o[0]&&(s=!0,c.content=t[6].transformedContent,ct(()=>s=!1)),!i&&64&o[0]&&(i=!0,c.needsFetching=t[6].needsFetching,ct(()=>i=!1)),!l&&64&o[0]&&(l=!0,c.url=t[6].displayUrl,ct(()=>l=!1)),n.$set(c),(!a||2048&o[0])&&q(e,"float",t[11])},i(t){a||(bt(n.$$.fragment,t),t&&lt(()=>{a&&(c||(c=xt(e,Vs,{x:50,duration:200},!0)),c.run(1))}),a=!0)},o(t){yt(n.$$.fragment,t),t&&(c||(c=xt(e,Vs,{x:50,duration:200},!1)),c.run(0)),a=!1},d(t){t&&_(e),Lt(n),t&&c&&c.end(),u=!1,o(d)}}}function nl(t){let e,n,r,s,i,l;return n=new jt({props:{onSubmit:t[22],$$slots:{default:[rl]},$$scope:{ctx:t}}}),{c(){e=D("div"),Nt(n.$$.fragment),P(e,"class","svelte-4zf6uq"),q(e,"float",t[11])},m(r,o){A(r,e,o),Dt(n,e,null),s=!0,i||(l=[I(e,"introend",t[46]),I(e,"outrostart",t[47]),I(e,"outroend",t[48])],i=!0)},p(t,r){const o={};512&r[0]|2&r[2]&&(o.$$scope={dirty:r,ctx:t}),n.$set(o),(!s||2048&r[0])&&q(e,"float",t[11])},i(t){s||(bt(n.$$.fragment,t),t&&lt(()=>{s&&(r||(r=xt(e,Vs,{x:50,duration:200},!0)),r.run(1))}),s=!0)},o(t){yt(n.$$.fragment,t),t&&(r||(r=xt(e,Vs,{x:50,duration:200},!1)),r.run(0)),s=!1},d(t){t&&_(e),Lt(n),t&&r&&r.end(),i=!1,o(l)}}}function rl(t){let e,n,r,s,i,l,c,a,u,d,p,f,h,m,g,$,v,b;return r=new Qs({}),{c(){e=D("h3"),n=D("a"),Nt(r.$$.fragment),s=R(" back"),i=U(),l=D("div"),c=D("p"),c.textContent="Enter list of URLs:",a=U(),u=D("textarea"),d=U(),p=D("p"),p.textContent="One URL per line",f=U(),h=D("p"),m=D("input"),P(n,"href","#home"),P(n,"class","homelink svelte-4zf6uq"),P(e,"class","back svelte-4zf6uq"),P(u,"rows","5"),P(u,"class","svelte-4zf6uq"),P(p,"class","small"),P(m,"type","submit"),m.value="Add all",P(m,"class","submit"),m.disabled=g=void 0===t[9]||!t[9].trim().length},m(o,g){A(o,e,g),T(e,n),Dt(r,n,null),T(n,s),A(o,i,g),A(o,l,g),T(l,c),T(l,a),T(l,u),B(u,t[9]),T(l,d),T(l,p),T(l,f),T(l,h),T(h,m),$=!0,v||(b=[I(n,"click",M(t[44])),I(u,"input",t[45])],v=!0)},p(t,e){512&e[0]&&B(u,t[9]),(!$||512&e[0]&&g!==(g=void 0===t[9]||!t[9].trim().length))&&(m.disabled=g)},i(t){$||(bt(r.$$.fragment,t),$=!0)},o(t){yt(r.$$.fragment,t),$=!1},d(t){t&&(_(e),_(i),_(l)),Lt(r),v=!1,o(b)}}}function ol(t){let e,n,r,s,i,l,c,a,u,d,p,f,h,m;s=new Gi({props:{data:t[1],edit:!0,onSubmit:t[27],onTransformAll:t[20],onFetchAll:t[21],$$slots:{default:[Qi]},$$scope:{ctx:t}}});let g=t[5]&&tl(t),$=t[6]&&el(t),v=void 0!==t[9]&&nl(t);return{c(){e=R("You are editing:\n\n"),n=D("div"),r=D("div"),Nt(s.$$.fragment),i=U(),g&&g.c(),l=U(),$&&$.c(),c=U(),v&&v.c(),a=U(),u=D("button"),u.textContent="Save",d=U(),p=D("a"),p.textContent="Cancel",P(r,"class","svelte-4zf6uq"),q(r,"hide",t[10]),P(n,"class","list svelte-4zf6uq"),P(u,"type","submit"),P(p,"href","#cancel"),P(p,"class","small")},m(o,b){A(o,e,b),A(o,n,b),T(n,r),Dt(s,r,null),T(n,i),g&&g.m(n,null),T(n,l),$&&$.m(n,null),T(n,c),v&&v.m(n,null),A(o,a,b),A(o,u,b),A(o,d,b),A(o,p,b),f=!0,h||(m=[I(u,"click",t[49]),I(p,"click",M(t[50]))],h=!0)},p(t,e){const o={};2&e[0]&&(o.data=t[1]),3&e[0]&&(o.onSubmit=t[27]),990&e[0]|2&e[2]&&(o.$$scope={dirty:e,ctx:t}),s.$set(o),(!f||1024&e[0])&&q(r,"hide",t[10]),t[5]?g?(g.p(t,e),32&e[0]&&bt(g,1)):(g=tl(t),g.c(),bt(g,1),g.m(n,l)):g&&($t(),yt(g,1,1,()=>{g=null}),vt()),t[6]?$?($.p(t,e),64&e[0]&&bt($,1)):($=el(t),$.c(),bt($,1),$.m(n,c)):$&&($t(),yt($,1,1,()=>{$=null}),vt()),void 0!==t[9]?v?(v.p(t,e),512&e[0]&&bt(v,1)):(v=nl(t),v.c(),bt(v,1),v.m(n,null)):v&&($t(),yt(v,1,1,()=>{v=null}),vt())},i(t){f||(bt(s.$$.fragment,t),bt(g),bt($),bt(v),f=!0)},o(t){yt(s.$$.fragment,t),yt(g),yt($),yt(v),f=!1},d(t){t&&(_(e),_(n),_(a),_(u),_(d),_(p)),Lt(s),g&&g.d(),$&&$.d(),v&&v.d(),h=!1,o(m)}}}const sl=50,il=200;function ll(t,e,n){let r,o,s;u(t,Jt,t=>n(52,r=t)),u(t,An,t=>n(53,o=t)),u(t,_n,t=>n(54,s=t));let{stage:i}=e;if(!s)throw new Error("Inconsistent state, expected to have book data");const l=(c=s,Object.assign(Object.assign({},c),{chapters:c.chapters.map(t=>Object.assign({},t))}));var c;const a=s;let d,p,f,h,m,g,$=0,v=-1;const b=t=>t+sl*$,y=t=>{t.displayUrl&&(o.series.type===Ze.GENERIC?t.apiUrl=t.displayUrl:t.apiUrl=je(t.displayUrl))};let w={pre:null,pages:[],post:null},x=!1,E=!0;return t.$$set=t=>{"stage"in t&&n(0,i=t.stage)},t.$$.update=()=>{2&t.$$.dirty[0]&&n(3,p=Math.ceil(a.chapters.length/sl-1)),6&t.$$.dirty[0]&&n(8,f=a.chapters.slice($*sl,($+1)*sl)),18&t.$$.dirty[0]&&n(5,h=v>=0?a.chapters[v]:void 0),140&t.$$.dirty[0]&&(n(7,w.pages=((t,e)=>{const n=new Array(e-t+1);for(let r=t;r<=e;r++)n[r-t]=r;return n})(Math.max(0,$-3),Math.min(p,$+3)),w),n(7,w.pre=0!==w.pages[0]?1:null,w),n(7,w.post=w.pages[w.pages.length-1]!==p?p+1:null,w)),32&t.$$.dirty[0]&&h&&y(h),64&t.$$.dirty[0]&&m&&y(m)},[i,a,$,p,v,h,m,w,f,g,x,E,l,b,t=>{t<1||(t===v&&n(4,--v),a.chapters.splice(t-1,2,a.chapters[t],a.chapters[t-1]),n(1,a))},t=>{t>=a.chapters.length||(t===v&&n(4,++v),a.chapters.splice(t,2,a.chapters[t+1],a.chapters[t]),n(1,a))},t=>{n(4,v=-1),a.chapters.splice(t,1),n(1,a)},t=>{if($==t){const e=prompt("New page:",""+($+1)),n=+(e||"");null!==e&&!isNaN(n)&&n>0&&n<=p+1&&(t=n-1)}d=Math.sign(t-$),n(2,$=t)},t=>{(t=>{a.chapters.splice($*sl,sl,...t.detail.items),n(1,a)})(t)},y,()=>{window.confirm("Really continue? This will discard all changes!")&&n(1,a.chapters=pn(r,a.chapters),a)},()=>{window.confirm("Really continue? This will discard all changes!")&&(n(1,a.chapters=a.chapters.map(t=>Object.assign(Object.assign({},t),{content:void 0,transformedContent:void 0,needsFetching:!0})),a),i.fetch(a))},()=>{const t=a.chapters.length,e=g.split("\n");n(1,a.chapters=a.chapters.concat(e.map((e,n)=>({apiUrl:e,id:Ne(),title:`Chapter ${n+t}`,displayUrl:e}))),a),n(9,g=void 0)},t=>n(4,v=b(t)),()=>{n(6,m={id:Ne(),title:"",apiUrl:"",displayUrl:""})},()=>{n(9,g="")},()=>n(1,a.chapters=[],a),()=>i.next(a),()=>{y(h),n(4,v=-1)},function(e){t.$$.not_equal(h.title,e)&&(h.title=e,n(5,h),n(4,v),n(1,a))},function(e){t.$$.not_equal(h.transformedContent,e)&&(h.transformedContent=e,n(5,h),n(4,v),n(1,a))},function(e){t.$$.not_equal(h.needsFetching,e)&&(h.needsFetching=e,n(5,h),n(4,v),n(1,a))},function(e){t.$$.not_equal(h.displayUrl,e)&&(h.displayUrl=e,n(5,h),n(4,v),n(1,a))},()=>{n(10,x=!0),n(11,E=!1)},()=>{n(11,E=!0)},()=>{n(10,x=!1)},()=>{if(!m)throw"";y(m),a.chapters.push(m),n(1,a),n(6,m=void 0)},function(e){t.$$.not_equal(m.title,e)&&(m.title=e,n(6,m))},function(e){t.$$.not_equal(m.transformedContent,e)&&(m.transformedContent=e,n(6,m))},function(e){t.$$.not_equal(m.needsFetching,e)&&(m.needsFetching=e,n(6,m))},function(e){t.$$.not_equal(m.displayUrl,e)&&(m.displayUrl=e,n(6,m))},()=>{n(10,x=!0),n(11,E=!1)},()=>{n(11,E=!0)},()=>{n(10,x=!1)},()=>n(9,g=void 0),function(){g=this.value,n(9,g)},()=>{n(10,x=!0),n(11,E=!1)},()=>{n(11,E=!0)},()=>{n(10,x=!1)},()=>i.next(a),()=>i.next(l)]}const cl=class extends Ft{constructor(t){super(),Rt(this,t,ll,ol,i,{stage:0},null,[-1,-1,-1])}};function al(t,e,n){const r=t.slice();return r[20]=e[n],r}function ul(t){let e,n,r,o;return e=new Se({props:{error:t[23],retry:t[14]}}),r=new ye({props:{backToSearch:t[2]}}),{c(){Nt(e.$$.fragment),n=U(),Nt(r.$$.fragment)},m(t,s){Dt(e,t,s),A(t,n,s),Dt(r,t,s),o=!0},p(t,n){const o={};16&n&&(o.error=t[23]),16&n&&(o.retry=t[14]),e.$set(o);const s={};4&n&&(s.backToSearch=t[2]),r.$set(s)},i(t){o||(bt(e.$$.fragment,t),bt(r.$$.fragment,t),o=!0)},o(t){yt(e.$$.fragment,t),yt(r.$$.fragment,t),o=!1},d(t){t&&_(n),Lt(e,t),Lt(r,t)}}}function dl(t){let e,n,r,s,i,l,c,a,u,d,p,f,h,m;function g(t,e){return 16&e&&(i=null),null==i&&(i=!!t[19].chapters.find(El)),i?bl:vl}r=new Gi({props:{data:t[19],url:t[1].url,$$slots:{default:[$l]},$$scope:{ctx:t}}});let $=g(t,-1),v=$(t);return p=new ye({props:{backToSearch:t[2]}}),{c(){e=R("Got the following series:\n\n  "),n=D("div"),Nt(r.$$.fragment),s=U(),v.c(),l=U(),c=D("button"),c.textContent="Edit book",a=U(),u=D("button"),u.textContent="Export",d=U(),Nt(p.$$.fragment),P(n,"class","list svelte-1hsynpq")},m(o,i){A(o,e,i),A(o,n,i),Dt(r,n,null),A(o,s,i),v.m(o,i),A(o,l,i),A(o,c,i),A(o,a,i),A(o,u,i),A(o,d,i),Dt(p,o,i),f=!0,h||(m=[I(c,"click",t[12]),I(u,"click",t[13])],h=!0)},p(t,e){const n={};16&e&&(n.data=t[19]),2&e&&(n.url=t[1].url),16777241&e&&(n.$$scope={dirty:e,ctx:t}),r.$set(n),$===($=g(t,e))&&v?v.p(t,e):(v.d(1),v=$(t),v&&(v.c(),v.m(l.parentNode,l)));const o={};4&e&&(o.backToSearch=t[2]),p.$set(o)},i(t){f||(bt(r.$$.fragment,t),bt(p.$$.fragment,t),f=!0)},o(t){yt(r.$$.fragment,t),yt(p.$$.fragment,t),f=!1},d(t){t&&(_(e),_(n),_(s),_(l),_(c),_(a),_(u),_(d)),Lt(r),v.d(t),Lt(p,t),h=!1,o(m)}}}function pl(t){let e;return{c(){e=R("hide")},m(t,n){A(t,e,n)},d(t){t&&_(e)}}}function fl(t){let e;return{c(){e=R("show")},m(t,n){A(t,e,n)},d(t){t&&_(e)}}}function hl(t){let e,n,r,o,s,i,l=t[0].newChapters+"";return{c(){e=D("a"),n=R("Found "),r=R(l),o=R(" new"),P(e,"href","#?")},m(l,c){A(l,e,c),T(e,n),T(e,r),T(e,o),s||(i=I(e,"click",M(t[9])),s=!0)},p(t,e){1&e&&l!==(l=t[0].newChapters+"")&&z(r,l)},d(t){t&&_(e),s=!1,i()}}}function ml(t){let e,n,r,o=[],s=new Map,i=Ct(t[19].chapters);const l=t=>t[20].id;for(let e=0;e<i.length;e+=1){let n=al(t,i,e),r=l(n);s.set(r,o[e]=gl(r,n))}return{c(){e=D("div");for(let t=0;t<o.length;t+=1)o[t].c();P(e,"class","chapter-list svelte-1hsynpq")},m(t,n){A(t,e,n);for(let t=0;t<o.length;t+=1)o[t]&&o[t].m(e,null);r=!0},p(t,n){16&n&&(i=Ct(t[19].chapters),o=Ot(o,n,l,1,t,i,s,e,Tt,gl,null,al))},i(t){r||(t&&lt(()=>{r&&(n||(n=xt(e,He,{},!0)),n.run(1))}),r=!0)},o(t){t&&(n||(n=xt(e,He,{},!1)),n.run(0)),r=!1},d(t){t&&_(e);for(let t=0;t<o.length;t+=1)o[t].d();t&&n&&n.end()}}}function gl(t,e){let n,r,o,s=e[20].title+"";return{key:t,first:null,c(){n=D("a"),r=R(s),P(n,"href",o=e[20].displayUrl),P(n,"target","_blank"),P(n,"class","small"),this.first=n},m(t,e){A(t,n,e),T(n,r)},p(t,i){e=t,16&i&&s!==(s=e[20].title+"")&&z(r,s),16&i&&o!==(o=e[20].displayUrl)&&P(n,"href",o)},d(t){t&&_(n)}}}function $l(t){let e,n,r,s,i,l,c,a,u,d,p,f,h,m,g=t[19].chapters.length+"";function $(t,e){return t[3]?pl:fl}let v=$(t),b=v(t),y="number"==typeof t[0].newChapters&&hl(t),w=t[3]&&ml(t);return{c(){e=D("p"),n=R("Found "),r=R(g),s=U(),i=D("a"),b.c(),l=U(),c=D("span"),a=U(),u=D("button"),u.textContent="Find more",d=U(),y&&y.c(),p=U(),w&&w.c(),f=F(),P(i,"href","#show"),P(i,"class","small"),P(c,"class","spacer svelte-1hsynpq"),P(e,"class","no-margin svelte-1hsynpq")},m(o,g){A(o,e,g),T(e,n),T(e,r),T(e,s),T(e,i),b.m(i,null),T(e,l),T(e,c),T(e,a),T(e,u),T(e,d),y&&y.m(e,null),A(o,p,g),w&&w.m(o,g),A(o,f,g),h||(m=[I(i,"click",M(t[7])),I(u,"click",t[8])],h=!0)},p(t,n){16&n&&g!==(g=t[19].chapters.length+"")&&z(r,g),v!==(v=$(t))&&(b.d(1),b=v(t),b&&(b.c(),b.m(i,null))),"number"==typeof t[0].newChapters?y?y.p(t,n):(y=hl(t),y.c(),y.m(e,null)):y&&(y.d(1),y=null),t[3]?w?(w.p(t,n),8&n&&bt(w,1)):(w=ml(t),w.c(),bt(w,1),w.m(f.parentNode,f)):w&&($t(),yt(w,1,1,()=>{w=null}),vt())},d(t){t&&(_(e),_(p),_(f)),b.d(),y&&y.d(),w&&w.d(t),h=!1,o(m)}}}function vl(e){let n,r,o;return{c(){n=D("button"),n.textContent="Generate EPUB"},m(t,s){A(t,n,s),r||(o=I(n,"click",e[11]),r=!0)},p:t,d(t){t&&_(n),r=!1,o()}}}function bl(e){let n,r,o;return{c(){n=D("button"),n.textContent="Fetch chapter contents"},m(t,s){A(t,n,s),r||(o=I(n,"click",e[10]),r=!0)},p:t,d(t){t&&_(n),r=!1,o()}}}function yl(t){let e,n;return e=new _e({props:{$$slots:{default:[wl]},$$scope:{ctx:t}}}),{c(){Nt(e.$$.fragment)},m(t,r){Dt(e,t,r),n=!0},p(t,n){const r={};16777216&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(bt(e.$$.fragment,t),n=!0)},o(t){yt(e.$$.fragment,t),n=!1},d(t){Lt(e,t)}}}function wl(t){let e;return{c(){e=R("Please wait, fetching data...")},m(t,n){A(t,e,n)},d(t){t&&_(e)}}}function xl(t){let e,n,r,o,s;e=new ir({props:{hasReddit:t[1].url.indexOf("reddit.com")>=0,hasOther:t[1].url.indexOf("reddit.com")<0}});let i={ctx:t,current:null,token:null,hasCatch:!0,pending:yl,then:dl,catch:ul,value:19,error:23,blocks:[,,,]};return Et(o=t[4],i),{c(){Nt(e.$$.fragment),n=U(),r=F(),i.block.c()},m(t,o){Dt(e,t,o),A(t,n,o),A(t,r,o),i.block.m(t,i.anchor=o),i.mount=()=>r.parentNode,i.anchor=r,s=!0},p(n,[r]){t=n;const s={};2&r&&(s.hasReddit=t[1].url.indexOf("reddit.com")>=0),2&r&&(s.hasOther=t[1].url.indexOf("reddit.com")<0),e.$set(s),i.ctx=t,16&r&&o!==(o=t[4])&&Et(o,i)||kt(i,t,r)},i(t){s||(bt(e.$$.fragment,t),bt(i.block),s=!0)},o(t){yt(e.$$.fragment,t);for(let t=0;t<3;t+=1)yt(i.blocks[t]);s=!1},d(t){t&&(_(n),_(r)),Lt(e,t),i.block.d(t),i.token=null,i=null}}}const El=t=>!1!==t.needsFetching&&t.apiUrl;function kl(t,e,n){let r,o,s,i;u(t,_n,t=>n(15,r=t)),u(t,An,t=>n(16,o=t)),u(t,Jt,t=>n(17,s=t)),u(t,De,t=>n(18,i=t));let{stage:l}=e,{series:c}=e,{backToSearch:a}=e,d=!1;const p=()=>r?Promise.resolve(r):(async(t,e)=>{var n,r,o,s;if(e.type==Ze.GENERIC){const r=await Ue(t,new URL(e.url)),o=nn(e.type,r);if(!(null===(n=null==o?void 0:o.chapters)||void 0===n?void 0:n.length))throw new Error("No chapters found");return o}const i=await Re(new URL(e.url)),l=await en(e,i);if(!i.ok)throw""+(null!==(o=null!==(r=l.message)&&void 0!==r?r:i.statusText)&&void 0!==o?o:i.status);const c=nn(e.type,l);if(!(null===(s=null==c?void 0:c.chapters)||void 0===s?void 0:s.length))throw new Error("No chapters found");return c})(i,c).then(t=>{const e=Object.assign(Object.assign({},t),{chapters:pn(s,t.chapters)});return _n.update(()=>e),e});let f=p();const h=async()=>{if(!r)throw new Error("Inconsistent state, expected to have book data");const t=JSON.stringify({bookData:await Rn(r),series:o.series});ge()(new Blob([t]),`${r.author} - ${r.title}.json`,"application/json")};return t.$$set=t=>{"stage"in t&&n(0,l=t.stage),"series"in t&&n(1,c=t.series),"backToSearch"in t&&n(2,a=t.backToSearch)},[l,c,a,d,f,p,h,()=>n(3,d=!d),()=>l.findMore(),()=>n(0,l.newChapters=void 0,l),()=>l.downloadAll(),()=>l.next(),()=>l.edit(),()=>h(),()=>n(4,f=p())]}const Cl=class extends Ft{constructor(t){super(),Rt(this,t,kl,xl,i,{stage:0,series:1,backToSearch:2})}};function Tl(t,e,n){const r=t.slice();return r[7]=e[n],r}function Sl(t){let e,n;return e=new Se({props:{error:t[10],retry:t[5]}}),{c(){Nt(e.$$.fragment)},m(t,r){Dt(e,t,r),n=!0},p(t,n){const r={};4&n&&(r.error=t[10]),4&n&&(r.retry=t[5]),e.$set(r)},i(t){n||(bt(e.$$.fragment,t),n=!0)},o(t){yt(e.$$.fragment,t),n=!1},d(t){Lt(e,t)}}}function Ol(e){let n,r,o,s,i,l,c,a,u=Ct(e[6]),d=[];for(let t=0;t<u.length;t+=1)d[t]=_l(Tl(e,u,t));return{c(){n=D("p"),r=R("The search for '"),o=R(e[1]),s=R("' returned these results:"),i=U(),l=D("ul");for(let t=0;t<d.length;t+=1)d[t].c();c=U(),a=D("p"),a.textContent="Please select one.",P(a,"class","small")},m(t,e){A(t,n,e),T(n,r),T(n,o),T(n,s),A(t,i,e),A(t,l,e);for(let t=0;t<d.length;t+=1)d[t]&&d[t].m(l,null);A(t,c,e),A(t,a,e)},p(t,e){if(2&e&&z(o,t[1]),5&e){let n;for(u=Ct(t[6]),n=0;n<u.length;n+=1){const r=Tl(t,u,n);d[n]?d[n].p(r,e):(d[n]=_l(r),d[n].c(),d[n].m(l,null))}for(;n<d.length;n+=1)d[n].d(1);d.length=u.length}},i:t,o:t,d(t){t&&(_(n),_(i),_(l),_(c),_(a)),N(d,t)}}}function Al(t){let e,n,r,o,s=t[7].author+"";return{c(){e=R("["),n=D("i"),r=R(s),o=R("]")},m(t,s){A(t,e,s),A(t,n,s),T(n,r),A(t,o,s)},p(t,e){4&e&&s!==(s=t[7].author+"")&&z(r,s)},d(t){t&&(_(e),_(n),_(o))}}}function _l(t){let e,n,r,o,s,i,l,c,a=t[7].title+"";function u(){return t[4](t[7])}let d=t[7].author&&Al(t);return{c(){e=D("li"),n=D("a"),r=R(a),s=U(),d&&d.c(),i=U(),P(n,"href",o=Pe(t[7].url))},m(t,o){A(t,e,o),T(e,n),T(n,r),T(e,s),d&&d.m(e,null),T(e,i),l||(c=I(n,"click",M(u)),l=!0)},p(s,l){t=s,4&l&&a!==(a=t[7].title+"")&&z(r,a),4&l&&o!==(o=Pe(t[7].url))&&P(n,"href",o),t[7].author?d?d.p(t,l):(d=Al(t),d.c(),d.m(e,i)):d&&(d.d(1),d=null)},d(t){t&&_(e),d&&d.d(),l=!1,c()}}}function Nl(t){let e,n;return e=new _e({props:{$$slots:{default:[Dl]},$$scope:{ctx:t}}}),{c(){Nt(e.$$.fragment)},m(t,r){Dt(e,t,r),n=!0},p(t,n){const r={};2048&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(bt(e.$$.fragment,t),n=!0)},o(t){yt(e.$$.fragment,t),n=!1},d(t){Lt(e,t)}}}function Dl(t){let e;return{c(){e=R("Please wait, fetching results...")},m(t,n){A(t,e,n)},d(t){t&&_(e)}}}function Ll(t){let e,n,r,o={ctx:t,current:null,token:null,hasCatch:!0,pending:Nl,then:Ol,catch:Sl,value:6,error:10,blocks:[,,,]};return Et(n=t[2],o),{c(){e=F(),o.block.c()},m(t,n){A(t,e,n),o.block.m(t,o.anchor=n),o.mount=()=>e.parentNode,o.anchor=e,r=!0},p(e,[r]){t=e,o.ctx=t,4&r&&n!==(n=t[2])&&Et(n,o)||kt(o,t,r)},i(t){r||(bt(o.block),r=!0)},o(t){for(let t=0;t<3;t+=1)yt(o.blocks[t]);r=!1},d(t){t&&_(e),o.block.d(t),o.token=null,o=null}}}function Rl(t,e,n){let{stage:r}=e,{search:o}=e;const s=()=>Ke(o).then(t=>{if(!t.length)throw new Error(`No series matched input \`${o}\``);return t});let i=s();return t.$$set=t=>{"stage"in t&&n(0,r=t.stage),"search"in t&&n(1,o=t.search)},[r,o,i,s,t=>r.next({url:t.url,type:Ze.HFY_SERIES}),()=>n(2,i=s())]}const Ul=class extends Ft{constructor(t){super(),Rt(this,t,Rl,Ll,i,{stage:0,search:1})}};function Fl(t,e,n){const r=t.slice();return r[11]=e[n],r}function Il(e){let n,r,o;return{c(){n=R("Due to "),r=D("a"),r.textContent="recent API changes on reddit",o=R(', creating ebooks has become limited. If you run into a "Too many requests" error, please wait 10 minutes before trying again.'),P(r,"href","https://www.redditinc.com/blog/apifacts"),P(r,"target","_blank")},m(t,e){A(t,n,e),A(t,r,e),A(t,o,e)},p:t,d(t){t&&(_(n),_(r),_(o))}}}function Ml(t){let e,n;return e=new Qn({props:{$$slots:{default:[Pl]},$$scope:{ctx:t}}}),{c(){Nt(e.$$.fragment)},m(t,r){Dt(e,t,r),n=!0},i(t){n||(bt(e.$$.fragment,t),n=!0)},o(t){yt(e.$$.fragment,t),n=!1},d(t){Lt(e,t)}}}function jl(t){let e,n;return e=new Qn({props:{$$slots:{default:[zl]},$$scope:{ctx:t}}}),{c(){Nt(e.$$.fragment)},m(t,r){Dt(e,t,r),n=!0},i(t){n||(bt(e.$$.fragment,t),n=!0)},o(t){yt(e.$$.fragment,t),n=!1},d(t){Lt(e,t)}}}function Pl(e){let n,r,o;return{c(){n=R("Extension detected. When downloading URL-based ebooks, we will attempt to use the extension to bypass "),r=D("a"),r.textContent="CORS",o=R("."),P(r,"href","https://github.com/cpiber/hfy-epub/blob/master/docs/other/cors.md"),P(r,"target","_blank")},m(t,e){A(t,n,e),A(t,r,e),A(t,o,e)},p:t,d(t){t&&(_(n),_(r),_(o))}}}function zl(e){let n,r,o,s,i;return{c(){n=R("When generating an ebook via URL, please be aware of "),r=D("code"),r.textContent="NetworkError",o=R("s, see "),s=D("a"),s.textContent="CORS",i=R("."),P(s,"href","https://github.com/cpiber/hfy-epub/blob/master/docs/other/cors.md"),P(s,"target","_blank")},m(t,e){A(t,n,e),A(t,r,e),A(t,o,e),A(t,s,e),A(t,i,e)},p:t,d(t){t&&(_(n),_(r),_(o),_(s),_(i))}}}function Bl(e){let n,r,s,i,l,c,a,u,d,p,f;return{c(){n=D("form"),r=D("p"),s=R("Import:\n        "),i=D("input"),l=U(),c=D("input"),u=U(),d=D("p"),d.textContent="Please only upload genuine backups, as there is no schema checking currently.",P(i,"id","upload"),P(i,"type","file"),P(i,"accept","application/json,*.json"),P(i,"name","files"),P(i,"size","30"),i.disabled=e[7],P(i,"class","svelte-1hos1p9"),P(c,"type","submit"),c.value="Go",P(c,"class","submit svelte-1hos1p9"),c.disabled=a=void 0===e[6]||e[7],P(r,"class","svelte-1hos1p9"),P(d,"class","small svelte-1hos1p9"),P(n,"class","form svelte-1hos1p9"),P(n,"enctype","multipart/form-data")},m(t,o){A(t,n,o),T(n,r),T(r,s),T(r,i),T(r,l),T(r,c),T(n,u),T(n,d),p||(f=[I(i,"change",e[24]),I(n,"submit",M(e[25]))],p=!0)},p(t,e){128&e&&(i.disabled=t[7]),192&e&&a!==(a=void 0===t[6]||t[7])&&(c.disabled=a)},i:t,o:t,d(t){t&&_(n),p=!1,o(f)}}}function ql(t){let e,n,r,s,i,l,c,a,u,d,p,f,h,m,g=t[8]&&Gl(t);return{c(){g&&g.c(),e=U(),n=D("form"),r=D("p"),r.textContent="Enter list of URLs:",s=U(),i=D("textarea"),l=U(),c=D("p"),c.textContent="One Chapter URL per line. You can add more chapters later in Edit Book > Add bulk. Use this when you have an external list of chapters.",a=U(),u=D("p"),d=D("input"),P(r,"class","svelte-1hos1p9"),P(i,"rows","5"),P(i,"placeholder",t[12]),i.disabled=t[7],P(i,"class","svelte-1hos1p9"),P(c,"class","small svelte-1hos1p9"),P(d,"type","submit"),d.value="Go",P(d,"class","submit svelte-1hos1p9"),d.disabled=p=void 0===t[4]||!t[4].trim().length||t[7],P(u,"class","svelte-1hos1p9"),P(n,"class","form svelte-1hos1p9")},m(o,p){g&&g.m(o,p),A(o,e,p),A(o,n,p),T(n,r),T(n,s),T(n,i),B(i,t[4]),T(n,l),T(n,c),T(n,a),T(n,u),T(u,d),f=!0,h||(m=[I(i,"input",t[23]),I(n,"submit",M(t[17]))],h=!0)},p(t,n){t[8]?g?(g.p(t,n),256&n&&bt(g,1)):(g=Gl(t),g.c(),bt(g,1),g.m(e.parentNode,e)):g&&($t(),yt(g,1,1,()=>{g=null}),vt()),(!f||128&n)&&(i.disabled=t[7]),16&n&&B(i,t[4]),(!f||144&n&&p!==(p=void 0===t[4]||!t[4].trim().length||t[7]))&&(d.disabled=p)},i(t){f||(bt(g),f=!0)},o(t){yt(g),f=!1},d(t){t&&(_(e),_(n)),g&&g.d(t),h=!1,o(m)}}}function Hl(t){let e,n,r,s,i,l,c,a,u,d,p,f,h,m,g,$,v,b=void 0!==t[0]&&!t[0].trim().length,y=t[3]&&Wl(t),w=b&&Vl(),x=t[3]&&Zl();return{c(){e=D("form"),n=D("p"),r=R("Search:\n        "),s=D("input"),i=U(),l=D("input"),a=U(),y&&y.c(),u=U(),w&&w.c(),d=U(),p=D("div"),x&&x.c(),f=U(),h=D("p"),h.textContent="You can:",m=U(),g=D("ul"),g.innerHTML='<li>Search for a series title on the <a href="https://reddit.com/r/HFY/wiki/series" target="_blank">r/HFY wiki</a></li> <li>Enter a series link to the <a href="https://reddit.com/r/HFY" target="_blank">r/HFY</a> wiki</li> <li>Enter a link to any reddit post, or other link (see <a href="https://github.com/cpiber/hfy-epub/blob/master/docs/other/cors.md" target="_blank">CORS</a>)</li>',P(s,"class","search svelte-1hos1p9"),P(s,"placeholder","Search or URL..."),s.disabled=t[7],P(l,"type","submit"),l.value="Go",P(l,"class","submit svelte-1hos1p9"),l.disabled=c=void 0===t[0]||!t[0].trim().length||t[7],P(n,"class","svelte-1hos1p9"),P(e,"class","form svelte-1hos1p9"),P(h,"class","spaceabove svelte-1hos1p9"),P(p,"class","overlay-wrapper svelte-1hos1p9")},m(o,c){A(o,e,c),T(e,n),T(n,r),T(n,s),B(s,t[0]),T(n,i),T(n,l),T(e,a),y&&y.m(e,null),t[22](e),A(o,u,c),w&&w.m(o,c),A(o,d,c),A(o,p,c),x&&x.m(p,null),T(p,f),T(p,h),T(p,m),T(p,g),$||(v=[I(s,"input",t[19]),I(s,"keyup",t[15]),I(s,"blur",t[13]),I(s,"click",t[15]),I(e,"submit",M(t[21]))],$=!0)},p(t,n){128&n&&(s.disabled=t[7]),1&n&&s.value!==t[0]&&B(s,t[0]),129&n&&c!==(c=void 0===t[0]||!t[0].trim().length||t[7])&&(l.disabled=c),t[3]?y?y.p(t,n):(y=Wl(t),y.c(),y.m(e,null)):y&&(y.d(1),y=null),1&n&&(b=void 0!==t[0]&&!t[0].trim().length),b?w||(w=Vl(),w.c(),w.m(d.parentNode,d)):w&&(w.d(1),w=null),t[3]?x?8&n&&bt(x,1):(x=Zl(),x.c(),bt(x,1),x.m(p,f)):x&&($t(),yt(x,1,1,()=>{x=null}),vt())},i(t){bt(x)},o(t){yt(x)},d(n){n&&(_(e),_(u),_(d),_(p)),y&&y.d(),t[22](null),w&&w.d(n),x&&x.d(),$=!1,o(v)}}}function Gl(t){let e,n;return e=new Se({props:{error:t[8]}}),{c(){Nt(e.$$.fragment)},m(t,r){Dt(e,t,r),n=!0},p(t,n){const r={};256&n&&(r.error=t[8]),e.$set(r)},i(t){n||(bt(e.$$.fragment,t),n=!0)},o(t){yt(e.$$.fragment,t),n=!1},d(t){Lt(e,t)}}}function Wl(t){let e,n,r={ctx:t,current:null,token:null,hasCatch:!1,pending:Jl,then:Xl,catch:Yl,value:26};return Et(n=t[14](t[11],t[0]??""),r),{c(){e=F(),r.block.c()},m(t,n){A(t,e,n),r.block.m(t,r.anchor=n),r.mount=()=>e.parentNode,r.anchor=e},p(e,o){t=e,r.ctx=t,2049&o&&n!==(n=t[14](t[11],t[0]??""))&&Et(n,r)||kt(r,t,o)},d(t){t&&_(e),r.block.d(t),r.token=null,r=null}}}function Yl(e){return{c:t,m:t,p:t,d:t}}function Xl(t){let e,n=Ct(t[26]),r=[];for(let e=0;e<n.length;e+=1)r[e]=Kl(Fl(t,n,e));return{c(){e=D("div");for(let t=0;t<r.length;t+=1)r[t].c();P(e,"class","search-results svelte-1hos1p9")},m(t,n){A(t,e,n);for(let t=0;t<r.length;t+=1)r[t]&&r[t].m(e,null)},p(t,o){if(18435&o){let s;for(n=Ct(t[26]),s=0;s<n.length;s+=1){const i=Fl(t,n,s);r[s]?r[s].p(i,o):(r[s]=Kl(i),r[s].c(),r[s].m(e,null))}for(;s<r.length;s+=1)r[s].d(1);r.length=n.length}},d(t){t&&_(e),N(r,t)}}}function Kl(t){let e,n,r,o,s,i=t[11].title+"";function l(){return t[20](t[11])}return{c(){e=D("a"),n=R(i),P(e,"class","result svelte-1hos1p9"),P(e,"href",r=Pe(t[11].url))},m(t,r){A(t,e,r),T(e,n),o||(s=I(e,"click",M(l)),o=!0)},p(o,s){t=o,2049&s&&i!==(i=t[11].title+"")&&z(n,i),2049&s&&r!==(r=Pe(t[11].url))&&P(e,"href",r)},d(t){t&&_(e),o=!1,s()}}}function Jl(e){return{c:t,m:t,p:t,d:t}}function Vl(t){let e;return{c(){e=D("p"),e.textContent="Please enter a search string",P(e,"class","small error svelte-1hos1p9")},m(t,n){A(t,e,n)},d(t){t&&_(e)}}}function Zl(t){let e,n,r;return{c(){e=D("div"),P(e,"class","overlay svelte-1hos1p9")},m(t,n){A(t,e,n),r=!0},i(t){r||(t&&lt(()=>{r&&(n||(n=xt(e,Js,{duration:100},!0)),n.run(1))}),r=!0)},o(t){t&&(n||(n=xt(e,Js,{duration:100},!1)),n.run(0)),r=!1},d(t){t&&_(e),t&&n&&n.end()}}}function Ql(t){let e,n,r,o,s,i,l,c,a,u,d,p;e=new Qn({props:{$$slots:{default:[Il]},$$scope:{ctx:t}}});const f=[jl,Ml],h=[];function m(t,e){return t[10].authorize?1:0}function g(e){t[18](e)}r=m(t),o=h[r]=f[r](t);let $={options:[{value:t[2].Search,label:"Search"},{value:t[2].List,label:"URLs"},{value:t[2].Import,label:"Import"}],name:"mode",class:"mode-select"};void 0!==t[5]&&($.selected=t[5]),i=new Ht({props:$}),nt.push(()=>_t(i,"selected",g));const v=[Hl,ql,Bl],b=[];function y(t,e){return t[5]==t[2].Search?0:t[5]==t[2].List?1:t[5]==t[2].Import?2:-1}return~(u=y(t))&&(d=b[u]=v[u](t)),{c(){Nt(e.$$.fragment),n=U(),o.c(),s=U(),Nt(i.$$.fragment),c=U(),a=D("div"),d&&d.c(),P(a,"class","mode svelte-1hos1p9")},m(t,o){Dt(e,t,o),A(t,n,o),h[r].m(t,o),A(t,s,o),Dt(i,t,o),A(t,c,o),A(t,a,o),~u&&b[u].m(a,null),p=!0},p(t,[n]){const c={};536870912&n&&(c.$$scope={dirty:n,ctx:t}),e.$set(c);let p=r;r=m(t),r!==p&&($t(),yt(h[p],1,1,()=>{h[p]=null}),vt(),o=h[r],o||(o=h[r]=f[r](t),o.c()),bt(o,1),o.m(s.parentNode,s));const g={};4&n&&(g.options=[{value:t[2].Search,label:"Search"},{value:t[2].List,label:"URLs"},{value:t[2].Import,label:"Import"}]),!l&&32&n&&(l=!0,g.selected=t[5],ct(()=>l=!1)),i.$set(g);let $=u;u=y(t),u===$?~u&&b[u].p(t,n):(d&&($t(),yt(b[$],1,1,()=>{b[$]=null}),vt()),~u?(d=b[u],d?d.p(t,n):(d=b[u]=v[u](t),d.c()),bt(d,1),d.m(a,null)):d=null)},i(t){p||(bt(e.$$.fragment,t),bt(o),bt(i.$$.fragment,t),bt(d),p=!0)},o(t){yt(e.$$.fragment,t),yt(o),yt(i.$$.fragment,t),yt(d),p=!1},d(t){t&&(_(n),_(s),_(c),_(a)),Lt(e,t),h[r].d(t),Lt(i,t),~u&&b[u].d()}}}function tc(t,e,n){let r;u(t,De,t=>n(10,r=t));let{stage:o}=e,{search:s}=e;var i;let l;!function(t){t.Search="search",t.List="list",t.Import="import"}(i||(i={}));let c,a,d,p,f=!1,h=i.Search,m=!1;const g=()=>{n(11,l=l||Ke().catch(t=>{console.warn(t)}).finally(g)),n(3,f=!!l&&!!s)},$=async()=>{if(!a)return;n(7,m=!0);const t=new FileReader,e=new Promise((e,n)=>{t.onload=e,t.onerror=n});t.readAsText(a),await e,n(7,m=!1);const r=JSON.parse(t.result);return r.bookData=Ln(r.bookData),r};return t.$$set=t=>{"stage"in t&&n(1,o=t.stage),"search"in t&&n(0,s=t.search)},[s,o,i,f,c,h,a,m,d,p,r,l,"https://example.com/chapter1\nhttps://example.com/chapter2",t=>n(3,f=!!p&&p.contains(t.relatedTarget)),async(t,e)=>{if(!t)return[];const r=await t;if(!r)return[];const o=e.toLowerCase(),s=r.filter(t=>-1!==t.title.toLowerCase().indexOf(o));return s.length||n(3,f=!1),s},g,$,()=>{try{o.fromList(c||"")}catch(t){n(8,d=t)}},function(t){h=t,n(5,h)},function(){s=this.value,n(0,s)},t=>o.next(t.url),()=>o.next(s||""),function(t){nt[t?"unshift":"push"](()=>{p=t,n(9,p)})},function(){c=this.value,n(4,c)},t=>n(6,a=t.currentTarget.files?.[0]),async()=>o.fromJSON(await $())]}const ec=class extends Ft{constructor(t){super(),Rt(this,t,tc,Ql,i,{stage:1,search:0})}};function nc(e){let n,r,o,s;return{c(){n=L("svg"),r=L("g"),o=L("path"),s=L("path"),P(o,"d","M173.145,73.91c-0.413-2.722-2.29-4.993-4.881-5.912l-13.727-4.881c-0.812-2.3-1.733-4.536-2.754-6.699l6.247-13.146\n\t\tc1.179-2.479,0.899-5.411-0.729-7.628c-5.265-7.161-11.556-13.452-18.698-18.693c-2.219-1.629-5.141-1.906-7.625-0.724\n\t\tl-13.138,6.242c-2.163-1.021-4.402-1.94-6.704-2.752l-4.883-13.729c-0.919-2.586-3.184-4.458-5.9-4.876\n\t\tc-9.65-1.483-16.792-1.483-26.457,0c-2.713,0.418-4.981,2.29-5.9,4.876l-4.883,13.729c-2.302,0.812-4.541,1.731-6.702,2.752\n\t\tl-13.143-6.242c-2.479-1.181-5.406-0.904-7.623,0.724c-7.142,5.241-13.433,11.532-18.698,18.693\n\t\tc-1.629,2.217-1.908,5.148-0.729,7.628l6.247,13.146c-1.021,2.159-1.94,4.4-2.754,6.699L5.982,68.003\n\t\tc-2.589,0.919-4.463,3.189-4.879,5.907c-0.749,4.92-1.099,9.115-1.099,13.219c0,4.098,0.35,8.299,1.099,13.219\n\t\tc0.413,2.722,2.29,4.993,4.881,5.912l13.727,4.881c0.814,2.304,1.736,4.541,2.754,6.704l-6.247,13.141\n\t\tc-1.179,2.479-0.899,5.411,0.727,7.623c5.258,7.156,11.549,13.447,18.7,18.698c2.217,1.629,5.144,1.911,7.625,0.724l13.138-6.242\n\t\tc2.163,1.021,4.402,1.94,6.704,2.752l4.883,13.729c0.919,2.586,3.184,4.458,5.9,4.876c4.828,0.744,9.154,1.104,13.228,1.104\n\t\tc4.074,0,8.401-0.36,13.228-1.104c2.715-0.418,4.981-2.29,5.9-4.876l4.883-13.729c2.302-0.812,4.541-1.731,6.704-2.752\n\t\tl13.138,6.242c2.484,1.186,5.411,0.904,7.628-0.724c7.159-5.26,13.45-11.551,18.698-18.698c1.626-2.212,1.906-5.144,0.727-7.623\n\t\tl-6.247-13.141c1.021-2.163,1.942-4.405,2.754-6.704l13.727-4.881c2.591-0.919,4.468-3.189,4.881-5.912\n\t\tc0.749-4.92,1.099-9.12,1.099-13.219S173.894,78.829,173.145,73.91z M158.949,93.72l-12.878,4.58\n\t\tc-2.251,0.797-3.982,2.625-4.66,4.92c-1.15,3.889-2.664,7.569-4.504,10.943c-1.142,2.1-1.213,4.619-0.187,6.777l5.841,12.285\n\t\tc-2.822,3.389-5.943,6.515-9.337,9.334l-12.283-5.834c-2.161-1.036-4.672-0.953-6.775,0.185c-3.379,1.838-7.061,3.35-10.953,4.502\n\t\tc-2.29,0.676-4.118,2.406-4.917,4.657l-4.582,12.883c-4.677,0.476-8.503,0.476-13.18,0l-4.582-12.883\n\t\tc-0.8-2.246-2.628-3.982-4.917-4.657c-3.894-1.152-7.579-2.664-10.953-4.502c-2.103-1.147-4.619-1.22-6.775-0.185l-12.283,5.839\n\t\tc-3.391-2.825-6.512-5.946-9.337-9.339l5.841-12.285c1.026-2.159,0.955-4.677-0.187-6.777c-1.835-3.364-3.35-7.049-4.504-10.948\n\t\tc-0.678-2.29-2.411-4.118-4.66-4.915l-12.878-4.58c-0.243-2.343-0.36-4.502-0.36-6.592s0.117-4.244,0.36-6.587l12.881-4.584\n\t\tc2.248-0.797,3.979-2.625,4.657-4.915c1.152-3.889,2.667-7.574,4.504-10.953c1.142-2.095,1.213-4.619,0.187-6.772l-5.841-12.285\n\t\tc2.827-3.393,5.948-6.519,9.337-9.339l12.288,5.839c2.151,1.036,4.677,0.953,6.775-0.185c3.372-1.838,7.054-3.35,10.948-4.502\n\t\tc2.29-0.676,4.118-2.411,4.917-4.657l4.582-12.883c4.633-0.481,8.466-0.481,13.18,0l4.582,12.883\n\t\tc0.8,2.246,2.628,3.982,4.917,4.657c3.894,1.152,7.579,2.664,10.953,4.502c2.103,1.147,4.614,1.22,6.775,0.185l12.283-5.839\n\t\tc3.389,2.82,6.51,5.946,9.337,9.339l-5.841,12.285c-1.026,2.154-0.955,4.677,0.187,6.772c1.843,3.389,3.357,7.069,4.504,10.948\n\t\tc0.678,2.295,2.409,4.123,4.66,4.92l12.878,4.58c0.243,2.343,0.36,4.502,0.36,6.592S159.192,91.377,158.949,93.72z"),P(s,"d","M87.124,50.802c-19.062,0-34.571,15.508-34.571,34.571s15.508,34.571,34.571,34.571s34.571-15.508,34.571-34.571\n\t\tS106.186,50.802,87.124,50.802z M87.124,105.009c-10.827,0-19.636-8.809-19.636-19.636s8.809-19.636,19.636-19.636\n\t\ts19.636,8.809,19.636,19.636S97.951,105.009,87.124,105.009z"),P(n,"version","1.1"),P(n,"xmlns","http://www.w3.org/2000/svg"),P(n,"xmlns:xlink","http://www.w3.org/1999/xlink"),P(n,"x","0px"),P(n,"y","0px"),P(n,"viewBox","0 0 174.248 174.248"),P(n,"xml:space","preserve")},m(t,e){A(t,n,e),T(n,r),T(r,o),T(r,s)},p:t,i:t,o:t,d(t){t&&_(n)}}}const rc=class extends Ft{constructor(t){super(),Rt(this,t,null,nc,i,{})}};function oc(e){let n;return{c(){n=D("header"),n.innerHTML='<h1 class="svelte-ntsh7z">r/HFY epub generator <a class="small svelte-ntsh7z" href="https://github.com/cpiber/hfy-epub/tree/master/docs/index.md" target="_blank">Help</a></h1>',P(n,"class","svelte-ntsh7z")},m(t,e){A(t,n,e)},p:t,i:t,o:t,d(t){t&&_(n)}}}function sc(t){return[]}const ic=class extends Ft{constructor(t){super(),Rt(this,t,sc,oc,i,{})}};function lc(t){let e,n,r,o,s,i,l,c;return{c(){e=D("p"),n=R("This website ("),r=D("a"),r.textContent="https://cpiber.github.io/hfy-epub",o=R(") does not, and will not, collect any data from its users.\n      Any actions taken on this page are purely in the user's browser; there is no server-side component.\n      No data is ever sent away.\n      For collecting the chapter data, this site contacts "),s=D("code"),s.textContent=`${Me}`,i=R(" and/or the specified URLs only. The book is generated in the browser."),P(r,"href","https://cpiber.github.io/hfy-epub"),P(r,"target","_blank"),P(e,"class","small svelte-1f8pws6")},m(t,l){A(t,e,l),T(e,n),T(e,r),T(e,o),T(e,s),T(e,i),c=!0},i(t){c||(t&&lt(()=>{c&&(l||(l=xt(e,He,{},!0)),l.run(1))}),c=!0)},o(t){t&&(l||(l=xt(e,He,{},!1)),l.run(0)),c=!1},d(t){t&&_(e),t&&l&&l.end()}}}function cc(t){let e,n,r,o,s;return{c(){e=D("label"),n=D("input"),r=R(" Use TinyMCE chapter editor"),P(n,"type","checkbox"),P(n,"aria-label","use TinyMCE editor"),P(n,"class","svelte-1f8pws6"),P(e,"class","small svelte-1f8pws6")},m(i,l){A(i,e,l),T(e,n),n.checked=t[2].useTiny,T(e,r),o||(s=I(n,"change",t[4]),o=!0)},p(t,e){4&e&&(n.checked=t[2].useTiny)},d(t){t&&_(e),o=!1,s()}}}function ac(t){let e,n,r,o,s,i,l,c,a,u,d,p,f,h,m,g=!On(t[1].stage,fn.SETTINGS),$=t[0]&&lc(),v=g&&cc(t);return{c(){e=D("footer"),n=D("p"),r=R("Made by "),o=D("a"),o.textContent="@cpiber",s=R(".\n    Source Code & bug tracker: "),i=D("a"),i.textContent="cpiber/hfy-epub",l=R(".\n    \n    Version "),c=R("0.4.0"),a=R(".\n    "),u=D("a"),u.textContent="Privacy",d=R("."),p=U(),$&&$.c(),f=U(),v&&v.c(),P(o,"href","https://github.com/cpiber"),P(o,"target","_blank"),P(i,"href","https://github.com/cpiber/hfy-epub"),P(i,"target","_blank"),P(u,"href","#privacy"),P(n,"class","small svelte-1f8pws6"),P(e,"class","svelte-1f8pws6")},m(g,b){A(g,e,b),T(e,n),T(n,r),T(n,o),T(n,s),T(n,i),T(n,l),T(n,c),T(n,a),T(n,u),T(n,d),T(e,p),$&&$.m(e,null),T(e,f),v&&v.m(e,null),h||(m=I(u,"click",M(t[3])),h=!0)},p(t,[n]){t[0]?$?1&n&&bt($,1):($=lc(),$.c(),bt($,1),$.m(e,f)):$&&($t(),yt($,1,1,()=>{$=null}),vt()),2&n&&(g=!On(t[1].stage,fn.SETTINGS)),g?v?v.p(t,n):(v=cc(t),v.c(),v.m(e,null)):v&&(v.d(1),v=null)},i(t){bt($)},o(t){yt($)},d(t){t&&_(e),$&&$.d(),v&&v.d(),h=!1,m()}}}function uc(t,e,n){let r,o;u(t,An,t=>n(1,r=t)),u(t,Jt,t=>n(2,o=t));let s=!1;return[s,r,o,()=>n(0,s=!s),function(){o.useTiny=this.checked,Jt.set(o)}]}const dc=class extends Ft{constructor(t){super(),Rt(this,t,uc,ac,i,{})}};function pc(t){let e,n,r,o,s,i;return n=new Qs({}),{c(){e=D("a"),Nt(n.$$.fragment),r=R(" home"),P(e,"href","#home"),P(e,"class","homelink svelte-ibaoy7")},m(l,c){A(l,e,c),Dt(n,e,null),T(e,r),o=!0,s||(i=I(e,"click",M(t[6])),s=!0)},i(t){o||(bt(n.$$.fragment,t),o=!0)},o(t){yt(n.$$.fragment,t),o=!1},d(t){t&&_(e),Lt(n),s=!1,i()}}}function fc(e){let n,r,o,s,i;return r=new rc({}),{c(){n=D("a"),Nt(r.$$.fragment),P(n,"href","#settings"),P(n,"class","settingslink svelte-ibaoy7")},m(t,l){A(t,n,l),Dt(r,n,null),o=!0,s||(i=I(n,"click",M(e[3])),s=!0)},p:t,i(t){o||(bt(r.$$.fragment,t),o=!0)},o(t){yt(r.$$.fragment,t),o=!1},d(t){t&&_(n),Lt(r),s=!1,i()}}}function hc(e){let n,r,o,s,i,l;return r=new Qs({}),{c(){n=D("a"),Nt(r.$$.fragment),o=R(" back"),P(n,"href","#home"),P(n,"class","homelink svelte-ibaoy7")},m(t,c){A(t,n,c),Dt(r,n,null),T(n,o),s=!0,i||(l=I(n,"click",M(e[7])),i=!0)},p:t,i(t){s||(bt(r.$$.fragment,t),s=!0)},o(t){yt(r.$$.fragment,t),s=!1},d(t){t&&_(n),Lt(r),i=!1,l()}}}function mc(e){let n,r,o;return{c(){n=D("h2"),n.textContent="Page not found",r=U(),o=D("p"),o.textContent="Sorry, the requested page could not be found"},m(t,e){A(t,n,e),A(t,r,e),A(t,o,e)},p:t,i:t,o:t,d(t){t&&(_(n),_(r),_(o))}}}function gc(e){let n,r;return n=new he({}),{c(){Nt(n.$$.fragment)},m(t,e){Dt(n,t,e),r=!0},p:t,i(t){r||(bt(n.$$.fragment,t),r=!0)},o(t){yt(n.$$.fragment,t),r=!1},d(t){Lt(n,t)}}}function $c(t){let e,n;return e=new Jn({props:{stage:t[0],backToSearch:t[2]}}),{c(){Nt(e.$$.fragment)},m(t,r){Dt(e,t,r),n=!0},p(t,n){const r={};1&n&&(r.stage=t[0]),4&n&&(r.backToSearch=t[2]),e.$set(r)},i(t){n||(bt(e.$$.fragment,t),n=!0)},o(t){yt(e.$$.fragment,t),n=!1},d(t){Lt(e,t)}}}function vc(t){let e,n;return e=new Tr({props:{stage:t[0]}}),{c(){Nt(e.$$.fragment)},m(t,r){Dt(e,t,r),n=!0},p(t,n){const r={};1&n&&(r.stage=t[0]),e.$set(r)},i(t){n||(bt(e.$$.fragment,t),n=!0)},o(t){yt(e.$$.fragment,t),n=!1},d(t){Lt(e,t)}}}function bc(t){let e,n;return e=new jr({props:{stage:t[0]}}),{c(){Nt(e.$$.fragment)},m(t,r){Dt(e,t,r),n=!0},p(t,n){const r={};1&n&&(r.stage=t[0]),e.$set(r)},i(t){n||(bt(e.$$.fragment,t),n=!0)},o(t){yt(e.$$.fragment,t),n=!1},d(t){Lt(e,t)}}}function yc(t){let e,n;return e=new cl({props:{stage:t[0]}}),{c(){Nt(e.$$.fragment)},m(t,r){Dt(e,t,r),n=!0},p(t,n){const r={};1&n&&(r.stage=t[0]),e.$set(r)},i(t){n||(bt(e.$$.fragment,t),n=!0)},o(t){yt(e.$$.fragment,t),n=!1},d(t){Lt(e,t)}}}function wc(t){let e,n;return e=new Cl({props:{stage:t[0],series:t[1].series,backToSearch:t[2]}}),{c(){Nt(e.$$.fragment)},m(t,r){Dt(e,t,r),n=!0},p(t,n){const r={};1&n&&(r.stage=t[0]),2&n&&(r.series=t[1].series),4&n&&(r.backToSearch=t[2]),e.$set(r)},i(t){n||(bt(e.$$.fragment,t),n=!0)},o(t){yt(e.$$.fragment,t),n=!1},d(t){Lt(e,t)}}}function xc(t){let e,n;return e=new Ul({props:{stage:t[0],search:t[1].search}}),{c(){Nt(e.$$.fragment)},m(t,r){Dt(e,t,r),n=!0},p(t,n){const r={};1&n&&(r.stage=t[0]),2&n&&(r.search=t[1].search),e.$set(r)},i(t){n||(bt(e.$$.fragment,t),n=!0)},o(t){yt(e.$$.fragment,t),n=!1},d(t){Lt(e,t)}}}function Ec(t){let e,n;return e=new ec({props:{stage:t[0],search:t[1].search}}),{c(){Nt(e.$$.fragment)},m(t,r){Dt(e,t,r),n=!0},p(t,n){const r={};1&n&&(r.stage=t[0]),2&n&&(r.search=t[1].search),e.$set(r)},i(t){n||(bt(e.$$.fragment,t),n=!0)},o(t){yt(e.$$.fragment,t),n=!1},d(t){Lt(e,t)}}}function kc(t){let e,n,r,o,s,i,l,c,a,u,d,p,f,h,m,g,$,v,b,y,w,x,E,k,C=!On(t[0],fn.INPUT)&&!On(t[0],fn.SETTINGS),S=C&&pc(t);const O=[hc,fc],N=[];function L(t,e){return 1&e&&(o=null),null==o&&(o=!!On(t[0],fn.SETTINGS)),o?0:1}s=L(t,-1),i=N[s]=O[s](t),c=new ic({});const R=[Ec,xc,wc,yc,bc,vc,$c,gc,mc],F=[];function I(t,e){return 1&e&&(d=null),1&e&&(p=null),1&e&&(f=null),1&e&&(h=null),1&e&&(m=null),1&e&&(g=null),1&e&&($=null),1&e&&(v=null),1&e&&(b=null),null==d&&(d=!!On(t[0],fn.INPUT)),d?0:(null==p&&(p=!!On(t[0],fn.SEARCH)),p?1:(null==f&&(f=!!On(t[0],fn.BOOK_DATA)),f?2:(null==h&&(h=!!On(t[0],fn.EDIT_DATA)),h?3:(null==m&&(m=!!On(t[0],fn.FIND_CHAPTERS)),m?4:(null==g&&(g=!!On(t[0],fn.DOWNLOAD_CHAPTERS)),g?5:(null==$&&($=!!On(t[0],fn.RESULT)),$?6:(null==v&&(v=!!On(t[0],fn.SETTINGS)),v?7:(null==b&&(b=!!On(t[0],fn._404)),b?8:-1))))))))}return~(y=I(t,-1))&&(w=F[y]=R[y](t)),E=new dc({}),{c(){e=D("div"),n=D("nav"),S&&S.c(),r=U(),i.c(),l=U(),Nt(c.$$.fragment),a=U(),u=D("main"),w&&w.c(),x=U(),Nt(E.$$.fragment),P(n,"class","mainnav svelte-ibaoy7"),P(u,"class","App-main"),P(e,"class","App svelte-ibaoy7")},m(t,o){A(t,e,o),T(e,n),S&&S.m(n,null),T(n,r),N[s].m(n,null),T(e,l),Dt(c,e,null),T(e,a),T(e,u),~y&&F[y].m(u,null),T(e,x),Dt(E,e,null),k=!0},p(t,[e]){1&e&&(C=!On(t[0],fn.INPUT)&&!On(t[0],fn.SETTINGS)),C?S?1&e&&bt(S,1):(S=pc(t),S.c(),bt(S,1),S.m(n,r)):S&&($t(),yt(S,1,1,()=>{S=null}),vt());let o=s;s=L(t,e),s===o?N[s].p(t,e):($t(),yt(N[o],1,1,()=>{N[o]=null}),vt(),i=N[s],i?i.p(t,e):(i=N[s]=O[s](t),i.c()),bt(i,1),i.m(n,null));let l=y;y=I(t,e),y===l?~y&&F[y].p(t,e):(w&&($t(),yt(F[l],1,1,()=>{F[l]=null}),vt()),~y?(w=F[y],w?w.p(t,e):(w=F[y]=R[y](t),w.c()),bt(w,1),w.m(u,null)):w=null)},i(t){k||(bt(S),bt(i),bt(c.$$.fragment,t),bt(w),bt(E.$$.fragment,t),k=!0)},o(t){yt(S),yt(i),yt(c.$$.fragment,t),yt(w),yt(E.$$.fragment,t),k=!1},d(t){t&&_(e),S&&S.d(),N[s].d(),Lt(c),~y&&F[y].d(),Lt(E)}}}function Cc(t,e,n){let r,o,s,i,l;return u(t,_n,t=>n(4,s=t)),u(t,An,t=>n(1,i=t)),u(t,Jt,t=>n(5,l=t)),t.$$.update=()=>{2&t.$$.dirty&&n(0,r=i.stage),1&t.$$.dirty&&n(2,o=On(r.from,fn.SEARCH)?()=>Cn($n):void 0),t.$$.dirty,t.$$.dirty,t.$$.dirty,32&t.$$.dirty&&localStorage.setItem("config",JSON.stringify(l)),2&t.$$.dirty&&localStorage.setItem("state",JSON.stringify({data:i.stage.dump(),search:i.search,series:i.series})),16&t.$$.dirty&&(async t=>t?JSON.stringify(await Rn(t)):"undefined")(s).then(t=>{try{localStorage.setItem("book",t)}catch(t){return t}},()=>{localStorage.removeItem("book"),console.error("Data too large! Caution, reloading won't work as expected!")})},[r,i,o,()=>{r.needsSaving&&!confirm("Unsaved changes. Continue?")||Cn(En)},s,l,()=>Cn(gn),()=>r.next()]}(()=>{var t;try{const e=JSON.parse(null!==(t=localStorage.getItem("config"))&&void 0!==t?t:"");Jt.set((t=>{if(!t||""+t!="[object Object]")return Kt;const e=Object.keys(t),n=Object.keys(Kt);for(const r of n)e.includes(r)||(t[r]=Kt[r]),typeof Kt[r]!=typeof t[r]&&(t[r]=Kt[r]);return t})(e))}catch(t){}})(),(()=>{var t;try{const e=(t=>{const e=JSON.parse(t);return Ln(e)})(null!==(t=localStorage.getItem("book"))&&void 0!==t?t:"");_n.update(()=>e)}catch(t){console.error(t)}})(),window.removeEventListener("popstate",Dn),window.addEventListener("popstate",Dn),Dn(),De.subscribe(()=>console.log("Extension status changed"));const Tc=class extends Ft{constructor(t){super(),Rt(this,t,Cc,kc,i,{})}};let Sc;try{Sc=new Tc({target:document.body})}catch(t){const e=document.createElement("div");e.className="fatal-error",e.ariaLabel="error",e.appendChild(document.createElement("h1")).textContent="Something went wrong:",e.appendChild(document.createElement("code")).textContent=t,document.body.appendChild(e)}})(),c=l.O(c)})();