(()=>{var t,e,n,r,o,s={4785:function(t,e){var n,r;void 0===(r="function"==typeof(n=function(){return function t(e,n,r){var o,s,i=window,a="application/octet-stream",l=r||a,c=e,u=!n&&!r&&c,d=document.createElement("a"),f=function(t){return String(t)},p=i.Blob||i.MozBlob||i.WebKitBlob||f,h=n||"download";if(p=p.call?p.bind(i):Blob,"true"===String(this)&&(l=(c=[c,l])[0],c=c[1]),u&&u.length<2048&&(h=u.split("/").pop().split("?")[0],d.href=u,-1!==d.href.indexOf(u))){var m=new XMLHttpRequest;return m.open("GET",u,!0),m.responseType="blob",m.onload=function(e){t(e.target.response,h,a)},setTimeout((function(){m.send()}),0),m}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(c)){if(!(c.length>2096103.424&&p!==f))return navigator.msSaveBlob?navigator.msSaveBlob($(c),h):y(c);l=(c=$(c)).type||a}else if(/([\x80-\xff])/.test(c)){for(var g=0,v=new Uint8Array(c.length),b=v.length;g<b;++g)v[g]=c.charCodeAt(g);c=new p([v],{type:l})}function $(t){for(var e=t.split(/[:;,]/),n=e[1],r=("base64"==e[2]?atob:decodeURIComponent)(e.pop()),o=r.length,s=0,i=new Uint8Array(o);s<o;++s)i[s]=r.charCodeAt(s);return new p([i],{type:n})}function y(t,e){if("download"in d)return d.href=t,d.setAttribute("download",h),d.className="download-js-link",d.innerHTML="downloading...",d.style.display="none",document.body.appendChild(d),setTimeout((function(){d.click(),document.body.removeChild(d),!0===e&&setTimeout((function(){i.URL.revokeObjectURL(d.href)}),250)}),66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,a)),window.open(t)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=t),!0;var n=document.createElement("iframe");document.body.appendChild(n),!e&&/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,a)),n.src=t,setTimeout((function(){document.body.removeChild(n)}),333)}if(o=c instanceof p?c:new p([c],{type:l}),navigator.msSaveBlob)return navigator.msSaveBlob(o,h);if(i.URL)y(i.URL.createObjectURL(o),!0);else{if("string"==typeof o||o.constructor===f)try{return y("data:"+l+";base64,"+i.btoa(o))}catch(t){return y("data:"+l+","+encodeURIComponent(o))}(s=new FileReader).onload=function(t){y(this.result)},s.readAsDataURL(o)}return!0}})?n.apply(e,[]):n)||(t.exports=r)}},i={};function a(t){var e=i[t];if(void 0!==e)return e.exports;var n=i[t]={id:t,loaded:!1,exports:{}};return s[t].call(n.exports,n,n.exports,a),n.loaded=!0,n.exports}a.m=s,t=[],a.O=(e,n,r,o)=>{if(!n){var s=1/0;for(u=0;u<t.length;u++){for(var[n,r,o]=t[u],i=!0,l=0;l<n.length;l++)(!1&o||s>=o)&&Object.keys(a.O).every((t=>a.O[t](n[l])))?n.splice(l--,1):(i=!1,o<s&&(s=o));if(i){t.splice(u--,1);var c=r();void 0!==c&&(e=c)}}return e}o=o||0;for(var u=t.length;u>0&&t[u-1][2]>o;u--)t[u]=t[u-1];t[u]=[n,r,o]},a.F={},a.E=t=>{Object.keys(a.F).map((e=>{a.F[e](t)}))},a.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return a.d(e,{a:e}),e},n=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,a.t=function(t,r){if(1&r&&(t=this(t)),8&r)return t;if("object"==typeof t&&t){if(4&r&&t.__esModule)return t;if(16&r&&"function"==typeof t.then)return t}var o=Object.create(null);a.r(o);var s={};e=e||[null,n({}),n([]),n(n)];for(var i=2&r&&t;"object"==typeof i&&!~e.indexOf(i);i=n(i))Object.getOwnPropertyNames(i).forEach((e=>s[e]=()=>t[e]));return s.default=()=>t,a.d(o,s),o},a.d=(t,e)=>{for(var n in e)a.o(e,n)&&!a.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},a.f={},a.e=t=>Promise.all(Object.keys(a.f).reduce(((e,n)=>(a.f[n](t,e),e)),[])),a.u=t=>t+".main.js",a.miniCssF=t=>"main.css",a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r={},o="hfy-epub:",a.l=(t,e,n,s)=>{if(r[t])r[t].push(e);else{var i,l;if(void 0!==n)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==t||d.getAttribute("data-webpack")==o+n){i=d;break}}i||(l=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,a.nc&&i.setAttribute("nonce",a.nc),i.setAttribute("data-webpack",o+n),i.src=t),r[t]=[e];var f=(e,n)=>{i.onerror=i.onload=null,clearTimeout(p);var o=r[t];if(delete r[t],i.parentNode&&i.parentNode.removeChild(i),o&&o.forEach((t=>t(n))),e)return e(n)},p=setTimeout(f.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=f.bind(null,i.onerror),i.onload=f.bind(null,i.onload),l&&document.head.appendChild(i)}},a.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{var t;a.g.importScripts&&(t=a.g.location+"");var e=a.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");n.length&&(t=n[n.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=t})(),(()=>{var t={179:0};a.f.j=(e,n)=>{var r=a.o(t,e)?t[e]:void 0;if(0!==r)if(r)n.push(r[2]);else{var o=new Promise(((n,o)=>r=t[e]=[n,o]));n.push(r[2]=o);var s=a.p+a.u(e),i=new Error;a.l(s,(n=>{if(a.o(t,e)&&(0!==(r=t[e])&&(t[e]=void 0),r)){var o=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.src;i.message="Loading chunk "+e+" failed.\n("+o+": "+s+")",i.name="ChunkLoadError",i.type=o,i.request=s,r[1](i)}}),"chunk-"+e,e)}},a.F.j=e=>{if(!a.o(t,e)||void 0===t[e]){t[e]=null;var n=document.createElement("link");a.nc&&n.setAttribute("nonce",a.nc),n.rel="prefetch",n.as="script",n.href=a.p+a.u(e),document.head.appendChild(n)}},a.O.j=e=>0===t[e];var e=(e,n)=>{var r,o,[s,i,l]=n,c=0;if(s.some((e=>0!==t[e]))){for(r in i)a.o(i,r)&&(a.m[r]=i[r]);if(l)var u=l(a)}for(e&&e(n);c<s.length;c++)o=s[c],a.o(t,o)&&t[o]&&t[o][0](),t[s[c]]=0;return a.O(u)},n=self.webpackChunkhfy_epub=self.webpackChunkhfy_epub||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})(),a.O(0,[179],(()=>{a.E(752),a.E(483)}),5);var l={};(()=>{"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function o(t){return"function"==typeof t}function s(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function i(t){return 0===Object.keys(t).length}new Set;let l,c=!1;function u(t,e){t.appendChild(e)}function d(t,e,n){t.insertBefore(e,n||null)}function f(t){t.parentNode.removeChild(t)}function p(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function h(t){return document.createElement(t)}function m(t){return document.createTextNode(t)}function g(){return m(" ")}function v(){return m("")}function b(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function $(t){return function(e){return e.preventDefault(),t.call(this,e)}}function y(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function w(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function E(t,e){t.value=null==e?"":e}function R(t){l=t}new Set;const x=[],O=[],N=[],T=[],k=Promise.resolve();let C=!1;function L(t){N.push(t)}let S=!1;const _=new Set;function A(){if(!S){S=!0;do{for(let t=0;t<x.length;t+=1){const e=x[t];R(e),j(e.$$)}for(R(null),x.length=0;O.length;)O.pop()();for(let t=0;t<N.length;t+=1){const e=N[t];_.has(e)||(_.add(e),e())}N.length=0}while(x.length);for(;T.length;)T.pop()();C=!1,S=!1,_.clear()}}function j(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(L)}}const P=new Set;let U,G;function I(t,e){t&&t.i&&(P.delete(t),t.i(e))}function D(t,e,n,r){if(t&&t.o){if(P.has(t))return;P.add(t),U.c.push((()=>{P.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}}function H(t){t&&t.c()}function M(t,n,s,i){const{fragment:a,on_mount:l,on_destroy:c,after_update:u}=t.$$;a&&a.m(n,s),i||L((()=>{const n=l.map(e).filter(o);c?c.push(...n):r(n),t.$$.on_mount=[]})),u.forEach(L)}function F(t,e){const n=t.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function B(e,o,s,i,a,u,d,p=[-1]){const h=l;R(e);const m=e.$$={fragment:null,ctx:null,props:u,update:t,not_equal:a,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(h?h.$$.context:o.context||[]),callbacks:n(),dirty:p,skip_bound:!1,root:o.target||h.$$.root};d&&d(m.root);let g=!1;if(m.ctx=s?s(e,o.props||{},((t,n,...r)=>{const o=r.length?r[0]:n;return m.ctx&&a(m.ctx[t],m.ctx[t]=o)&&(!m.skip_bound&&m.bound[t]&&m.bound[t](o),g&&function(t,e){-1===t.$$.dirty[0]&&(x.push(t),C||(C=!0,k.then(A)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}(e,t)),n})):[],m.update(),g=!0,r(m.before_update),m.fragment=!!i&&i(m.ctx),o.target){if(o.hydrate){c=!0;const t=(v=o.target,Array.from(v.childNodes));m.fragment&&m.fragment.l(t),t.forEach(f)}else m.fragment&&m.fragment.c();o.intro&&I(e.$$.fragment),M(e,o.target,o.anchor,o.customElement),c=!1,A()}var v;R(h)}"undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global,new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]),"function"==typeof HTMLElement&&(G=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:t}=this.$$;this.$$.on_disconnect=t.map(e).filter(o);for(const t in this.$$.slotted)this.appendChild(this.$$.slotted[t])}attributeChangedCallback(t,e,n){this[t]=n}disconnectedCallback(){r(this.$$.on_disconnect)}$destroy(){F(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){this.$$set&&!i(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}});class W{$destroy(){F(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){this.$$set&&!i(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function q(e){let n;return{c(){n=h("footer"),n.innerHTML='Made by <a href="https://github.com/cpiber" target="_blank" class="svelte-vfwmie">@cpiber</a>. Source Code: <a href="https://github.com/cpiber/hfy-epub" target="_blank" class="svelte-vfwmie">cpiber/hfy-epub</a>',y(n,"class","svelte-vfwmie")},m(t,e){d(t,n,e)},p:t,i:t,o:t,d(t){t&&f(n)}}}const K=class extends W{constructor(t){super(),B(this,t,null,q,s,{})}};function Y(e){let n;return{c(){n=h("header"),n.innerHTML='<h1 class="svelte-10isbm1">r/HFY epub generator</h1>',y(n,"class","svelte-10isbm1")},m(t,e){d(t,n,e)},p:t,i:t,o:t,d(t){t&&f(n)}}}const z=class extends W{constructor(t){super(),B(this,t,null,Y,s,{})}};function V(t){let e;return{c(){e=h("p"),e.textContent="Please enter a search string",y(e,"class","small error svelte-1uob44x")},m(t,n){d(t,e,n)},d(t){t&&f(e)}}}function X(e){let n,o,s,i,a,l,c,p,m,$,w,R,x,O=!e[0].trim().length,N=O&&V();return{c(){n=h("h2"),n.textContent="Please enter your search terms below:",o=g(),s=h("p"),s.innerHTML='For now, we only support <a href="https://reddit.com/r/HFY" target="_blank">r/HFY</a>: series titles and urls to wiki pages',i=g(),a=h("form"),l=h("input"),c=g(),p=h("input"),$=g(),N&&N.c(),w=v(),y(n,"class","heading svelte-1uob44x"),y(l,"class","search svelte-1uob44x"),y(l,"placeholder","Search..."),y(p,"type","submit"),p.value="Go",y(p,"class","submit svelte-1uob44x"),p.disabled=m=!e[0].trim().length,y(a,"class","form svelte-1uob44x")},m(t,r){var f;d(t,n,r),d(t,o,r),d(t,s,r),d(t,i,r),d(t,a,r),u(a,l),E(l,e[0]),u(a,c),u(a,p),d(t,$,r),N&&N.m(t,r),d(t,w,r),R||(x=[b(l,"input",e[2]),b(a,"submit",(f=e[3],function(t){return t.stopPropagation(),f.call(this,t)}))],R=!0)},p(t,[e]){1&e&&l.value!==t[0]&&E(l,t[0]),1&e&&m!==(m=!t[0].trim().length)&&(p.disabled=m),1&e&&(O=!t[0].trim().length),O?N||(N=V(),N.c(),N.m(w.parentNode,w)):N&&(N.d(1),N=null)},i:t,o:t,d(t){t&&f(n),t&&f(o),t&&f(s),t&&f(i),t&&f(a),t&&f($),N&&N.d(t),t&&f(w),R=!1,r(x)}}}function J(t,e,n){let{search:r=""}=e,{goNext:o}=e;return t.$$set=t=>{"search"in t&&n(0,r=t.search),"goNext"in t&&n(1,o=t.goNext)},[r,o,function(){r=this.value,n(0,r)},()=>o(r)]}const Q=class extends W{constructor(t){super(),B(this,t,J,X,s,{search:0,goNext:1})}};var Z,tt=a(4785),et=a.n(tt),nt=function(t){return t.hostname="api.reddit.com",t.pathname.endsWith("/")?t.pathname=t.pathname.slice(0,t.pathname.length-1)+".json":t.pathname.endsWith(".json")||(t.pathname+=".json"),t.protocol="https",t.toString()},rt=(Z=new DOMParser,function(t){return Z.parseFromString(t,"text/html").documentElement.textContent});function ot(t,e,n){const r=t.slice();return r[13]=e[n],r}function st(t){let e,n,r,o,s,i,a,l,c=t[3]?": ":"";return{c(){e=h("p"),n=m("Sorry, there was an error"),r=m(c),o=m(t[3]),s=g(),i=h("button"),i.textContent="Retry",y(e,"class","error svelte-ggvisn")},m(c,f){d(c,e,f),u(e,n),u(e,r),u(e,o),d(c,s,f),d(c,i,f),a||(l=b(i,"click",t[6]),a=!0)},p(t,e){8&e&&c!==(c=t[3]?": ":"")&&w(r,c),8&e&&w(o,t[3])},d(t){t&&f(e),t&&f(s),t&&f(i),a=!1,l()}}}function it(e){let n,r,o,s,i;return{c(){n=h("h3"),n.textContent="Your ebook is ready!",r=g(),o=h("button"),o.textContent="Download",y(n,"class","valid svelte-ggvisn")},m(t,a){d(t,n,a),d(t,r,a),d(t,o,a),s||(i=b(o,"click",e[9]),s=!0)},p:t,d(t){t&&f(n),t&&f(r),t&&f(o),s=!1,i()}}}function at(e){let n;return{c(){n=h("div"),n.innerHTML='<div class="loading-slider-container svelte-ggvisn"><span class="loading-slider svelte-ggvisn">•</span></div> \n    <p class="loading svelte-ggvisn">Please wait, generating ebook...</p>',y(n,"class","loading-container svelte-ggvisn")},m(t,e){d(t,n,e)},p:t,d(t){t&&f(n)}}}function lt(t){let e,n,r,o=t[4],s=[];for(let e=0;e<o.length;e+=1)s[e]=dt(ot(t,o,e));return{c(){e=h("div"),e.innerHTML='<div class="loading-slider-container svelte-ggvisn"><span class="loading-slider svelte-ggvisn">•</span></div> \n    <p class="loading svelte-ggvisn">Please wait, fetching chapters...</p>',n=g(),r=h("div");for(let t=0;t<s.length;t+=1)s[t].c();y(e,"class","loading-container svelte-ggvisn"),y(r,"class","chapters svelte-ggvisn")},m(t,o){d(t,e,o),d(t,n,o),d(t,r,o);for(let t=0;t<s.length;t+=1)s[t].m(r,null)},p(t,e){if(16&e){let n;for(o=t[4],n=0;n<o.length;n+=1){const i=ot(t,o,n);s[n]?s[n].p(i,e):(s[n]=dt(i),s[n].c(),s[n].m(r,null))}for(;n<s.length;n+=1)s[n].d(1);s.length=o.length}},d(t){t&&f(e),t&&f(n),t&&f(r),p(s,t)}}}function ct(t){let e,n,r,o,s,i,a,l,c,p,v,$,E,R,x,O,N,T,k,C,L,S=t[2].title+"",_=t[2].author+"",A=t[2].chapters.length+"";return{c(){e=m("Got the following series:\n\n  "),n=h("div"),r=h("h3"),r.textContent="Title",o=g(),s=h("p"),i=m(S),a=g(),l=h("h3"),l.textContent="Author",c=g(),p=h("p"),v=m(_),$=g(),E=h("h3"),E.textContent="Chapters",R=g(),x=h("p"),O=m("Found "),N=m(A),T=g(),k=h("button"),k.textContent="Fetch chapters and generate EPUB",y(n,"class","series-card svelte-ggvisn")},m(f,h){d(f,e,h),d(f,n,h),u(n,r),u(n,o),u(n,s),u(s,i),u(n,a),u(n,l),u(n,c),u(n,p),u(p,v),u(n,$),u(n,E),u(n,R),u(n,x),u(x,O),u(x,N),d(f,T,h),d(f,k,h),C||(L=b(k,"click",t[7]),C=!0)},p(t,e){4&e&&S!==(S=t[2].title+"")&&w(i,S),4&e&&_!==(_=t[2].author+"")&&w(v,_),4&e&&A!==(A=t[2].chapters.length+"")&&w(N,A)},d(t){t&&f(e),t&&f(n),t&&f(T),t&&f(k),C=!1,L()}}}function ut(e){let n;return{c(){n=h("div"),n.innerHTML='<div class="loading-slider-container svelte-ggvisn"><span class="loading-slider svelte-ggvisn">•</span></div> \n    <p class="loading svelte-ggvisn">Please wait, fetching data...</p>',y(n,"class","loading-container svelte-ggvisn")},m(t,e){d(t,n,e)},p:t,d(t){t&&f(n)}}}function dt(t){let e,n,r=t[13].title+"";return{c(){e=h("p"),n=m(r),y(e,"class","valid small svelte-ggvisn")},m(t,r){d(t,e,r),u(e,n)},p(t,e){16&e&&r!==(r=t[13].title+"")&&w(n,r)},d(t){t&&f(e)}}}function ft(e){let n;function r(t,e){return t[1]===t[0].LOADING?ut:t[1]===t[0].PRESENT?ct:t[1]===t[0].FETCHING?lt:t[1]===t[0].GENERATING?at:t[1]===t[0].DOWNLOAD?it:t[1]===t[0].ERROR?st:void 0}let o=r(e),s=o&&o(e);return{c(){s&&s.c(),n=v()},m(t,e){s&&s.m(t,e),d(t,n,e)},p(t,[e]){o===(o=r(t))&&s?s.p(t,e):(s&&s.d(1),s=o&&o(t),s&&(s.c(),s.m(n.parentNode,n)))},i:t,o:t,d(t){s&&s.d(t),t&&f(n)}}}function pt(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,s){function i(t){try{l(r.next(t))}catch(t){s(t)}}function a(t){try{l(r.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,a)}l((r=r.apply(t,e||[])).next())}))};let{series:o}=e;const s=Promise.all([a.e(752),a.e(483)]).then(a.t.bind(a,5752,23));var i;!function(t){t[t.LOADING=0]="LOADING",t[t.PRESENT=1]="PRESENT",t[t.FETCHING=2]="FETCHING",t[t.GENERATING=3]="GENERATING",t[t.DOWNLOAD=4]="DOWNLOAD",t[t.ERROR=5]="ERROR"}(i||(i={}));let l,c,u,d=i.LOADING,f=[];const p=()=>r(void 0,void 0,void 0,(function*(){n(1,d=i.LOADING);try{const t=yield fetch(o),e=(yield t.json()).data.content_md,r={author:e.match(/\[\*\*([^*\]]+)\*\*\]/)[1],title:e.match(/##\s*\*\*(.+)\*\*/)[1],chapters:[...e.matchAll(/\[([^\]]+)\]\s*\(((?:https?:\/\/(?:[^.]+\.)?reddit\.com)?\/r\/hfy\/comments\/[^)]+)\)/gim)].map((t=>({title:t[1],url:nt(new URL(t[2].startsWith("http")?t[2]:`https://api.reddit.com${t[2]}`))})))};n(2,l=r),n(1,d=r.chapters.length?i.PRESENT:i.ERROR),n(3,c="No chapters found")}catch(t){n(1,d=i.ERROR),n(3,c=`${t.message||t}`)}}));return p(),t.$$set=t=>{"series"in t&&n(8,o=t.series)},[i,d,l,c,f,u,p,()=>r(void 0,void 0,void 0,(function*(){n(1,d=i.FETCHING);try{for(const t of l.chapters){const e=yield fetch(t.url),r=yield e.json(),{selftext_html:o,title:s,url:i}=r[0].data.children[0].data;f.push({title:s,content:rt(o),url:i}),n(4,f)}}catch(t){n(1,d=i.ERROR),n(3,c=`${t.message||t}`)}r(void 0,void 0,void 0,(function*(){n(1,d=i.GENERATING);const{default:t}=yield s;n(5,u=yield t({title:l.title,author:l.author,verbose:!0},f)),n(1,d=i.DOWNLOAD)}))})),o,()=>et()(u,`${l.title}.epub`,"application/epub+zip")]}const ht=class extends W{constructor(t){super(),B(this,t,pt,ft,s,{series:8})}};function mt(t,e,n){const r=t.slice();return r[9]=e[n],r}function gt(t){let e,n,r,o,s,i,a,l,c=t[6],v=[];for(let e=0;e<c.length;e+=1)v[e]=yt(mt(t,c,e));return{c(){e=h("p"),n=m("The search for '"),r=m(t[0]),o=m("' returned these results:"),s=g(),i=h("ul");for(let t=0;t<v.length;t+=1)v[t].c();a=g(),l=h("p"),l.textContent="Please select one.",y(l,"class","small")},m(t,c){d(t,e,c),u(e,n),u(e,r),u(e,o),d(t,s,c),d(t,i,c);for(let t=0;t<v.length;t+=1)v[t].m(i,null);d(t,a,c),d(t,l,c)},p(t,e){if(1&e&&w(r,t[0]),66&e){let n;for(c=t[6],n=0;n<c.length;n+=1){const r=mt(t,c,n);v[n]?v[n].p(r,e):(v[n]=yt(r),v[n].c(),v[n].m(i,null))}for(;n<v.length;n+=1)v[n].d(1);v.length=c.length}},d(t){t&&f(e),t&&f(s),t&&f(i),p(v,t),t&&f(a),t&&f(l)}}}function vt(e){let n,r,o,s,i;return{c(){n=h("p"),r=m("That's a valid series url, "),o=h("a"),o.textContent="go on ahead",y(o,"href","#?"),y(n,"class","valid svelte-158maml")},m(t,a){d(t,n,a),u(n,r),u(n,o),s||(i=b(o,"click",$(e[7])),s=!0)},p:t,d(t){t&&f(n),s=!1,i()}}}function bt(t){let e,n,r,o,s=t[5]?": ":"";return{c(){e=h("p"),n=m("Sorry, can't process that"),r=m(s),o=m(t[5]),y(e,"class","error svelte-158maml")},m(t,s){d(t,e,s),u(e,n),u(e,r),u(e,o)},p(t,e){32&e&&s!==(s=t[5]?": ":"")&&w(r,s),32&e&&w(o,t[5])},d(t){t&&f(e)}}}function $t(e){let n;return{c(){n=h("div"),n.innerHTML='<div class="loading-slider-container svelte-158maml"><span class="loading-slider svelte-158maml">•</span></div> \n    <p class="loading svelte-158maml">Please wait, fetching results...</p>',y(n,"class","loading-container svelte-158maml")},m(t,e){d(t,n,e)},p:t,d(t){t&&f(n)}}}function yt(t){let e,n,r,o,s,i=t[9].title+"";function a(){return t[8](t[9])}return{c(){e=h("li"),n=h("a"),r=m(i),y(n,"href","#?")},m(t,i){d(t,e,i),u(e,n),u(n,r),o||(s=b(n,"click",$(a)),o=!0)},p(e,n){t=e,64&n&&i!==(i=t[9].title+"")&&w(r,i)},d(t){t&&f(e),o=!1,s()}}}function wt(e){let n;function r(t,e){return t[4]===t[3].LOADING?$t:t[4]===t[3].ERROR?bt:t[4]===t[3].OK?vt:t[4]===t[3].RESULTS?gt:void 0}let o=r(e),s=o&&o(e);return{c(){s&&s.c(),n=v()},m(t,e){s&&s.m(t,e),d(t,n,e)},p(t,[e]){o===(o=r(t))&&s?s.p(t,e):(s&&s.d(1),s=o&&o(t),s&&(s.c(),s.m(n.parentNode,n)))},i:t,o:t,d(t){s&&s.d(t),t&&f(n)}}}function Et(t,e,n){let r,{search:o}=e,{goNext:s}=e;var i;!function(t){t[t.LOADING=0]="LOADING",t[t.OK=1]="OK",t[t.RESULTS=2]="RESULTS",t[t.ERROR=3]="ERROR"}(i||(i={}));let a=i.LOADING,l="",c=[];try{if(!o.match(/^https?:\/\/(?:[^.]+\.)?reddit\.com\/r\/hfy\/wiki\/series\//i))throw new Error;r=nt(new URL(o)),fetch(r).then((t=>(t.ok&&s(r),n(4,a=t.ok?i.OK:i.ERROR),t.ok?{}:t.json()))).then((t=>n(5,l=t.message))).catch((t=>{n(4,a=i.ERROR),n(5,l=`${t.message||t}`)}))}catch(t){const e=o.toLowerCase();fetch("https://api.reddit.com/r/hfy/wiki/series.json").then((t=>t.json())).then((t=>t.data.content_md)).then((t=>[...t.matchAll(/\[([^\]]+)\]\s*\(((?:https?:\/\/(?:[^.]+\.)?reddit\.com)?\/r\/hfy\/wiki\/series\/[^)]+)\)/gim)].map((t=>({title:t[1],url:nt(new URL(t[2].startsWith("http")?t[2]:`https://api.reddit.com${t[2]}`))}))))).then((t=>n(6,c=t.filter((t=>-1!==t.title.toLowerCase().indexOf(e)))))).then((t=>{n(4,a=t.length?i.RESULTS:i.ERROR),n(5,l=`No series matched input \`${o}\``)})).catch((t=>{n(4,a=i.ERROR),n(5,l=`${t.message||t}`)}))}return t.$$set=t=>{"search"in t&&n(0,o=t.search),"goNext"in t&&n(1,s=t.goNext)},[o,s,r,i,a,l,c,()=>s(r),t=>s(t.url)]}const Rt=class extends W{constructor(t){super(),B(this,t,Et,wt,s,{search:0,goNext:1})}};function xt(e){let n,r,o;return{c(){n=m(e[2]),r=g(),o=m(e[3])},m(t,e){d(t,n,e),d(t,r,e),d(t,o,e)},p(t,e){4&e&&w(n,t[2]),8&e&&w(o,t[3])},i:t,o:t,d(t){t&&f(n),t&&f(r),t&&f(o)}}}function Ot(t){let e,n;return e=new ht({props:{series:t[3]}}),{c(){H(e.$$.fragment)},m(t,r){M(e,t,r),n=!0},p(t,n){const r={};8&n&&(r.series=t[3]),e.$set(r)},i(t){n||(I(e.$$.fragment,t),n=!0)},o(t){D(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Nt(t){let e,n;return e=new Rt({props:{goNext:t[6],search:t[2]}}),{c(){H(e.$$.fragment)},m(t,r){M(e,t,r),n=!0},p(t,n){const r={};8&n&&(r.goNext=t[6]),4&n&&(r.search=t[2]),e.$set(r)},i(t){n||(I(e.$$.fragment,t),n=!0)},o(t){D(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Tt(t){let e,n;return e=new Q({props:{goNext:t[5],search:t[2]}}),{c(){H(e.$$.fragment)},m(t,r){M(e,t,r),n=!0},p(t,n){const r={};4&n&&(r.goNext=t[5]),4&n&&(r.search=t[2]),e.$set(r)},i(t){n||(I(e.$$.fragment,t),n=!0)},o(t){D(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function kt(e){let n,r,o;return{c(){n=h("a"),n.textContent="Go back home",y(n,"href","#?"),y(n,"class","homelink svelte-sdxuta")},m(t,s){d(t,n,s),r||(o=b(n,"click",$(e[7])),r=!0)},p:t,d(t){t&&f(n),r=!1,o()}}}function Ct(t){let e,n,o,s,i,a,l,c,p,m;n=new z({});const v=[Tt,Nt,Ot,xt],b=[];function $(t,e){return t[1]===t[0].INPUT?0:t[1]===t[0].SEARCH?1:t[1]===t[0].RESULT?2:3}i=$(t),a=b[i]=v[i](t);let w=t[1]!==t[0].INPUT&&kt(t);return p=new K({}),{c(){e=h("div"),H(n.$$.fragment),o=g(),s=h("main"),a.c(),l=g(),w&&w.c(),c=g(),H(p.$$.fragment),y(s,"class","App-main"),y(e,"class","App svelte-sdxuta")},m(t,r){d(t,e,r),M(n,e,null),u(e,o),u(e,s),b[i].m(s,null),u(s,l),w&&w.m(s,null),u(e,c),M(p,e,null),m=!0},p(t,[e]){let n=i;i=$(t),i===n?b[i].p(t,e):(U={r:0,c:[],p:U},D(b[n],1,1,(()=>{b[n]=null})),U.r||r(U.c),U=U.p,a=b[i],a?a.p(t,e):(a=b[i]=v[i](t),a.c()),I(a,1),a.m(s,l)),t[1]!==t[0].INPUT?w?w.p(t,e):(w=kt(t),w.c(),w.m(s,null)):w&&(w.d(1),w=null)},i(t){m||(I(n.$$.fragment,t),I(a),I(p.$$.fragment,t),m=!0)},o(t){D(n.$$.fragment,t),D(a),D(p.$$.fragment,t),m=!1},d(t){t&&f(e),F(n),b[i].d(),w&&w.d(),F(p)}}}function Lt(t,e,n){var r;!function(t){t[t.INPUT=0]="INPUT",t[t.SEARCH=1]="SEARCH",t[t.RESULT=2]="RESULT"}(r||(r={}));let o,s,i=r.INPUT;const a=()=>n(1,i=Math.min(i+1,r.RESULT));return[r,i,o,s,a,t=>(n(2,o=t.trim()),a()),t=>(n(3,s=t),a()),()=>n(1,i=0)]}const St=class extends W{constructor(t){super(),B(this,t,Lt,Ct,s,{})}};let _t;try{_t=new St({target:document.body})}catch(t){const e=document.createElement("div");e.className="fatal-error",e.ariaLabel="error",e.appendChild(document.createElement("h1")).textContent="Something went wrong:",e.appendChild(document.createElement("code")).textContent=t,document.body.appendChild(e)}})(),l=a.O(l)})();