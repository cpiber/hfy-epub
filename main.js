(()=>{var t,e,n,r,o,i={4785:function(t,e){var n,r;void 0===(r="function"==typeof(n=function(){return function t(e,n,r){var o,i,s=window,a="application/octet-stream",l=r||a,c=e,u=!n&&!r&&c,d=document.createElement("a"),f=function(t){return String(t)},h=s.Blob||s.MozBlob||s.WebKitBlob||f,p=n||"download";if(h=h.call?h.bind(s):Blob,"true"===String(this)&&(l=(c=[c,l])[0],c=c[1]),u&&u.length<2048&&(p=u.split("/").pop().split("?")[0],d.href=u,-1!==d.href.indexOf(u))){var m=new XMLHttpRequest;return m.open("GET",u,!0),m.responseType="blob",m.onload=function(e){t(e.target.response,p,a)},setTimeout((function(){m.send()}),0),m}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(c)){if(!(c.length>2096103.424&&h!==f))return navigator.msSaveBlob?navigator.msSaveBlob(y(c),p):w(c);l=(c=y(c)).type||a}else if(/([\x80-\xff])/.test(c)){for(var g=0,v=new Uint8Array(c.length),b=v.length;g<b;++g)v[g]=c.charCodeAt(g);c=new h([v],{type:l})}function y(t){for(var e=t.split(/[:;,]/),n=e[1],r=("base64"==e[2]?atob:decodeURIComponent)(e.pop()),o=r.length,i=0,s=new Uint8Array(o);i<o;++i)s[i]=r.charCodeAt(i);return new h([s],{type:n})}function w(t,e){if("download"in d)return d.href=t,d.setAttribute("download",p),d.className="download-js-link",d.innerHTML="downloading...",d.style.display="none",document.body.appendChild(d),setTimeout((function(){d.click(),document.body.removeChild(d),!0===e&&setTimeout((function(){s.URL.revokeObjectURL(d.href)}),250)}),66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,a)),window.open(t)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=t),!0;var n=document.createElement("iframe");document.body.appendChild(n),!e&&/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,a)),n.src=t,setTimeout((function(){document.body.removeChild(n)}),333)}if(o=c instanceof h?c:new h([c],{type:l}),navigator.msSaveBlob)return navigator.msSaveBlob(o,p);if(s.URL)w(s.URL.createObjectURL(o),!0);else{if("string"==typeof o||o.constructor===f)try{return w("data:"+l+";base64,"+s.btoa(o))}catch(t){return w("data:"+l+","+encodeURIComponent(o))}(i=new FileReader).onload=function(t){w(this.result)},i.readAsDataURL(o)}return!0}})?n.apply(e,[]):n)||(t.exports=r)}},s={};function a(t){var e=s[t];if(void 0!==e)return e.exports;var n=s[t]={id:t,loaded:!1,exports:{}};return i[t].call(n.exports,n,n.exports,a),n.loaded=!0,n.exports}a.m=i,t=[],a.O=(e,n,r,o)=>{if(!n){var i=1/0;for(u=0;u<t.length;u++){for(var[n,r,o]=t[u],s=!0,l=0;l<n.length;l++)(!1&o||i>=o)&&Object.keys(a.O).every((t=>a.O[t](n[l])))?n.splice(l--,1):(s=!1,o<i&&(i=o));if(s){t.splice(u--,1);var c=r();void 0!==c&&(e=c)}}return e}o=o||0;for(var u=t.length;u>0&&t[u-1][2]>o;u--)t[u]=t[u-1];t[u]=[n,r,o]},a.F={},a.E=t=>{Object.keys(a.F).map((e=>{a.F[e](t)}))},a.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return a.d(e,{a:e}),e},n=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,a.t=function(t,r){if(1&r&&(t=this(t)),8&r)return t;if("object"==typeof t&&t){if(4&r&&t.__esModule)return t;if(16&r&&"function"==typeof t.then)return t}var o=Object.create(null);a.r(o);var i={};e=e||[null,n({}),n([]),n(n)];for(var s=2&r&&t;"object"==typeof s&&!~e.indexOf(s);s=n(s))Object.getOwnPropertyNames(s).forEach((e=>i[e]=()=>t[e]));return i.default=()=>t,a.d(o,i),o},a.d=(t,e)=>{for(var n in e)a.o(e,n)&&!a.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},a.f={},a.e=t=>Promise.all(Object.keys(a.f).reduce(((e,n)=>(a.f[n](t,e),e)),[])),a.u=t=>t+".main.js",a.miniCssF=t=>"main.css",a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r={},o="hfy-epub:",a.l=(t,e,n,i)=>{if(r[t])r[t].push(e);else{var s,l;if(void 0!==n)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==t||d.getAttribute("data-webpack")==o+n){s=d;break}}s||(l=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,a.nc&&s.setAttribute("nonce",a.nc),s.setAttribute("data-webpack",o+n),s.src=t),r[t]=[e];var f=(e,n)=>{s.onerror=s.onload=null,clearTimeout(h);var o=r[t];if(delete r[t],s.parentNode&&s.parentNode.removeChild(s),o&&o.forEach((t=>t(n))),e)return e(n)},h=setTimeout(f.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=f.bind(null,s.onerror),s.onload=f.bind(null,s.onload),l&&document.head.appendChild(s)}},a.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{var t;a.g.importScripts&&(t=a.g.location+"");var e=a.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");n.length&&(t=n[n.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=t})(),(()=>{var t={179:0};a.f.j=(e,n)=>{var r=a.o(t,e)?t[e]:void 0;if(0!==r)if(r)n.push(r[2]);else{var o=new Promise(((n,o)=>r=t[e]=[n,o]));n.push(r[2]=o);var i=a.p+a.u(e),s=new Error;a.l(i,(n=>{if(a.o(t,e)&&(0!==(r=t[e])&&(t[e]=void 0),r)){var o=n&&("load"===n.type?"missing":n.type),i=n&&n.target&&n.target.src;s.message="Loading chunk "+e+" failed.\n("+o+": "+i+")",s.name="ChunkLoadError",s.type=o,s.request=i,r[1](s)}}),"chunk-"+e,e)}},a.F.j=e=>{if(!a.o(t,e)||void 0===t[e]){t[e]=null;var n=document.createElement("link");a.nc&&n.setAttribute("nonce",a.nc),n.rel="prefetch",n.as="script",n.href=a.p+a.u(e),document.head.appendChild(n)}},a.O.j=e=>0===t[e];var e=(e,n)=>{var r,o,[i,s,l]=n,c=0;if(i.some((e=>0!==t[e]))){for(r in s)a.o(s,r)&&(a.m[r]=s[r]);if(l)var u=l(a)}for(e&&e(n);c<i.length;c++)o=i[c],a.o(t,o)&&t[o]&&t[o][0](),t[i[c]]=0;return a.O(u)},n=self.webpackChunkhfy_epub=self.webpackChunkhfy_epub||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})(),a.O(0,[179],(()=>{a.E(752),a.E(483)}),5);var l={};(()=>{"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function o(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function s(t){return 0===Object.keys(t).length}new Set;let l,c=!1;function u(t,e){t.appendChild(e)}function d(t,e,n){t.insertBefore(e,n||null)}function f(t){t.parentNode.removeChild(t)}function h(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function p(t){return document.createElement(t)}function m(t){return document.createTextNode(t)}function g(){return m(" ")}function v(){return m("")}function b(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function y(t){return function(e){return e.preventDefault(),t.call(this,e)}}function w(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function $(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function x(t,e){t.value=null==e?"":e}function E(t){l=t}new Set;const R=[],N=[],O=[],k=[],T=Promise.resolve();let C=!1;function S(t){O.push(t)}let L=!1;const A=new Set;function _(){if(!L){L=!0;do{for(let t=0;t<R.length;t+=1){const e=R[t];E(e),P(e.$$)}for(E(null),R.length=0;N.length;)N.pop()();for(let t=0;t<O.length;t+=1){const e=O[t];A.has(e)||(A.add(e),e())}O.length=0}while(R.length);for(;k.length;)k.pop()();C=!1,L=!1,A.clear()}}function P(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(S)}}const j=new Set;let U,G;function I(t,e){t&&t.i&&(j.delete(t),t.i(e))}function D(t,e,n,r){if(t&&t.o){if(j.has(t))return;j.add(t),U.c.push((()=>{j.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}}function H(t){t&&t.c()}function F(t,n,i,s){const{fragment:a,on_mount:l,on_destroy:c,after_update:u}=t.$$;a&&a.m(n,i),s||S((()=>{const n=l.map(e).filter(o);c?c.push(...n):r(n),t.$$.on_mount=[]})),u.forEach(S)}function M(t,e){const n=t.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function B(e,o,i,s,a,u,d,h=[-1]){const p=l;E(e);const m=e.$$={fragment:null,ctx:null,props:u,update:t,not_equal:a,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(p?p.$$.context:o.context||[]),callbacks:n(),dirty:h,skip_bound:!1,root:o.target||p.$$.root};d&&d(m.root);let g=!1;if(m.ctx=i?i(e,o.props||{},((t,n,...r)=>{const o=r.length?r[0]:n;return m.ctx&&a(m.ctx[t],m.ctx[t]=o)&&(!m.skip_bound&&m.bound[t]&&m.bound[t](o),g&&function(t,e){-1===t.$$.dirty[0]&&(R.push(t),C||(C=!0,T.then(_)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}(e,t)),n})):[],m.update(),g=!0,r(m.before_update),m.fragment=!!s&&s(m.ctx),o.target){if(o.hydrate){c=!0;const t=(v=o.target,Array.from(v.childNodes));m.fragment&&m.fragment.l(t),t.forEach(f)}else m.fragment&&m.fragment.c();o.intro&&I(e.$$.fragment),F(e,o.target,o.anchor,o.customElement),c=!1,_()}var v;E(p)}"undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global,new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]),"function"==typeof HTMLElement&&(G=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:t}=this.$$;this.$$.on_disconnect=t.map(e).filter(o);for(const t in this.$$.slotted)this.appendChild(this.$$.slotted[t])}attributeChangedCallback(t,e,n){this[t]=n}disconnectedCallback(){r(this.$$.on_disconnect)}$destroy(){M(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){this.$$set&&!s(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}});class W{$destroy(){M(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){this.$$set&&!s(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function q(t){let e;return{c(){e=p("p"),e.innerHTML='This website (<a href="https://cpiber.github.io/hfy-epub" target="_blank" class="svelte-agc9w7">https://cpiber.github.io/hfy-epub</a>) does not, and will not, collect any data from its users.\n      Any actions taken on this page are purely in the user&#39;s browser; there is no server-side component.\n      No data is ever sent away.\n      For collecting the chapter data, this site contacts <code class="svelte-agc9w7">https://api.reddit.com</code> only. The book is generated in the browser.',w(e,"class","small svelte-agc9w7")},m(t,n){d(t,e,n)},d(t){t&&f(e)}}}function K(e){let n,r,o,i,s,a,l,c,h,v,$,x,E,R,N=e[0]&&q();return{c(){n=p("footer"),r=p("p"),o=m("Made by "),i=p("a"),i.textContent="@cpiber",s=m(". Source Code: "),a=p("a"),a.textContent="cpiber/hfy-epub",l=m(". Version "),c=m("0.1.1"),h=m(". "),v=p("a"),v.textContent="Privacy",$=m("."),x=g(),N&&N.c(),w(i,"href","https://github.com/cpiber"),w(i,"target","_blank"),w(i,"class","svelte-agc9w7"),w(a,"href","https://github.com/cpiber/hfy-epub"),w(a,"target","_blank"),w(a,"class","svelte-agc9w7"),w(v,"href","#?"),w(v,"class","svelte-agc9w7"),w(r,"class","small svelte-agc9w7"),w(n,"class","svelte-agc9w7")},m(t,f){d(t,n,f),u(n,r),u(r,o),u(r,i),u(r,s),u(r,a),u(r,l),u(r,c),u(r,h),u(r,v),u(r,$),u(n,x),N&&N.m(n,null),E||(R=b(v,"click",y(e[1])),E=!0)},p(t,[e]){t[0]?N||(N=q(),N.c(),N.m(n,null)):N&&(N.d(1),N=null)},i:t,o:t,d(t){t&&f(n),N&&N.d(),E=!1,R()}}}function Y(t,e,n){let r=!1;return[r,()=>n(0,r=!r)]}const z=class extends W{constructor(t){super(),B(this,t,Y,K,i,{})}};function V(e){let n;return{c(){n=p("header"),n.innerHTML='<h1 class="svelte-10isbm1">r/HFY epub generator</h1>',w(n,"class","svelte-10isbm1")},m(t,e){d(t,n,e)},p:t,i:t,o:t,d(t){t&&f(n)}}}const X=class extends W{constructor(t){super(),B(this,t,null,V,i,{})}};function J(t){let e;return{c(){e=p("p"),e.textContent="Please enter a search string",w(e,"class","small error svelte-1uob44x")},m(t,n){d(t,e,n)},d(t){t&&f(e)}}}function Q(e){let n,o,i,s,a,l,c,h,m,y,$,E,R,N=!e[0].trim().length,O=N&&J();return{c(){n=p("h2"),n.textContent="Please enter your search terms below:",o=g(),i=p("p"),i.innerHTML='For now, we only support <a href="https://reddit.com/r/HFY" target="_blank">r/HFY</a>: series titles and urls to wiki pages',s=g(),a=p("form"),l=p("input"),c=g(),h=p("input"),y=g(),O&&O.c(),$=v(),w(n,"class","heading svelte-1uob44x"),w(l,"class","search svelte-1uob44x"),w(l,"placeholder","Search..."),w(h,"type","submit"),h.value="Go",w(h,"class","submit svelte-1uob44x"),h.disabled=m=!e[0].trim().length,w(h,"name","search"),w(a,"class","form svelte-1uob44x")},m(t,r){var f;d(t,n,r),d(t,o,r),d(t,i,r),d(t,s,r),d(t,a,r),u(a,l),x(l,e[0]),u(a,c),u(a,h),d(t,y,r),O&&O.m(t,r),d(t,$,r),E||(R=[b(l,"input",e[2]),b(a,"submit",(f=e[3],function(t){return t.stopPropagation(),f.call(this,t)}))],E=!0)},p(t,[e]){1&e&&l.value!==t[0]&&x(l,t[0]),1&e&&m!==(m=!t[0].trim().length)&&(h.disabled=m),1&e&&(N=!t[0].trim().length),N?O||(O=J(),O.c(),O.m($.parentNode,$)):O&&(O.d(1),O=null)},i:t,o:t,d(t){t&&f(n),t&&f(o),t&&f(i),t&&f(s),t&&f(a),t&&f(y),O&&O.d(t),t&&f($),E=!1,r(R)}}}function Z(t,e,n){let{search:r=""}=e,{goNext:o}=e;return t.$$set=t=>{"search"in t&&n(0,r=t.search),"goNext"in t&&n(1,o=t.goNext)},[r,o,function(){r=this.value,n(0,r)},()=>o(r)]}const tt=class extends W{constructor(t){super(),B(this,t,Z,Q,i,{search:0,goNext:1})}};var et,nt=a(4785),rt=a.n(nt),ot=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{l(r.next(t))}catch(t){i(t)}}function a(t){try{l(r.throw(t))}catch(t){i(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}l((r=r.apply(t,e||[])).next())}))},it=function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},st=function(t,e){return ot(void 0,void 0,void 0,(function(){var n,r;return it(this,(function(o){switch(o.label){case 0:n="undefined"!=typeof AbortController?new AbortController:{},r=setTimeout((function(){return n.abort&&n.abort()}),e),o.label=1;case 1:return o.trys.push([1,,3,4]),[4,fetch(t,{signal:n.signal})];case 2:return[2,o.sent()];case 3:return clearTimeout(r),[7];case 4:return[2]}}))}))},at=function(t,e,n){return void 0===e&&(e=1e4),void 0===n&&(n=3),ot(void 0,void 0,void 0,(function(){var r;return it(this,(function(o){switch(o.label){case 0:r=0,o.label=1;case 1:if(!(r<n-1))return[3,6];o.label=2;case 2:return o.trys.push([2,4,,5]),[4,st(t,e)];case 3:return[2,o.sent()];case 4:return o.sent(),console.log("Failed to fetch `"+t+"` "+(r+1)+" "+(0===r?"time":"times")+". Retrying..."),[3,5];case 5:return r++,[3,1];case 6:return[2,st(t,e)]}}))}))},lt=function(t){return t.hostname="api.reddit.com",t.pathname.endsWith("/")?t.pathname=t.pathname.slice(0,t.pathname.length-1)+".json":t.pathname.endsWith(".json")||(t.pathname+=".json"),t.protocol="https",t.toString()},ct=function(t){return t.slice(0,-5).replace("https://api","https://www")},ut=(et=new DOMParser,function(t){return et.parseFromString(t,"text/html").documentElement.textContent});function dt(t,e,n){const r=t.slice();return r[13]=e[n],r}function ft(t){let e,n,r,o,i,s,a,l,c=t[4]?": ":"";return{c(){e=p("p"),n=m("Sorry, there was an error"),r=m(c),o=m(t[4]),i=g(),s=p("button"),s.textContent="Retry",w(e,"class","error svelte-ggvisn")},m(c,f){d(c,e,f),u(e,n),u(e,r),u(e,o),d(c,i,f),d(c,s,f),a||(l=b(s,"click",t[7]),a=!0)},p(t,e){16&e&&c!==(c=t[4]?": ":"")&&$(r,c),16&e&&$(o,t[4])},d(t){t&&f(e),t&&f(i),t&&f(s),a=!1,l()}}}function ht(e){let n,r,o,i,s;return{c(){n=p("h3"),n.textContent="Your ebook is ready!",r=g(),o=p("button"),o.textContent="Download",w(n,"class","valid svelte-ggvisn")},m(t,a){d(t,n,a),d(t,r,a),d(t,o,a),i||(s=b(o,"click",e[9]),i=!0)},p:t,d(t){t&&f(n),t&&f(r),t&&f(o),i=!1,s()}}}function pt(e){let n;return{c(){n=p("div"),n.innerHTML='<div class="loading-slider-container svelte-ggvisn"><span class="loading-slider svelte-ggvisn">•</span></div> \n    <p class="loading svelte-ggvisn">Please wait, generating ebook...</p>',w(n,"class","loading-container svelte-ggvisn")},m(t,e){d(t,n,e)},p:t,d(t){t&&f(n)}}}function mt(t){let e,n,r,o=t[5],i=[];for(let e=0;e<o.length;e+=1)i[e]=bt(dt(t,o,e));return{c(){e=p("div"),e.innerHTML='<div class="loading-slider-container svelte-ggvisn"><span class="loading-slider svelte-ggvisn">•</span></div> \n    <p class="loading svelte-ggvisn">Please wait, fetching chapters...</p>',n=g(),r=p("div");for(let t=0;t<i.length;t+=1)i[t].c();w(e,"class","loading-container svelte-ggvisn"),w(r,"class","chapters svelte-ggvisn")},m(t,o){d(t,e,o),d(t,n,o),d(t,r,o);for(let t=0;t<i.length;t+=1)i[t].m(r,null)},p(t,e){if(32&e){let n;for(o=t[5],n=0;n<o.length;n+=1){const s=dt(t,o,n);i[n]?i[n].p(s,e):(i[n]=bt(s),i[n].c(),i[n].m(r,null))}for(;n<i.length;n+=1)i[n].d(1);i.length=o.length}},d(t){t&&f(e),t&&f(n),t&&f(r),h(i,t)}}}function gt(t){let e,n,r,o,i,s,a,l,c,h,v,y,x,E,R,N,O,k,T,C,S,L,A,_=t[3].title+"",P=t[3].author+"",j=t[3].chapters.length+"";return{c(){e=m("Got the following series:\n\n  "),n=p("div"),r=p("h3"),r.textContent="Title",o=g(),i=p("p"),s=p("a"),a=m(_),c=g(),h=p("h3"),h.textContent="Author",v=g(),y=p("p"),x=m(P),E=g(),R=p("h3"),R.textContent="Chapters",N=g(),O=p("p"),k=m("Found "),T=m(j),C=g(),S=p("button"),S.textContent="Fetch chapters and generate EPUB",w(s,"href",l=ct(t[0])),w(s,"target","_blank"),w(n,"class","series-card svelte-ggvisn")},m(l,f){d(l,e,f),d(l,n,f),u(n,r),u(n,o),u(n,i),u(i,s),u(s,a),u(n,c),u(n,h),u(n,v),u(n,y),u(y,x),u(n,E),u(n,R),u(n,N),u(n,O),u(O,k),u(O,T),d(l,C,f),d(l,S,f),L||(A=b(S,"click",t[8]),L=!0)},p(t,e){8&e&&_!==(_=t[3].title+"")&&$(a,_),1&e&&l!==(l=ct(t[0]))&&w(s,"href",l),8&e&&P!==(P=t[3].author+"")&&$(x,P),8&e&&j!==(j=t[3].chapters.length+"")&&$(T,j)},d(t){t&&f(e),t&&f(n),t&&f(C),t&&f(S),L=!1,A()}}}function vt(e){let n;return{c(){n=p("div"),n.innerHTML='<div class="loading-slider-container svelte-ggvisn"><span class="loading-slider svelte-ggvisn">•</span></div> \n    <p class="loading svelte-ggvisn">Please wait, fetching data...</p>',w(n,"class","loading-container svelte-ggvisn")},m(t,e){d(t,n,e)},p:t,d(t){t&&f(n)}}}function bt(t){let e,n,r=t[13].title+"";return{c(){e=p("p"),n=m(r),w(e,"class","valid small svelte-ggvisn")},m(t,r){d(t,e,r),u(e,n)},p(t,e){32&e&&r!==(r=t[13].title+"")&&$(n,r)},d(t){t&&f(e)}}}function yt(e){let n;function r(t,e){return t[2]===t[1].LOADING?vt:t[2]===t[1].PRESENT?gt:t[2]===t[1].FETCHING?mt:t[2]===t[1].GENERATING?pt:t[2]===t[1].DOWNLOAD?ht:t[2]===t[1].ERROR?ft:void 0}let o=r(e),i=o&&o(e);return{c(){i&&i.c(),n=v()},m(t,e){i&&i.m(t,e),d(t,n,e)},p(t,[e]){o===(o=r(t))&&i?i.p(t,e):(i&&i.d(1),i=o&&o(t),i&&(i.c(),i.m(n.parentNode,n)))},i:t,o:t,d(t){i&&i.d(t),t&&f(n)}}}function wt(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{l(r.next(t))}catch(t){i(t)}}function a(t){try{l(r.throw(t))}catch(t){i(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}l((r=r.apply(t,e||[])).next())}))};let{series:o}=e;const i=Promise.all([a.e(752),a.e(483)]).then(a.t.bind(a,5752,23));var s;!function(t){t[t.LOADING=0]="LOADING",t[t.PRESENT=1]="PRESENT",t[t.FETCHING=2]="FETCHING",t[t.GENERATING=3]="GENERATING",t[t.DOWNLOAD=4]="DOWNLOAD",t[t.ERROR=5]="ERROR"}(s||(s={}));let l,c,u,d=s.LOADING,f=[];const h=()=>r(void 0,void 0,void 0,(function*(){var t;n(2,d=s.LOADING);try{const e=yield fetch(o),r=yield e.json();if(!e.ok)throw r.message;const i=r.data.content_md,a={author:i.match(/\[\*\*([^*\]]+)\*\*\]|A Story By \[(?:\*\*)?([^\]]+?)(?:\*\*)?\]/i).slice(1).find(Boolean),title:null===(t=i.match(/##?\s*\*\*(.+)\*\*/))||void 0===t?void 0:t[1],chapters:[...i.matchAll(/\[([^\]]+)\]\s*\(((?:https?:\/\/(?:[^.]+\.)?reddit\.com)?\/r\/hfy\/comments\/[^)]+)\)/gim)].map((t=>({title:t[1],url:lt(new URL(t[2].startsWith("http")?t[2]:`https://api.reddit.com${t[2]}`))})))};n(3,l=a),n(2,d=a.chapters.length?s.PRESENT:s.ERROR),n(4,c="No chapters found")}catch(t){n(2,d=s.ERROR),n(4,c=`${t.message||t}`)}}));return h(),t.$$set=t=>{"series"in t&&n(0,o=t.series)},[o,s,d,l,c,f,u,h,()=>r(void 0,void 0,void 0,(function*(){n(2,d=s.FETCHING);try{for(let t=0;t<l.chapters.length;t+=100)yield Promise.all(l.chapters.slice(t,t+100).map((t=>at(t.url).then((t=>t.json())).then((t=>{const{selftext_html:e,title:r,url:o}=t[0].data.children[0].data;f.push({title:r,content:ut(e),url:o}),n(5,f)})))))}catch(t){n(2,d=s.ERROR),n(4,c=`${t.message||t}`)}r(void 0,void 0,void 0,(function*(){n(2,d=s.GENERATING);const{default:t}=yield i;n(6,u=yield t({title:l.title,author:l.author,verbose:!0},f)),n(2,d=s.DOWNLOAD)}))})),()=>rt()(u,`${l.title}.epub`,"application/epub+zip")]}const $t=class extends W{constructor(t){super(),B(this,t,wt,yt,i,{series:0})}};function xt(t,e,n){const r=t.slice();return r[9]=e[n],r}function Et(t){let e,n,r,o,i,s,a,l,c=t[6],v=[];for(let e=0;e<c.length;e+=1)v[e]=Tt(xt(t,c,e));return{c(){e=p("p"),n=m("The search for '"),r=m(t[0]),o=m("' returned these results:"),i=g(),s=p("ul");for(let t=0;t<v.length;t+=1)v[t].c();a=g(),l=p("p"),l.textContent="Please select one.",w(l,"class","small")},m(t,c){d(t,e,c),u(e,n),u(e,r),u(e,o),d(t,i,c),d(t,s,c);for(let t=0;t<v.length;t+=1)v[t].m(s,null);d(t,a,c),d(t,l,c)},p(t,e){if(1&e&&$(r,t[0]),66&e){let n;for(c=t[6],n=0;n<c.length;n+=1){const r=xt(t,c,n);v[n]?v[n].p(r,e):(v[n]=Tt(r),v[n].c(),v[n].m(s,null))}for(;n<v.length;n+=1)v[n].d(1);v.length=c.length}},d(t){t&&f(e),t&&f(i),t&&f(s),h(v,t),t&&f(a),t&&f(l)}}}function Rt(e){let n,r,o,i,s;return{c(){n=p("p"),r=m("That's a valid series url, "),o=p("a"),o.textContent="go on ahead",w(o,"href","#?"),w(n,"class","valid svelte-158maml")},m(t,a){d(t,n,a),u(n,r),u(n,o),i||(s=b(o,"click",y(e[7])),i=!0)},p:t,d(t){t&&f(n),i=!1,s()}}}function Nt(t){let e,n,r,o,i=t[5]?": ":"";return{c(){e=p("p"),n=m("Sorry, can't process that"),r=m(i),o=m(t[5]),w(e,"class","error svelte-158maml")},m(t,i){d(t,e,i),u(e,n),u(e,r),u(e,o)},p(t,e){32&e&&i!==(i=t[5]?": ":"")&&$(r,i),32&e&&$(o,t[5])},d(t){t&&f(e)}}}function Ot(e){let n;return{c(){n=p("div"),n.innerHTML='<div class="loading-slider-container svelte-158maml"><span class="loading-slider svelte-158maml">•</span></div> \n    <p class="loading svelte-158maml">Please wait, fetching results...</p>',w(n,"class","loading-container svelte-158maml")},m(t,e){d(t,n,e)},p:t,d(t){t&&f(n)}}}function kt(t){let e,n,r,o,i=t[9].author+"";return{c(){e=m("["),n=p("i"),r=m(i),o=m("]")},m(t,i){d(t,e,i),d(t,n,i),u(n,r),d(t,o,i)},p(t,e){64&e&&i!==(i=t[9].author+"")&&$(r,i)},d(t){t&&f(e),t&&f(n),t&&f(o)}}}function Tt(t){let e,n,r,o,i,s,a,l,c=t[9].title+"";function h(){return t[8](t[9])}let v=t[9].author&&kt(t);return{c(){e=p("li"),n=p("a"),r=m(c),i=g(),v&&v.c(),s=g(),w(n,"href",o=ct(t[9].url))},m(t,o){d(t,e,o),u(e,n),u(n,r),u(e,i),v&&v.m(e,null),u(e,s),a||(l=b(n,"click",y(h)),a=!0)},p(i,a){t=i,64&a&&c!==(c=t[9].title+"")&&$(r,c),64&a&&o!==(o=ct(t[9].url))&&w(n,"href",o),t[9].author?v?v.p(t,a):(v=kt(t),v.c(),v.m(e,s)):v&&(v.d(1),v=null)},d(t){t&&f(e),v&&v.d(),a=!1,l()}}}function Ct(e){let n;function r(t,e){return t[4]===t[3].LOADING?Ot:t[4]===t[3].ERROR?Nt:t[4]===t[3].OK?Rt:t[4]===t[3].RESULTS?Et:void 0}let o=r(e),i=o&&o(e);return{c(){i&&i.c(),n=v()},m(t,e){i&&i.m(t,e),d(t,n,e)},p(t,[e]){o===(o=r(t))&&i?i.p(t,e):(i&&i.d(1),i=o&&o(t),i&&(i.c(),i.m(n.parentNode,n)))},i:t,o:t,d(t){i&&i.d(t),t&&f(n)}}}function St(t,e,n){let r,{search:o}=e,{goNext:i}=e;var s;!function(t){t[t.LOADING=0]="LOADING",t[t.OK=1]="OK",t[t.RESULTS=2]="RESULTS",t[t.ERROR=3]="ERROR"}(s||(s={}));let a=s.LOADING,l="",c=[];try{if(!o.match(/^https?:\/\/(?:[^.]+\.)?reddit\.com\/r\/hfy\/wiki\/series\//i))throw new Error;r=lt(new URL(o)),i(r)}catch(t){const e=o.toLowerCase();fetch("https://api.reddit.com/r/hfy/wiki/series.json").then((t=>t.json())).then((t=>t.data.content_md)).then((t=>[...t.matchAll(/\[([^\]]+)\]\s*\(((?:https?:\/\/(?:[^.]+\.)?reddit\.com)?\/r\/hfy\/wiki\/series\/[^)]+)\)\s*(?:\[\*([^\]]+)\*\])?/gim)].map((t=>({title:t[1],author:t[3],url:lt(new URL(t[2].startsWith("http")?t[2]:`https://api.reddit.com${t[2]}`))}))))).then((t=>n(6,c=t.filter((t=>-1!==t.title.toLowerCase().indexOf(e)))))).then((t=>{n(4,a=t.length?s.RESULTS:s.ERROR),n(5,l=`No series matched input \`${o}\``)})).catch((t=>{n(4,a=s.ERROR),n(5,l=`${t.message||t}`)}))}return t.$$set=t=>{"search"in t&&n(0,o=t.search),"goNext"in t&&n(1,i=t.goNext)},[o,i,r,s,a,l,c,()=>i(r),t=>i(t.url)]}const Lt=class extends W{constructor(t){super(),B(this,t,St,Ct,i,{search:0,goNext:1})}};function At(e){let n,r,o;return{c(){n=m(e[2]),r=g(),o=m(e[3])},m(t,e){d(t,n,e),d(t,r,e),d(t,o,e)},p(t,e){4&e&&$(n,t[2]),8&e&&$(o,t[3])},i:t,o:t,d(t){t&&f(n),t&&f(r),t&&f(o)}}}function _t(t){let e,n;return e=new $t({props:{series:t[3]}}),{c(){H(e.$$.fragment)},m(t,r){F(e,t,r),n=!0},p(t,n){const r={};8&n&&(r.series=t[3]),e.$set(r)},i(t){n||(I(e.$$.fragment,t),n=!0)},o(t){D(e.$$.fragment,t),n=!1},d(t){M(e,t)}}}function Pt(t){let e,n;return e=new Lt({props:{goNext:t[6],search:t[2]}}),{c(){H(e.$$.fragment)},m(t,r){F(e,t,r),n=!0},p(t,n){const r={};8&n&&(r.goNext=t[6]),4&n&&(r.search=t[2]),e.$set(r)},i(t){n||(I(e.$$.fragment,t),n=!0)},o(t){D(e.$$.fragment,t),n=!1},d(t){M(e,t)}}}function jt(t){let e,n;return e=new tt({props:{goNext:t[5],search:t[2]}}),{c(){H(e.$$.fragment)},m(t,r){F(e,t,r),n=!0},p(t,n){const r={};4&n&&(r.goNext=t[5]),4&n&&(r.search=t[2]),e.$set(r)},i(t){n||(I(e.$$.fragment,t),n=!0)},o(t){D(e.$$.fragment,t),n=!1},d(t){M(e,t)}}}function Ut(e){let n,r,o;return{c(){n=p("a"),n.textContent="Go back home",w(n,"href","#?"),w(n,"class","homelink svelte-sdxuta")},m(t,i){d(t,n,i),r||(o=b(n,"click",y(e[7])),r=!0)},p:t,d(t){t&&f(n),r=!1,o()}}}function Gt(t){let e,n,o,i,s,a,l,c,h,m;n=new X({});const v=[jt,Pt,_t,At],b=[];function y(t,e){return t[1]===t[0].INPUT?0:t[1]===t[0].SEARCH?1:t[1]===t[0].RESULT?2:3}s=y(t),a=b[s]=v[s](t);let $=t[1]!==t[0].INPUT&&Ut(t);return h=new z({}),{c(){e=p("div"),H(n.$$.fragment),o=g(),i=p("main"),a.c(),l=g(),$&&$.c(),c=g(),H(h.$$.fragment),w(i,"class","App-main"),w(e,"class","App svelte-sdxuta")},m(t,r){d(t,e,r),F(n,e,null),u(e,o),u(e,i),b[s].m(i,null),u(i,l),$&&$.m(i,null),u(e,c),F(h,e,null),m=!0},p(t,[e]){let n=s;s=y(t),s===n?b[s].p(t,e):(U={r:0,c:[],p:U},D(b[n],1,1,(()=>{b[n]=null})),U.r||r(U.c),U=U.p,a=b[s],a?a.p(t,e):(a=b[s]=v[s](t),a.c()),I(a,1),a.m(i,l)),t[1]!==t[0].INPUT?$?$.p(t,e):($=Ut(t),$.c(),$.m(i,null)):$&&($.d(1),$=null)},i(t){m||(I(n.$$.fragment,t),I(a),I(h.$$.fragment,t),m=!0)},o(t){D(n.$$.fragment,t),D(a),D(h.$$.fragment,t),m=!1},d(t){t&&f(e),M(n),b[s].d(),$&&$.d(),M(h)}}}function It(t,e,n){var r;!function(t){t[t.INPUT=0]="INPUT",t[t.SEARCH=1]="SEARCH",t[t.RESULT=2]="RESULT"}(r||(r={}));let o,i,s=r.INPUT;const a=()=>n(1,s=Math.min(s+1,r.RESULT));return[r,s,o,i,a,t=>(n(2,o=t.trim()),a()),t=>(n(3,i=t),a()),()=>n(1,s=0)]}const Dt=class extends W{constructor(t){super(),B(this,t,It,Gt,i,{})}};let Ht;try{Ht=new Dt({target:document.body})}catch(t){const e=document.createElement("div");e.className="fatal-error",e.ariaLabel="error",e.appendChild(document.createElement("h1")).textContent="Something went wrong:",e.appendChild(document.createElement("code")).textContent=t,document.body.appendChild(e)}})(),l=a.O(l)})();