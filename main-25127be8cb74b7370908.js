(()=>{var e,t,n,r,o,s={3:function(e,t){var n,r;void 0===(r="function"==typeof(n=function(){return function e(t,n,r){var o,s,l=window,i="application/octet-stream",c=r||i,a=t,u=!n&&!r&&a,d=document.createElement("a"),p=function(e){return String(e)},f=l.Blob||l.MozBlob||l.WebKitBlob||p,h=n||"download";if(f=f.call?f.bind(l):Blob,"true"===String(this)&&(c=(a=[a,c])[0],a=a[1]),u&&u.length<2048&&(h=u.split("/").pop().split("?")[0],d.href=u,-1!==d.href.indexOf(u))){var m=new XMLHttpRequest;return m.open("GET",u,!0),m.responseType="blob",m.onload=function(t){e(t.target.response,h,i)},setTimeout((function(){m.send()}),0),m}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(a)){if(!(a.length>2096103.424&&f!==p))return navigator.msSaveBlob?navigator.msSaveBlob(b(a),h):y(a);c=(a=b(a)).type||i}else if(/([\x80-\xff])/.test(a)){for(var g=0,$=new Uint8Array(a.length),v=$.length;g<v;++g)$[g]=a.charCodeAt(g);a=new f([$],{type:c})}function b(e){for(var t=e.split(/[:;,]/),n=t[1],r=("base64"==t[2]?atob:decodeURIComponent)(t.pop()),o=r.length,s=0,l=new Uint8Array(o);s<o;++s)l[s]=r.charCodeAt(s);return new f([l],{type:n})}function y(e,t){if("download"in d)return d.href=e,d.setAttribute("download",h),d.className="download-js-link",d.innerHTML="downloading...",d.style.display="none",document.body.appendChild(d),setTimeout((function(){d.click(),document.body.removeChild(d),!0===t&&setTimeout((function(){l.URL.revokeObjectURL(d.href)}),250)}),66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,i)),window.open(e)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=e),!0;var n=document.createElement("iframe");document.body.appendChild(n),!t&&/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,i)),n.src=e,setTimeout((function(){document.body.removeChild(n)}),333)}if(o=a instanceof f?a:new f([a],{type:c}),navigator.msSaveBlob)return navigator.msSaveBlob(o,h);if(l.URL)y(l.URL.createObjectURL(o),!0);else{if("string"==typeof o||o.constructor===p)try{return y("data:"+c+";base64,"+l.btoa(o))}catch(e){return y("data:"+c+","+encodeURIComponent(o))}(s=new FileReader).onload=function(e){y(this.result)},s.readAsDataURL(o)}return!0}})?n.apply(t,[]):n)||(e.exports=r)}},l={};function i(e){var t=l[e];if(void 0!==t)return t.exports;var n=l[e]={exports:{}};return s[e].call(n.exports,n,n.exports,i),n.exports}i.m=s,e=[],i.O=(t,n,r,o)=>{if(!n){var s=1/0;for(u=0;u<e.length;u++){for(var[n,r,o]=e[u],l=!0,c=0;c<n.length;c++)(!1&o||s>=o)&&Object.keys(i.O).every((e=>i.O[e](n[c])))?n.splice(c--,1):(l=!1,o<s&&(s=o));if(l){e.splice(u--,1);var a=r();void 0!==a&&(t=a)}}return t}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[n,r,o]},i.F={},i.E=e=>{Object.keys(i.F).map((t=>{i.F[t](e)}))},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},n=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(e,r){if(1&r&&(e=this(e)),8&r)return e;if("object"==typeof e&&e){if(4&r&&e.__esModule)return e;if(16&r&&"function"==typeof e.then)return e}var o=Object.create(null);i.r(o);var s={};t=t||[null,n({}),n([]),n(n)];for(var l=2&r&&e;"object"==typeof l&&!~t.indexOf(l);l=n(l))Object.getOwnPropertyNames(l).forEach((t=>s[t]=()=>e[t]));return s.default=()=>e,i.d(o,s),o},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce(((t,n)=>(i.f[n](e,t),t)),[])),i.u=e=>e+"-"+{22:"8084057f48563858b6d9",696:"44a7998ed756191c1fda"}[e]+".js",i.miniCssF=e=>{},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r={},o="hfy-epub:",i.l=(e,t,n,s)=>{if(r[e])r[e].push(t);else{var l,c;if(void 0!==n)for(var a=document.getElementsByTagName("script"),u=0;u<a.length;u++){var d=a[u];if(d.getAttribute("src")==e||d.getAttribute("data-webpack")==o+n){l=d;break}}l||(c=!0,(l=document.createElement("script")).charset="utf-8",l.timeout=120,i.nc&&l.setAttribute("nonce",i.nc),l.setAttribute("data-webpack",o+n),l.src=e),r[e]=[t];var p=(t,n)=>{l.onerror=l.onload=null,clearTimeout(f);var o=r[e];if(delete r[e],l.parentNode&&l.parentNode.removeChild(l),o&&o.forEach((e=>e(n))),t)return t(n)},f=setTimeout(p.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=p.bind(null,l.onerror),l.onload=p.bind(null,l.onload),c&&document.head.appendChild(l)}},i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.p="/hfy-epub/",(()=>{var e={792:0};i.f.j=(t,n)=>{var r=i.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var o=new Promise(((n,o)=>r=e[t]=[n,o]));n.push(r[2]=o);var s=i.p+i.u(t),l=new Error;i.l(s,(n=>{if(i.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var o=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.src;l.message="Loading chunk "+t+" failed.\n("+o+": "+s+")",l.name="ChunkLoadError",l.type=o,l.request=s,r[1](l)}}),"chunk-"+t,t)}},i.F.j=t=>{if(!i.o(e,t)||void 0===e[t]){e[t]=null;var n=document.createElement("link");i.nc&&n.setAttribute("nonce",i.nc),n.rel="prefetch",n.as="script",n.href=i.p+i.u(t),document.head.appendChild(n)}},i.O.j=t=>0===e[t];var t=(t,n)=>{var r,o,[s,l,c]=n,a=0;if(s.some((t=>0!==e[t]))){for(r in l)i.o(l,r)&&(i.m[r]=l[r]);if(c)var u=c(i)}for(t&&t(n);a<s.length;a++)o=s[a],i.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return i.O(u)},n=self.webpackChunkhfy_epub=self.webpackChunkhfy_epub||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),i.O(0,[792],(()=>{i.E(696),i.E(22)}),5);var c={};(()=>{"use strict";function e(){}const t=e=>e;function n(e){return e()}function r(){return Object.create(null)}function o(e){e.forEach(n)}function s(e){return"function"==typeof e}function l(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function c(t,n,r){t.$$.on_destroy.push(function(t,...n){if(null==t){for(const e of n)e(void 0);return e}const r=t.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}(n,r))}function a(e,t,n,r){if(e){const o=u(e,t,n,r);return e[0](o)}}function u(e,t,n,r){return e[1]&&r?function(e,t){for(const n in t)e[n]=t[n];return e}(n.ctx.slice(),e[1](r(t))):n.ctx}function d(e,t,n,r){if(e[2]&&r){const o=e[2](r(n));if(void 0===t.dirty)return o;if("object"==typeof o){const e=[],n=Math.max(t.dirty.length,o.length);for(let r=0;r<n;r+=1)e[r]=t.dirty[r]|o[r];return e}return t.dirty|o}return t.dirty}function p(e,t,n,r,o,s){if(o){const l=u(t,n,r,s);e.p(l,o)}}function f(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let e=0;e<n;e++)t[e]=-1;return t}return-1}function h(t){return t&&s(t.destroy)?t.destroy:e}function m(e){const t="string"==typeof e&&e.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return t?[parseFloat(t[1]),t[2]||"px"]:[e,"px"]}const g="undefined"!=typeof window;let $=g?()=>window.performance.now():()=>Date.now(),v=g?e=>requestAnimationFrame(e):e;const b=new Set;function y(e){b.forEach((t=>{t.c(e)||(b.delete(t),t.f())})),0!==b.size&&v(y)}const w="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;class x{_listeners="WeakMap"in w?new WeakMap:void 0;_observer=void 0;options;constructor(e){this.options=e}observe(e,t){return this._listeners.set(e,t),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){return this._observer??(this._observer=new ResizeObserver((e=>{for(const t of e)x.entries.set(t.target,t),this._listeners.get(t.target)?.(t)})))}}x.entries="WeakMap"in w?new WeakMap:void 0;let E=!1;function k(e,t){e.appendChild(t)}function T(e){if(!e)return document;const t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function S(e){const t=D("style");return t.textContent="/* empty */",function(e,t){k(e.head||e,t),t.sheet}(T(e),t),t.sheet}function C(e,t,n){e.insertBefore(t,n||null)}function O(e){e.parentNode&&e.parentNode.removeChild(e)}function _(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function D(e){return document.createElement(e)}function N(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function A(e){return document.createTextNode(e)}function R(){return A(" ")}function L(){return A("")}function I(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function F(e){return function(t){return t.preventDefault(),e.call(this,t)}}function U(e){return function(t){return t.stopPropagation(),e.call(this,t)}}function P(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function j(e,t){t=""+t,e.data!==t&&(e.data=t)}function M(e,t){e.value=null==t?"":t}function G(e,t,n){e.classList.toggle(t,!!n)}function z(e,t,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:r})}const H=new Map;let B,q=0;function W(e,t,n,r,o,s,l,i=0){const c=16.666/r;let a="{\n";for(let e=0;e<=1;e+=c){const r=t+(n-t)*s(e);a+=100*e+`%{${l(r,1-r)}}\n`}const u=a+`100% {${l(n,1-n)}}\n}`,d=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(u)}_${i}`,p=T(e),{stylesheet:f,rules:h}=H.get(p)||function(e,t){const n={stylesheet:S(t),rules:{}};return H.set(e,n),n}(p,e);h[d]||(h[d]=!0,f.insertRule(`@keyframes ${d} ${u}`,f.cssRules.length));const m=e.style.animation||"";return e.style.animation=`${m?`${m}, `:""}${d} ${r}ms linear ${o}ms 1 both`,q+=1,d}function Y(e){B=e}function K(){if(!B)throw new Error("Function called outside component initialization");return B}function X(e){K().$$.on_mount.push(e)}function V(e){K().$$.on_destroy.push(e)}function J(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach((e=>e.call(this,t)))}const Z=[],Q=[];let ee=[];const te=[],ne=Promise.resolve();let re=!1;function oe(e){ee.push(e)}function se(e){te.push(e)}const le=new Set;let ie,ce=0;function ae(){if(0!==ce)return;const e=B;do{try{for(;ce<Z.length;){const e=Z[ce];ce++,Y(e),ue(e.$$)}}catch(e){throw Z.length=0,ce=0,e}for(Y(null),Z.length=0,ce=0;Q.length;)Q.pop()();for(let e=0;e<ee.length;e+=1){const t=ee[e];le.has(t)||(le.add(t),t())}ee.length=0}while(Z.length);for(;te.length;)te.pop()();re=!1,le.clear(),Y(e)}function ue(e){if(null!==e.fragment){e.update(),o(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(oe)}}function de(e,t,n){e.dispatchEvent(z(`${t?"intro":"outro"}${n}`))}const pe=new Set;let fe;function he(){fe={r:0,c:[],p:fe}}function me(){fe.r||o(fe.c),fe=fe.p}function ge(e,t){e&&e.i&&(pe.delete(e),e.i(t))}function $e(e,t,n,r){if(e&&e.o){if(pe.has(e))return;pe.add(e),fe.c.push((()=>{pe.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}else r&&r()}const ve={duration:0};function be(n,r,l,i){let c,a=r(n,l,{direction:"both"}),u=i?0:1,d=null,p=null,f=null;function h(){f&&function(e,t){const n=(e.style.animation||"").split(", "),r=n.filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")),o=n.length-r.length;o&&(e.style.animation=r.join(", "),q-=o,q||v((()=>{q||(H.forEach((e=>{const{ownerNode:t}=e.stylesheet;t&&O(t)})),H.clear())})))}(n,f)}function m(e,t){const n=e.b-u;return t*=Math.abs(n),{a:u,b:e.b,d:n,duration:t,start:e.start,end:e.start+t,group:e.group}}function g(r){const{delay:s=0,duration:l=300,easing:i=t,tick:g=e,css:w}=a||ve,x={start:$()+s,b:r};r||(x.group=fe,fe.r+=1),"inert"in n&&(r?void 0!==c&&(n.inert=c):(c=n.inert,n.inert=!0)),d||p?p=x:(w&&(h(),f=W(n,u,r,l,s,i,w)),r&&g(0,1),d=m(x,l),oe((()=>de(n,r,"start"))),function(e){let t;0===b.size&&v(y),new Promise((n=>{b.add(t={c:e,f:n})}))}((e=>{if(p&&e>p.start&&(d=m(p,l),p=null,de(n,d.b,"start"),w&&(h(),f=W(n,u,d.b,d.duration,0,i,a.css))),d)if(e>=d.end)g(u=d.b,1-u),de(n,d.b,"end"),p||(d.b?h():--d.group.r||o(d.group.c)),d=null;else if(e>=d.start){const t=e-d.start;u=d.a+d.d*i(t/d.duration),g(u,1-u)}return!(!d&&!p)})))}return{run(e){s(a)?(ie||(ie=Promise.resolve(),ie.then((()=>{ie=null}))),ie).then((()=>{a=a({direction:e?"in":"out"}),g(e)})):g(e)},end(){h(),d=p=null}}}function ye(e,t){const n=t.token={};function r(e,r,o,s){if(t.token!==n)return;t.resolved=s;let l=t.ctx;void 0!==o&&(l=l.slice(),l[o]=s);const i=e&&(t.current=e)(l);let c=!1;t.block&&(t.blocks?t.blocks.forEach(((e,n)=>{n!==r&&e&&(he(),$e(e,1,1,(()=>{t.blocks[n]===e&&(t.blocks[n]=null)})),me())})):t.block.d(1),i.c(),ge(i,1),i.m(t.mount(),t.anchor),c=!0),t.block=i,t.blocks&&(t.blocks[r]=i),c&&ae()}if(!(o=e)||"object"!=typeof o&&"function"!=typeof o||"function"!=typeof o.then){if(t.current!==t.then)return r(t.then,1,t.value,e),!0;t.resolved=e}else{const n=K();if(e.then((e=>{Y(n),r(t.then,1,t.value,e),Y(null)}),(e=>{if(Y(n),r(t.catch,2,t.error,e),Y(null),!t.hasCatch)throw e})),t.current!==t.pending)return r(t.pending,0),!0}var o}function we(e,t,n){const r=t.slice(),{resolved:o}=e;e.current===e.then&&(r[e.value]=o),e.current===e.catch&&(r[e.error]=o),e.block.p(r,n)}function xe(e){return void 0!==e?.length?e:Array.from(e)}function Ee(e,t){e.d(1),t.delete(e.key)}function ke(e,t){$e(e,1,1,(()=>{t.delete(e.key)}))}function Te(e,t,n,r,s,l,i,c,a,u,d,p){let f=e.length,h=l.length,m=f;const g={};for(;m--;)g[e[m].key]=m;const $=[],v=new Map,b=new Map,y=[];for(m=h;m--;){const e=p(s,l,m),o=n(e);let c=i.get(o);c?r&&y.push((()=>c.p(e,t))):(c=u(o,e),c.c()),v.set(o,$[m]=c),o in g&&b.set(o,Math.abs(m-g[o]))}const w=new Set,x=new Set;function E(e){ge(e,1),e.m(c,d),i.set(e.key,e),d=e.first,h--}for(;f&&h;){const t=$[h-1],n=e[f-1],r=t.key,o=n.key;t===n?(d=t.first,f--,h--):v.has(o)?!i.has(r)||w.has(r)?E(t):x.has(o)?f--:b.get(r)>b.get(o)?(x.add(r),E(t)):(w.add(o),f--):(a(n,i),f--)}for(;f--;){const t=e[f];v.has(t.key)||a(t,i)}for(;h;)E($[h-1]);return o(y),$}let Se;function Ce(e,t,n){const r=e.$$.props[t];void 0!==r&&(e.$$.bound[r]=n,n(e.$$.ctx[r]))}function Oe(e){e&&e.c()}function _e(e,t,r){const{fragment:l,after_update:i}=e.$$;l&&l.m(t,r),oe((()=>{const t=e.$$.on_mount.map(n).filter(s);e.$$.on_destroy?e.$$.on_destroy.push(...t):o(t),e.$$.on_mount=[]})),i.forEach(oe)}function De(e,t){const n=e.$$;null!==n.fragment&&(function(e){const t=[],n=[];ee.forEach((r=>-1===e.indexOf(r)?t.push(r):n.push(r))),n.forEach((e=>e())),ee=t}(n.after_update),o(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Ne(t,n,s,l,i,c,a=null,u=[-1]){const d=B;Y(t);const p=t.$$={fragment:null,ctx:[],props:c,update:e,not_equal:i,bound:r(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(d?d.$$.context:[])),callbacks:r(),dirty:u,skip_bound:!1,root:n.target||d.$$.root};a&&a(p.root);let f=!1;if(p.ctx=s?s(t,n.props||{},((e,n,...r)=>{const o=r.length?r[0]:n;return p.ctx&&i(p.ctx[e],p.ctx[e]=o)&&(!p.skip_bound&&p.bound[e]&&p.bound[e](o),f&&function(e,t){-1===e.$$.dirty[0]&&(Z.push(e),re||(re=!0,ne.then(ae)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(t,e)),n})):[],p.update(),f=!0,o(p.before_update),p.fragment=!!l&&l(p.ctx),n.target){if(n.hydrate){E=!0;const e=(h=n.target,Array.from(h.childNodes));p.fragment&&p.fragment.l(e),e.forEach(O)}else p.fragment&&p.fragment.c();n.intro&&ge(t.$$.fragment),_e(t,n.target,n.anchor),E=!1,ae()}var h;Y(d)}function Ae(e,t,n,r){const o=n[e]?.type;if(t="Boolean"===o&&"boolean"!=typeof t?null!=t:t,!r||!n[e])return t;if("toAttribute"===r)switch(o){case"Object":case"Array":return null==t?null:JSON.stringify(t);case"Boolean":return t?"":null;case"Number":return null==t?null:t;default:return t}else switch(o){case"Object":case"Array":return t&&JSON.parse(t);case"Boolean":default:return t;case"Number":return null!=t?+t:t}}new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]),"function"==typeof HTMLElement&&(Se=class extends HTMLElement{$$ctor;$$s;$$c;$$cn=!1;$$d={};$$r=!1;$$p_d={};$$l={};$$l_u=new Map;constructor(e,t,n){super(),this.$$ctor=e,this.$$s=t,n&&this.attachShadow({mode:"open"})}addEventListener(e,t,n){if(this.$$l[e]=this.$$l[e]||[],this.$$l[e].push(t),this.$$c){const n=this.$$c.$on(e,t);this.$$l_u.set(t,n)}super.addEventListener(e,t,n)}removeEventListener(e,t,n){if(super.removeEventListener(e,t,n),this.$$c){const e=this.$$l_u.get(t);e&&(e(),this.$$l_u.delete(t))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){if(await Promise.resolve(),!this.$$cn||this.$$c)return;function e(e){return()=>{let t;return{c:function(){t=D("slot"),"default"!==e&&P(t,"name",e)},m:function(e,n){C(e,t,n)},d:function(e){e&&O(t)}}}}const t={},n=function(e){const t={};return e.childNodes.forEach((e=>{t[e.slot||"default"]=!0})),t}(this);for(const o of this.$$s)o in n&&(t[o]=[e(o)]);for(const s of this.attributes){const l=this.$$g_p(s.name);l in this.$$d||(this.$$d[l]=Ae(l,s.value,this.$$p_d,"toProp"))}for(const i in this.$$p_d)i in this.$$d||void 0===this[i]||(this.$$d[i]=this[i],delete this[i]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:t,$$scope:{ctx:[]}}});const r=()=>{this.$$r=!0;for(const e in this.$$p_d)if(this.$$d[e]=this.$$c.$$.ctx[this.$$c.$$.props[e]],this.$$p_d[e].reflect){const t=Ae(e,this.$$d[e],this.$$p_d,"toAttribute");null==t?this.removeAttribute(this.$$p_d[e].attribute||e):this.setAttribute(this.$$p_d[e].attribute||e,t)}this.$$r=!1};this.$$c.$$.after_update.push(r),r();for(const c in this.$$l)for(const a of this.$$l[c]){const u=this.$$c.$on(c,a);this.$$l_u.set(a,u)}this.$$l={}}}attributeChangedCallback(e,t,n){this.$$r||(e=this.$$g_p(e),this.$$d[e]=Ae(e,n,this.$$p_d,"toProp"),this.$$c?.$set({[e]:this.$$d[e]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then((()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)}))}$$g_p(e){return Object.keys(this.$$p_d).find((t=>this.$$p_d[t].attribute===e||!this.$$p_d[t].attribute&&t.toLowerCase()===e))||e}});class Re{$$=void 0;$$set=void 0;$destroy(){De(this,1),this.$destroy=e}$on(t,n){if(!s(n))return e;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const e=r.indexOf(n);-1!==e&&r.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function Le(e){let t,n,r,o;const l=e[2].default,i=a(l,e,e[1],null);return{c(){t=D("form"),i&&i.c(),P(t,"class","column-card svelte-12n6e3q")},m(l,c){C(l,t,c),i&&i.m(t,null),n=!0,r||(o=I(t,"submit",F((function(){s(e[0])&&e[0].apply(this,arguments)}))),r=!0)},p(t,[r]){e=t,i&&i.p&&(!n||2&r)&&p(i,l,e,e[1],n?d(l,e[1],r,null):f(e[1]),null)},i(e){n||(ge(i,e),n=!0)},o(e){$e(i,e),n=!1},d(e){e&&O(t),i&&i.d(e),r=!1,o()}}}function Ie(e,t,n){let{$$slots:r={},$$scope:o}=t,{onSubmit:s}=t;return e.$$set=e=>{"onSubmit"in e&&n(0,s=e.onSubmit),"$$scope"in e&&n(1,o=e.$$scope)},[s,o,r]}"undefined"!=typeof window&&(window.__svelte||(window.__svelte={v:new Set})).v.add("4");const Fe=class extends Re{constructor(e){super(),Ne(this,e,Ie,Le,l,{onSubmit:0})}};function Ue(e,t,n){const r=e.slice();return r[6]=t[n],r}function Pe(e,t){let n,r,o,s,l,i,c,a,u,d=!1,p=t[6].label+"";return c=function(e){let t;return{p(...n){t=n,t.forEach((t=>e.push(t)))},r(){t.forEach((t=>e.splice(e.indexOf(t),1)))}}}(t[5][0]),{key:e,first:null,c(){n=D("label"),r=D("input"),l=R(),i=A(p),P(r,"type","radio"),P(r,"name",t[2]),r.__value=o=t[6].value,M(r,r.__value),r.checked=s=t[0]===t[6].value,P(n,"class","svelte-1tapr9t"),G(n,"selected",t[0]===t[6].value),c.p(r),this.first=n},m(e,o){C(e,n,o),k(n,r),r.checked=r.__value===t[0],k(n,l),k(n,i),a||(u=I(r,"change",t[4]),a=!0)},p(e,l){t=e,4&l&&P(r,"name",t[2]),2&l&&o!==(o=t[6].value)&&(r.__value=o,M(r,r.__value),d=!0),3&l&&s!==(s=t[0]===t[6].value)&&(r.checked=s),(d||3&l)&&(r.checked=r.__value===t[0]),2&l&&p!==(p=t[6].label+"")&&j(i,p),3&l&&G(n,"selected",t[0]===t[6].value)},d(e){e&&O(n),c.r(),a=!1,u()}}}function je(t){let n,r=[],o=new Map,s=xe(t[1]);const l=e=>e[6].value;for(let e=0;e<s.length;e+=1){let n=Ue(t,s,e),i=l(n);o.set(i,r[e]=Pe(i,n))}return{c(){n=D("div");for(let e=0;e<r.length;e+=1)r[e].c();P(n,"role","radiogroup"),P(n,"class",t[3])},m(e,t){C(e,n,t);for(let e=0;e<r.length;e+=1)r[e]&&r[e].m(n,null)},p(e,[t]){7&t&&(s=xe(e[1]),r=Te(r,t,l,1,e,s,o,n,Ee,Pe,null,Ue)),8&t&&P(n,"class",e[3])},i:e,o:e,d(e){e&&O(n);for(let e=0;e<r.length;e+=1)r[e].d()}}}function Me(e,t,n){let{options:r}=t,{selected:o}=t,{name:s=`radio-${Math.random().toString().slice(2)}`}=t,{class:l}=t;return e.$$set=e=>{"options"in e&&n(1,r=e.options),"selected"in e&&n(0,o=e.selected),"name"in e&&n(2,s=e.name),"class"in e&&n(3,l=e.class)},[o,r,s,l,function(){o=this.__value,n(0,o)},[[]]]}const Ge=class extends Re{constructor(e){super(),Ne(this,e,Me,je,l,{options:1,selected:0,name:2,class:3})}},ze=[];function He(t,n=e){let r;const o=new Set;function s(e){if(l(t,e)&&(t=e,r)){const e=!ze.length;for(const e of o)e[1](),ze.push(e,t);if(e){for(let e=0;e<ze.length;e+=2)ze[e][0](ze[e+1]);ze.length=0}}}function i(e){s(e(t))}return{set:s,update:i,subscribe:function(l,c=e){const a=[l,c];return o.add(a),1===o.size&&(r=n(s,i)||e),l(t),()=>{o.delete(a),0===o.size&&r&&(r(),r=null)}}}}var Be,qe;!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.REGEXP=1]="REGEXP",e[e.FUNCTION=2]="FUNCTION"}(Be||(Be={})),function(e){e[e.NONE=0]="NONE",e[e.REGEXP=1]="REGEXP",e[e.SELECTOR=2]="SELECTOR",e[e.FUNCTION=3]="FUNCTION"}(qe||(qe={}));const We={useTiny:!1,nextLink:Be.DEFAULT,nextLinkRegex:'href="([^"]+)"[^>]*>\\s*Next',nextLinkFn:'return "https://www.reddit.com/r/HFY/comments/f94rak/oc_pthok_eats_an_ice_cream_cone/" // use `document` or `html` to extract',transform:qe.NONE,transformRegex:".md",transformSelector:"",transformFn:'title = "P\'Thok Eats an Ice Cream Cone" // or read from `title`\nhtml = "https://www.reddit.com/r/HFY/comments/f94rak/oc_pthok_eats_an_ice_cream_cone/" // use `document`, `html`, `url`'},Ye=He(We),Ke=e=>{const t=new Function("sandbox",`with (sandbox) {${e}\n}`),n=Object.create(null);n.console={log:console.log,table:console.table,error:console.error,assert:console.assert};const r=new Proxy(n,{has:Xe,get:Ve});return e=>(e&&Object.defineProperties(r,e),{proxy:r,ret:t(r)})};function Xe(e,t){return!0}function Ve(e,t){if(t!==Symbol.unscopables)return e[t]}function Je(e){let t,n,r,o,s,l,i,c,a,u;return{c(){t=D("label"),n=A("Function: "),r=D("span"),r.textContent="Only input code you trust!",o=R(),s=D("textarea"),i=R(),c=D("span"),c.innerHTML="Globals <code>document</code> and <code>html</code> are available; Must produce the url as <code>return</code>",P(r,"class","small warning svelte-5v9ihf"),P(s,"rows","5"),P(s,"placeholder",l=We.nextLinkFn),P(s,"class","svelte-5v9ihf"),P(c,"class","small svelte-5v9ihf"),P(t,"class","field svelte-5v9ihf")},m(l,d){C(l,t,d),k(t,n),k(t,r),k(t,o),k(t,s),M(s,e[0].nextLinkFn),k(t,i),k(t,c),a||(u=I(s,"input",e[7]),a=!0)},p(e,t){1&t&&M(s,e[0].nextLinkFn)},d(e){e&&O(t),a=!1,u()}}}function Ze(e){let t,n,r,o,s,l,i,c;return{c(){t=D("label"),n=A("Regex:\n          "),r=D("input"),s=R(),l=D("span"),l.textContent="Must produce the url in the first group",P(r,"type","text"),P(r,"placeholder",o=We.nextLinkRegex),P(r,"class","svelte-5v9ihf"),P(l,"class","small svelte-5v9ihf"),P(t,"class","field svelte-5v9ihf")},m(o,a){C(o,t,a),k(t,n),k(t,r),M(r,e[0].nextLinkRegex),k(t,s),k(t,l),i||(c=I(r,"input",e[6]),i=!0)},p(e,t){1&t&&r.value!==e[0].nextLinkRegex&&M(r,e[0].nextLinkRegex)},d(e){e&&O(t),i=!1,c()}}}function Qe(t){let n;return{c(){n=D("span"),n.textContent='Finds a "First" link, with fallback to other links that aren\'t "Previous" or "Index" or "First"',P(n,"class","small svelte-5v9ihf")},m(e,t){C(e,n,t)},p:e,d(e){e&&O(n)}}}function et(e){let t,n,r,o,s,l,i,c,a,u;return{c(){t=D("label"),n=A("Function: "),r=D("span"),r.textContent="Only input code you trust!",o=R(),s=D("textarea"),i=R(),c=D("span"),c.innerHTML="Globals <code>document</code>, <code>html</code>, <code>title</code> and <code>url</code> are available; Modify the latter three to transform",P(r,"class","small warning svelte-5v9ihf"),P(s,"rows","5"),P(s,"placeholder",l=We.transformFn),P(s,"class","svelte-5v9ihf"),P(c,"class","small svelte-5v9ihf"),P(t,"class","field svelte-5v9ihf")},m(l,d){C(l,t,d),k(t,n),k(t,r),k(t,o),k(t,s),M(s,e[0].transformFn),k(t,i),k(t,c),a||(u=I(s,"input",e[11]),a=!0)},p(e,t){1&t&&M(s,e[0].transformFn)},d(e){e&&O(t),a=!1,u()}}}function tt(e){let t,n,r,o,s,l;return{c(){t=D("label"),n=A("Selector:\n          "),r=D("input"),P(r,"type","text"),P(r,"placeholder",o=We.transformSelector),P(r,"class","svelte-5v9ihf"),P(t,"class","field svelte-5v9ihf")},m(o,i){C(o,t,i),k(t,n),k(t,r),M(r,e[0].transformSelector),s||(l=I(r,"input",e[10]),s=!0)},p(e,t){1&t&&r.value!==e[0].transformSelector&&M(r,e[0].transformSelector)},d(e){e&&O(t),s=!1,l()}}}function nt(e){let t,n,r,o,s,l,i,c;return{c(){t=D("label"),n=A("Regex:\n          "),r=D("input"),s=R(),l=D("span"),l.textContent="Must produce the new html in the first group",P(r,"type","text"),P(r,"placeholder",o=We.transformRegex),P(r,"class","svelte-5v9ihf"),P(l,"class","small svelte-5v9ihf"),P(t,"class","field svelte-5v9ihf")},m(o,a){C(o,t,a),k(t,n),k(t,r),M(r,e[0].transformRegex),k(t,s),k(t,l),i||(c=I(r,"input",e[9]),i=!0)},p(e,t){1&t&&r.value!==e[0].transformRegex&&M(r,e[0].transformRegex)},d(e){e&&O(t),i=!1,c()}}}function rt(e){let t,n,r,o,s,l,i,c,a,u,d,p,f,h,m,g,$,v,b,y,w,x,E,T,S,_,N;function L(t){e[5](t)}let F={options:[{value:Be.DEFAULT,label:"Default"},{value:Be.REGEXP,label:"Regex"},{value:Be.FUNCTION,label:"Function"}],name:"radio-next-type"};function U(e,t){return e[0].nextLink===Be.DEFAULT?Qe:e[0].nextLink===Be.REGEXP?Ze:e[0].nextLink===Be.FUNCTION?Je:void 0}void 0!==e[0].nextLink&&(F.selected=e[0].nextLink),f=new Ge({props:F}),Q.push((()=>Ce(f,"selected",L)));let j=U(e),M=j&&j(e);function G(t){e[8](t)}let z={options:[{value:qe.NONE,label:"No transform"},{value:qe.REGEXP,label:"Regex"},{value:qe.SELECTOR,label:"Query-Selector"},{value:qe.FUNCTION,label:"Function"}],name:"radio-transform"};function H(e,t){return e[0].transform===qe.REGEXP?nt:e[0].transform===qe.SELECTOR?tt:e[0].transform===qe.FUNCTION?et:void 0}void 0!==e[0].transform&&(z.selected=e[0].transform),x=new Ge({props:z}),Q.push((()=>Ce(x,"selected",G)));let B=H(e),q=B&&B(e);return{c(){t=D("h3"),t.textContent="Editor",n=R(),r=D("div"),o=D("label"),s=D("input"),l=A("\n        Use TinyMCE, a powerful HTML editor, for editing chapters"),i=R(),c=D("h3"),c.textContent="Next chapter",a=R(),u=D("div"),d=D("p"),d.textContent="Specify how next chapter links are extracted.",p=R(),Oe(f.$$.fragment),m=R(),M&&M.c(),g=R(),$=D("h3"),$.textContent="Chapter transform",v=R(),b=D("div"),y=D("p"),y.textContent="Automatically transform chapter contents.",w=R(),Oe(x.$$.fragment),T=R(),q&&q.c(),P(s,"type","checkbox"),P(s,"class","svelte-5v9ihf"),P(o,"class","field svelte-5v9ihf")},m(h,E){C(h,t,E),C(h,n,E),C(h,r,E),k(r,o),k(o,s),s.checked=e[0].useTiny,k(o,l),C(h,i,E),C(h,c,E),C(h,a,E),C(h,u,E),k(u,d),k(u,p),_e(f,u,null),k(u,m),M&&M.m(u,null),C(h,g,E),C(h,$,E),C(h,v,E),C(h,b,E),k(b,y),k(b,w),_e(x,b,null),k(b,T),q&&q.m(b,null),S=!0,_||(N=I(s,"change",e[4]),_=!0)},p(e,t){1&t&&(s.checked=e[0].useTiny);const n={};!h&&1&t&&(h=!0,n.selected=e[0].nextLink,se((()=>h=!1))),f.$set(n),j===(j=U(e))&&M?M.p(e,t):(M&&M.d(1),M=j&&j(e),M&&(M.c(),M.m(u,null)));const r={};!E&&1&t&&(E=!0,r.selected=e[0].transform,se((()=>E=!1))),x.$set(r),B===(B=H(e))&&q?q.p(e,t):(q&&q.d(1),q=B&&B(e),q&&(q.c(),q.m(b,null)))},i(e){S||(ge(f.$$.fragment,e),ge(x.$$.fragment,e),S=!0)},o(e){$e(f.$$.fragment,e),$e(x.$$.fragment,e),S=!1},d(e){e&&(O(t),O(n),O(r),O(i),O(c),O(a),O(u),O(g),O($),O(v),O(b)),De(f),M&&M.d(),De(x),q&&q.d(),_=!1,N()}}}function ot(e){let t,n,r,o;return{c(){t=D("span"),n=A("Transform Function invalid: "),r=D("code"),o=A(e[3]),P(t,"class","small error svelte-5v9ihf")},m(e,s){C(e,t,s),k(t,n),k(t,r),k(r,o)},p(e,t){8&t&&j(o,e[3])},d(e){e&&O(t)}}}function st(e){let t,n,r,o;return{c(){t=D("span"),n=A("Transform Selector invalid: "),r=D("code"),o=A(e[3]),P(t,"class","small error svelte-5v9ihf")},m(e,s){C(e,t,s),k(t,n),k(t,r),k(r,o)},p(e,t){8&t&&j(o,e[3])},d(e){e&&O(t)}}}function lt(e){let t,n,r,o;return{c(){t=D("span"),n=A("Transform Regex invalid: "),r=D("code"),o=A(e[3]),P(t,"class","small error svelte-5v9ihf")},m(e,s){C(e,t,s),k(t,n),k(t,r),k(r,o)},p(e,t){8&t&&j(o,e[3])},d(e){e&&O(t)}}}function it(e){let t,n,r,o;return{c(){t=D("span"),n=A("Chapter Function invalid: "),r=D("code"),o=A(e[2]),P(t,"class","small error svelte-5v9ihf")},m(e,s){C(e,t,s),k(t,n),k(t,r),k(r,o)},p(e,t){4&t&&j(o,e[2])},d(e){e&&O(t)}}}function ct(e){let t,n,r,o;return{c(){t=D("span"),n=A("Chapter Regex invalid: "),r=D("code"),o=A(e[2]),P(t,"class","small error svelte-5v9ihf")},m(e,s){C(e,t,s),k(t,n),k(t,r),k(r,o)},p(e,t){4&t&&j(o,e[2])},d(e){e&&O(t)}}}function at(e){let t,n,r,o,s,l,i,c,a,u;function d(e,t){return e[1]&&e[0].nextLink===Be.REGEXP&&e[2]?ct:e[1]&&e[0].nextLink===Be.FUNCTION&&e[2]?it:e[1]&&e[0].transform===qe.REGEXP&&e[3]?lt:e[1]&&e[0].transform===qe.SELECTOR&&e[3]?st:e[1]&&e[0].transform===qe.FUNCTION&&e[3]?ot:void 0}n=new Fe({props:{$$slots:{default:[rt]},$$scope:{ctx:e}}});let p=d(e),f=p&&p(e);return{c(){t=D("div"),Oe(n.$$.fragment),r=R(),o=D("button"),s=A("Save"),l=R(),f&&f.c(),i=L(),P(t,"class","settings svelte-5v9ihf"),P(o,"type","submit"),o.disabled=e[1]},m(d,p){C(d,t,p),_e(n,t,null),C(d,r,p),C(d,o,p),k(o,s),C(d,l,p),f&&f.m(d,p),C(d,i,p),c=!0,a||(u=I(o,"click",e[12]),a=!0)},p(e,[t]){const r={};262145&t&&(r.$$scope={dirty:t,ctx:e}),n.$set(r),(!c||2&t)&&(o.disabled=e[1]),p===(p=d(e))&&f?f.p(e,t):(f&&f.d(1),f=p&&p(e),f&&(f.c(),f.m(i.parentNode,i)))},i(e){c||(ge(n.$$.fragment,e),c=!0)},o(e){$e(n.$$.fragment,e),c=!1},d(e){e&&(O(t),O(r),O(o),O(l),O(i)),De(n),f&&f.d(e),a=!1,u()}}}function ut(e,t,n){let r;c(e,Ye,(e=>n(13,r=e)));const o=Object.assign({},r),s=Object.assign({},r),l=(e,t)=>{if(!e.trim().length)return{error:"Must specify a regular expression",disableSave:!0};try{return new RegExp(e,"i"),{error:void 0,disableSave:t}}catch(e){return{error:e,disableSave:!0}}},i=(e,t)=>{if(!e.trim().length)return{error:"Must specify a function",disableSave:!0};try{return Ke(e),{error:void 0,disableSave:t}}catch(e){return{error:e,disableSave:!0}}};let a,u,d=!1;return X((()=>n(1,d=!0))),e.$$.update=()=>{1&e.$$.dirty&&n(1,d=o.nextLink===s.nextLink&&o.nextLinkRegex===s.nextLinkRegex&&o.nextLinkFn===s.nextLinkFn&&o.transform===s.transform&&o.transformRegex===s.transformRegex&&o.transformSelector===s.transformSelector&&o.transformFn===s.transformFn&&o.useTiny===s.useTiny),3&e.$$.dirty&&o.nextLink===Be.REGEXP&&n(1,({disableSave:d,error:a}=l(o.nextLinkRegex,d)),d,(n(2,a),n(0,o),n(1,d))),3&e.$$.dirty&&o.nextLink===Be.FUNCTION&&n(1,({disableSave:d,error:a}=i(o.nextLinkFn,d)),d,(n(2,a),n(0,o),n(1,d))),3&e.$$.dirty&&o.transform===qe.REGEXP&&n(1,({disableSave:d,error:u}=l(o.transformRegex,d)),d,(n(3,u),n(0,o),n(1,d))),3&e.$$.dirty&&o.transform===qe.SELECTOR&&n(1,({disableSave:d,error:u}=((e,t)=>{if(!e.trim().length)return{error:"Must specify a selector",disableSave:!0};try{return document.querySelector(e),{error:void 0,disableSave:t}}catch(e){return{error:e,disableSave:!0}}})(o.transformSelector,d)),d,(n(3,u),n(0,o),n(1,d))),3&e.$$.dirty&&o.transform===qe.FUNCTION&&n(1,({disableSave:d,error:u}=i(o.transformFn,d)),d,(n(3,u),n(0,o),n(1,d)))},[o,d,a,u,function(){o.useTiny=this.checked,n(0,o)},function(t){e.$$.not_equal(o.nextLink,t)&&(o.nextLink=t,n(0,o))},function(){o.nextLinkRegex=this.value,n(0,o)},function(){o.nextLinkFn=this.value,n(0,o)},function(t){e.$$.not_equal(o.transform,t)&&(o.transform=t,n(0,o))},function(){o.transformRegex=this.value,n(0,o)},function(){o.transformSelector=this.value,n(0,o)},function(){o.transformFn=this.value,n(0,o)},()=>{Ye.set(o),n(1,d=!0)}]}const dt=class extends Re{constructor(e){super(),Ne(this,e,ut,at,l,{})}};var pt=i(3),ft=i.n(pt);function ht(e){let t,n,r;return{c(){t=D("a"),t.textContent="Back to Search",P(t,"href","#search"),P(t,"class","small")},m(o,l){C(o,t,l),n||(r=I(t,"click",F((function(){s(e[0])&&e[0].apply(this,arguments)}))),n=!0)},p(t,n){e=t},d(e){e&&O(t),n=!1,r()}}}function mt(t){let n,r=t[0]&&ht(t);return{c(){r&&r.c(),n=L()},m(e,t){r&&r.m(e,t),C(e,n,t)},p(e,[t]){e[0]?r?r.p(e,t):(r=ht(e),r.c(),r.m(n.parentNode,n)):r&&(r.d(1),r=null)},i:e,o:e,d(e){e&&O(n),r&&r.d(e)}}}function gt(e,t,n){let{backToSearch:r}=t;return e.$$set=e=>{"backToSearch"in e&&n(0,r=e.backToSearch)},[r]}const $t=class extends Re{constructor(e){super(),Ne(this,e,gt,mt,l,{backToSearch:0})}};function vt(e,t,n){const r=e.slice();return r[4]=t[n],r}function bt(t){let n;return{c(){n=D("span"),n.textContent=`Sorry, can't process that${t[4]?": ":""}${t[4].message||t[4]}`,P(n,"class","error svelte-m4i2yw")},m(e,t){C(e,n,t)},p:e,d(e){e&&O(n)}}}function yt(e){let t,n,r;return{c(){t=D("button"),t.textContent="Retry"},m(o,l){C(o,t,l),n||(r=I(t,"click",(function(){s(e[0])&&e[0].apply(this,arguments)})),n=!0)},p(t,n){e=t},d(e){e&&O(t),n=!1,r()}}}function wt(e){let t,n,r;return{c(){t=D("a"),t.textContent="back",P(t,"href","#back")},m(o,l){C(o,t,l),n||(r=I(t,"click",F((function(){s(e[1])&&e[1].apply(this,arguments)}))),n=!0)},p(t,n){e=t},d(e){e&&O(t),n=!1,r()}}}function xt(t){let n,r,o,s,l=xe(t[2]),i=[];for(let e=0;e<l.length;e+=1)i[e]=bt(vt(t,l,e));let c=t[0]&&yt(t),a=t[1]&&wt(t);return{c(){n=D("p");for(let e=0;e<i.length;e+=1)i[e].c();r=R(),c&&c.c(),o=R(),a&&a.c(),s=L()},m(e,t){C(e,n,t);for(let e=0;e<i.length;e+=1)i[e]&&i[e].m(n,null);C(e,r,t),c&&c.m(e,t),C(e,o,t),a&&a.m(e,t),C(e,s,t)},p(e,[t]){if(4&t){let r;for(l=xe(e[2]),r=0;r<l.length;r+=1){const o=vt(e,l,r);i[r]?i[r].p(o,t):(i[r]=bt(o),i[r].c(),i[r].m(n,null))}for(;r<i.length;r+=1)i[r].d(1);i.length=l.length}e[0]?c?c.p(e,t):(c=yt(e),c.c(),c.m(o.parentNode,o)):c&&(c.d(1),c=null),e[1]?a?a.p(e,t):(a=wt(e),a.c(),a.m(s.parentNode,s)):a&&(a.d(1),a=null)},i:e,o:e,d(e){e&&(O(n),O(r),O(o),O(s)),_(i,e),c&&c.d(e),a&&a.d(e)}}}function Et(e,t,n){let{error:r}=t,{retry:o}=t,{back:s}=t,l=Array.isArray(r)?r:[r];return e.$$set=e=>{"error"in e&&n(3,r=e.error),"retry"in e&&n(0,o=e.retry),"back"in e&&n(1,s=e.back)},[o,s,l,r]}const kt=class extends Re{constructor(e){super(),Ne(this,e,Et,xt,l,{error:3,retry:0,back:1})}};function Tt(e){let t,n,r,o,s;const l=e[1].default,i=a(l,e,e[0],null),c=i||function(){let e;return{c(){e=A("Loading...")},m(t,n){C(t,e,n)},d(t){t&&O(e)}}}();return{c(){t=D("div"),n=D("div"),n.innerHTML='<span class="loading-slider svelte-w1n7v1">•</span>',r=R(),o=D("p"),c&&c.c(),P(n,"class","loading-slider-container svelte-w1n7v1"),P(o,"class","loading svelte-w1n7v1"),P(t,"class","loading-container svelte-w1n7v1")},m(e,l){C(e,t,l),k(t,n),k(t,r),k(t,o),c&&c.m(o,null),s=!0},p(e,[t]){i&&i.p&&(!s||1&t)&&p(i,l,e,e[0],s?d(l,e[0],t,null):f(e[0]),null)},i(e){s||(ge(c,e),s=!0)},o(e){$e(c,e),s=!1},d(e){e&&O(t),c&&c.d(e)}}}function St(e,t,n){let{$$slots:r={},$$scope:o}=t;return e.$$set=e=>{"$$scope"in e&&n(0,o=e.$$scope)},[o,r]}const Ct=class extends Re{constructor(e){super(),Ne(this,e,St,Tt,l,{})}};let Ot=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&n[e]];return t};const _t=async(e,t)=>{const n="undefined"!=typeof AbortController?new AbortController:{},r=setTimeout((()=>n.abort&&n.abort()),t);try{return await fetch(e,{signal:n.signal})}finally{clearTimeout(r)}},Dt=async(e,t=1e4,n=3)=>{for(let r=0;r<n-1;r++)try{return await _t(e,t)}catch(t){console.log(`Failed to fetch \`${e}\` ${r+1} ${0===r?"time":"times"}. Retrying...`)}return _t(e,t)},Nt=async(e,t,n=1e4,r=3)=>{const o=new URL(e,t);for(let e=0;e<r-1;e++)try{return await _t(o,n)}catch(t){console.log(`Failed to fetch \`${o}\` ${e+1} ${0===e?"time":"times"}. Retrying...`)}return _t(o,n)};function At(e){const t=e-1;return t*t*t+1}const Rt="www.reddit.com",Lt=e=>(e instanceof URL||(e=new URL(e)),e.hostname=Rt,e.pathname.endsWith("/")?e.pathname=`${e.pathname.slice(0,e.pathname.length-1)}.json`:e.pathname.endsWith(".json")||(e.pathname+=".json"),e.protocol="https",e.search="",e.hash="",e.toString()),It=e=>{const t=new URL(e);return("reddit.com"===t.host||t.host.match(/\.reddit\.com$/))&&e.match(".json$")?e.slice(0,-5).replace("https://api","https://www"):e},Ft=(()=>{const e=new DOMParser;return t=>{var n;return null!==(n=e.parseFromString(t,"text/html").documentElement.textContent)&&void 0!==n?n:""}})(),Ut=(()=>{const e=new DOMParser;return t=>e.parseFromString(t,"text/html")})();function Pt(e){return"string"==typeof e||e instanceof String}function jt(e,{delay:t=0,duration:n=200,prop:r="height",easing:o=At}={}){const s=getComputedStyle(e)[r];if(!Pt(s)||!s.endsWith("px"))throw new Error(`invalid property '${r}' does not return pixels`);const l=+s.slice(0,-2);return{delay:t,duration:n,easing:o,css:e=>`overflow: hidden; ${r}: ${e*l}px`}}const Mt=/(?:https?:\/\/(?:[^.]+\.)?reddit\.com)?\/r\/([^\/]+)\/comments\/.+/i,Gt=/href="((?:https?:\/\/(?:[^.]+\.)?reddit\.com)?\/r\/([^\/]+)\/comments\/[^"]+)"[^>]*>\s*([^<]+)/gim,zt=/href="([^"]+)"[^>]*>\s*(.+)<\/a>/gim,Ht=/^https?:\/\/(?:[^.]+\.)?reddit\.com\/r\/hfy\/wiki\/series\//i,Bt=async e=>{const t=await Dt(new URL(`https://${Rt}/r/hfy/wiki/series.json`)),n=await t.json();if(!t.ok)throw n.message;const r=[...n.data.content_md.matchAll(/\[([^\]]+)\]\s*\(((?:https?:\/\/(?:[^.]+\.)?reddit\.com)?\/r\/hfy\/wiki\/series\/[^)]+)\)\s*(?:\[\*([^\]]+)\*\])?/gim)].map((e=>({title:e[1],author:e[3],url:Lt(e[2].startsWith("http")?e[2]:`https://${Rt}${e[2]}`)})));if(!e)return r;const o=e.toLowerCase();return r.filter((e=>-1!==e.title.toLowerCase().indexOf(o)))},qt=/^https?:\/\/(?:[^.]+\.)?reddit\.com\/r\/([^/]+)\/comments\//i,Wt=e=>({id:e[0].data.children[0].data.id,title:e[0].data.children[0].data.title,content:Ft(e[0].data.children[0].data.selftext_html),apiUrl:Lt(e[0].data.children[0].data.url),displayUrl:e[0].data.children[0].data.url,needsFetching:!1});var Yt;!function(e){e[e.HFY_SERIES=0]="HFY_SERIES",e[e.POST=1]="POST",e[e.GENERIC=2]="GENERIC",e[e.SEARCH=3]="SEARCH"}(Yt||(Yt={}));const Kt=new DOMParser,Xt=(e,t)=>e===Yt.GENERIC?t:Lt(t),Vt=(e,t)=>e.type===Yt.GENERIC?t.text():t.json(),Jt=(e,t,n)=>{switch(e){case Yt.POST:case Yt.HFY_SERIES:return Wt(t);case Yt.GENERIC:return((e,t)=>{const n=Ut(e);return{id:Ot(),apiUrl:t,displayUrl:t,title:n.title,content:n.body.innerHTML,needsFetching:!1}})(t,n)}throw new Error(`Getting data from source type \`${Yt[e]}\` not supported, this should never happen`)};let Zt,Qt;const en=(e,t)=>{switch(e.nextLink){case Be.DEFAULT:return(e=>{const t=e.match(/href="([^"]+)"[^>]*>\s*Next/i);if(t)return t[1];const n=[...e.matchAll(Gt)].reverse().find((e=>{const t=e[3].toLowerCase();return!t.startsWith("first")&&!t.startsWith("prev")&&!t.startsWith("index")}));if(n)return n[1];const r=[...e.matchAll(zt)],o=r.find((e=>-1!==e[2].toLowerCase().indexOf("next")));if(o)return o[1];const s=r.reverse().find((e=>{const t=e[2].toLowerCase();return!t.startsWith("first")&&!t.startsWith("prev")&&!t.startsWith("index")}));return s?s[1]:void 0})(t);case Be.REGEXP:return(e=>{const t=e.match(Zt);if(t&&t.length>1)return t[1]})(t);case Be.FUNCTION:return(e=>{let t;return Qt({document:{get:()=>t=null!=t?t:Kt.parseFromString(e,"text/html"),configurable:!0},html:{writable:!1,value:e,configurable:!0}}).ret})(t)}};let tn;const nn=e=>{const t=e.match(tn);return t&&t.length>1&&(e=t[1]),e};let rn;const on=(e,t)=>{switch(e.transform){case qe.NONE:return Object.assign(Object.assign({},t),{transformedContent:t.content});case qe.REGEXP:return Object.assign(Object.assign({},t),{transformedContent:nn(t.content||"")});case qe.SELECTOR:return Object.assign(Object.assign({},t),{transformedContent:(n=e.transformSelector,r=t.content||"",null===(o=Kt.parseFromString(r,"text/html").querySelector(n))||void 0===o?void 0:o.innerHTML)});case qe.FUNCTION:return(e=>{let t;const n={document:{get:()=>t=null!=t?t:Kt.parseFromString(e.content||"","text/html"),configurable:!0},title:{writable:!0,value:e.title,configurable:!0},html:{writable:!0,value:e.content,configurable:!0},url:{writable:!0,value:e.displayUrl,configurable:!0}},{proxy:r}=rn(n);return Object.assign(Object.assign({},e),{title:Pt(r.title)?r.title:e.title,transformedContent:Pt(r.html)?r.html:e.content,displayUrl:Pt(r.url)?r.url:e.displayUrl})})(t)}var n,r,o},sn=(e,t)=>t.map(on.bind(null,e));var ln;Ye.subscribe((e=>{try{Zt=new RegExp(e.nextLinkRegex,"i"),tn=new RegExp(e.transformRegex,"i"),Qt=Ke(e.nextLinkFn),rn=Ke(e.transformFn)}catch(e){console.error(e)}})),function(e){e[e.INPUT=0]="INPUT",e[e.SEARCH=1]="SEARCH",e[e.BOOK_DATA=2]="BOOK_DATA",e[e.EDIT_DATA=3]="EDIT_DATA",e[e.FIND_CHAPTERS=4]="FIND_CHAPTERS",e[e.DOWNLOAD_CHAPTERS=5]="DOWNLOAD_CHAPTERS",e[e.RESULT=6]="RESULT",e[e.SETTINGS=7]="SETTINGS",e[e._404=8]="_404"}(ln||(ln={}));const cn=e=>e===ln.INPUT?i.p:`${i.p}${ln[e].toLowerCase().replace(/_/g,"-")}`;class an{constructor(){this.stage=ln.INPUT}dump(){return[]}}class un extends an{constructor(){super(...arguments),this.stage=ln.INPUT}next(e){const t=(e=>{try{return new URL(e),(e=>!!e.match(Ht))(e)?Yt.HFY_SERIES:(e=>!!e.match(qt))(e)?Yt.POST:Yt.GENERIC}catch(e){}return Yt.SEARCH})(e);return console.debug("Input",e,"resulted in type",t),En.update((n=>Object.assign(Object.assign({},n),{search:e,series:t!==Yt.SEARCH?{url:Xt(t,e),type:t}:n.series}))),kn.update((()=>{})),t===Yt.SEARCH?bn(dn):bn(pn)}fromList(e){const t=e.split("\n");return En.update((e=>Object.assign(Object.assign({},e),{series:{url:t[0],type:Yt.GENERIC}}))),kn.update((()=>({author:"unknown",title:"unknown",chapters:t.map(((e,t)=>({apiUrl:e,id:Ot(),title:`Chapter ${t}`,displayUrl:e})))}))),bn(pn)}fromJSON({series:e,bookData:t}){return En.update((t=>Object.assign(Object.assign({},t),{series:e}))),kn.update((()=>t)),bn(pn)}}class dn extends an{constructor(){super(...arguments),this.stage=ln.SEARCH}next(e){return En.update((t=>Object.assign(Object.assign({},t),{series:e}))),kn.update((()=>{})),bn(pn)}}class pn extends an{constructor(e=void 0){super(),this.newChapters=e,this.stage=ln.BOOK_DATA}next(){return bn(gn)}edit(){return bn(fn)}findMore(){return bn(hn)}downloadAll(){return bn(mn)}dump(){return[this.newChapters]}}class fn extends an{constructor(){super(...arguments),this.stage=ln.EDIT_DATA,this.needsSaving=!0}next(e){return kn.update((()=>e)),bn(pn)}}class hn extends an{constructor(){super(...arguments),this.stage=ln.FIND_CHAPTERS,this.needsSaving=!0}next(e,t){return kn.update((()=>e)),bn(pn,t)}}class mn extends an{constructor(){super(...arguments),this.stage=ln.DOWNLOAD_CHAPTERS,this.needsSaving=!0}next(e){return kn.update((()=>e)),bn(pn)}}class gn extends an{constructor(){super(...arguments),this.stage=ln.RESULT}next(){return bn(pn)}}class $n extends an{constructor(){super(...arguments),this.stage=ln.SETTINGS}next(){return wn()}}const vn={[ln.INPUT]:un,[ln.SEARCH]:dn,[ln.BOOK_DATA]:pn,[ln.EDIT_DATA]:fn,[ln.FIND_CHAPTERS]:hn,[ln.DOWNLOAD_CHAPTERS]:mn,[ln.RESULT]:gn,[ln.SETTINGS]:$n,[ln._404]:class extends an{constructor(){super(...arguments),this.stage=ln._404}next(){return wn()}}};function bn(e,...t){En.update((n=>{const r=new e(...t);r.from=n.stage;const o=r.dump();try{r.stage===ln.SETTINGS?history.pushState({data:o,search:n.search,series:n.series},"",cn(r.stage)):history.replaceState({data:o,search:n.search,series:n.series},"",cn(r.stage))}catch(e){console.error("Data too large! Caution, forwards/backwards won't work as expected!"),o.length>0&&(o[0]=void 0),r.stage===ln.SETTINGS?history.pushState({data:o,search:n.search,series:n.series},"",cn(r.stage)):history.replaceState({data:o,search:n.search,series:n.series},"",cn(r.stage))}return Object.assign(Object.assign({},n),{stage:r,lastBookData:e.usesBookData?r.bookData:n.lastBookData})}))}function yn(e,{data:t,search:n,series:r}={series:{type:Yt.GENERIC,url:""}}){t=t||[],En.update((o=>{try{const s=new vn[e](...t);return s.stage===o.stage.stage?o:(s.from=o.stage,Object.assign(Object.assign({},o),{search:n,series:r,stage:s}))}catch(r){return console.group("Failed to update page"),console.error(r),console.log("Parameters:",e,t,n),console.groupEnd(),history.pushState({data:[],search:o.search,series:o.series},"","/"),o}}))}function wn(){history.back()}function xn(e,t){return!!e&&e.stage===t}const En=He({stage:new un,series:{type:Yt.GENERIC,url:""}}),kn=He(void 0),Tn=new RegExp("^"+i.p.replace("/","/")),Sn=()=>{const e=location.pathname.replace(Tn,"").split("/")[0]||"";if(e.length>60)return;if(""===e)return yn(ln.INPUT);const t=e.toUpperCase().replace(/-/g,"_"),n=(()=>{var e;try{return JSON.parse(null!==(e=localStorage.getItem("state"))&&void 0!==e?e:"")}catch(e){return}})(),r=Object.assign(Object.assign({},n),history.state||{});return t in ln?yn(ln[t],r):yn(ln._404)};function Cn(e,t,n){const r=e.slice();return r[9]=t[n][0],r[10]=t[n][1],r[11]=t[n][2],r}function On(e,t,n){const r=e.slice();return r[9]=t[n][0],r[10]=t[n][1],r[11]=t[n][2],r}function _n(e){let t,n,r,o,l,i,c,a;return t=new kt({props:{error:e[17],retry:e[7]}}),l=new $t({props:{backToSearch:e[1]}}),{c(){Oe(t.$$.fragment),n=R(),r=D("button"),r.textContent="Back to book",o=R(),Oe(l.$$.fragment)},m(u,d){_e(t,u,d),C(u,n,d),C(u,r,d),C(u,o,d),_e(l,u,d),i=!0,c||(a=I(r,"click",(function(){s(e[0].next.bind(e[0]))&&e[0].next.bind(e[0]).apply(this,arguments)})),c=!0)},p(n,r){e=n;const o={};8&r&&(o.error=e[17]),8&r&&(o.retry=e[7]),t.$set(o);const s={};2&r&&(s.backToSearch=e[1]),l.$set(s)},i(e){i||(ge(t.$$.fragment,e),ge(l.$$.fragment,e),i=!0)},o(e){$e(t.$$.fragment,e),$e(l.$$.fragment,e),i=!1},d(e){e&&(O(n),O(r),O(o)),De(t,e),De(l,e),c=!1,a()}}}function Dn(e){let t,n,r,l,i,c,a,u,d,p,f,h,m=e[2].find(Mn);function g(){return e[6](e[14])}a=new $t({props:{backToSearch:e[1]}});let $=m&&Nn(e);return{c(){t=D("h3"),t.textContent="Your e-book is ready!",n=R(),r=D("button"),r.textContent="Download",l=R(),i=D("button"),i.textContent="Back to book",c=R(),Oe(a.$$.fragment),u=R(),$&&$.c(),d=L(),P(t,"class","valid svelte-ardw9p")},m(o,m){C(o,t,m),C(o,n,m),C(o,r,m),C(o,l,m),C(o,i,m),C(o,c,m),_e(a,o,m),C(o,u,m),$&&$.m(o,m),C(o,d,m),p=!0,f||(h=[I(r,"click",g),I(i,"click",(function(){s(e[0].next.bind(e[0]))&&e[0].next.bind(e[0]).apply(this,arguments)}))],f=!0)},p(t,n){e=t;const r={};2&n&&(r.backToSearch=e[1]),a.$set(r),4&n&&(m=e[2].find(Mn)),m?$?$.p(e,n):($=Nn(e),$.c(),$.m(d.parentNode,d)):$&&($.d(1),$=null)},i(e){p||(ge(a.$$.fragment,e),p=!0)},o(e){$e(a.$$.fragment,e),p=!1},d(e){e&&(O(t),O(n),O(r),O(l),O(i),O(c),O(u),O(d)),De(a,e),$&&$.d(e),f=!1,o(h)}}}function Nn(e){let t,n=xe(e[2]),r=[];for(let t=0;t<n.length;t+=1)r[t]=Ln(Cn(e,n,t));return{c(){t=D("div");for(let e=0;e<r.length;e+=1)r[e].c();P(t,"class","logs svelte-ardw9p")},m(e,n){C(e,t,n);for(let e=0;e<r.length;e+=1)r[e]&&r[e].m(t,null)},p(e,o){if(4&o){let s;for(n=xe(e[2]),s=0;s<n.length;s+=1){const l=Cn(e,n,s);r[s]?r[s].p(l,o):(r[s]=Ln(l),r[s].c(),r[s].m(t,null))}for(;s<r.length;s+=1)r[s].d(1);r.length=n.length}},d(e){e&&O(t),_(r,e)}}}function An(e){let t,n,r=e[10]+"",o=e[11]>1&&Rn(e);return{c(){t=D("p"),n=A(r),o&&o.c(),P(t,"class","small warning svelte-ardw9p")},m(e,r){C(e,t,r),k(t,n),o&&o.m(t,null)},p(e,s){4&s&&r!==(r=e[10]+"")&&j(n,r),e[11]>1?o?o.p(e,s):(o=Rn(e),o.c(),o.m(t,null)):o&&(o.d(1),o=null)},d(e){e&&O(t),o&&o.d()}}}function Rn(e){let t,n,r,o=e[11]+"";return{c(){t=A(" ("),n=A(o),r=A(" times)")},m(e,o){C(e,t,o),C(e,n,o),C(e,r,o)},p(e,t){4&t&&o!==(o=e[11]+"")&&j(n,o)},d(e){e&&(O(t),O(n),O(r))}}}function Ln(e){let t,n="warn"===e[9]&&An(e);return{c(){n&&n.c(),t=L()},m(e,r){n&&n.m(e,r),C(e,t,r)},p(e,r){"warn"===e[9]?n?n.p(e,r):(n=An(e),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(e){e&&O(t),n&&n.d(e)}}}function In(e){let t,n,r,o;t=new Ct({props:{$$slots:{default:[Fn]},$$scope:{ctx:e}}});let s=xe(e[2]),l=[];for(let t=0;t<s.length;t+=1)l[t]=Pn(On(e,s,t));return{c(){Oe(t.$$.fragment),n=R(),r=D("div");for(let e=0;e<l.length;e+=1)l[e].c();P(r,"class","logs svelte-ardw9p")},m(e,s){_e(t,e,s),C(e,n,s),C(e,r,s);for(let e=0;e<l.length;e+=1)l[e]&&l[e].m(r,null);o=!0},p(e,n){const o={};if(262144&n&&(o.$$scope={dirty:n,ctx:e}),t.$set(o),4&n){let t;for(s=xe(e[2]),t=0;t<s.length;t+=1){const o=On(e,s,t);l[t]?l[t].p(o,n):(l[t]=Pn(o),l[t].c(),l[t].m(r,null))}for(;t<l.length;t+=1)l[t].d(1);l.length=s.length}},i(e){o||(ge(t.$$.fragment,e),o=!0)},o(e){$e(t.$$.fragment,e),o=!1},d(e){e&&(O(n),O(r)),De(t,e),_(l,e)}}}function Fn(e){let t;return{c(){t=A("Please wait, generating e-book...")},m(e,n){C(e,t,n)},d(e){e&&O(t)}}}function Un(e){let t,n,r,o=e[11]+"";return{c(){t=A(" ("),n=A(o),r=A(" times)")},m(e,o){C(e,t,o),C(e,n,o),C(e,r,o)},p(e,t){4&t&&o!==(o=e[11]+"")&&j(n,o)},d(e){e&&(O(t),O(n),O(r))}}}function Pn(e){let t,n,r=e[10]+"",o=e[11]>1&&Un(e);return{c(){t=D("p"),n=A(r),o&&o.c(),P(t,"class","small svelte-ardw9p"),G(t,"warning","warn"===e[9])},m(e,r){C(e,t,r),k(t,n),o&&o.m(t,null)},p(e,s){4&s&&r!==(r=e[10]+"")&&j(n,r),e[11]>1?o?o.p(e,s):(o=Un(e),o.c(),o.m(t,null)):o&&(o.d(1),o=null),4&s&&G(t,"warning","warn"===e[9])},d(e){e&&O(t),o&&o.d()}}}function jn(e){let t,n,r,o={ctx:e,current:null,token:null,hasCatch:!0,pending:In,then:Dn,catch:_n,value:14,error:17,blocks:[,,,]};return ye(n=e[3],o),{c(){t=L(),o.block.c()},m(e,n){C(e,t,n),o.block.m(e,o.anchor=n),o.mount=()=>t.parentNode,o.anchor=t,r=!0},p(t,[r]){e=t,o.ctx=e,8&r&&n!==(n=e[3])&&ye(n,o)||we(o,e,r)},i(e){r||(ge(o.block),r=!0)},o(e){for(let e=0;e<3;e+=1)$e(o.blocks[e]);r=!1},d(e){e&&O(t),o.block.d(e),o.token=null,o=null}}}const Mn=([e])=>"warn"===e;function Gn(e,t,n){let r;c(e,kn,(e=>n(4,r=e)));let{stage:o}=t,{backToSearch:s}=t;const l=Promise.all([i.e(696),i.e(22)]).then(i.t.bind(i,696,23));if(!r)throw new Error("Inconsistent state, expected to have book data");let a=[];const u=async()=>{n(2,a=[]);const{default:e}=await l;return await e({title:Ft(r.title),author:Ft(r.author),ignoreFailedDownloads:!0,verbose:(e,t,...r)=>{const o=[t,...r].join(" "),s=a.find((e=>e[1]===o));s?++s[2]:a.push([e,o,1]),n(2,a)}},r.chapters.map((e=>{var t;return{title:Ft(e.title),content:null!==(t=e.transformedContent)&&void 0!==t?t:"<i>Content missing</i>",url:e.displayUrl}})))};let d=u();return e.$$set=e=>{"stage"in e&&n(0,o=e.stage),"backToSearch"in e&&n(1,s=e.backToSearch)},[o,s,a,d,r,u,e=>ft()(e,`${Ft(r.author)} - ${Ft(r.title)}.epub`,"application/epub+zip"),()=>n(3,d=u())]}const zn=class extends Re{constructor(e){super(),Ne(this,e,Gn,jn,l,{stage:0,backToSearch:1})}};function Hn(e,t,n){const r=e.slice();return r[12]=t[n],r}function Bn(e,t,n){const r=e.slice();return r[12]=t[n],r}function qn(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function Wn(e){let t,n,r,o,s,l=!e[3].length&&Yn(e),i=xe(e[1]),c=[];for(let t=0;t<i.length;t+=1)c[t]=Xn(Hn(e,i,t));let a=e[3].length&&Vn(e);return{c(){l&&l.c(),t=R(),n=D("div");for(let e=0;e<c.length;e+=1)c[e].c();r=R(),a&&a.c(),o=L(),P(n,"class","chapters svelte-1rrnlr6")},m(e,i){l&&l.m(e,i),C(e,t,i),C(e,n,i);for(let e=0;e<c.length;e+=1)c[e]&&c[e].m(n,null);C(e,r,i),a&&a.m(e,i),C(e,o,i),s=!0},p(e,r){if(e[3].length?l&&(l.d(1),l=null):l?l.p(e,r):(l=Yn(e),l.c(),l.m(t.parentNode,t)),2&r){let t;for(i=xe(e[1]),t=0;t<i.length;t+=1){const o=Hn(e,i,t);c[t]?c[t].p(o,r):(c[t]=Xn(o),c[t].c(),c[t].m(n,null))}for(;t<c.length;t+=1)c[t].d(1);c.length=i.length}e[3].length?a?(a.p(e,r),8&r&&ge(a,1)):(a=Vn(e),a.c(),ge(a,1),a.m(o.parentNode,o)):a&&(he(),$e(a,1,1,(()=>{a=null})),me())},i(e){s||(ge(a),s=!0)},o(e){$e(a),s=!1},d(e){e&&(O(t),O(n),O(r),O(o)),l&&l.d(e),_(c,e),a&&a.d(e)}}}function Yn(e){let t,n=e[0].next(e[15])+"";return{c(){t=A(n)},m(e,n){C(e,t,n)},p(e,r){17&r&&n!==(n=e[0].next(e[15])+"")&&j(t,n)},d(e){e&&O(t)}}}function Kn(e){let t,n,r=e[12].title+"";return{c(){t=D("p"),n=A(r),P(t,"class","valid small svelte-1rrnlr6")},m(e,r){C(e,t,r),k(t,n)},p(e,t){2&t&&r!==(r=e[12].title+"")&&j(n,r)},d(e){e&&O(t)}}}function Xn(e){let t,n=e[12]&&!0===e[12].new&&Kn(e);return{c(){n&&n.c(),t=L()},m(e,r){n&&n.m(e,r),C(e,t,r)},p(e,r){e[12]&&!0===e[12].new?n?n.p(e,r):(n=Kn(e),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(e){e&&O(t),n&&n.d(e)}}}function Vn(t){let n,r,o=t[3],s=Jn(t);return{c(){s.c(),n=L()},m(e,t){s.m(e,t),C(e,n,t),r=!0},p(t,r){8&r&&l(o,o=t[3])?(he(),$e(s,1,1,e),me(),s=Jn(t),s.c(),ge(s,1),s.m(n.parentNode,n)):s.p(t,r)},i(e){r||(ge(s),r=!0)},o(e){$e(s),r=!1},d(e){e&&O(n),s.d(e)}}}function Jn(e){let t,n;return t=new kt({props:{error:e[3],retry:e[8],back:e[9]}}),{c(){Oe(t.$$.fragment)},m(e,r){_e(t,e,r),n=!0},p(e,n){const r={};8&n&&(r.error=e[3]),16&n&&(r.retry=e[8]),35&n&&(r.back=e[9]),t.$set(r)},i(e){n||(ge(t.$$.fragment,e),n=!0)},o(e){$e(t.$$.fragment,e),n=!1},d(e){De(t,e)}}}function Zn(e){let t,n,r,o,s,l,i,c,a,u,d;t=new Ct({props:{$$slots:{default:[Qn]},$$scope:{ctx:e}}});let p=xe(e[1]),f=[];for(let t=0;t<p.length;t+=1)f[t]=tr(Bn(e,p,t));let h=e[3].length&&nr(e);return{c(){Oe(t.$$.fragment),n=R(),r=D("button"),o=A("Cancel"),s=R(),l=D("div");for(let e=0;e<f.length;e+=1)f[e].c();i=R(),h&&h.c(),c=L(),r.disabled=e[2],P(l,"class","chapters svelte-1rrnlr6")},m(p,m){_e(t,p,m),C(p,n,m),C(p,r,m),k(r,o),C(p,s,m),C(p,l,m);for(let e=0;e<f.length;e+=1)f[e]&&f[e].m(l,null);C(p,i,m),h&&h.m(p,m),C(p,c,m),a=!0,u||(d=I(r,"click",F(e[7])),u=!0)},p(e,n){const o={};if(262144&n&&(o.$$scope={dirty:n,ctx:e}),t.$set(o),(!a||4&n)&&(r.disabled=e[2]),2&n){let t;for(p=xe(e[1]),t=0;t<p.length;t+=1){const r=Bn(e,p,t);f[t]?f[t].p(r,n):(f[t]=tr(r),f[t].c(),f[t].m(l,null))}for(;t<f.length;t+=1)f[t].d(1);f.length=p.length}e[3].length?h?(h.p(e,n),8&n&&ge(h,1)):(h=nr(e),h.c(),ge(h,1),h.m(c.parentNode,c)):h&&(he(),$e(h,1,1,(()=>{h=null})),me())},i(e){a||(ge(t.$$.fragment,e),ge(h),a=!0)},o(e){$e(t.$$.fragment,e),$e(h),a=!1},d(e){e&&(O(n),O(r),O(s),O(l),O(i),O(c)),De(t,e),_(f,e),h&&h.d(e),u=!1,d()}}}function Qn(e){let t;return{c(){t=A("Please wait, fetching chapters...")},m(e,n){C(e,t,n)},d(e){e&&O(t)}}}function er(e){let t,n,r=e[12].title+"";return{c(){t=D("p"),n=A(r),P(t,"class","valid small svelte-1rrnlr6")},m(e,r){C(e,t,r),k(t,n)},p(e,t){2&t&&r!==(r=e[12].title+"")&&j(n,r)},d(e){e&&O(t)}}}function tr(e){let t,n=e[12]&&!0===e[12].new&&er(e);return{c(){n&&n.c(),t=L()},m(e,r){n&&n.m(e,r),C(e,t,r)},p(e,r){e[12]&&!0===e[12].new?n?n.p(e,r):(n=er(e),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(e){e&&O(t),n&&n.d(e)}}}function nr(t){let n,r,o=t[3],s=rr(t);return{c(){s.c(),n=L()},m(e,t){s.m(e,t),C(e,n,t),r=!0},p(t,r){8&r&&l(o,o=t[3])?(he(),$e(s,1,1,e),me(),s=rr(t),s.c(),ge(s,1),s.m(n.parentNode,n)):s.p(t,r)},i(e){r||(ge(s),r=!0)},o(e){$e(s),r=!1},d(e){e&&O(n),s.d(e)}}}function rr(e){let t,n;return t=new kt({props:{error:e[3]}}),{c(){Oe(t.$$.fragment)},m(e,r){_e(t,e,r),n=!0},p(e,n){const r={};8&n&&(r.error=e[3]),t.$set(r)},i(e){n||(ge(t.$$.fragment,e),n=!0)},o(e){$e(t.$$.fragment,e),n=!1},d(e){De(t,e)}}}function or(e){let t,n,r,o={ctx:e,current:null,token:null,hasCatch:!1,pending:Zn,then:Wn,catch:qn,value:15,blocks:[,,,]};return ye(n=e[4],o),{c(){t=L(),o.block.c()},m(e,n){C(e,t,n),o.block.m(e,o.anchor=n),o.mount=()=>t.parentNode,o.anchor=t,r=!0},p(t,[r]){e=t,o.ctx=e,16&r&&n!==(n=e[4])&&ye(n,o)||we(o,e,r)},i(e){r||(ge(o.block),r=!0)},o(e){for(let e=0;e<3;e+=1)$e(o.blocks[e]);r=!1},d(e){e&&O(t),o.block.d(e),o.token=null,o=null}}}function sr(e,t,n){let r,o,s;c(e,kn,(e=>n(5,r=e))),c(e,En,(e=>n(10,o=e))),c(e,Ye,(e=>n(11,s=e)));let{stage:l}=t;if(!r)throw new Error("Inconsistent state, expected to have book data");let i=[...r.chapters.map((e=>Object.assign(Object.assign({},e),{new:!1})))],a=!1,u=[];const d=async()=>{let e,t=i;for(n(1,i=new Array(i.length)),n(3,u=[]),e=0;e<t.length&&!a;e+=10)await Promise.all(t.slice(e,e+10).map((async(r,l)=>{var c,a;if(n(1,i[l+e]=Object.assign({},t[l+e]),i),!1!==r.needsFetching)try{const t=await Nt(r.apiUrl,new URL(o.series.url).origin),u=await Vt(o.series,t);if(!t.ok)throw""+(null!==(a=null!==(c=u.message)&&void 0!==c?c:t.statusText)&&void 0!==a?a:t.status);n(1,i[l+e]=Object.assign(Object.assign({},on(s,Jt(o.series.type,u,r.apiUrl))),{new:!0}),i),n(1,i)}catch(e){u.push(e),n(3,u)}})));for(;e<t.length;e++)n(1,i[e]=Object.assign({},t[e]),i);return Object.assign(Object.assign({},r),{chapters:i})};let p=d();return e.$$set=e=>{"stage"in e&&n(0,l=e.stage)},[l,i,a,u,p,r,d,()=>n(2,a=!0),()=>n(4,p=d()),()=>l.next({...r,chapters:i})]}const lr=class extends Re{constructor(e){super(),Ne(this,e,sr,or,l,{stage:0})}};function ir(e,t,n){const r=e.slice();return r[15]=t[n],r}function cr(e){let t,n;return t=new kt({props:{error:e[19],retry:e[10],back:e[11]}}),{c(){Oe(t.$$.fragment)},m(e,r){_e(t,e,r),n=!0},p(e,n){const r={};16&n&&(r.error=e[19]),16&n&&(r.retry=e[10]),71&n&&(r.back=e[11]),t.$set(r)},i(e){n||(ge(t.$$.fragment,e),n=!0)},o(e){$e(t.$$.fragment,e),n=!1},d(e){De(t,e)}}}function ar(t){let n,r=t[0].next(t[18],t[1].length)+"";return{c(){n=A(r)},m(e,t){C(e,n,t)},p(e,t){19&t&&r!==(r=e[0].next(e[18],e[1].length)+"")&&j(n,r)},i:e,o:e,d(e){e&&O(n)}}}function ur(e){let t,n,r,l,i,c,a,u,d,p;t=new Ct({props:{$$slots:{default:[dr]},$$scope:{ctx:e}}});let f=xe(e[1]),m=[];for(let t=0;t<f.length;t+=1)m[t]=pr(ir(e,f,t));return{c(){Oe(t.$$.fragment),n=R(),r=D("div");for(let e=0;e<m.length;e+=1)m[e].c();i=R(),c=D("button"),a=A("Cancel"),P(r,"class","chapters"),c.disabled=e[3]},m(o,s){_e(t,o,s),C(o,n,s),C(o,r,s);for(let e=0;e<m.length;e+=1)m[e]&&m[e].m(r,null);C(o,i,s),C(o,c,s),k(c,a),u=!0,d||(p=[h(l=e[8].call(null,r,{newchapters:e[1],scroll:e[5]})),I(c,"click",F(e[9]))],d=!0)},p(e,n){const o={};if(1048576&n&&(o.$$scope={dirty:n,ctx:e}),t.$set(o),2&n){let t;for(f=xe(e[1]),t=0;t<f.length;t+=1){const o=ir(e,f,t);m[t]?m[t].p(o,n):(m[t]=pr(o),m[t].c(),m[t].m(r,null))}for(;t<m.length;t+=1)m[t].d(1);m.length=f.length}l&&s(l.update)&&34&n&&l.update.call(null,{newchapters:e[1],scroll:e[5]}),(!u||8&n)&&(c.disabled=e[3])},i(e){u||(ge(t.$$.fragment,e),u=!0)},o(e){$e(t.$$.fragment,e),u=!1},d(e){e&&(O(n),O(r),O(i),O(c)),De(t,e),_(m,e),d=!1,o(p)}}}function dr(e){let t;return{c(){t=A("Please wait, fetching chapters...")},m(e,n){C(e,t,n)},d(e){e&&O(t)}}}function pr(e){let t,n,r,o,s,l,i=e[15].from+"",c=e[15].url+"";return{c(){t=D("p"),n=A(i),r=A(": Found "),o=D("a"),s=A(c),P(o,"href",l=e[15].url),P(t,"class","valid small svelte-tsai6h")},m(e,l){C(e,t,l),k(t,n),k(t,r),k(t,o),k(o,s)},p(e,t){2&t&&i!==(i=e[15].from+"")&&j(n,i),2&t&&c!==(c=e[15].url+"")&&j(s,c),2&t&&l!==(l=e[15].url)&&P(o,"href",l)},d(e){e&&O(t)}}}function fr(e){let t,n,r,o={ctx:e,current:null,token:null,hasCatch:!0,pending:ur,then:ar,catch:cr,value:18,error:19,blocks:[,,,]};return ye(n=e[4],o),{c(){t=L(),o.block.c()},m(e,n){C(e,t,n),o.block.m(e,o.anchor=n),o.mount=()=>t.parentNode,o.anchor=t,r=!0},p(t,[r]){e=t,o.ctx=e,16&r&&n!==(n=e[4])&&ye(n,o)||we(o,e,r)},i(e){r||(ge(o.block),r=!0)},o(e){for(let e=0;e<3;e+=1)$e(o.blocks[e]);r=!1},d(e){e&&O(t),o.block.d(e),o.token=null,o=null}}}function hr(e,t,n){let r,o,s;c(e,kn,(e=>n(6,r=e))),c(e,En,(e=>n(12,o=e))),c(e,Ye,(e=>n(13,s=e)));let{stage:l}=t;if(!r)throw new Error("Inconsistent state, expected to have book data");let i,a=[],u=!1;const d=async()=>{var e,t,l,c,d,p;for(n(2,i=r.chapters.map((e=>Object.assign({},e))));!u;){let r=i[i.length-1];if(!1!==r.needsFetching){const n=await Nt(r.apiUrl,new URL(o.series.url).origin),l=await Vt(o.series,n);if(!n.ok)throw""+(null!==(t=null!==(e=l.message)&&void 0!==e?e:n.statusText)&&void 0!==t?t:n.status);i.splice(-1,1,r=on(s,Jt(o.series.type,l,r.apiUrl)))}let u=en(s,null!==(l=r.transformedContent)&&void 0!==l?l:"");if(u||(u=en(s,null!==(c=r.content)&&void 0!==c?c:"")),!u)break;const f=Xt(o.series.type,u);if(i.find((e=>e.apiUrl===f)))break;a.push({from:r.title,url:u}),n(1,a);const h=await Nt(f,new URL(o.series.url).origin),m=await Vt(o.series,h);if(!h.ok)throw""+(null!==(p=null!==(d=m.message)&&void 0!==d?d:h.statusText)&&void 0!==p?p:h.status);i.push(on(s,Jt(o.series.type,m,f)))}return Object.assign(Object.assign({},r),{chapters:i})};let p=d(),f=!0;function h(){const e=document.documentElement.scrollHeight-document.documentElement.scrollTop;n(5,f=Math.abs(document.documentElement.clientHeight-e)<1)}return window.addEventListener("scroll",h),V((()=>{window.removeEventListener("scroll",h)})),e.$$set=e=>{"stage"in e&&n(0,l=e.stage)},[l,a,i,u,p,f,r,d,(e,t)=>({update:({scroll:e})=>{e&&document.querySelector("footer").scrollIntoView()}}),()=>n(3,u=!0),()=>n(4,p=d()),()=>l.next({...r,chapters:i},a.length)]}const mr=class extends Re{constructor(e){super(),Ne(this,e,hr,fr,l,{stage:0})}},gr="finalize",$r="consider";function vr(e,t,n){e.dispatchEvent(new CustomEvent(gr,{detail:{items:t,info:n}}))}function br(e,t,n){e.dispatchEvent(new CustomEvent($r,{detail:{items:t,info:n}}))}const yr="draggedEntered",wr="draggedLeft",xr="draggedOverIndex",Er="draggedLeftDocument",kr={LEFT_FOR_ANOTHER:"leftForAnother",OUTSIDE_OF_ANY:"outsideOfAny"};function Tr(e,t,n){e.dispatchEvent(new CustomEvent(yr,{detail:{indexObj:t,draggedEl:n}}))}function Sr(e,t,n){e.dispatchEvent(new CustomEvent(wr,{detail:{draggedEl:t,type:kr.LEFT_FOR_ANOTHER,theOtherDz:n}}))}function Cr(e,t,n){e.dispatchEvent(new CustomEvent(xr,{detail:{indexObj:t,draggedEl:n}}))}const Or={DRAG_STARTED:"dragStarted",DRAGGED_ENTERED:yr,DRAGGED_ENTERED_ANOTHER:"dragEnteredAnother",DRAGGED_OVER_INDEX:xr,DRAGGED_LEFT:wr,DRAGGED_LEFT_ALL:"draggedLeftAll",DROPPED_INTO_ZONE:"droppedIntoZone",DROPPED_INTO_ANOTHER:"droppedIntoAnother",DROPPED_OUTSIDE_OF_ANY:"droppedOutsideOfAny",DRAG_STOPPED:"dragStopped"},_r={POINTER:"pointer",KEYBOARD:"keyboard"},Dr="isDndShadowItem",Nr="data-is-dnd-shadow-item-internal",Ar="data-is-dnd-shadow-item-hint",Rr="id:dnd-shadow-placeholder-0000",Lr="dnd-action-dragged-el";let Ir="id",Fr=0;function Ur(){Fr++}function Pr(){if(0===Fr)throw new Error("Bug! trying to decrement when there are no dropzones");Fr--}const jr="undefined"==typeof window;let Mr,Gr=()=>{};function zr(e){let t;const n=e.getBoundingClientRect(),r=getComputedStyle(e),o=r.transform;if(o){let s,l,i,c;if(o.startsWith("matrix3d("))t=o.slice(9,-1).split(/, /),s=+t[0],l=+t[5],i=+t[12],c=+t[13];else{if(!o.startsWith("matrix("))return n;t=o.slice(7,-1).split(/, /),s=+t[0],l=+t[3],i=+t[4],c=+t[5]}const a=r.transformOrigin,u=n.x-i-(1-s)*parseFloat(a),d=n.y-c-(1-l)*parseFloat(a.slice(a.indexOf(" ")+1)),p=s?n.width/s:e.offsetWidth,f=l?n.height/l:e.offsetHeight;return{x:u,y:d,width:p,height:f,top:d,right:u+p,bottom:d+f,left:u}}return n}function Hr(e){const t=zr(e);return{top:t.top+window.scrollY,bottom:t.bottom+window.scrollY,left:t.left+window.scrollX,right:t.right+window.scrollX}}function Br(e){const t=e.getBoundingClientRect();return{top:t.top+window.scrollY,bottom:t.bottom+window.scrollY,left:t.left+window.scrollX,right:t.right+window.scrollX}}function qr(e){return{x:(e.left+e.right)/2,y:(e.top+e.bottom)/2}}function Wr(e,t){return e.y<=t.bottom&&e.y>=t.top&&e.x>=t.left&&e.x<=t.right}function Yr(e){return qr(Br(e))}function Kr(e,t){return Wr(Yr(e),Hr(t))}function Xr(){Gr((()=>"resetting indexes cache")),Mr=new Map}function Vr(e,t){if(!Kr(e,t))return null;const n=t.children;if(0===n.length)return{index:0,isProximityBased:!0};const r=function(e){const t=Array.from(e.children).findIndex((e=>e.getAttribute(Nr)));if(t>=0)return Mr.has(e)||Mr.set(e,new Map),Mr.get(e).set(t,Hr(e.children[t])),t}(t);for(let o=0;o<n.length;o++)if(Kr(e,n[o])){const n=Mr.has(t)&&Mr.get(t).get(o);return n&&!Wr(Yr(e),n)?{index:r,isProximityBased:!1}:{index:o,isProximityBased:!1}}let o,s=Number.MAX_VALUE;for(let t=0;t<n.length;t++){const r=(l=e,i=n[t],c=void 0,a=void 0,c=Yr(l),a=Yr(i),Math.sqrt(Math.pow(c.x-a.x,2)+Math.pow(c.y-a.y,2)));r<s&&(s=r,o=t)}var l,i,c,a;return{index:o,isProximityBased:!0}}function Jr(e){return JSON.stringify(e,null,2)}function Zr(e){if(!e)throw new Error("cannot get depth of a falsy node");return Qr(e,0)}function Qr(e,t=0){return e.parentElement?Qr(e.parentElement,t+1):t-1}Xr();const eo=200,to=10;let no;const ro=30;function oo(){let e;function t(){e={directionObj:void 0,stepPx:0}}function n(t){const{directionObj:r,stepPx:o}=e;r&&(t.scrollBy(r.x*o,r.y*o),window.requestAnimationFrame((()=>n(t))))}function r(e){return ro-e}return t(),{scrollIfNeeded:function(o,s){if(!s)return!1;const l=function(e,t){const n=t===document.scrollingElement?{top:0,bottom:window.innerHeight,left:0,right:window.innerWidth}:t.getBoundingClientRect();return Wr(e,n)?{top:e.y-n.top,bottom:n.bottom-e.y,left:e.x-n.left,right:n.right-e.x}:null}(o,s),i=!!e.directionObj;if(null===l)return i&&t(),!1;let[c,a]=[!1,!1];return s.scrollHeight>s.clientHeight&&(l.bottom<ro?(c=!0,e.directionObj={x:0,y:1},e.stepPx=r(l.bottom)):l.top<ro&&(c=!0,e.directionObj={x:0,y:-1},e.stepPx=r(l.top)),!i&&c)||s.scrollWidth>s.clientWidth&&(l.right<ro?(a=!0,e.directionObj={x:1,y:0},e.stepPx=r(l.right)):l.left<ro&&(a=!0,e.directionObj={x:-1,y:0},e.stepPx=r(l.left)),!i&&a)?(n(s),!0):(t(),!1)},resetScrolling:t}}function so(e){if(!e)return[];const t=[];let n=e;for(;n;){const{overflow:e}=window.getComputedStyle(n);e.split(" ").some((e=>e.includes("auto")||e.includes("scroll")))&&t.push(n),n=n.parentElement}return t}const lo=Object.freeze({USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT:"USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT"}),io={[lo.USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT]:!1};function co(e){if(!lo[e])throw new Error(`Can't get non existing feature flag ${e}! Supported flags: ${Object.keys(lo)}`);return io[e]}const ao=.2;function uo(e){return`${e} ${ao}s ease`}function po(e,t,n,r){fo(t,e);const o=t.getBoundingClientRect(),s=e.getBoundingClientRect(),l=o.width-s.width,i=o.height-s.height;if(l||i){const t={left:(n-s.left)/s.width,top:(r-s.top)/s.height};co(lo.USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT)||(e.style.height=`${o.height}px`,e.style.width=`${o.width}px`),e.style.left=parseFloat(e.style.left)-t.left*l+"px",e.style.top=parseFloat(e.style.top)-t.top*i+"px"}}function fo(e,t){const n=window.getComputedStyle(e);Array.from(n).filter((e=>e.startsWith("background")||e.startsWith("padding")||e.startsWith("font")||e.startsWith("text")||e.startsWith("align")||e.startsWith("justify")||e.startsWith("display")||e.startsWith("flex")||e.startsWith("border")||"opacity"===e||"color"===e||"list-style-type"===e||co(lo.USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT)&&("width"===e||"height"===e))).forEach((e=>t.style.setProperty(e,n.getPropertyValue(e),n.getPropertyPriority(e))))}function ho(e,t){e.draggable=!1,e.ondragstart=()=>!1,t?(e.style.userSelect="",e.style.WebkitUserSelect="",e.style.cursor=""):(e.style.userSelect="none",e.style.WebkitUserSelect="none",e.style.cursor="grab")}function mo(e){e.style.display="none",e.style.position="fixed",e.style.zIndex="-5"}function go(e,t=()=>{},n=()=>[]){e.forEach((e=>{const r=t(e);Object.keys(r).forEach((t=>{e.style[t]=r[t]})),n(e).forEach((t=>e.classList.add(t)))}))}function $o(e,t=()=>{},n=()=>[]){e.forEach((e=>{const r=t(e);Object.keys(r).forEach((t=>{e.style[t]=""})),n(e).forEach((t=>e.classList.contains(t)&&e.classList.remove(t)))}))}const vo="--any--",bo=100,yo=20,wo=3,xo={outline:"rgba(255, 255, 102, 0.7) solid 2px"},Eo="data-is-dnd-original-dragged-item";let ko,To,So,Co,Oo,_o,Do,No,Ao,Ro,Lo,Io,Fo=!1,Uo=!1,Po=!1,jo=[];const Mo=new Map,Go=new Map,zo=new WeakMap;function Ho(e,t){Mo.get(t).delete(e),Pr(),0===Mo.get(t).size&&Mo.delete(t)}function Bo(e){return e.findIndex((e=>!!e[Dr]))}function qo(e){Gr((()=>["dragged entered",e.currentTarget,e.detail]));let{items:t,dropFromOthersDisabled:n}=Go.get(e.currentTarget);if(n&&e.currentTarget!==Oo)return void Gr((()=>"ignoring dragged entered because drop is currently disabled"));if(Po=!1,t=t.filter((e=>e[Ir]!==Do[Ir])),Gr((()=>`dragged entered items ${Jr(t)}`)),Oo!==e.currentTarget){const e=Go.get(Oo).items.filter((e=>!e[Dr]));br(Oo,e,{trigger:Or.DRAGGED_ENTERED_ANOTHER,id:So[Ir],source:_r.POINTER})}const{index:r,isProximityBased:o}=e.detail.indexObj,s=o&&r===e.currentTarget.children.length-1?r+1:r;No=e.currentTarget,t.splice(s,0,Do),br(e.currentTarget,t,{trigger:Or.DRAGGED_ENTERED,id:So[Ir],source:_r.POINTER})}function Wo(e){if(!Fo)return;Gr((()=>["dragged left",e.currentTarget,e.detail]));const{items:t,dropFromOthersDisabled:n}=Go.get(e.currentTarget);if(n&&e.currentTarget!==Oo&&e.currentTarget!==No)return void Gr((()=>"drop is currently disabled"));const r=[...t],o=Bo(r);-1!==o&&r.splice(o,1);const s=No;No=void 0;const{type:l,theOtherDz:i}=e.detail;if(l===kr.OUTSIDE_OF_ANY||l===kr.LEFT_FOR_ANOTHER&&i!==Oo&&Go.get(i).dropFromOthersDisabled){Gr((()=>"dragged left all, putting shadow element back in the origin dz")),Po=!0,No=Oo;const e=s===Oo?r:[...Go.get(Oo).items];e.splice(_o,0,Do),br(Oo,e,{trigger:Or.DRAGGED_LEFT_ALL,id:So[Ir],source:_r.POINTER})}br(e.currentTarget,r,{trigger:Or.DRAGGED_LEFT,id:So[Ir],source:_r.POINTER})}function Yo(e){Gr((()=>["dragged is over index",e.currentTarget,e.detail]));const{items:t,dropFromOthersDisabled:n}=Go.get(e.currentTarget);if(n&&e.currentTarget!==Oo)return void Gr((()=>"drop is currently disabled"));const r=[...t];Po=!1;const{index:o}=e.detail.indexObj,s=Bo(r);-1!==s&&r.splice(s,1),r.splice(o,0,Do),br(e.currentTarget,r,{trigger:Or.DRAGGED_OVER_INDEX,id:So[Ir],source:_r.POINTER})}function Ko(e){e.preventDefault();const t=e.touches?e.touches[0]:e;Ro={x:t.clientX,y:t.clientY},To.style.transform=`translate3d(${Ro.x-Ao.x}px, ${Ro.y-Ao.y}px, 0)`}function Xo(){Gr((()=>"dropped")),Uo=!0,window.removeEventListener("mousemove",Ko),window.removeEventListener("touchmove",Ko),window.removeEventListener("mouseup",Xo),window.removeEventListener("touchend",Xo),function(){Gr((()=>"unwatching dragged element"));const e=Mo.get(Co);for(const t of e)t.removeEventListener(yr,qo),t.removeEventListener(wr,Wo),t.removeEventListener(xr,Yo);window.removeEventListener(Er,Xo),Io.destroy(),Io=void 0,Gr((()=>"unobserving")),clearTimeout(no),Xr()}(),function(e){e.style.cursor="grab"}(To),No||(Gr((()=>"element was dropped right after it left origin but before entering somewhere else")),No=Oo),Gr((()=>["dropped in dz",No]));let{items:e,type:t}=Go.get(No);$o(Mo.get(t),(e=>Go.get(e).dropTargetStyle),(e=>Go.get(e).dropTargetClasses));let n=Bo(e);-1===n&&No===Oo&&(n=_o),e=e.map((e=>e[Dr]?So:e)),function(e,t){const n=zr(e>-1?No.children[e]:No),r=n.left-parseFloat(To.style.left),o=n.top-parseFloat(To.style.top),{dropAnimationDurationMs:s}=Go.get(No),l=`transform ${s}ms ease`;To.style.transition=To.style.transition?To.style.transition+","+l:l,To.style.transform=`translate3d(${r}px, ${o}px, 0)`,window.setTimeout(t,s)}(n,(function(){var t;Lo(),vr(No,e,{trigger:Po?Or.DROPPED_OUTSIDE_OF_ANY:Or.DROPPED_INTO_ZONE,id:So[Ir],source:_r.POINTER}),No!==Oo&&vr(Oo,Go.get(Oo).items,{trigger:Or.DROPPED_INTO_ANOTHER,id:So[Ir],source:_r.POINTER}),-1!==n&&((t=No.children[n]).style.visibility="",t.removeAttribute(Nr)),To.remove(),ko.remove(),jo.length&&(Gr((()=>["will destroy zones that were removed during drag",jo])),jo.forEach((({dz:e,destroy:t})=>{t(),e.remove()})),jo=[]),To=void 0,ko=void 0,So=void 0,Co=void 0,Oo=void 0,_o=void 0,Do=void 0,No=void 0,Ao=void 0,Ro=void 0,Fo=!1,Uo=!1,Lo=void 0,Po=!1}))}function Vo(e,t){let n=!1;const r={items:void 0,type:void 0,flipDurationMs:0,dragDisabled:!1,morphDisabled:!1,dropFromOthersDisabled:!1,dropTargetStyle:xo,dropTargetClasses:[],transformDraggedElement:()=>{},centreDraggedOnCursor:!1};Gr((()=>[`dndzone good to go options: ${Jr(t)}, config: ${Jr(r)}`,{node:e}]));let o=new Map;function s(){window.removeEventListener("mousemove",i),window.removeEventListener("touchmove",i),window.removeEventListener("mouseup",l),window.removeEventListener("touchend",l)}function l(e){s(),ko=void 0,Ao=void 0,Ro=void 0,"touchend"===e.type&&e.target.click()}function i(e){e.preventDefault();const t=e.touches?e.touches[0]:e;Ro={x:t.clientX,y:t.clientY},(Math.abs(Ro.x-Ao.x)>=wo||Math.abs(Ro.y-Ao.y)>=wo)&&(s(),function(){Gr((()=>[`drag start config: ${Jr(r)}`,ko])),Fo=!0;const e=o.get(ko);_o=e,Oo=ko.parentElement;const t=Oo.closest("dialog")||Oo.getRootNode(),n=t.body||t,{items:s,type:l,centreDraggedOnCursor:i}=r,c=[...s];So=c[e],Co=l,Do=function(e){return{...e,[Dr]:!0,[Ir]:Rr}}(So),To=function(e,t){const n=e.getBoundingClientRect(),r=function(e){const t=e.cloneNode(!0),n=[],r="SELECT"===e.tagName,o=r?[e]:[...e.querySelectorAll("select")];for(const e of o)n.push(e.value);if(o.length>0){const e=r?[t]:[...t.querySelectorAll("select")];for(let t=0;t<e.length;t++){const r=e[t],o=n[t],s=r.querySelector(`option[value="${o}"`);s&&s.setAttribute("selected",!0)}}const s="CANVAS"===e.tagName,l=s?[e]:[...e.querySelectorAll("canvas")];if(l.length>0){const e=s?[t]:[...t.querySelectorAll("canvas")];for(let t=0;t<e.length;t++){const n=l[t],r=e[t];r.width=n.width,r.height=n.height,n.width>0&&n.height>0&&r.getContext("2d").drawImage(n,0,0)}}return t}(e);fo(e,r),r.id=Lr,r.style.position="fixed";let o=n.top,s=n.left;if(r.style.top=`${o}px`,r.style.left=`${s}px`,t){const e=qr(n);o-=e.y-t.y,s-=e.x-t.x,window.setTimeout((()=>{r.style.top=`${o}px`,r.style.left=`${s}px`}),0)}return r.style.margin="0",r.style.boxSizing="border-box",r.style.height=`${n.height}px`,r.style.width=`${n.width}px`,r.style.transition=`${uo("top")}, ${uo("left")}, ${uo("background-color")}, ${uo("opacity")}, ${uo("color")} `,window.setTimeout((()=>r.style.transition+=`, ${uo("width")}, ${uo("height")}`),0),r.style.zIndex="9999",r.style.cursor="grabbing",r}(ko,i&&Ro),ko.setAttribute(Eo,!0),window.requestAnimationFrame((function e(){To.parentElement?window.requestAnimationFrame(e):(n.appendChild(To),To.focus(),function(){Gr((()=>"watching dragged element"));const e=Mo.get(Co);for(const t of e)t.addEventListener(yr,qo),t.addEventListener(wr,Wo),t.addEventListener(xr,Yo);window.addEventListener(Er,Xo);const t=Math.max(...Array.from(e.keys()).map((e=>Go.get(e).dropAnimationDurationMs))),n=0===t?yo:Math.max(t,bo);Io=function(e=[],t){Gr((()=>"creating multi-scroller"));const n=function(e){const t=new Set;for(let n of e)so(n).forEach((e=>t.add(e)));return(document.scrollingElement.scrollHeight>document.scrollingElement.clientHeight||document.scrollingElement.scrollWidth>document.scrollingElement.clientHeight)&&t.add(document.scrollingElement),t}(e),r=Array.from(n).sort(((e,t)=>Zr(t)-Zr(e))),{scrollIfNeeded:o,resetScrolling:s}=oo();return{multiScrollIfNeeded:n.size>0?function(){const e=t();if(!e||!r)return!1;const n=r.filter((t=>Wr(e,t.getBoundingClientRect())||t===document.scrollingElement));for(let t=0;t<n.length;t++)if(o(e,n[t]))return!0;return!1}:()=>!1,destroy:()=>s()}}(e,(()=>Ro)),function(e,t,n=eo,r){let o,s,l,i=!1;const c=Array.from(t).sort(((e,t)=>Zr(t)-Zr(e)));!function t(){const a=Yr(e),u=r.multiScrollIfNeeded();if(!u&&l&&Math.abs(l.x-a.x)<to&&Math.abs(l.y-a.y)<to)return void(no=window.setTimeout(t,n));if(function(e){const t=Br(e);return t.right<0||t.left>document.documentElement.scrollWidth||t.bottom<0||t.top>document.documentElement.scrollHeight}(e))return Gr((()=>"off document")),void function(e){window.dispatchEvent(new CustomEvent(Er,{detail:{draggedEl:e}}))}(e);l=a;let d=!1;for(const t of c){u&&Xr();const n=Vr(e,t);if(null===n)continue;const{index:r}=n;d=!0,t!==o?(o&&Sr(o,e,t),Tr(t,n,e),o=t):r!==s&&(Cr(t,n,e),s=r);break}!d&&i&&o?(function(e,t){e.dispatchEvent(new CustomEvent(wr,{detail:{draggedEl:t,type:kr.OUTSIDE_OF_ANY}}))}(o,e),o=void 0,s=void 0,i=!1):i=!0,no=window.setTimeout(t,n)}()}(To,e,1.07*n,Io)}(),mo(ko),n.appendChild(ko),Do[Ir]=So[Ir])})),go(Array.from(Mo.get(r.type)).filter((e=>e===Oo||!Go.get(e).dropFromOthersDisabled)),(e=>Go.get(e).dropTargetStyle),(e=>Go.get(e).dropTargetClasses)),c.splice(e,1,Do),Lo=function(e){const t=e.style.minHeight;e.style.minHeight=window.getComputedStyle(e).getPropertyValue("height");const n=e.style.minWidth;return e.style.minWidth=window.getComputedStyle(e).getPropertyValue("width"),function(){e.style.minHeight=t,e.style.minWidth=n}}(Oo),br(Oo,c,{trigger:Or.DRAG_STARTED,id:So[Ir],source:_r.POINTER}),window.addEventListener("mousemove",Ko,{passive:!1}),window.addEventListener("touchmove",Ko,{passive:!1,capture:!1}),window.addEventListener("mouseup",Xo,{passive:!1}),window.addEventListener("touchend",Xo,{passive:!1})}())}function c(e){if(e.target!==e.currentTarget&&(void 0!==e.target.value||e.target.isContentEditable))return void Gr((()=>"won't initiate drag on a nested input element"));if(e.button)return void Gr((()=>`ignoring none left click button: ${e.button}`));if(Fo)return void Gr((()=>"cannot start a new drag before finalizing previous one"));e.preventDefault(),e.stopPropagation();const t=e.touches?e.touches[0]:e;Ao={x:t.clientX,y:t.clientY},Ro={...Ao},ko=e.currentTarget,window.addEventListener("mousemove",i,{passive:!1}),window.addEventListener("touchmove",i,{passive:!1,capture:!1}),window.addEventListener("mouseup",l,{passive:!1}),window.addEventListener("touchend",l,{passive:!1})}function a({items:t,flipDurationMs:s=0,type:l=vo,dragDisabled:i=!1,morphDisabled:a=!1,dropFromOthersDisabled:u=!1,dropTargetStyle:d=xo,dropTargetClasses:p=[],transformDraggedElement:f=()=>{},centreDraggedOnCursor:h=!1}){function m(e,t){return Go.get(e)?Go.get(e)[t]:r[t]}var g,$;r.dropAnimationDurationMs=s,r.type&&l!==r.type&&Ho(e,r.type),r.type=l,r.items=[...t],r.dragDisabled=i,r.morphDisabled=a,r.transformDraggedElement=f,r.centreDraggedOnCursor=h,!n||!Fo||Uo||function(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(!{}.hasOwnProperty.call(t,n)||t[n]!==e[n])return!1;return!0}(d,r.dropTargetStyle)&&function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}(p,r.dropTargetClasses)||($o([e],(()=>r.dropTargetStyle),(()=>p)),go([e],(()=>d),(()=>p))),r.dropTargetStyle=d,r.dropTargetClasses=[...p],n&&Fo&&r.dropFromOthersDisabled!==u&&(u?$o([e],(e=>m(e,"dropTargetStyle")),(e=>m(e,"dropTargetClasses"))):go([e],(e=>m(e,"dropTargetStyle")),(e=>m(e,"dropTargetClasses")))),r.dropFromOthersDisabled=u,Go.set(e,r),g=e,$=l,Gr((()=>"registering drop-zone if absent")),Mo.has($)||Mo.set($,new Set),Mo.get($).has(g)||(Mo.get($).add(g),Ur());const v=Bo(r.items);for(let t=0;t<e.children.length;t++){const s=e.children[t];ho(s,i),t!==v?(s.removeEventListener("mousedown",zo.get(s)),s.removeEventListener("touchstart",zo.get(s)),i||(s.addEventListener("mousedown",c),s.addEventListener("touchstart",c),zo.set(s,c)),o.set(s,t),n||(n=!0)):(a||po(To,s,Ro.x,Ro.y),r.transformDraggedElement(To,So,t),(b=s).style.visibility="hidden",b.setAttribute(Nr,"true"))}var b}return a(t),{update:e=>{Gr((()=>`pointer dndzone will update newOptions: ${Jr(e)}`)),a(e)},destroy:()=>{function t(){Gr((()=>"pointer dndzone will destroy")),Ho(e,Go.get(e).type),Go.delete(e)}var n,r;Fo&&!e.closest(`[${Eo}]`)?(Gr((()=>"pointer dndzone will be scheduled for destruction")),n=e,r=t,jo.push({dz:n,destroy:r}),window.requestAnimationFrame((()=>{mo(n),document.body.appendChild(n)}))):t()}}}const Jo={DND_ZONE_ACTIVE:"dnd-zone-active",DND_ZONE_DRAG_DISABLED:"dnd-zone-drag-disabled"},Zo={[Jo.DND_ZONE_ACTIVE]:"Tab to one the items and press space-bar or enter to start dragging it",[Jo.DND_ZONE_DRAG_DISABLED]:"This is a disabled drag and drop list"},Qo="dnd-action-aria-alert";let es;function ts(){es||(es=document.createElement("div"),es.id=Qo,es.style.position="fixed",es.style.bottom="0",es.style.left="0",es.style.zIndex="-5",es.style.opacity="0",es.style.height="0",es.style.width="0",es.setAttribute("role","alert"),document.body.prepend(es),Object.entries(Zo).forEach((([e,t])=>document.body.prepend(function(e,t){const n=document.createElement("div");return n.id=e,n.innerHTML=`<p>${t}</p>`,n.style.display="none",n.style.position="fixed",n.style.zIndex="-5",n}(e,t)))))}function ns(e){if(jr)return;es||ts(),es.innerHTML="";const t=document.createTextNode(e);es.appendChild(t),es.style.display="none",es.style.display="inline"}const rs="--any--",os={outline:"rgba(255, 255, 102, 0.7) solid 2px"};let ss,ls,is,cs,as=!1,us="",ds="";const ps=new WeakSet,fs=new WeakMap,hs=new WeakMap,ms=new Map,gs=new Map,$s=new Map;let vs;function bs(e,t){Gr((()=>"unregistering drop-zone")),ls===e&&ks(),$s.get(t).delete(e),Pr(),0===$s.get(t).size&&$s.delete(t),0===$s.size&&(Gr((()=>"removing global keydown and click handlers")),window.removeEventListener("keydown",ys),window.removeEventListener("click",ws),vs=void 0,!jr&&es&&(Object.keys(Zo).forEach((e=>document.getElementById(e)?.remove())),es.remove(),es=void 0))}function ys(e){as&&"Escape"===e.key&&ks()}function ws(){as&&(ps.has(document.activeElement)||(Gr((()=>"clicked outside of any draggable")),ks()))}function xs(e){if(Gr((()=>"zone focus")),!as)return;const t=e.currentTarget;if(t===ls)return;us=t.getAttribute("aria-label")||"";const{items:n}=gs.get(ls),r=n.find((e=>e[Ir]===cs)),o=n.indexOf(r),s=n.splice(o,1)[0],{items:l,autoAriaDisabled:i}=gs.get(t);t.getBoundingClientRect().top<ls.getBoundingClientRect().top||t.getBoundingClientRect().left<ls.getBoundingClientRect().left?(l.push(s),i||ns(`Moved item ${ds} to the end of the list ${us}`)):(l.unshift(s),i||ns(`Moved item ${ds} to the beginning of the list ${us}`)),vr(ls,n,{trigger:Or.DROPPED_INTO_ANOTHER,id:cs,source:_r.KEYBOARD}),vr(t,l,{trigger:Or.DROPPED_INTO_ZONE,id:cs,source:_r.KEYBOARD}),ls=t}function Es(){ms.forEach((({update:e},t)=>e(gs.get(t))))}function ks(e=!0){Gr((()=>"drop")),gs.get(ls).autoAriaDisabled||ns(`Stopped dragging item ${ds}`),ps.has(document.activeElement)&&document.activeElement.blur(),e&&br(ls,gs.get(ls).items,{trigger:Or.DRAG_STOPPED,id:cs,source:_r.KEYBOARD}),$o($s.get(ss),(e=>gs.get(e).dropTargetStyle),(e=>gs.get(e).dropTargetClasses)),is=null,cs=null,ds="",ss=null,ls=null,us="",as=!1,Es()}function Ts(e,t){const n={items:void 0,type:void 0,dragDisabled:!1,zoneTabIndex:0,zoneItemTabIndex:0,dropFromOthersDisabled:!1,dropTargetStyle:os,dropTargetClasses:[],autoAriaDisabled:!1};function r(e,t,n){e.length<=1||e.splice(n,1,e.splice(t,1,e[n])[0])}function o(t){switch(Gr((()=>["handling key down",t.key])),t.key){case"Enter":case" ":if((void 0!==t.target.disabled||t.target.href||t.target.isContentEditable)&&!ps.has(t.target))return;t.preventDefault(),t.stopPropagation(),as?ks():s(t);break;case"ArrowDown":case"ArrowRight":{if(!as)return;t.preventDefault(),t.stopPropagation();const{items:o}=gs.get(e),s=Array.from(e.children),l=s.indexOf(t.currentTarget);Gr((()=>["arrow down",l])),l<s.length-1&&(n.autoAriaDisabled||ns(`Moved item ${ds} to position ${l+2} in the list ${us}`),r(o,l,l+1),vr(e,o,{trigger:Or.DROPPED_INTO_ZONE,id:cs,source:_r.KEYBOARD}));break}case"ArrowUp":case"ArrowLeft":{if(!as)return;t.preventDefault(),t.stopPropagation();const{items:o}=gs.get(e),s=Array.from(e.children).indexOf(t.currentTarget);Gr((()=>["arrow up",s])),s>0&&(n.autoAriaDisabled||ns(`Moved item ${ds} to position ${s} in the list ${us}`),r(o,s,s-1),vr(e,o,{trigger:Or.DROPPED_INTO_ZONE,id:cs,source:_r.KEYBOARD}));break}}}function s(t){Gr((()=>"drag start")),function(t){const{items:r}=gs.get(e),o=Array.from(e.children),s=o.indexOf(t);is=t,is.tabIndex=n.zoneItemTabIndex,cs=r[s][Ir],ds=o[s].getAttribute("aria-label")||""}(t.currentTarget),ls=e,ss=n.type,as=!0;const r=Array.from($s.get(n.type)).filter((e=>e===ls||!gs.get(e).dropFromOthersDisabled));if(go(r,(e=>gs.get(e).dropTargetStyle),(e=>gs.get(e).dropTargetClasses)),!n.autoAriaDisabled){let e=`Started dragging item ${ds}. Use the arrow keys to move it within its list ${us}`;r.length>1&&(e+=", or tab to another list in order to move the item into it"),ns(e)}br(e,gs.get(e).items,{trigger:Or.DRAG_STARTED,id:cs,source:_r.KEYBOARD}),Es()}function l(e){as&&e.currentTarget!==is&&(e.stopPropagation(),ks(!1),s(e))}function i({items:t=[],type:r=rs,dragDisabled:s=!1,zoneTabIndex:i=0,zoneItemTabIndex:c=0,dropFromOthersDisabled:a=!1,dropTargetStyle:u=os,dropTargetClasses:d=[],autoAriaDisabled:p=!1}){var f,h;n.items=[...t],n.dragDisabled=s,n.dropFromOthersDisabled=a,n.zoneTabIndex=i,n.zoneItemTabIndex=c,n.dropTargetStyle=u,n.dropTargetClasses=d,n.autoAriaDisabled=p,n.type&&r!==n.type&&bs(e,n.type),n.type=r,f=e,h=r,Gr((()=>"registering drop-zone if absent")),0===$s.size&&(Gr((()=>"adding global keydown and click handlers")),vs=jr?null:("complete"===document.readyState?ts():window.addEventListener("DOMContentLoaded",ts),{...Jo}),window.addEventListener("keydown",ys),window.addEventListener("click",ws)),$s.has(h)||$s.set(h,new Set),$s.get(h).has(f)||($s.get(h).add(f),Ur()),p||(e.setAttribute("aria-disabled",s),e.setAttribute("role","list"),e.setAttribute("aria-describedby",s?vs.DND_ZONE_DRAG_DISABLED:vs.DND_ZONE_ACTIVE)),gs.set(e,n),e.tabIndex=as?e===ls||is.contains(e)||n.dropFromOthersDisabled||ls&&n.type!==gs.get(ls).type?-1:0:n.zoneTabIndex,e.addEventListener("focus",xs);for(let t=0;t<e.children.length;t++){const r=e.children[t];ps.add(r),r.tabIndex=as?-1:n.zoneItemTabIndex,p||r.setAttribute("role","listitem"),r.removeEventListener("keydown",fs.get(r)),r.removeEventListener("click",hs.get(r)),s||(r.addEventListener("keydown",o),fs.set(r,o),r.addEventListener("click",l),hs.set(r,l)),as&&n.items[t][Ir]===cs&&(Gr((()=>["focusing on",{i:t,focusedItemId:cs}])),is=r,is.tabIndex=n.zoneItemTabIndex,r.focus())}}i(t);const c={update:e=>{Gr((()=>`keyboard dndzone will update newOptions: ${Jr(e)}`)),i(e)},destroy:()=>{Gr((()=>"keyboard dndzone will destroy")),bs(e,n.type),gs.delete(e),ms.delete(e)}};return ms.set(e,c),c}function Ss(e,t){if(function(e){return!!e.closest(`[${Ar}="true"]`)}(e))return{update:()=>{},destroy:()=>{}};Cs(t);const n=Vo(e,t),r=Ts(e,t);return{update:e=>{Cs(e),n.update(e),r.update(e)},destroy:()=>{n.destroy(),r.destroy()}}}function Cs(e){const{items:t,flipDurationMs:n,type:r,dragDisabled:o,morphDisabled:s,dropFromOthersDisabled:l,zoneTabIndex:i,zoneItemTabIndex:c,dropTargetStyle:a,dropTargetClasses:u,transformDraggedElement:d,autoAriaDisabled:p,centreDraggedOnCursor:f,...h}=e;if(Object.keys(h).length>0&&console.warn("dndzone will ignore unknown options",h),!t)throw new Error("no 'items' key provided to dndzone");const m=t.find((e=>!{}.hasOwnProperty.call(e,Ir)));if(m)throw new Error(`missing '${Ir}' property for item ${Jr(m)}`);if(u&&!Array.isArray(u))throw new Error(`dropTargetClasses should be an array but instead it is a ${typeof u}, ${Jr(u)}`);if(i&&!Os(i))throw new Error(`zoneTabIndex should be a number but instead it is a ${typeof i}, ${Jr(i)}`);if(c&&!Os(c))throw new Error(`zoneItemTabIndex should be a number but instead it is a ${typeof c}, ${Jr(c)}`)}function Os(e){return!isNaN(e)&&(0|(t=parseFloat(e)))===t;var t}function _s(e,{delay:n=0,duration:r=400,easing:o=t}={}){const s=+getComputedStyle(e).opacity;return{delay:n,duration:r,easing:o,css:e=>"opacity: "+e*s}}function Ds(e,{delay:t=0,duration:n=400,easing:r=At,x:o=0,y:s=0,opacity:l=0}={}){const i=getComputedStyle(e),c=+i.opacity,a="none"===i.transform?"":i.transform,u=c*(1-l),[d,p]=m(o),[f,h]=m(s);return{delay:t,duration:n,easing:r,css:(e,t)=>`\n\t\t\ttransform: ${a} translate(${(1-e)*d}${p}, ${(1-e)*f}${h});\n\t\t\topacity: ${c-u*t}`}}new Set;const Ns=["Activate","AddUndo","BeforeAddUndo","BeforeExecCommand","BeforeGetContent","BeforeRenderUI","BeforeSetContent","BeforePaste","Blur","Change","ClearUndos","Click","CommentChange","CompositionEnd","CompositionStart","CompositionUpdate","ContextMenu","Copy","Cut","Dblclick","Deactivate","Dirty","Drag","DragDrop","DragEnd","DragGesture","DragOver","Drop","ExecCommand","Focus","FocusIn","FocusOut","GetContent","Hide","Init","Input","KeyDown","KeyPress","KeyUp","LoadContent","MouseDown","MouseEnter","MouseLeave","MouseMove","MouseOut","MouseOver","MouseUp","NodeChange","ObjectResizeStart","ObjectResized","ObjectSelected","Paste","PostProcess","PostRender","PreProcess","ProgressState","Redo","Remove","Reset","ResizeEditor","SaveContent","SelectionChange","SetAttrib","SetContent","Show","Submit","Undo","VisualAid"];function As(e){let t;return{c(){var n,r;t=D("textarea"),P(t,"id",e[0]),n=t,r="visibility",null=="hidden"?n.style.removeProperty(r):n.style.setProperty(r,"hidden","")},m(n,r){C(n,t,r),e[19](t)},p(e,n){1&n&&P(t,"id",e[0])},d(n){n&&O(t),e[19](null)}}}function Rs(e){let t;return{c(){t=D("div"),P(t,"id",e[0])},m(n,r){C(n,t,r),e[18](t)},p(e,n){1&n&&P(t,"id",e[0])},d(n){n&&O(t),e[18](null)}}}function Ls(t){let n;function r(e,t){return e[1]?Rs:As}let o=r(t),s=o(t);return{c(){n=D("div"),s.c(),P(n,"class",t[2])},m(e,r){C(e,n,r),s.m(n,null),t[20](n)},p(e,[t]){o===(o=r(e))&&s?s.p(e,t):(s.d(1),s=o(e),s&&(s.c(),s.m(n,null))),4&t&&P(n,"class",e[2])},i:e,o:e,d(e){e&&O(n),s.d(),t[20](null)}}}const Is=e=>e+"_"+Math.floor(1e9*Math.random())+String(Date.now());let Fs=(()=>{let e={listeners:[],scriptId:Is("tiny-script"),scriptLoaded:!1,injected:!1};return{load:(t,n,r)=>{e.scriptLoaded?r():(e.listeners.push(r),e.injected||((t,n,r)=>{e.injected=!0;const o=n.createElement("script");o.referrerPolicy="origin",o.type="application/javascript",o.src=r,o.onload=()=>{e.listeners.forEach((e=>e())),e.scriptLoaded=!0},n.head&&n.head.appendChild(o)})(e.scriptId,t,n))}}})();function Us(e,t,n){var r;let o,s,l,{id:c=Is("tinymce-svelte")}=t,{inline:a}=t,{disabled:u=!1}=t,{apiKey:d="no-api-key"}=t,{licenseKey:p}=t,{channel:f="7"}=t,{scriptSrc:h}=t,{conf:m={}}=t,{modelEvents:g="change input undo redo"}=t,{value:$=""}=t,{text:v=""}=t,{cssClass:b="tinymce-wrapper"}=t,y=$,w=u;const x=function(){const e=K();return(t,n,{cancelable:r=!1}={})=>{const o=e.$$.callbacks[t];if(o){const s=z(t,n,{cancelable:r});return o.slice().forEach((t=>{t.call(e,s)})),!s.defaultPrevented}return!0}}(),E=()=>{const e="undefined"!=typeof window?window:i.g;return e&&e.tinymce?e.tinymce:null},k=()=>{const e=Object.assign(Object.assign({},m),{target:s,inline:void 0!==a?a:void 0!==m.inline&&m.inline,readonly:u,license_key:p,setup:e=>{n(15,l=e),e.on("init",(()=>{e.setContent($),e.on(g,(()=>{n(16,y=e.getContent()),y!==$&&(n(5,$=y),n(6,v=e.getContent({format:"text"})))}))})),((e,t)=>{Ns.forEach((n=>{e.on(n,(r=>{t(n.toLowerCase(),{eventName:n,event:r,editor:e})}))}))})(e,x),"function"==typeof m.setup&&m.setup(e)}});n(4,s.style.visibility="",s),E().init(e)};return X((()=>{if(null!==E())setTimeout(k,0);else{const e=h||`https://cdn.tiny.cloud/1/${d}/tinymce/${f}/tinymce.min.js`;Fs.load(o.ownerDocument,e,(()=>{k()}))}})),V((()=>{var e;l&&(null===(e=E())||void 0===e||e.remove(l))})),e.$$set=e=>{"id"in e&&n(0,c=e.id),"inline"in e&&n(1,a=e.inline),"disabled"in e&&n(7,u=e.disabled),"apiKey"in e&&n(8,d=e.apiKey),"licenseKey"in e&&n(9,p=e.licenseKey),"channel"in e&&n(10,f=e.channel),"scriptSrc"in e&&n(11,h=e.scriptSrc),"conf"in e&&n(12,m=e.conf),"modelEvents"in e&&n(13,g=e.modelEvents),"value"in e&&n(5,$=e.value),"text"in e&&n(6,v=e.text),"cssClass"in e&&n(2,b=e.cssClass)},e.$$.update=()=>{245920&e.$$.dirty&&(l&&y!==$&&(l.setContent($),n(6,v=l.getContent({format:"text"}))),l&&u!==w&&(n(17,w=u),"function"==typeof(null===n(14,r=l.mode)||void 0===r?void 0:r.set)?l.mode.set(u?"readonly":"design"):l.setMode(u?"readonly":"design")))},[c,a,b,o,s,$,v,u,d,p,f,h,m,g,r,l,y,w,function(e){Q[e?"unshift":"push"]((()=>{s=e,n(4,s)}))},function(e){Q[e?"unshift":"push"]((()=>{s=e,n(4,s)}))},function(e){Q[e?"unshift":"push"]((()=>{o=e,n(3,o)}))}]}const Ps=class extends Re{constructor(e){super(),Ne(this,e,Us,Ls,l,{id:0,inline:1,disabled:7,apiKey:8,licenseKey:9,channel:10,scriptSrc:11,conf:12,modelEvents:13,value:5,text:6,cssClass:2})}};function js(t){let n,r,o;return{c(){n=N("svg"),r=N("g"),o=N("path"),P(o,"d","M38,52a2,2,0,0,1-1.41-.59l-24-24a2,2,0,0,1,0-2.82l24-24a2,2,0,0,1,2.82,0,2,2,0,0,1,0,2.82L16.83,26,39.41,48.59A2,2,0,0,1,38,52Z"),P(n,"version","1.1"),P(n,"xmlns","http://www.w3.org/2000/svg"),P(n,"xmlns:xlink","http://www.w3.org/1999/xlink"),P(n,"x","0px"),P(n,"y","0px"),P(n,"viewBox","0 0 52 52"),P(n,"xml:space","preserve")},m(e,t){C(e,n,t),k(n,r),k(r,o)},p:e,i:e,o:e,d(e){e&&O(n)}}}const Ms=class extends Re{constructor(e){super(),Ne(this,e,null,js,l,{})}};function Gs(t){let n,r;return{c(){n=N("svg"),r=N("polygon"),P(r,"points","0,490 490,490 245,0"),P(n,"version","1.1"),P(n,"xmlns","http://www.w3.org/2000/svg"),P(n,"xmlns:xlink","http://www.w3.org/1999/xlink"),P(n,"x","0px"),P(n,"y","0px"),P(n,"viewBox","0 0 490 490"),P(n,"xml:space","preserve")},m(e,t){C(e,n,t),k(n,r)},p:e,i:e,o:e,d(e){e&&O(n)}}}const zs=class extends Re{constructor(e){super(),Ne(this,e,null,Gs,l,{})}};function Hs(e){let t,n,r,l,i,c,a,u,d,p,f,h,m;return r=new zs({}),a=new zs({}),{c(){t=D("div"),n=D("a"),Oe(r.$$.fragment),l=A(" move up"),i=R(),c=D("a"),Oe(a.$$.fragment),u=A(" move down"),d=R(),p=D("a"),p.textContent="remove",P(n,"href","#up"),P(n,"class","small up svelte-1uea1m1"),G(n,"control-disabled",!e[0]),P(c,"href","#dowm"),P(c,"class","small down svelte-1uea1m1"),G(c,"control-disabled",!e[1]),P(p,"href","#remove"),P(p,"class","small remove svelte-1uea1m1"),G(p,"control-disabled",!e[2]),P(t,"class","controls svelte-1uea1m1")},m(o,g){C(o,t,g),k(t,n),_e(r,n,null),k(n,l),k(t,i),k(t,c),_e(a,c,null),k(c,u),k(t,d),k(t,p),f=!0,h||(m=[I(n,"click",U(F((function(){s(e[0])&&e[0].apply(this,arguments)})))),I(c,"click",U(F((function(){s(e[1])&&e[1].apply(this,arguments)})))),I(p,"click",U(F((function(){s(e[2])&&e[2].apply(this,arguments)}))))],h=!0)},p(t,[r]){e=t,(!f||1&r)&&G(n,"control-disabled",!e[0]),(!f||2&r)&&G(c,"control-disabled",!e[1]),(!f||4&r)&&G(p,"control-disabled",!e[2])},i(e){f||(ge(r.$$.fragment,e),ge(a.$$.fragment,e),f=!0)},o(e){$e(r.$$.fragment,e),$e(a.$$.fragment,e),f=!1},d(e){e&&O(t),De(r),De(a),h=!1,o(m)}}}function Bs(e,t,n){let{moveUp:r}=t,{moveDown:o}=t,{remove:s}=t;return e.$$set=e=>{"moveUp"in e&&n(0,r=e.moveUp),"moveDown"in e&&n(1,o=e.moveDown),"remove"in e&&n(2,s=e.remove)},[r,o,s]}const qs=class extends Re{constructor(e){super(),Ne(this,e,Bs,Hs,l,{moveUp:0,moveDown:1,remove:2})}};function Ws(e){let t,n,r,s,l,i;return{c(){t=D("div"),n=D("span"),n.textContent="URL",r=R(),s=D("span"),P(n,"class","label svelte-1bcq7l1"),P(s,"class","url svelte-1bcq7l1"),P(s,"aria-label","URL"),P(s,"contenteditable",""),P(s,"role","textbox"),P(s,"tabindex","0"),void 0===e[3]&&oe((()=>e[14].call(s))),P(t,"class","field svelte-1bcq7l1")},m(o,c){C(o,t,c),k(t,n),k(t,r),k(t,s),void 0!==e[3]&&(s.innerText=e[3]),l||(i=[I(s,"input",e[14]),I(s,"keydown",e[11])],l=!0)},p(e,t){8&t&&e[3]!==s.innerText&&(s.innerText=e[3])},d(e){e&&O(t),l=!1,o(i)}}}function Ys(t){let n,r,o,s;return{c(){n=D("textarea"),n.disabled=r=t[2]&&t[4],P(n,"class","svelte-1bcq7l1")},m(e,r){C(e,n,r),M(n,t[1]),o||(s=I(n,"input",t[16]),o=!0)},p(e,t){20&t&&r!==(r=e[2]&&e[4])&&(n.disabled=r),2&t&&M(n,e[1])},i:e,o:e,d(e){e&&O(n),o=!1,s()}}}function Ks(e){let t,n,r;function o(t){e[15](t)}let s={disabled:e[2]&&e[4],apiKey:"okcf1pz4foebbixgcdydveaavknj41e62etldhxguuyug0v3",conf:e[12]};return void 0!==e[1]&&(s.value=e[1]),t=new Ps({props:s}),Q.push((()=>Ce(t,"value",o))),{c(){Oe(t.$$.fragment)},m(e,n){_e(t,e,n),r=!0},p(e,r){const o={};20&r&&(o.disabled=e[2]&&e[4]),!n&&2&r&&(n=!0,o.value=e[1],se((()=>n=!1))),t.$set(o)},i(e){r||(ge(t.$$.fragment,e),r=!0)},o(e){$e(t.$$.fragment,e),r=!1},d(e){De(t,e)}}}function Xs(e){let t,n,r,o,s;return{c(){t=D("label"),n=D("input"),r=A(" Fetch contents"),P(n,"type","checkbox"),P(n,"class","svelte-1bcq7l1"),P(t,"class","svelte-1bcq7l1")},m(l,i){C(l,t,i),k(t,n),n.checked=e[2],k(t,r),o||(s=I(n,"change",e[17]),o=!0)},p(e,t){4&t&&(n.checked=e[2])},d(e){e&&O(t),o=!1,s()}}}function Vs(e){let t,n,r,o;return r=new qs({props:{moveUp:e[6],moveDown:e[7],remove:e[8]}}),{c(){t=D("span"),n=R(),Oe(r.$$.fragment)},m(e,s){C(e,t,s),C(e,n,s),_e(r,e,s),o=!0},p(e,t){const n={};64&t&&(n.moveUp=e[6]),128&t&&(n.moveDown=e[7]),256&t&&(n.remove=e[8]),r.$set(n)},i(e){o||(ge(r.$$.fragment,e),o=!0)},o(e){$e(r.$$.fragment,e),o=!1},d(e){e&&(O(t),O(n)),De(r,e)}}}function Js(e){let t,n,r,l,i,c,a,u,d,p,f,h,m,g,$,v,b,y,w,x;r=new Ms({});let E=void 0!==e[3]&&Ws(e);const T=[Ks,Ys],S=[];function _(e,t){return e[10].useTiny?0:1}m=_(e),g=S[m]=T[m](e);let N=e[4]&&Xs(e),U=!e[9]&&Vs(e);return{c(){t=D("h3"),n=D("a"),Oe(r.$$.fragment),l=A(" back"),i=R(),c=D("div"),a=D("div"),u=D("span"),u.textContent="Title",d=R(),p=D("span"),f=R(),E&&E.c(),h=R(),g.c(),$=R(),N&&N.c(),v=R(),U&&U.c(),b=L(),P(n,"href","#home"),P(n,"class","homelink svelte-1bcq7l1"),P(t,"class","back svelte-1bcq7l1"),P(u,"class","label svelte-1bcq7l1"),P(p,"class","title svelte-1bcq7l1"),P(p,"aria-label","Title"),P(p,"contenteditable",""),P(p,"role","textbox"),P(p,"tabindex","0"),void 0===e[0]&&oe((()=>e[13].call(p))),P(a,"class","field svelte-1bcq7l1"),P(c,"class","chapter edit svelte-1bcq7l1")},m(o,g){C(o,t,g),k(t,n),_e(r,n,null),k(n,l),C(o,i,g),C(o,c,g),k(c,a),k(a,u),k(a,d),k(a,p),void 0!==e[0]&&(p.innerText=e[0]),k(c,f),E&&E.m(c,null),k(c,h),S[m].m(c,null),k(c,$),N&&N.m(c,null),C(o,v,g),U&&U.m(o,g),C(o,b,g),y=!0,w||(x=[I(n,"click",F((function(){s(e[5])&&e[5].apply(this,arguments)}))),I(p,"input",e[13]),I(p,"keydown",e[11])],w=!0)},p(t,n){e=t,1&n&&e[0]!==p.innerText&&(p.innerText=e[0]),void 0!==e[3]?E?E.p(e,n):(E=Ws(e),E.c(),E.m(c,h)):E&&(E.d(1),E=null);let r=m;m=_(e),m===r?S[m].p(e,n):(he(),$e(S[r],1,1,(()=>{S[r]=null})),me(),g=S[m],g?g.p(e,n):(g=S[m]=T[m](e),g.c()),ge(g,1),g.m(c,$)),e[4]?N?N.p(e,n):(N=Xs(e),N.c(),N.m(c,null)):N&&(N.d(1),N=null),e[9]?U&&(he(),$e(U,1,1,(()=>{U=null})),me()):U?(U.p(e,n),512&n&&ge(U,1)):(U=Vs(e),U.c(),ge(U,1),U.m(b.parentNode,b))},i(e){y||(ge(r.$$.fragment,e),ge(g),ge(U),y=!0)},o(e){$e(r.$$.fragment,e),$e(g),$e(U),y=!1},d(e){e&&(O(t),O(i),O(c),O(v),O(b)),De(r),E&&E.d(),S[m].d(),N&&N.d(),U&&U.d(e),w=!1,o(x)}}}function Zs(e){let t,n;return t=new Fe({props:{onSubmit:e[5],$$slots:{default:[Js]},$$scope:{ctx:e}}}),{c(){Oe(t.$$.fragment)},m(e,r){_e(t,e,r),n=!0},p(e,[n]){const r={};32&n&&(r.onSubmit=e[5]),264191&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(ge(t.$$.fragment,e),n=!0)},o(e){$e(t.$$.fragment,e),n=!1},d(e){De(t,e)}}}function Qs(e,t,n){let r;c(e,Ye,(e=>n(10,r=e)));let{title:o}=t,{content:s}=t,{needsFetching:l}=t,{url:i}=t,{canFetch:a=!1}=t,{close:u}=t,{moveUp:d}=t,{moveDown:p}=t,{remove:f}=t,{hideControls:h=!1}=t;return l=null==l||l,s=null!=s?s:"",e.$$set=e=>{"title"in e&&n(0,o=e.title),"content"in e&&n(1,s=e.content),"needsFetching"in e&&n(2,l=e.needsFetching),"url"in e&&n(3,i=e.url),"canFetch"in e&&n(4,a=e.canFetch),"close"in e&&n(5,u=e.close),"moveUp"in e&&n(6,d=e.moveUp),"moveDown"in e&&n(7,p=e.moveDown),"remove"in e&&n(8,f=e.remove),"hideControls"in e&&n(9,h=e.hideControls)},[o,s,l,i,a,u,d,p,f,h,r,e=>{"Enter"!==e.key&&13!==e.keyCode||e.preventDefault()},{plugins:"code",toolbar:"undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | outdent indent | code"},function(){o=this.innerText,n(0,o)},function(){i=this.innerText,n(3,i)},function(e){s=e,n(1,s)},function(){s=this.value,n(1,s)},function(){l=this.checked,n(2,l)}]}const el=class extends Re{constructor(e){super(),Ne(this,e,Qs,Zs,l,{title:0,content:1,needsFetching:2,url:3,canFetch:4,close:5,moveUp:6,moveDown:7,remove:8,hideControls:9})}};function tl(e){let t,n;return{c(){t=D("span"),n=A(e[5]),P(t,"class","content svelte-1peomaw")},m(e,r){C(e,t,r),k(t,n)},p(e,t){32&t&&j(n,e[5])},d(e){e&&O(t)}}}function nl(e){let t,n,r,l,i,c,a,u,d,p,f,h,m,g=!e[6]&&tl(e);return p=new qs({props:{moveUp:e[2],moveDown:e[3],remove:e[4]}}),{c(){t=D("div"),n=D("div"),r=D("span"),l=A(e[0]),i=R(),g&&g.c(),c=R(),a=D("a"),a.textContent="×",u=R(),d=D("div"),Oe(p.$$.fragment),P(r,"class","title svelte-1peomaw"),P(r,"aria-label","Title"),P(a,"class","small remove svelte-1peomaw"),P(a,"href","#remove"),P(n,"class","preview svelte-1peomaw"),G(n,"empty",e[6]),P(d,"class","more svelte-1peomaw"),P(t,"class","chapter svelte-1peomaw"),P(t,"tabindex","0"),P(t,"title",e[0]),P(t,"role","button")},m(o,$){C(o,t,$),k(t,n),k(n,r),k(r,l),k(n,i),g&&g.m(n,null),k(n,c),k(n,a),k(t,u),k(t,d),_e(p,d,null),f=!0,h||(m=[I(a,"click",F((function(){s(e[4])&&e[4].apply(this,arguments)}))),I(t,"click",(function(){s(e[1])&&e[1].apply(this,arguments)})),I(t,"keydown",e[7]),I(t,"contextmenu",F(e[9]))],h=!0)},p(r,[o]){e=r,(!f||1&o)&&j(l,e[0]),e[6]?g&&(g.d(1),g=null):g?g.p(e,o):(g=tl(e),g.c(),g.m(n,c)),(!f||64&o)&&G(n,"empty",e[6]);const s={};4&o&&(s.moveUp=e[2]),8&o&&(s.moveDown=e[3]),16&o&&(s.remove=e[4]),p.$set(s),(!f||1&o)&&P(t,"title",e[0])},i(e){f||(ge(p.$$.fragment,e),f=!0)},o(e){$e(p.$$.fragment,e),f=!1},d(e){e&&O(t),g&&g.d(),De(p),h=!1,o(m)}}}function rl(e,t,n){let r,{title:o}=t,{content:s}=t,{select:l}=t,{moveUp:i}=t,{moveDown:c}=t,{remove:a}=t;s=null!=s?s:"";let u="";return e.$$set=e=>{"title"in e&&n(0,o=e.title),"content"in e&&n(8,s=e.content),"select"in e&&n(1,l=e.select),"moveUp"in e&&n(2,i=e.moveUp),"moveDown"in e&&n(3,c=e.moveDown),"remove"in e&&n(4,a=e.remove)},e.$$.update=()=>{256&e.$$.dirty&&n(6,r=!s||!s.trim().length),256&e.$$.dirty&&setTimeout((()=>n(5,u=Ft(s||""))),0)},[o,l,i,c,a,u,r,e=>{"Enter"!==e.key&&13!==e.keyCode||l()},s,function(t){J.call(this,e,t)}]}const ol=class extends Re{constructor(e){super(),Ne(this,e,rl,nl,l,{title:0,content:8,select:1,moveUp:2,moveDown:3,remove:4})}};function sl(e){let t,n,r;return{c(){t=D("span"),P(t,"class","edit svelte-r6vfao"),P(t,"contenteditable",""),P(t,"role","textbox"),P(t,"tabindex","0"),void 0===e[0].title&&oe((()=>e[8].call(t)))},m(o,s){C(o,t,s),void 0!==e[0].title&&(t.innerText=e[0].title),n||(r=[I(t,"input",e[8]),I(t,"keydown",e[5])],n=!0)},p(e,n){1&n&&e[0].title!==t.innerText&&(t.innerText=e[0].title)},d(e){e&&O(t),n=!1,o(r)}}}function ll(e){let t,n,r,o=Ft(e[0].title)+"";return{c(){t=D("a"),n=A(o),P(t,"href",r=It(e[2])),P(t,"target","_blank")},m(e,r){C(e,t,r),k(t,n)},p(e,s){1&s&&o!==(o=Ft(e[0].title)+"")&&j(n,o),4&s&&r!==(r=It(e[2]))&&P(t,"href",r)},d(e){e&&O(t)}}}function il(e){let t,n,r;return{c(){t=D("span"),P(t,"class","edit svelte-r6vfao"),P(t,"contenteditable",""),P(t,"role","textbox"),P(t,"tabindex","0"),void 0===e[0].author&&oe((()=>e[9].call(t)))},m(o,s){C(o,t,s),void 0!==e[0].author&&(t.innerText=e[0].author),n||(r=[I(t,"input",e[9]),I(t,"keydown",e[5])],n=!0)},p(e,n){1&n&&e[0].author!==t.innerText&&(t.innerText=e[0].author)},d(e){e&&O(t),n=!1,o(r)}}}function cl(e){let t,n=Ft(e[0].author)+"";return{c(){t=A(n)},m(e,n){C(e,t,n)},p(e,r){1&r&&n!==(n=Ft(e[0].author)+"")&&j(t,n)},d(e){e&&O(t)}}}function al(e){let t,n,r,o,l,i;return{c(){t=D("h3"),t.textContent="Actions",n=R(),r=D("p"),o=D("button"),o.textContent="Transform all"},m(c,a){C(c,t,a),C(c,n,a),C(c,r,a),k(r,o),l||(i=I(o,"click",F((function(){s(e[4])&&e[4].apply(this,arguments)}))),l=!0)},p(t,n){e=t},d(e){e&&(O(t),O(n),O(r)),l=!1,i()}}}function ul(e){let t,n,r,o;const s=e[7].default,l=a(s,e,e[10],null);return{c(){t=D("h3"),t.textContent="Chapters",n=R(),r=D("div"),l&&l.c()},m(e,s){C(e,t,s),C(e,n,s),C(e,r,s),l&&l.m(r,null),o=!0},p(e,t){l&&l.p&&(!o||1024&t)&&p(l,s,e,e[10],o?d(s,e[10],t,null):f(e[10]),null)},i(e){o||(ge(l,e),o=!0)},o(e){$e(l,e),o=!1},d(e){e&&(O(t),O(n),O(r)),l&&l.d(e)}}}function dl(e){let t,n,r,o,s,l,i,c,a,u,d;function p(e,t){return e[1]?sl:ll}let f=p(e),h=f(e);function m(e,t){return e[1]?il:cl}let g=m(e),$=g(e),v=e[1]&&al(e),b=e[6].default&&ul(e);return{c(){t=D("h3"),t.textContent="Title",n=R(),r=D("p"),h.c(),o=R(),s=D("h3"),s.textContent="Author",l=R(),i=D("p"),$.c(),c=R(),v&&v.c(),a=R(),b&&b.c(),u=L()},m(e,p){C(e,t,p),C(e,n,p),C(e,r,p),h.m(r,null),C(e,o,p),C(e,s,p),C(e,l,p),C(e,i,p),$.m(i,null),C(e,c,p),v&&v.m(e,p),C(e,a,p),b&&b.m(e,p),C(e,u,p),d=!0},p(e,t){f===(f=p(e))&&h?h.p(e,t):(h.d(1),h=f(e),h&&(h.c(),h.m(r,null))),g===(g=m(e))&&$?$.p(e,t):($.d(1),$=g(e),$&&($.c(),$.m(i,null))),e[1]?v?v.p(e,t):(v=al(e),v.c(),v.m(a.parentNode,a)):v&&(v.d(1),v=null),e[6].default?b?(b.p(e,t),64&t&&ge(b,1)):(b=ul(e),b.c(),ge(b,1),b.m(u.parentNode,u)):b&&(he(),$e(b,1,1,(()=>{b=null})),me())},i(e){d||(ge(b),d=!0)},o(e){$e(b),d=!1},d(e){e&&(O(t),O(n),O(r),O(o),O(s),O(l),O(i),O(c),O(a),O(u)),h.d(),$.d(),v&&v.d(e),b&&b.d(e)}}}function pl(e){let t,n;return t=new Fe({props:{onSubmit:e[3],$$slots:{default:[dl]},$$scope:{ctx:e}}}),{c(){Oe(t.$$.fragment)},m(e,r){_e(t,e,r),n=!0},p(e,[n]){const r={};8&n&&(r.onSubmit=e[3]),1111&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(ge(t.$$.fragment,e),n=!0)},o(e){$e(t.$$.fragment,e),n=!1},d(e){De(t,e)}}}function fl(e,t,n){let{$$slots:r={},$$scope:o}=t;const s=function(e){const t={};for(const n in e)t[n]=!0;return t}(r);let{edit:l=!1}=t,{data:i}=t,{url:c=""}=t,{onSubmit:a}=t,{onTransformAll:u}=t;return e.$$set=e=>{"edit"in e&&n(1,l=e.edit),"data"in e&&n(0,i=e.data),"url"in e&&n(2,c=e.url),"onSubmit"in e&&n(3,a=e.onSubmit),"onTransformAll"in e&&n(4,u=e.onTransformAll),"$$scope"in e&&n(10,o=e.$$scope)},[i,l,c,a,u,e=>{"Enter"!==e.key&&13!==e.keyCode||e.preventDefault()},s,r,function(){i.title=this.innerText,n(0,i)},function(){i.author=this.innerText,n(0,i)},o]}const hl=class extends Re{constructor(e){super(),Ne(this,e,fl,pl,l,{edit:1,data:0,url:2,onSubmit:3,onTransformAll:4})}};function ml(e,t,n){const r=e.slice();return r[48]=t[n],r}function gl(e,t,n){const r=e.slice();return r[51]=t[n],r[53]=n,r}function $l(e,t){let n,r,o;function s(){return t[20](t[53])}return r=new ol({props:{title:t[51].title,content:t[51].transformedContent,select:s,moveUp:t[2]>0||t[53]>0?t[13].bind(null,t[12](t[53])):void 0,moveDown:t[2]<t[3]||t[53]<t[8].length-1?t[14].bind(null,t[12](t[53])):void 0,remove:t[15].bind(null,t[12](t[53]))}}),{key:e,first:null,c(){n=L(),Oe(r.$$.fragment),this.first=n},m(e,t){C(e,n,t),_e(r,e,t),o=!0},p(e,n){t=e;const o={};256&n[0]&&(o.title=t[51].title),256&n[0]&&(o.content=t[51].transformedContent),272&n[0]&&(o.select=s),260&n[0]&&(o.moveUp=t[2]>0||t[53]>0?t[13].bind(null,t[12](t[53])):void 0),268&n[0]&&(o.moveDown=t[2]<t[3]||t[53]<t[8].length-1?t[14].bind(null,t[12](t[53])):void 0),256&n[0]&&(o.remove=t[15].bind(null,t[12](t[53]))),r.$set(o)},i(e){o||(ge(r.$$.fragment,e),o=!0)},o(e){$e(r.$$.fragment,e),o=!1},d(e){e&&O(n),De(r,e)}}}function vl(e){let t,n,r,l,i,c,a,u,d,p=null!==e[7].pre&&bl(e),f=xe(e[7].pages),h=[];for(let t=0;t<f.length;t+=1)h[t]=yl(ml(e,f,t));let m=null!==e[7].post&&wl(e);return{c(){t=D("nav"),n=D("a"),n.textContent="Previous",r=A("\n          ::\n          "),p&&p.c(),l=R();for(let e=0;e<h.length;e+=1)h[e].c();i=R(),m&&m.c(),c=A("\n          ::\n          "),a=D("a"),a.textContent="Next",P(n,"class","small svelte-138yesn"),P(n,"href","#prevous"),G(n,"disabled",e[2]<=0),P(a,"class","small svelte-138yesn"),P(a,"href","#next"),G(a,"disabled",e[2]>=e[3]),P(t,"class","svelte-138yesn")},m(o,f){C(o,t,f),k(t,n),k(t,r),p&&p.m(t,null),k(t,l);for(let e=0;e<h.length;e+=1)h[e]&&h[e].m(t,null);k(t,i),m&&m.m(t,null),k(t,c),k(t,a),u||(d=[I(n,"click",F((function(){s(e[16].bind(null,e[2]-1))&&e[16].bind(null,e[2]-1).apply(this,arguments)}))),I(a,"click",F((function(){s(e[16].bind(null,e[2]+1))&&e[16].bind(null,e[2]+1).apply(this,arguments)})))],u=!0)},p(r,o){if(e=r,4&o[0]&&G(n,"disabled",e[2]<=0),null!==e[7].pre?p?p.p(e,o):(p=bl(e),p.c(),p.m(t,l)):p&&(p.d(1),p=null),65668&o[0]){let n;for(f=xe(e[7].pages),n=0;n<f.length;n+=1){const r=ml(e,f,n);h[n]?h[n].p(r,o):(h[n]=yl(r),h[n].c(),h[n].m(t,i))}for(;n<h.length;n+=1)h[n].d(1);h.length=f.length}null!==e[7].post?m?m.p(e,o):(m=wl(e),m.c(),m.m(t,c)):m&&(m.d(1),m=null),12&o[0]&&G(a,"disabled",e[2]>=e[3])},d(e){e&&O(t),p&&p.d(),_(h,e),m&&m.d(),u=!1,o(d)}}}function bl(e){let t,n,r,o,l,i,c=e[7].pre+"";return{c(){t=D("a"),n=A(c),o=A("\n            ."),P(t,"class","small svelte-138yesn"),P(t,"href",r=`#page ${e[7].pre}`)},m(r,c){C(r,t,c),k(t,n),C(r,o,c),l||(i=I(t,"click",F((function(){s(e[16].bind(null,e[7].pre-1))&&e[16].bind(null,e[7].pre-1).apply(this,arguments)}))),l=!0)},p(o,s){e=o,128&s[0]&&c!==(c=e[7].pre+"")&&j(n,c),128&s[0]&&r!==(r=`#page ${e[7].pre}`)&&P(t,"href",r)},d(e){e&&(O(t),O(o)),l=!1,i()}}}function yl(e){let t,n,r,o,l,i=e[48]+1+"";return{c(){t=D("a"),n=A(i),P(t,"class","small svelte-138yesn"),P(t,"href",r=`#page ${e[48]+1}`),G(t,"current",e[48]==e[2])},m(r,i){C(r,t,i),k(t,n),o||(l=I(t,"click",F((function(){s(e[16].bind(null,e[48]))&&e[16].bind(null,e[48]).apply(this,arguments)}))),o=!0)},p(o,s){e=o,128&s[0]&&i!==(i=e[48]+1+"")&&j(n,i),128&s[0]&&r!==(r=`#page ${e[48]+1}`)&&P(t,"href",r),132&s[0]&&G(t,"current",e[48]==e[2])},d(e){e&&O(t),o=!1,l()}}}function wl(e){let t,n,r,o,l,i,c=e[7].post+"";return{c(){t=A(".\n            "),n=D("a"),r=A(c),P(n,"class","small svelte-138yesn"),P(n,"href",o=`#page ${e[7].post}`)},m(o,c){C(o,t,c),C(o,n,c),k(n,r),l||(i=I(n,"click",F((function(){s(e[16].bind(null,e[7].post-1))&&e[16].bind(null,e[7].post-1).apply(this,arguments)}))),l=!0)},p(t,s){e=t,128&s[0]&&c!==(c=e[7].post+"")&&j(r,c),128&s[0]&&o!==(o=`#page ${e[7].post}`)&&P(n,"href",o)},d(e){e&&(O(t),O(n)),l=!1,i()}}}function xl(e){let t,n,r,l,i,c,a,u,d,p,f=[],m=new Map,g=xe(e[8]);const $=e=>e[51].id;for(let t=0;t<g.length;t+=1){let n=gl(e,g,t),r=$(n);m.set(r,f[t]=$l(r,n))}let v=e[1].chapters.length>0&&vl(e);return{c(){t=D("div");for(let e=0;e<f.length;e+=1)f[e].c();r=R(),v&&v.c(),l=R(),i=D("button"),i.textContent="Add new",c=R(),a=D("a"),a.textContent="Remove all",P(t,"class","chapters svelte-138yesn"),P(a,"class","small remove svelte-138yesn"),P(a,"href","#clear")},m(o,s){C(o,t,s);for(let e=0;e<f.length;e+=1)f[e]&&f[e].m(t,null);C(o,r,s),v&&v.m(o,s),C(o,l,s),C(o,i,s),C(o,c,s),C(o,a,s),u=!0,d||(p=[h(n=Ss.call(null,t,{items:e[8],flipDurationMs:Cl})),I(t,"consider",e[17]),I(t,"finalize",e[17]),I(i,"click",F(e[21])),I(a,"click",F(e[22]))],d=!0)},p(e,r){61724&r[0]&&(g=xe(e[8]),he(),f=Te(f,r,$,1,e,g,m,t,ke,$l,null,gl),me()),n&&s(n.update)&&256&r[0]&&n.update.call(null,{items:e[8],flipDurationMs:Cl}),e[1].chapters.length>0?v?v.p(e,r):(v=vl(e),v.c(),v.m(l.parentNode,l)):v&&(v.d(1),v=null)},i(e){if(!u){for(let e=0;e<g.length;e+=1)ge(f[e]);u=!0}},o(e){for(let e=0;e<f.length;e+=1)$e(f[e]);u=!1},d(e){e&&(O(t),O(r),O(l),O(i),O(c),O(a));for(let e=0;e<f.length;e+=1)f[e].d();v&&v.d(e),d=!1,o(p)}}}function El(e){let t,n,r,s,l,i,c,a,u,d;function p(t){e[25](t)}function f(t){e[26](t)}function h(t){e[27](t)}function m(t){e[28](t)}let g={canFetch:!!e[5].apiUrl,close:e[24],moveUp:e[2]>0||e[4]>0?e[13].bind(null,e[4]):void 0,moveDown:e[2]<e[3]||e[4]<e[8].length-1?e[14].bind(null,e[4]):void 0,remove:e[15].bind(null,e[4])};return void 0!==e[5].title&&(g.title=e[5].title),void 0!==e[5].transformedContent&&(g.content=e[5].transformedContent),void 0!==e[5].needsFetching&&(g.needsFetching=e[5].needsFetching),void 0!==e[5].displayUrl&&(g.url=e[5].displayUrl),n=new el({props:g}),Q.push((()=>Ce(n,"title",p))),Q.push((()=>Ce(n,"content",f))),Q.push((()=>Ce(n,"needsFetching",h))),Q.push((()=>Ce(n,"url",m))),{c(){t=D("div"),Oe(n.$$.fragment),P(t,"class","svelte-138yesn"),G(t,"float",e[10])},m(r,o){C(r,t,o),_e(n,t,null),a=!0,u||(d=[I(t,"introend",e[29]),I(t,"outrostart",e[30]),I(t,"outroend",e[31])],u=!0)},p(e,o){const c={};32&o[0]&&(c.canFetch=!!e[5].apiUrl),48&o[0]&&(c.close=e[24]),20&o[0]&&(c.moveUp=e[2]>0||e[4]>0?e[13].bind(null,e[4]):void 0),284&o[0]&&(c.moveDown=e[2]<e[3]||e[4]<e[8].length-1?e[14].bind(null,e[4]):void 0),16&o[0]&&(c.remove=e[15].bind(null,e[4])),!r&&32&o[0]&&(r=!0,c.title=e[5].title,se((()=>r=!1))),!s&&32&o[0]&&(s=!0,c.content=e[5].transformedContent,se((()=>s=!1))),!l&&32&o[0]&&(l=!0,c.needsFetching=e[5].needsFetching,se((()=>l=!1))),!i&&32&o[0]&&(i=!0,c.url=e[5].displayUrl,se((()=>i=!1))),n.$set(c),(!a||1024&o[0])&&G(t,"float",e[10])},i(e){a||(ge(n.$$.fragment,e),e&&oe((()=>{a&&(c||(c=be(t,Ds,{x:50,duration:200},!0)),c.run(1))})),a=!0)},o(e){$e(n.$$.fragment,e),e&&(c||(c=be(t,Ds,{x:50,duration:200},!1)),c.run(0)),a=!1},d(e){e&&O(t),De(n),e&&c&&c.end(),u=!1,o(d)}}}function kl(e){let t,n,r,s,l,i,c,a,u,d;function p(t){e[33](t)}function f(t){e[34](t)}function h(t){e[35](t)}function m(t){e[36](t)}let g={canFetch:!!e[6].apiUrl,hideControls:!0,close:e[32]};return void 0!==e[6].title&&(g.title=e[6].title),void 0!==e[6].transformedContent&&(g.content=e[6].transformedContent),void 0!==e[6].needsFetching&&(g.needsFetching=e[6].needsFetching),void 0!==e[6].displayUrl&&(g.url=e[6].displayUrl),n=new el({props:g}),Q.push((()=>Ce(n,"title",p))),Q.push((()=>Ce(n,"content",f))),Q.push((()=>Ce(n,"needsFetching",h))),Q.push((()=>Ce(n,"url",m))),{c(){t=D("div"),Oe(n.$$.fragment),P(t,"class","svelte-138yesn"),G(t,"float",e[10])},m(r,o){C(r,t,o),_e(n,t,null),a=!0,u||(d=[I(t,"introend",e[37]),I(t,"outrostart",e[38]),I(t,"outroend",e[39])],u=!0)},p(e,o){const c={};64&o[0]&&(c.canFetch=!!e[6].apiUrl),66&o[0]&&(c.close=e[32]),!r&&64&o[0]&&(r=!0,c.title=e[6].title,se((()=>r=!1))),!s&&64&o[0]&&(s=!0,c.content=e[6].transformedContent,se((()=>s=!1))),!l&&64&o[0]&&(l=!0,c.needsFetching=e[6].needsFetching,se((()=>l=!1))),!i&&64&o[0]&&(i=!0,c.url=e[6].displayUrl,se((()=>i=!1))),n.$set(c),(!a||1024&o[0])&&G(t,"float",e[10])},i(e){a||(ge(n.$$.fragment,e),e&&oe((()=>{a&&(c||(c=be(t,Ds,{x:50,duration:200},!0)),c.run(1))})),a=!0)},o(e){$e(n.$$.fragment,e),e&&(c||(c=be(t,Ds,{x:50,duration:200},!1)),c.run(0)),a=!1},d(e){e&&O(t),De(n),e&&c&&c.end(),u=!1,o(d)}}}function Tl(e){let t,n,r,s,l,i,c,a,u,d,p,f,h;s=new hl({props:{data:e[1],edit:!0,onSubmit:e[23],onTransformAll:e[19],$$slots:{default:[xl]},$$scope:{ctx:e}}});let m=e[5]&&El(e),g=e[6]&&kl(e);return{c(){t=A("You are editing:\n\n"),n=D("div"),r=D("div"),Oe(s.$$.fragment),l=R(),m&&m.c(),i=R(),g&&g.c(),c=R(),a=D("button"),a.textContent="Save",u=R(),d=D("a"),d.textContent="Cancel",P(r,"class","svelte-138yesn"),G(r,"hide",e[9]),P(n,"class","list svelte-138yesn"),P(a,"type","submit"),P(d,"href","#cancel"),P(d,"class","small")},m(o,$){C(o,t,$),C(o,n,$),k(n,r),_e(s,r,null),k(n,l),m&&m.m(n,null),k(n,i),g&&g.m(n,null),C(o,c,$),C(o,a,$),C(o,u,$),C(o,d,$),p=!0,f||(h=[I(a,"click",e[40]),I(d,"click",F(e[41]))],f=!0)},p(e,t){const o={};2&t[0]&&(o.data=e[1]),3&t[0]&&(o.onSubmit=e[23]),478&t[0]|8388608&t[1]&&(o.$$scope={dirty:t,ctx:e}),s.$set(o),(!p||512&t[0])&&G(r,"hide",e[9]),e[5]?m?(m.p(e,t),32&t[0]&&ge(m,1)):(m=El(e),m.c(),ge(m,1),m.m(n,i)):m&&(he(),$e(m,1,1,(()=>{m=null})),me()),e[6]?g?(g.p(e,t),64&t[0]&&ge(g,1)):(g=kl(e),g.c(),ge(g,1),g.m(n,null)):g&&(he(),$e(g,1,1,(()=>{g=null})),me())},i(e){p||(ge(s.$$.fragment,e),ge(m),ge(g),p=!0)},o(e){$e(s.$$.fragment,e),$e(m),$e(g),p=!1},d(e){e&&(O(t),O(n),O(c),O(a),O(u),O(d)),De(s),m&&m.d(),g&&g.d(),f=!1,o(h)}}}const Sl=50,Cl=200;function Ol(e,t,n){let r,o,s;c(e,Ye,(e=>n(43,r=e))),c(e,En,(e=>n(44,o=e))),c(e,kn,(e=>n(45,s=e)));let{stage:l}=t;if(!s)throw new Error("Inconsistent state, expected to have book data");const i=(a=s,Object.assign(Object.assign({},a),{chapters:a.chapters.map((e=>Object.assign({},e)))}));var a;const u=s;let d,p,f,h,m,g=0,$=-1;const v=e=>e+Sl*g,b=e=>{e.displayUrl&&(o.series.type===Yt.GENERIC?e.apiUrl=e.displayUrl:e.apiUrl=Lt(e.displayUrl))};let y={pre:null,pages:[],post:null},w=!1,x=!0;return e.$$set=e=>{"stage"in e&&n(0,l=e.stage)},e.$$.update=()=>{2&e.$$.dirty[0]&&n(3,p=Math.ceil(u.chapters.length/Sl-1)),6&e.$$.dirty[0]&&n(8,f=u.chapters.slice(g*Sl,(g+1)*Sl)),18&e.$$.dirty[0]&&n(5,h=$>=0?u.chapters[$]:void 0),140&e.$$.dirty[0]&&(n(7,y.pages=((e,t)=>{const n=new Array(t-e+1);for(let r=e;r<=t;r++)n[r-e]=r;return n})(Math.max(0,g-3),Math.min(p,g+3)),y),n(7,y.pre=0!==y.pages[0]?1:null,y),n(7,y.post=y.pages[y.pages.length-1]!==p?p+1:null,y)),32&e.$$.dirty[0]&&h&&b(h),64&e.$$.dirty[0]&&m&&b(m)},[l,u,g,p,$,h,m,y,f,w,x,i,v,e=>{e<1||(e===$&&n(4,--$),u.chapters.splice(e-1,2,u.chapters[e],u.chapters[e-1]),n(1,u))},e=>{e>=u.chapters.length||(e===$&&n(4,++$),u.chapters.splice(e,2,u.chapters[e+1],u.chapters[e]),n(1,u))},e=>{n(4,$=-1),u.chapters.splice(e,1),n(1,u)},e=>{if(g==e){const t=prompt("New page:",""+(g+1)),n=+(t||"");null!==t&&!isNaN(n)&&n>0&&n<=p+1&&(e=n-1)}d=Math.sign(e-g),n(2,g=e)},e=>{(e=>{u.chapters.splice(g*Sl,Sl,...e.detail.items),n(1,u)})(e)},b,()=>{window.confirm("Really continue? This will discard all changes!")&&n(1,u.chapters=sn(r,u.chapters),u)},e=>n(4,$=v(e)),()=>{n(6,m={id:Ot(),title:"",apiUrl:"",displayUrl:""})},()=>n(1,u.chapters=[],u),()=>l.next(u),()=>{b(h),n(4,$=-1)},function(t){e.$$.not_equal(h.title,t)&&(h.title=t,n(5,h),n(4,$),n(1,u))},function(t){e.$$.not_equal(h.transformedContent,t)&&(h.transformedContent=t,n(5,h),n(4,$),n(1,u))},function(t){e.$$.not_equal(h.needsFetching,t)&&(h.needsFetching=t,n(5,h),n(4,$),n(1,u))},function(t){e.$$.not_equal(h.displayUrl,t)&&(h.displayUrl=t,n(5,h),n(4,$),n(1,u))},()=>{n(9,w=!0),n(10,x=!1)},()=>{n(10,x=!0)},()=>{n(9,w=!1)},()=>{if(!m)throw"";b(m),u.chapters.push(m),n(1,u),n(6,m=void 0)},function(t){e.$$.not_equal(m.title,t)&&(m.title=t,n(6,m))},function(t){e.$$.not_equal(m.transformedContent,t)&&(m.transformedContent=t,n(6,m))},function(t){e.$$.not_equal(m.needsFetching,t)&&(m.needsFetching=t,n(6,m))},function(t){e.$$.not_equal(m.displayUrl,t)&&(m.displayUrl=t,n(6,m))},()=>{n(9,w=!0),n(10,x=!1)},()=>{n(10,x=!0)},()=>{n(9,w=!1)},()=>l.next(u),()=>l.next(i)]}const _l=class extends Re{constructor(e){super(),Ne(this,e,Ol,Tl,l,{stage:0},null,[-1,-1])}};function Dl(e,t,n){const r=e.slice();return r[19]=t[n],r}function Nl(e){let t,n,r,o;return t=new kt({props:{error:e[22],retry:e[14]}}),r=new $t({props:{backToSearch:e[2]}}),{c(){Oe(t.$$.fragment),n=R(),Oe(r.$$.fragment)},m(e,s){_e(t,e,s),C(e,n,s),_e(r,e,s),o=!0},p(e,n){const o={};16&n&&(o.error=e[22]),16&n&&(o.retry=e[14]),t.$set(o);const s={};4&n&&(s.backToSearch=e[2]),r.$set(s)},i(e){o||(ge(t.$$.fragment,e),ge(r.$$.fragment,e),o=!0)},o(e){$e(t.$$.fragment,e),$e(r.$$.fragment,e),o=!1},d(e){e&&O(n),De(t,e),De(r,e)}}}function Al(e){let t,n,r,s,l,i,c,a,u,d,p,f,h,m;function g(e,t){return 16&t&&(l=null),null==l&&(l=!!e[18].chapters.find(Bl)),l?Ml:jl}r=new hl({props:{data:e[18],url:e[1].url,$$slots:{default:[Pl]},$$scope:{ctx:e}}});let $=g(e,-1),v=$(e);return p=new $t({props:{backToSearch:e[2]}}),{c(){t=A("Got the following series:\n\n  "),n=D("div"),Oe(r.$$.fragment),s=R(),v.c(),i=R(),c=D("button"),c.textContent="Edit book",a=R(),u=D("button"),u.textContent="Export",d=R(),Oe(p.$$.fragment),P(n,"class","list svelte-1hsynpq")},m(o,l){C(o,t,l),C(o,n,l),_e(r,n,null),C(o,s,l),v.m(o,l),C(o,i,l),C(o,c,l),C(o,a,l),C(o,u,l),C(o,d,l),_e(p,o,l),f=!0,h||(m=[I(c,"click",e[12]),I(u,"click",e[13])],h=!0)},p(e,t){const n={};16&t&&(n.data=e[18]),2&t&&(n.url=e[1].url),8388633&t&&(n.$$scope={dirty:t,ctx:e}),r.$set(n),$===($=g(e,t))&&v?v.p(e,t):(v.d(1),v=$(e),v&&(v.c(),v.m(i.parentNode,i)));const o={};4&t&&(o.backToSearch=e[2]),p.$set(o)},i(e){f||(ge(r.$$.fragment,e),ge(p.$$.fragment,e),f=!0)},o(e){$e(r.$$.fragment,e),$e(p.$$.fragment,e),f=!1},d(e){e&&(O(t),O(n),O(s),O(i),O(c),O(a),O(u),O(d)),De(r),v.d(e),De(p,e),h=!1,o(m)}}}function Rl(e){let t;return{c(){t=A("hide")},m(e,n){C(e,t,n)},d(e){e&&O(t)}}}function Ll(e){let t;return{c(){t=A("show")},m(e,n){C(e,t,n)},d(e){e&&O(t)}}}function Il(e){let t,n,r,o,s,l,i=e[0].newChapters+"";return{c(){t=D("a"),n=A("Found "),r=A(i),o=A(" new"),P(t,"href","#?")},m(i,c){C(i,t,c),k(t,n),k(t,r),k(t,o),s||(l=I(t,"click",F(e[9])),s=!0)},p(e,t){1&t&&i!==(i=e[0].newChapters+"")&&j(r,i)},d(e){e&&O(t),s=!1,l()}}}function Fl(e){let t,n,r,o=[],s=new Map,l=xe(e[18].chapters);const i=e=>e[19].id;for(let t=0;t<l.length;t+=1){let n=Dl(e,l,t),r=i(n);s.set(r,o[t]=Ul(r,n))}return{c(){t=D("div");for(let e=0;e<o.length;e+=1)o[e].c();P(t,"class","chapter-list svelte-1hsynpq")},m(e,n){C(e,t,n);for(let e=0;e<o.length;e+=1)o[e]&&o[e].m(t,null);r=!0},p(e,n){16&n&&(l=xe(e[18].chapters),o=Te(o,n,i,1,e,l,s,t,Ee,Ul,null,Dl))},i(e){r||(e&&oe((()=>{r&&(n||(n=be(t,jt,{},!0)),n.run(1))})),r=!0)},o(e){e&&(n||(n=be(t,jt,{},!1)),n.run(0)),r=!1},d(e){e&&O(t);for(let e=0;e<o.length;e+=1)o[e].d();e&&n&&n.end()}}}function Ul(e,t){let n,r,o,s=Ft(t[19].title)+"";return{key:e,first:null,c(){n=D("a"),r=A(s),P(n,"href",o=t[19].displayUrl),P(n,"target","_blank"),P(n,"class","small"),this.first=n},m(e,t){C(e,n,t),k(n,r)},p(e,l){t=e,16&l&&s!==(s=Ft(t[19].title)+"")&&j(r,s),16&l&&o!==(o=t[19].displayUrl)&&P(n,"href",o)},d(e){e&&O(n)}}}function Pl(e){let t,n,r,s,l,i,c,a,u,d,p,f,h,m,g=e[18].chapters.length+"";function $(e,t){return e[3]?Rl:Ll}let v=$(e),b=v(e),y="number"==typeof e[0].newChapters&&Il(e),w=e[3]&&Fl(e);return{c(){t=D("p"),n=A("Found "),r=A(g),s=R(),l=D("a"),b.c(),i=R(),c=D("span"),a=R(),u=D("button"),u.textContent="Find more",d=R(),y&&y.c(),p=R(),w&&w.c(),f=L(),P(l,"href","#show"),P(l,"class","small"),P(c,"class","spacer svelte-1hsynpq"),P(t,"class","no-margin svelte-1hsynpq")},m(o,g){C(o,t,g),k(t,n),k(t,r),k(t,s),k(t,l),b.m(l,null),k(t,i),k(t,c),k(t,a),k(t,u),k(t,d),y&&y.m(t,null),C(o,p,g),w&&w.m(o,g),C(o,f,g),h||(m=[I(l,"click",F(e[7])),I(u,"click",e[8])],h=!0)},p(e,n){16&n&&g!==(g=e[18].chapters.length+"")&&j(r,g),v!==(v=$(e))&&(b.d(1),b=v(e),b&&(b.c(),b.m(l,null))),"number"==typeof e[0].newChapters?y?y.p(e,n):(y=Il(e),y.c(),y.m(t,null)):y&&(y.d(1),y=null),e[3]?w?(w.p(e,n),8&n&&ge(w,1)):(w=Fl(e),w.c(),ge(w,1),w.m(f.parentNode,f)):w&&(he(),$e(w,1,1,(()=>{w=null})),me())},d(e){e&&(O(t),O(p),O(f)),b.d(),y&&y.d(),w&&w.d(e),h=!1,o(m)}}}function jl(t){let n,r,o;return{c(){n=D("button"),n.textContent="Generate EPUB"},m(e,s){C(e,n,s),r||(o=I(n,"click",t[11]),r=!0)},p:e,d(e){e&&O(n),r=!1,o()}}}function Ml(t){let n,r,o;return{c(){n=D("button"),n.textContent="Fetch chapter contents"},m(e,s){C(e,n,s),r||(o=I(n,"click",t[10]),r=!0)},p:e,d(e){e&&O(n),r=!1,o()}}}function Gl(e){let t,n;return t=new Ct({props:{$$slots:{default:[zl]},$$scope:{ctx:e}}}),{c(){Oe(t.$$.fragment)},m(e,r){_e(t,e,r),n=!0},p(e,n){const r={};8388608&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(ge(t.$$.fragment,e),n=!0)},o(e){$e(t.$$.fragment,e),n=!1},d(e){De(t,e)}}}function zl(e){let t;return{c(){t=A("Please wait, fetching data...")},m(e,n){C(e,t,n)},d(e){e&&O(t)}}}function Hl(e){let t,n,r,o={ctx:e,current:null,token:null,hasCatch:!0,pending:Gl,then:Al,catch:Nl,value:18,error:22,blocks:[,,,]};return ye(n=e[4],o),{c(){t=L(),o.block.c()},m(e,n){C(e,t,n),o.block.m(e,o.anchor=n),o.mount=()=>t.parentNode,o.anchor=t,r=!0},p(t,[r]){e=t,o.ctx=e,16&r&&n!==(n=e[4])&&ye(n,o)||we(o,e,r)},i(e){r||(ge(o.block),r=!0)},o(e){for(let e=0;e<3;e+=1)$e(o.blocks[e]);r=!1},d(e){e&&O(t),o.block.d(e),o.token=null,o=null}}}const Bl=e=>!1!==e.needsFetching&&e.apiUrl;function ql(e,t,n){let r,o,s;c(e,kn,(e=>n(15,r=e))),c(e,En,(e=>n(16,o=e))),c(e,Ye,(e=>n(17,s=e)));let{stage:l}=t,{series:i}=t,{backToSearch:a}=t,u=!1;const d=()=>r?Promise.resolve(r):(async e=>{var t,n,r;const o=await Dt(new URL(e.url)),s=await Vt(e,o);if(!o.ok)throw""+(null!==(n=null!==(t=s.message)&&void 0!==t?t:o.statusText)&&void 0!==n?n:o.status);const l=((e,t)=>{switch(e){case Yt.HFY_SERIES:return(({data:{content_md:e,content_html:t}})=>{var n,r,o,s,l,i;const c=(new DOMParser).parseFromString(Ft(t),"text/html").querySelectorAll("a[href]");return{author:null!==(o=null===(r=null===(n=e.match(/\[\*\*(?:Author\s*[-:]\s*)?([^*\]]+)\*\*\]|A Story By \[(?:\*\*)?([^\]]+?)(?:\*\*)?\]/i))||void 0===n?void 0:n.slice(1).find(Boolean))||void 0===r?void 0:r.trim())&&void 0!==o?o:"unknown",title:null!==(i=null===(l=null===(s=e.match(/##?\s*\*\*(.+)\*\*/))||void 0===s?void 0:s[1])||void 0===l?void 0:l.trim())&&void 0!==i?i:"unknown",chapters:Array.from(c).filter((e=>e.getAttribute("href").match(Mt))).map(((e,t)=>{var n,r;const o=e.getAttribute("href").startsWith("http")?e.getAttribute("href"):`https://www.reddit.com${e.getAttribute("href")}`;return{id:Ot(),title:null!==(r=null===(n=e.textContent)||void 0===n?void 0:n.trim())&&void 0!==r?r:`Chapter ${t}`,apiUrl:Lt(o),displayUrl:o}}))}})(t);case Yt.POST:return(e=>({author:e[0].data.children[0].data.author,title:e[0].data.children[0].data.title,chapters:[Wt(e)]}))(t);case Yt.GENERIC:return(e=>{const t=Ut(e);return{title:t.title,author:"unknown",chapters:Array.from(t.querySelectorAll("ul a, ol a")).map((e=>({displayUrl:e.href,apiUrl:e.href,id:Ot(),title:e.innerHTML})))}})(t)}throw new Error(`Getting data from source type \`${Yt[e]}\` not supported, this should never happen`)})(e.type,s);if(!(null===(r=null==l?void 0:l.chapters)||void 0===r?void 0:r.length))throw new Error("No chapters found");return l})(i).then((e=>{const t=Object.assign(Object.assign({},e),{chapters:sn(s,e.chapters)});return kn.update((()=>t)),t}));let p=d();const f=()=>{if(!r)throw new Error("Inconsistent state, expected to have book data");const e=JSON.stringify({bookData:r,series:o.series});ft()(new Blob([e]),`${Ft(r.author)} - ${Ft(r.title)}.json`,"application/json")};return e.$$set=e=>{"stage"in e&&n(0,l=e.stage),"series"in e&&n(1,i=e.series),"backToSearch"in e&&n(2,a=e.backToSearch)},[l,i,a,u,p,d,f,()=>n(3,u=!u),()=>l.findMore(),()=>n(0,l.newChapters=void 0,l),()=>l.downloadAll(),()=>l.next(),()=>l.edit(),()=>f(),()=>n(4,p=d())]}const Wl=class extends Re{constructor(e){super(),Ne(this,e,ql,Hl,l,{stage:0,series:1,backToSearch:2})}};function Yl(e,t,n){const r=e.slice();return r[7]=t[n],r}function Kl(e){let t,n;return t=new kt({props:{error:e[10],retry:e[5]}}),{c(){Oe(t.$$.fragment)},m(e,r){_e(t,e,r),n=!0},p(e,n){const r={};4&n&&(r.error=e[10]),4&n&&(r.retry=e[5]),t.$set(r)},i(e){n||(ge(t.$$.fragment,e),n=!0)},o(e){$e(t.$$.fragment,e),n=!1},d(e){De(t,e)}}}function Xl(t){let n,r,o,s,l,i,c,a,u=xe(t[6]),d=[];for(let e=0;e<u.length;e+=1)d[e]=Jl(Yl(t,u,e));return{c(){n=D("p"),r=A("The search for '"),o=A(t[1]),s=A("' returned these results:"),l=R(),i=D("ul");for(let e=0;e<d.length;e+=1)d[e].c();c=R(),a=D("p"),a.textContent="Please select one.",P(a,"class","small")},m(e,t){C(e,n,t),k(n,r),k(n,o),k(n,s),C(e,l,t),C(e,i,t);for(let e=0;e<d.length;e+=1)d[e]&&d[e].m(i,null);C(e,c,t),C(e,a,t)},p(e,t){if(2&t&&j(o,e[1]),5&t){let n;for(u=xe(e[6]),n=0;n<u.length;n+=1){const r=Yl(e,u,n);d[n]?d[n].p(r,t):(d[n]=Jl(r),d[n].c(),d[n].m(i,null))}for(;n<d.length;n+=1)d[n].d(1);d.length=u.length}},i:e,o:e,d(e){e&&(O(n),O(l),O(i),O(c),O(a)),_(d,e)}}}function Vl(e){let t,n,r,o,s=e[7].author+"";return{c(){t=A("["),n=D("i"),r=A(s),o=A("]")},m(e,s){C(e,t,s),C(e,n,s),k(n,r),C(e,o,s)},p(e,t){4&t&&s!==(s=e[7].author+"")&&j(r,s)},d(e){e&&(O(t),O(n),O(o))}}}function Jl(e){let t,n,r,o,s,l,i,c,a=e[7].title+"";function u(){return e[4](e[7])}let d=e[7].author&&Vl(e);return{c(){t=D("li"),n=D("a"),r=A(a),s=R(),d&&d.c(),l=R(),P(n,"href",o=It(e[7].url))},m(e,o){C(e,t,o),k(t,n),k(n,r),k(t,s),d&&d.m(t,null),k(t,l),i||(c=I(n,"click",F(u)),i=!0)},p(s,i){e=s,4&i&&a!==(a=e[7].title+"")&&j(r,a),4&i&&o!==(o=It(e[7].url))&&P(n,"href",o),e[7].author?d?d.p(e,i):(d=Vl(e),d.c(),d.m(t,l)):d&&(d.d(1),d=null)},d(e){e&&O(t),d&&d.d(),i=!1,c()}}}function Zl(e){let t,n;return t=new Ct({props:{$$slots:{default:[Ql]},$$scope:{ctx:e}}}),{c(){Oe(t.$$.fragment)},m(e,r){_e(t,e,r),n=!0},p(e,n){const r={};2048&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(ge(t.$$.fragment,e),n=!0)},o(e){$e(t.$$.fragment,e),n=!1},d(e){De(t,e)}}}function Ql(e){let t;return{c(){t=A("Please wait, fetching results...")},m(e,n){C(e,t,n)},d(e){e&&O(t)}}}function ei(e){let t,n,r,o={ctx:e,current:null,token:null,hasCatch:!0,pending:Zl,then:Xl,catch:Kl,value:6,error:10,blocks:[,,,]};return ye(n=e[2],o),{c(){t=L(),o.block.c()},m(e,n){C(e,t,n),o.block.m(e,o.anchor=n),o.mount=()=>t.parentNode,o.anchor=t,r=!0},p(t,[r]){e=t,o.ctx=e,4&r&&n!==(n=e[2])&&ye(n,o)||we(o,e,r)},i(e){r||(ge(o.block),r=!0)},o(e){for(let e=0;e<3;e+=1)$e(o.blocks[e]);r=!1},d(e){e&&O(t),o.block.d(e),o.token=null,o=null}}}function ti(e,t,n){let{stage:r}=t,{search:o}=t;const s=()=>Bt(o).then((e=>{if(!e.length)throw new Error(`No series matched input \`${o}\``);return e}));let l=s();return e.$$set=e=>{"stage"in e&&n(0,r=e.stage),"search"in e&&n(1,o=e.search)},[r,o,l,s,e=>r.next({url:e.url,type:Yt.HFY_SERIES}),()=>n(2,l=s())]}const ni=class extends Re{constructor(e){super(),Ne(this,e,ti,ei,l,{stage:0,search:1})}};function ri(e,t,n){const r=e.slice();return r[9]=t[n],r}function oi(e){let t,n,r,s,l,i,c,a,u,d,p;return{c(){t=D("form"),n=D("p"),r=A("Import:\n        "),s=D("input"),l=R(),i=D("input"),a=R(),u=D("p"),u.textContent="Please only upload genuine backups, as there is no schema checking currently.",P(s,"id","upload"),P(s,"type","file"),P(s,"accept","application/json,*.json"),P(s,"name","files"),P(s,"size","30"),s.disabled=e[7],P(s,"class","svelte-1hos1p9"),P(i,"type","submit"),i.value="Go",P(i,"class","submit svelte-1hos1p9"),i.disabled=c=void 0===e[6]||e[7],P(n,"class","svelte-1hos1p9"),P(u,"class","small svelte-1hos1p9"),P(t,"class","form svelte-1hos1p9"),P(t,"enctype","multipart/form-data")},m(o,c){C(o,t,c),k(t,n),k(n,r),k(n,s),k(n,l),k(n,i),k(t,a),k(t,u),d||(p=[I(s,"change",e[22]),I(t,"submit",F(e[23]))],d=!0)},p(e,t){128&t&&(s.disabled=e[7]),192&t&&c!==(c=void 0===e[6]||e[7])&&(i.disabled=c)},d(e){e&&O(t),d=!1,o(p)}}}function si(e){let t,n,r,s,l,i,c,a,u,d,p,f;return{c(){t=D("form"),n=D("p"),n.textContent="Enter list of URLs:",r=R(),s=D("textarea"),l=R(),i=D("p"),i.textContent="One URL per line",c=R(),a=D("p"),u=D("input"),P(n,"class","svelte-1hos1p9"),P(s,"rows","5"),P(s,"placeholder",e[10]),s.disabled=e[7],P(s,"class","svelte-1hos1p9"),P(i,"class","small svelte-1hos1p9"),P(u,"type","submit"),u.value="Go",P(u,"class","submit svelte-1hos1p9"),u.disabled=d=void 0===e[4]||!e[4].trim().length||e[7],P(a,"class","svelte-1hos1p9"),P(t,"class","form svelte-1hos1p9")},m(o,d){C(o,t,d),k(t,n),k(t,r),k(t,s),M(s,e[4]),k(t,l),k(t,i),k(t,c),k(t,a),k(a,u),p||(f=[I(s,"input",e[20]),I(t,"submit",F(e[21]))],p=!0)},p(e,t){128&t&&(s.disabled=e[7]),16&t&&M(s,e[4]),144&t&&d!==(d=void 0===e[4]||!e[4].trim().length||e[7])&&(u.disabled=d)},d(e){e&&O(t),p=!1,o(f)}}}function li(e){let t,n,r,s,l,i,c,a,u,d,p,f,h,m,g,$,v,b=void 0!==e[0]&&!e[0].trim().length,y=e[3]&&ii(e),w=b&&pi(),x=e[3]&&fi();return{c(){t=D("form"),n=D("p"),r=A("Search:\n        "),s=D("input"),l=R(),i=D("input"),a=R(),y&&y.c(),u=R(),w&&w.c(),d=R(),p=D("div"),x&&x.c(),f=R(),h=D("p"),h.textContent="You can:",m=R(),g=D("ul"),g.innerHTML='<li>Search for a series title on the <a href="https://reddit.com/r/HFY/wiki/series" target="_blank">r/HFY wiki</a></li> <li>Enter a series link to the <a href="https://reddit.com/r/HFY" target="_blank">r/HFY</a> wiki</li> <li>Enter a link to any reddit post, or other link (see <a href="https://github.com/cpiber/hfy-epub/blob/master/docs/other/cors.md" target="_blank">CORS</a>)</li>',P(s,"class","search svelte-1hos1p9"),P(s,"placeholder","Search or URL..."),s.disabled=e[7],P(i,"type","submit"),i.value="Go",P(i,"class","submit svelte-1hos1p9"),i.disabled=c=void 0===e[0]||!e[0].trim().length||e[7],P(n,"class","svelte-1hos1p9"),P(t,"class","form svelte-1hos1p9"),P(h,"class","spaceabove svelte-1hos1p9"),P(p,"class","overlay-wrapper svelte-1hos1p9")},m(o,c){C(o,t,c),k(t,n),k(n,r),k(n,s),M(s,e[0]),k(n,l),k(n,i),k(t,a),y&&y.m(t,null),e[19](t),C(o,u,c),w&&w.m(o,c),C(o,d,c),C(o,p,c),x&&x.m(p,null),k(p,f),k(p,h),k(p,m),k(p,g),$||(v=[I(s,"input",e[16]),I(s,"keyup",e[13]),I(s,"blur",e[11]),I(s,"click",e[13]),I(t,"submit",F(e[18]))],$=!0)},p(e,n){128&n&&(s.disabled=e[7]),1&n&&s.value!==e[0]&&M(s,e[0]),129&n&&c!==(c=void 0===e[0]||!e[0].trim().length||e[7])&&(i.disabled=c),e[3]?y?y.p(e,n):(y=ii(e),y.c(),y.m(t,null)):y&&(y.d(1),y=null),1&n&&(b=void 0!==e[0]&&!e[0].trim().length),b?w||(w=pi(),w.c(),w.m(d.parentNode,d)):w&&(w.d(1),w=null),e[3]?x?8&n&&ge(x,1):(x=fi(),x.c(),ge(x,1),x.m(p,f)):x&&(he(),$e(x,1,1,(()=>{x=null})),me())},d(n){n&&(O(t),O(u),O(d),O(p)),y&&y.d(),e[19](null),w&&w.d(n),x&&x.d(),$=!1,o(v)}}}function ii(e){let t,n,r={ctx:e,current:null,token:null,hasCatch:!1,pending:di,then:ai,catch:ci,value:24};return ye(n=e[12](e[9],e[0]??""),r),{c(){t=L(),r.block.c()},m(e,n){C(e,t,n),r.block.m(e,r.anchor=n),r.mount=()=>t.parentNode,r.anchor=t},p(t,o){e=t,r.ctx=e,513&o&&n!==(n=e[12](e[9],e[0]??""))&&ye(n,r)||we(r,e,o)},d(e){e&&O(t),r.block.d(e),r.token=null,r=null}}}function ci(t){return{c:e,m:e,p:e,d:e}}function ai(e){let t,n=xe(e[24]),r=[];for(let t=0;t<n.length;t+=1)r[t]=ui(ri(e,n,t));return{c(){t=D("div");for(let e=0;e<r.length;e+=1)r[e].c();P(t,"class","search-results svelte-1hos1p9")},m(e,n){C(e,t,n);for(let e=0;e<r.length;e+=1)r[e]&&r[e].m(t,null)},p(e,o){if(4611&o){let s;for(n=xe(e[24]),s=0;s<n.length;s+=1){const l=ri(e,n,s);r[s]?r[s].p(l,o):(r[s]=ui(l),r[s].c(),r[s].m(t,null))}for(;s<r.length;s+=1)r[s].d(1);r.length=n.length}},d(e){e&&O(t),_(r,e)}}}function ui(e){let t,n,r,o,s,l=e[9].title+"";function i(){return e[17](e[9])}return{c(){t=D("a"),n=A(l),P(t,"class","result svelte-1hos1p9"),P(t,"href",r=It(e[9].url))},m(e,r){C(e,t,r),k(t,n),o||(s=I(t,"click",F(i)),o=!0)},p(o,s){e=o,513&s&&l!==(l=e[9].title+"")&&j(n,l),513&s&&r!==(r=It(e[9].url))&&P(t,"href",r)},d(e){e&&O(t),o=!1,s()}}}function di(t){return{c:e,m:e,p:e,d:e}}function pi(e){let t;return{c(){t=D("p"),t.textContent="Please enter a search string",P(t,"class","small error svelte-1hos1p9")},m(e,n){C(e,t,n)},d(e){e&&O(t)}}}function fi(e){let t,n,r;return{c(){t=D("div"),P(t,"class","overlay svelte-1hos1p9")},m(e,n){C(e,t,n),r=!0},i(e){r||(e&&oe((()=>{r&&(n||(n=be(t,_s,{duration:100},!0)),n.run(1))})),r=!0)},o(e){e&&(n||(n=be(t,_s,{duration:100},!1)),n.run(0)),r=!1},d(e){e&&O(t),e&&n&&n.end()}}}function hi(e){let t,n,r,o,s;function l(t){e[15](t)}let i={options:[{value:e[2].Search,label:"Search"},{value:e[2].List,label:"URLs"},{value:e[2].Import,label:"Import"}],name:"mode",class:"mode-select"};function c(e,t){return e[5]==e[2].Search?li:e[5]==e[2].List?si:e[5]==e[2].Import?oi:void 0}void 0!==e[5]&&(i.selected=e[5]),t=new Ge({props:i}),Q.push((()=>Ce(t,"selected",l)));let a=c(e),u=a&&a(e);return{c(){Oe(t.$$.fragment),r=R(),o=D("div"),u&&u.c(),P(o,"class","mode svelte-1hos1p9")},m(e,n){_e(t,e,n),C(e,r,n),C(e,o,n),u&&u.m(o,null),s=!0},p(e,[r]){const s={};4&r&&(s.options=[{value:e[2].Search,label:"Search"},{value:e[2].List,label:"URLs"},{value:e[2].Import,label:"Import"}]),!n&&32&r&&(n=!0,s.selected=e[5],se((()=>n=!1))),t.$set(s),a===(a=c(e))&&u?u.p(e,r):(u&&u.d(1),u=a&&a(e),u&&(u.c(),u.m(o,null)))},i(e){s||(ge(t.$$.fragment,e),s=!0)},o(e){$e(t.$$.fragment,e),s=!1},d(e){e&&(O(r),O(o)),De(t,e),u&&u.d()}}}function mi(e,t,n){let{stage:r}=t,{search:o}=t;var s;let l;!function(e){e.Search="search",e.List="list",e.Import="import"}(s||(s={}));let i,c,a,u=!1,d=s.Search,p=!1;const f=()=>{n(9,l=l||Bt().finally(f)),n(3,u=!!l&&!!o)},h=async()=>{if(!c)return;n(7,p=!0);const e=new FileReader,t=new Promise(((t,n)=>{e.onload=t,e.onerror=n}));return e.readAsText(c),await t,n(7,p=!1),JSON.parse(e.result)};return e.$$set=e=>{"stage"in e&&n(1,r=e.stage),"search"in e&&n(0,o=e.search)},[o,r,s,u,i,d,c,p,a,l,"https://example.com/chapter1\nhttps://example.com/chapter2",e=>n(3,u=!!a&&a.contains(e.relatedTarget)),async(e,t)=>{if(!e)return[];const r=await e,o=t.toLowerCase(),s=r.filter((e=>-1!==e.title.toLowerCase().indexOf(o)));return s.length||n(3,u=!1),s},f,h,function(e){d=e,n(5,d)},function(){o=this.value,n(0,o)},e=>r.next(e.url),()=>r.next(o||""),function(e){Q[e?"unshift":"push"]((()=>{a=e,n(8,a)}))},function(){i=this.value,n(4,i)},()=>r.fromList(i||""),e=>n(6,c=e.currentTarget.files?.[0]),async()=>r.fromJSON(await h())]}const gi=class extends Re{constructor(e){super(),Ne(this,e,mi,hi,l,{stage:1,search:0})}};function $i(t){let n,r,o,s;return{c(){n=N("svg"),r=N("g"),o=N("path"),s=N("path"),P(o,"d","M173.145,73.91c-0.413-2.722-2.29-4.993-4.881-5.912l-13.727-4.881c-0.812-2.3-1.733-4.536-2.754-6.699l6.247-13.146\n\t\tc1.179-2.479,0.899-5.411-0.729-7.628c-5.265-7.161-11.556-13.452-18.698-18.693c-2.219-1.629-5.141-1.906-7.625-0.724\n\t\tl-13.138,6.242c-2.163-1.021-4.402-1.94-6.704-2.752l-4.883-13.729c-0.919-2.586-3.184-4.458-5.9-4.876\n\t\tc-9.65-1.483-16.792-1.483-26.457,0c-2.713,0.418-4.981,2.29-5.9,4.876l-4.883,13.729c-2.302,0.812-4.541,1.731-6.702,2.752\n\t\tl-13.143-6.242c-2.479-1.181-5.406-0.904-7.623,0.724c-7.142,5.241-13.433,11.532-18.698,18.693\n\t\tc-1.629,2.217-1.908,5.148-0.729,7.628l6.247,13.146c-1.021,2.159-1.94,4.4-2.754,6.699L5.982,68.003\n\t\tc-2.589,0.919-4.463,3.189-4.879,5.907c-0.749,4.92-1.099,9.115-1.099,13.219c0,4.098,0.35,8.299,1.099,13.219\n\t\tc0.413,2.722,2.29,4.993,4.881,5.912l13.727,4.881c0.814,2.304,1.736,4.541,2.754,6.704l-6.247,13.141\n\t\tc-1.179,2.479-0.899,5.411,0.727,7.623c5.258,7.156,11.549,13.447,18.7,18.698c2.217,1.629,5.144,1.911,7.625,0.724l13.138-6.242\n\t\tc2.163,1.021,4.402,1.94,6.704,2.752l4.883,13.729c0.919,2.586,3.184,4.458,5.9,4.876c4.828,0.744,9.154,1.104,13.228,1.104\n\t\tc4.074,0,8.401-0.36,13.228-1.104c2.715-0.418,4.981-2.29,5.9-4.876l4.883-13.729c2.302-0.812,4.541-1.731,6.704-2.752\n\t\tl13.138,6.242c2.484,1.186,5.411,0.904,7.628-0.724c7.159-5.26,13.45-11.551,18.698-18.698c1.626-2.212,1.906-5.144,0.727-7.623\n\t\tl-6.247-13.141c1.021-2.163,1.942-4.405,2.754-6.704l13.727-4.881c2.591-0.919,4.468-3.189,4.881-5.912\n\t\tc0.749-4.92,1.099-9.12,1.099-13.219S173.894,78.829,173.145,73.91z M158.949,93.72l-12.878,4.58\n\t\tc-2.251,0.797-3.982,2.625-4.66,4.92c-1.15,3.889-2.664,7.569-4.504,10.943c-1.142,2.1-1.213,4.619-0.187,6.777l5.841,12.285\n\t\tc-2.822,3.389-5.943,6.515-9.337,9.334l-12.283-5.834c-2.161-1.036-4.672-0.953-6.775,0.185c-3.379,1.838-7.061,3.35-10.953,4.502\n\t\tc-2.29,0.676-4.118,2.406-4.917,4.657l-4.582,12.883c-4.677,0.476-8.503,0.476-13.18,0l-4.582-12.883\n\t\tc-0.8-2.246-2.628-3.982-4.917-4.657c-3.894-1.152-7.579-2.664-10.953-4.502c-2.103-1.147-4.619-1.22-6.775-0.185l-12.283,5.839\n\t\tc-3.391-2.825-6.512-5.946-9.337-9.339l5.841-12.285c1.026-2.159,0.955-4.677-0.187-6.777c-1.835-3.364-3.35-7.049-4.504-10.948\n\t\tc-0.678-2.29-2.411-4.118-4.66-4.915l-12.878-4.58c-0.243-2.343-0.36-4.502-0.36-6.592s0.117-4.244,0.36-6.587l12.881-4.584\n\t\tc2.248-0.797,3.979-2.625,4.657-4.915c1.152-3.889,2.667-7.574,4.504-10.953c1.142-2.095,1.213-4.619,0.187-6.772l-5.841-12.285\n\t\tc2.827-3.393,5.948-6.519,9.337-9.339l12.288,5.839c2.151,1.036,4.677,0.953,6.775-0.185c3.372-1.838,7.054-3.35,10.948-4.502\n\t\tc2.29-0.676,4.118-2.411,4.917-4.657l4.582-12.883c4.633-0.481,8.466-0.481,13.18,0l4.582,12.883\n\t\tc0.8,2.246,2.628,3.982,4.917,4.657c3.894,1.152,7.579,2.664,10.953,4.502c2.103,1.147,4.614,1.22,6.775,0.185l12.283-5.839\n\t\tc3.389,2.82,6.51,5.946,9.337,9.339l-5.841,12.285c-1.026,2.154-0.955,4.677,0.187,6.772c1.843,3.389,3.357,7.069,4.504,10.948\n\t\tc0.678,2.295,2.409,4.123,4.66,4.92l12.878,4.58c0.243,2.343,0.36,4.502,0.36,6.592S159.192,91.377,158.949,93.72z"),P(s,"d","M87.124,50.802c-19.062,0-34.571,15.508-34.571,34.571s15.508,34.571,34.571,34.571s34.571-15.508,34.571-34.571\n\t\tS106.186,50.802,87.124,50.802z M87.124,105.009c-10.827,0-19.636-8.809-19.636-19.636s8.809-19.636,19.636-19.636\n\t\ts19.636,8.809,19.636,19.636S97.951,105.009,87.124,105.009z"),P(n,"version","1.1"),P(n,"xmlns","http://www.w3.org/2000/svg"),P(n,"xmlns:xlink","http://www.w3.org/1999/xlink"),P(n,"x","0px"),P(n,"y","0px"),P(n,"viewBox","0 0 174.248 174.248"),P(n,"xml:space","preserve")},m(e,t){C(e,n,t),k(n,r),k(r,o),k(r,s)},p:e,i:e,o:e,d(e){e&&O(n)}}}const vi=class extends Re{constructor(e){super(),Ne(this,e,null,$i,l,{})}};function bi(e){let t,n;const r=e[1].default,o=a(r,e,e[0],null);return{c(){t=D("p"),o&&o.c(),P(t,"class","info alert svelte-1mwdlru")},m(e,r){C(e,t,r),o&&o.m(t,null),n=!0},p(e,[t]){o&&o.p&&(!n||1&t)&&p(o,r,e,e[0],n?d(r,e[0],t,null):f(e[0]),null)},i(e){n||(ge(o,e),n=!0)},o(e){$e(o,e),n=!1},d(e){e&&O(t),o&&o.d(e)}}}function yi(e,t,n){let{$$slots:r={},$$scope:o}=t;return e.$$set=e=>{"$$scope"in e&&n(0,o=e.$$scope)},[o,r]}const wi=class extends Re{constructor(e){super(),Ne(this,e,yi,bi,l,{})}};function xi(t){let n,r,o;return{c(){n=A("Due to "),r=D("a"),r.textContent="recent API changes on reddit",o=A(', creating ebooks has become limited. If you run into a "Too many requests" error, please wait 10 minutes before trying again.'),P(r,"href","https://www.redditinc.com/blog/apifacts"),P(r,"target","_blank"),P(r,"class","svelte-ntsh7z")},m(e,t){C(e,n,t),C(e,r,t),C(e,o,t)},p:e,d(e){e&&(O(n),O(r),O(o))}}}function Ei(t){let n,r,o,s,l;return{c(){n=A("When generating an ebook via URL, please be aware of "),r=D("code"),r.textContent="NetworkError",o=A("s, see "),s=D("a"),s.textContent="CORS",l=A("."),P(r,"class","svelte-ntsh7z"),P(s,"href","https://github.com/cpiber/hfy-epub/blob/master/docs/other/cors.md"),P(s,"target","_blank"),P(s,"class","svelte-ntsh7z")},m(e,t){C(e,n,t),C(e,r,t),C(e,o,t),C(e,s,t),C(e,l,t)},p:e,d(e){e&&(O(n),O(r),O(o),O(s),O(l))}}}function ki(e){let t,n,r,o,s,l,i;return o=new wi({props:{$$slots:{default:[xi]},$$scope:{ctx:e}}}),l=new wi({props:{$$slots:{default:[Ei]},$$scope:{ctx:e}}}),{c(){t=D("header"),n=D("h1"),n.innerHTML='r/HFY epub generator <a class="small svelte-ntsh7z" href="https://github.com/cpiber/hfy-epub/tree/master/docs/index.md" target="_blank">Help</a>',r=R(),Oe(o.$$.fragment),s=R(),Oe(l.$$.fragment),P(n,"class","svelte-ntsh7z"),P(t,"class","svelte-ntsh7z")},m(e,c){C(e,t,c),k(t,n),k(t,r),_e(o,t,null),k(t,s),_e(l,t,null),i=!0},p(e,[t]){const n={};1&t&&(n.$$scope={dirty:t,ctx:e}),o.$set(n);const r={};1&t&&(r.$$scope={dirty:t,ctx:e}),l.$set(r)},i(e){i||(ge(o.$$.fragment,e),ge(l.$$.fragment,e),i=!0)},o(e){$e(o.$$.fragment,e),$e(l.$$.fragment,e),i=!1},d(e){e&&O(t),De(o),De(l)}}}const Ti=class extends Re{constructor(e){super(),Ne(this,e,null,ki,l,{})}};function Si(e){let t,n,r,o,s,l,i,c,a,u,d;return{c(){t=D("p"),n=A("This website ("),r=D("a"),r.textContent="https://cpiber.github.io/hfy-epub",o=A(") does not, and will not, collect any data from its users.\n      Any actions taken on this page are purely in the user's browser; there is no server-side component.\n      No data is ever sent away.\n      For collecting the chapter data, this site contacts "),s=D("code"),s.textContent=`${Rt}`,l=A(" only. The book is generated in the browser."),c=R(),a=D("p"),a.innerHTML="If TinyMCE-Editor is activated, the user&#39;s browser connects to <code>cdn.tiny.cloud</code> and <code>sp.tinymce.com</code> to load the necessary files.",P(r,"href","https://cpiber.github.io/hfy-epub"),P(r,"target","_blank"),P(t,"class","small svelte-1f8pws6"),P(a,"class","small svelte-1f8pws6")},m(e,i){C(e,t,i),k(t,n),k(t,r),k(t,o),k(t,s),k(t,l),C(e,c,i),C(e,a,i),d=!0},i(e){d||(e&&oe((()=>{d&&(i||(i=be(t,jt,{},!0)),i.run(1))})),e&&oe((()=>{d&&(u||(u=be(a,jt,{},!0)),u.run(1))})),d=!0)},o(e){e&&(i||(i=be(t,jt,{},!1)),i.run(0)),e&&(u||(u=be(a,jt,{},!1)),u.run(0)),d=!1},d(e){e&&(O(t),O(c),O(a)),e&&i&&i.end(),e&&u&&u.end()}}}function Ci(e){let t,n,r,o,s;return{c(){t=D("label"),n=D("input"),r=A(" Use TinyMCE chapter editor"),P(n,"type","checkbox"),P(n,"aria-label","use TinyMCE editor"),P(n,"class","svelte-1f8pws6"),P(t,"class","small svelte-1f8pws6")},m(l,i){C(l,t,i),k(t,n),n.checked=e[2].useTiny,k(t,r),o||(s=I(n,"change",e[4]),o=!0)},p(e,t){4&t&&(n.checked=e[2].useTiny)},d(e){e&&O(t),o=!1,s()}}}function Oi(e){let t,n,r,o,s,l,i,c,a,u,d,p,f,h,m,g=!xn(e[1].stage,ln.SETTINGS),$=e[0]&&Si(),v=g&&Ci(e);return{c(){t=D("footer"),n=D("p"),r=A("Made by "),o=D("a"),o.textContent="@cpiber",s=A(".\n    Source Code & bug tracker: "),l=D("a"),l.textContent="cpiber/hfy-epub",i=A(".\n    \n    Version "),c=A("0.3.2"),a=A(".\n    "),u=D("a"),u.textContent="Privacy",d=A("."),p=R(),$&&$.c(),f=R(),v&&v.c(),P(o,"href","https://github.com/cpiber"),P(o,"target","_blank"),P(l,"href","https://github.com/cpiber/hfy-epub"),P(l,"target","_blank"),P(u,"href","#privacy"),P(n,"class","small svelte-1f8pws6"),P(t,"class","svelte-1f8pws6")},m(g,b){C(g,t,b),k(t,n),k(n,r),k(n,o),k(n,s),k(n,l),k(n,i),k(n,c),k(n,a),k(n,u),k(n,d),k(t,p),$&&$.m(t,null),k(t,f),v&&v.m(t,null),h||(m=I(u,"click",F(e[3])),h=!0)},p(e,[n]){e[0]?$?1&n&&ge($,1):($=Si(),$.c(),ge($,1),$.m(t,f)):$&&(he(),$e($,1,1,(()=>{$=null})),me()),2&n&&(g=!xn(e[1].stage,ln.SETTINGS)),g?v?v.p(e,n):(v=Ci(e),v.c(),v.m(t,null)):v&&(v.d(1),v=null)},i(e){ge($)},o(e){$e($)},d(e){e&&O(t),$&&$.d(),v&&v.d(),h=!1,m()}}}function _i(e,t,n){let r,o;c(e,En,(e=>n(1,r=e))),c(e,Ye,(e=>n(2,o=e)));let s=!1;return[s,r,o,()=>n(0,s=!s),function(){o.useTiny=this.checked,Ye.set(o)}]}const Di=class extends Re{constructor(e){super(),Ne(this,e,_i,Oi,l,{})}};function Ni(e){let t,n,r,o,s,l;return n=new Ms({}),{c(){t=D("a"),Oe(n.$$.fragment),r=A(" home"),P(t,"href","#home"),P(t,"class","homelink svelte-ibaoy7")},m(i,c){C(i,t,c),_e(n,t,null),k(t,r),o=!0,s||(l=I(t,"click",F(e[6])),s=!0)},i(e){o||(ge(n.$$.fragment,e),o=!0)},o(e){$e(n.$$.fragment,e),o=!1},d(e){e&&O(t),De(n),s=!1,l()}}}function Ai(t){let n,r,o,s,l;return r=new vi({}),{c(){n=D("a"),Oe(r.$$.fragment),P(n,"href","#settings"),P(n,"class","settingslink svelte-ibaoy7")},m(e,i){C(e,n,i),_e(r,n,null),o=!0,s||(l=I(n,"click",F(t[3])),s=!0)},p:e,i(e){o||(ge(r.$$.fragment,e),o=!0)},o(e){$e(r.$$.fragment,e),o=!1},d(e){e&&O(n),De(r),s=!1,l()}}}function Ri(t){let n,r,o,s,l,i;return r=new Ms({}),{c(){n=D("a"),Oe(r.$$.fragment),o=A(" back"),P(n,"href","#home"),P(n,"class","homelink svelte-ibaoy7")},m(e,c){C(e,n,c),_e(r,n,null),k(n,o),s=!0,l||(i=I(n,"click",F(t[7])),l=!0)},p:e,i(e){s||(ge(r.$$.fragment,e),s=!0)},o(e){$e(r.$$.fragment,e),s=!1},d(e){e&&O(n),De(r),l=!1,i()}}}function Li(t){let n,r,o;return{c(){n=D("h2"),n.textContent="Page not found",r=R(),o=D("p"),o.textContent="Sorry, the requested page could not be found"},m(e,t){C(e,n,t),C(e,r,t),C(e,o,t)},p:e,i:e,o:e,d(e){e&&(O(n),O(r),O(o))}}}function Ii(t){let n,r;return n=new dt({}),{c(){Oe(n.$$.fragment)},m(e,t){_e(n,e,t),r=!0},p:e,i(e){r||(ge(n.$$.fragment,e),r=!0)},o(e){$e(n.$$.fragment,e),r=!1},d(e){De(n,e)}}}function Fi(e){let t,n;return t=new zn({props:{stage:e[0],backToSearch:e[2]}}),{c(){Oe(t.$$.fragment)},m(e,r){_e(t,e,r),n=!0},p(e,n){const r={};1&n&&(r.stage=e[0]),4&n&&(r.backToSearch=e[2]),t.$set(r)},i(e){n||(ge(t.$$.fragment,e),n=!0)},o(e){$e(t.$$.fragment,e),n=!1},d(e){De(t,e)}}}function Ui(e){let t,n;return t=new lr({props:{stage:e[0]}}),{c(){Oe(t.$$.fragment)},m(e,r){_e(t,e,r),n=!0},p(e,n){const r={};1&n&&(r.stage=e[0]),t.$set(r)},i(e){n||(ge(t.$$.fragment,e),n=!0)},o(e){$e(t.$$.fragment,e),n=!1},d(e){De(t,e)}}}function Pi(e){let t,n;return t=new mr({props:{stage:e[0]}}),{c(){Oe(t.$$.fragment)},m(e,r){_e(t,e,r),n=!0},p(e,n){const r={};1&n&&(r.stage=e[0]),t.$set(r)},i(e){n||(ge(t.$$.fragment,e),n=!0)},o(e){$e(t.$$.fragment,e),n=!1},d(e){De(t,e)}}}function ji(e){let t,n;return t=new _l({props:{stage:e[0]}}),{c(){Oe(t.$$.fragment)},m(e,r){_e(t,e,r),n=!0},p(e,n){const r={};1&n&&(r.stage=e[0]),t.$set(r)},i(e){n||(ge(t.$$.fragment,e),n=!0)},o(e){$e(t.$$.fragment,e),n=!1},d(e){De(t,e)}}}function Mi(e){let t,n;return t=new Wl({props:{stage:e[0],series:e[1].series,backToSearch:e[2]}}),{c(){Oe(t.$$.fragment)},m(e,r){_e(t,e,r),n=!0},p(e,n){const r={};1&n&&(r.stage=e[0]),2&n&&(r.series=e[1].series),4&n&&(r.backToSearch=e[2]),t.$set(r)},i(e){n||(ge(t.$$.fragment,e),n=!0)},o(e){$e(t.$$.fragment,e),n=!1},d(e){De(t,e)}}}function Gi(e){let t,n;return t=new ni({props:{stage:e[0],search:e[1].search}}),{c(){Oe(t.$$.fragment)},m(e,r){_e(t,e,r),n=!0},p(e,n){const r={};1&n&&(r.stage=e[0]),2&n&&(r.search=e[1].search),t.$set(r)},i(e){n||(ge(t.$$.fragment,e),n=!0)},o(e){$e(t.$$.fragment,e),n=!1},d(e){De(t,e)}}}function zi(e){let t,n;return t=new gi({props:{stage:e[0],search:e[1].search}}),{c(){Oe(t.$$.fragment)},m(e,r){_e(t,e,r),n=!0},p(e,n){const r={};1&n&&(r.stage=e[0]),2&n&&(r.search=e[1].search),t.$set(r)},i(e){n||(ge(t.$$.fragment,e),n=!0)},o(e){$e(t.$$.fragment,e),n=!1},d(e){De(t,e)}}}function Hi(e){let t,n,r,o,s,l,i,c,a,u,d,p,f,h,m,g,$,v,b,y,w,x,E,T,S=!xn(e[0],ln.INPUT)&&!xn(e[0],ln.SETTINGS),_=S&&Ni(e);const N=[Ri,Ai],A=[];function L(e,t){return 1&t&&(o=null),null==o&&(o=!!xn(e[0],ln.SETTINGS)),o?0:1}s=L(e,-1),l=A[s]=N[s](e),c=new Ti({});const I=[zi,Gi,Mi,ji,Pi,Ui,Fi,Ii,Li],F=[];function U(e,t){return 1&t&&(d=null),1&t&&(p=null),1&t&&(f=null),1&t&&(h=null),1&t&&(m=null),1&t&&(g=null),1&t&&($=null),1&t&&(v=null),1&t&&(b=null),null==d&&(d=!!xn(e[0],ln.INPUT)),d?0:(null==p&&(p=!!xn(e[0],ln.SEARCH)),p?1:(null==f&&(f=!!xn(e[0],ln.BOOK_DATA)),f?2:(null==h&&(h=!!xn(e[0],ln.EDIT_DATA)),h?3:(null==m&&(m=!!xn(e[0],ln.FIND_CHAPTERS)),m?4:(null==g&&(g=!!xn(e[0],ln.DOWNLOAD_CHAPTERS)),g?5:(null==$&&($=!!xn(e[0],ln.RESULT)),$?6:(null==v&&(v=!!xn(e[0],ln.SETTINGS)),v?7:(null==b&&(b=!!xn(e[0],ln._404)),b?8:-1))))))))}return~(y=U(e,-1))&&(w=F[y]=I[y](e)),E=new Di({}),{c(){t=D("div"),n=D("nav"),_&&_.c(),r=R(),l.c(),i=R(),Oe(c.$$.fragment),a=R(),u=D("main"),w&&w.c(),x=R(),Oe(E.$$.fragment),P(n,"class","mainnav svelte-ibaoy7"),P(u,"class","App-main"),P(t,"class","App svelte-ibaoy7")},m(e,o){C(e,t,o),k(t,n),_&&_.m(n,null),k(n,r),A[s].m(n,null),k(t,i),_e(c,t,null),k(t,a),k(t,u),~y&&F[y].m(u,null),k(t,x),_e(E,t,null),T=!0},p(e,[t]){1&t&&(S=!xn(e[0],ln.INPUT)&&!xn(e[0],ln.SETTINGS)),S?_?1&t&&ge(_,1):(_=Ni(e),_.c(),ge(_,1),_.m(n,r)):_&&(he(),$e(_,1,1,(()=>{_=null})),me());let o=s;s=L(e,t),s===o?A[s].p(e,t):(he(),$e(A[o],1,1,(()=>{A[o]=null})),me(),l=A[s],l?l.p(e,t):(l=A[s]=N[s](e),l.c()),ge(l,1),l.m(n,null));let i=y;y=U(e,t),y===i?~y&&F[y].p(e,t):(w&&(he(),$e(F[i],1,1,(()=>{F[i]=null})),me()),~y?(w=F[y],w?w.p(e,t):(w=F[y]=I[y](e),w.c()),ge(w,1),w.m(u,null)):w=null)},i(e){T||(ge(_),ge(l),ge(c.$$.fragment,e),ge(w),ge(E.$$.fragment,e),T=!0)},o(e){$e(_),$e(l),$e(c.$$.fragment,e),$e(w),$e(E.$$.fragment,e),T=!1},d(e){e&&O(t),_&&_.d(),A[s].d(),De(c),~y&&F[y].d(),De(E)}}}function Bi(e,t,n){let r,o,s,l,i;return c(e,kn,(e=>n(4,s=e))),c(e,En,(e=>n(1,l=e))),c(e,Ye,(e=>n(5,i=e))),e.$$.update=()=>{if(2&e.$$.dirty&&n(0,r=l.stage),1&e.$$.dirty&&n(2,o=xn(r.from,ln.SEARCH)?()=>bn(dn):void 0),e.$$.dirty,e.$$.dirty,e.$$.dirty,32&e.$$.dirty&&localStorage.setItem("config",JSON.stringify(i)),2&e.$$.dirty&&localStorage.setItem("state",JSON.stringify({data:l.stage.dump(),search:l.search,series:l.series})),16&e.$$.dirty)try{localStorage.setItem("book",JSON.stringify(s))}catch(e){localStorage.removeItem("book"),console.error("Data too large! Caution, reloading won't work as expected!")}},[r,l,o,()=>{r.needsSaving&&!confirm("Unsaved changes. Continue?")||bn($n)},s,i,()=>bn(un),()=>r.next()]}(()=>{var e;try{const t=JSON.parse(null!==(e=localStorage.getItem("config"))&&void 0!==e?e:"");Ye.set((e=>{if(!e||""+e!="[object Object]")return We;const t=Object.keys(e),n=Object.keys(We);for(const r of n)t.includes(r)||(e[r]=We[r]),typeof We[r]!=typeof e[r]&&(e[r]=We[r]);return e})(t))}catch(e){}})(),(()=>{var e;try{const t=JSON.parse(null!==(e=localStorage.getItem("book"))&&void 0!==e?e:"");kn.update((()=>t))}catch(e){}})(),window.removeEventListener("popstate",Sn),window.addEventListener("popstate",Sn),Sn();const qi=class extends Re{constructor(e){super(),Ne(this,e,Bi,Hi,l,{})}};let Wi;try{Wi=new qi({target:document.body})}catch(e){const t=document.createElement("div");t.className="fatal-error",t.ariaLabel="error",t.appendChild(document.createElement("h1")).textContent="Something went wrong:",t.appendChild(document.createElement("code")).textContent=e,document.body.appendChild(t)}})(),c=i.O(c)})();