(()=>{var e,t,n,r,o,s={3:function(e,t){var n,r;void 0===(r="function"==typeof(n=function(){return function e(t,n,r){var o,s,i=window,l="application/octet-stream",c=r||l,a=t,u=!n&&!r&&a,d=document.createElement("a"),p=function(e){return String(e)},f=i.Blob||i.MozBlob||i.WebKitBlob||p,h=n||"download";if(f=f.call?f.bind(i):Blob,"true"===String(this)&&(c=(a=[a,c])[0],a=a[1]),u&&u.length<2048&&(h=u.split("/").pop().split("?")[0],d.href=u,-1!==d.href.indexOf(u))){var m=new XMLHttpRequest;return m.open("GET",u,!0),m.responseType="blob",m.onload=function(t){e(t.target.response,h,l)},setTimeout((function(){m.send()}),0),m}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(a)){if(!(a.length>2096103.424&&f!==p))return navigator.msSaveBlob?navigator.msSaveBlob(b(a),h):y(a);c=(a=b(a)).type||l}else if(/([\x80-\xff])/.test(a)){for(var g=0,$=new Uint8Array(a.length),v=$.length;g<v;++g)$[g]=a.charCodeAt(g);a=new f([$],{type:c})}function b(e){for(var t=e.split(/[:;,]/),n=t[1],r=("base64"==t[2]?atob:decodeURIComponent)(t.pop()),o=r.length,s=0,i=new Uint8Array(o);s<o;++s)i[s]=r.charCodeAt(s);return new f([i],{type:n})}function y(e,t){if("download"in d)return d.href=e,d.setAttribute("download",h),d.className="download-js-link",d.innerHTML="downloading...",d.style.display="none",document.body.appendChild(d),setTimeout((function(){d.click(),document.body.removeChild(d),!0===t&&setTimeout((function(){i.URL.revokeObjectURL(d.href)}),250)}),66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,l)),window.open(e)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=e),!0;var n=document.createElement("iframe");document.body.appendChild(n),!t&&/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,l)),n.src=e,setTimeout((function(){document.body.removeChild(n)}),333)}if(o=a instanceof f?a:new f([a],{type:c}),navigator.msSaveBlob)return navigator.msSaveBlob(o,h);if(i.URL)y(i.URL.createObjectURL(o),!0);else{if("string"==typeof o||o.constructor===p)try{return y("data:"+c+";base64,"+i.btoa(o))}catch(e){return y("data:"+c+","+encodeURIComponent(o))}(s=new FileReader).onload=function(e){y(this.result)},s.readAsDataURL(o)}return!0}})?n.apply(t,[]):n)||(e.exports=r)}},i={};function l(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={exports:{}};return s[e].call(n.exports,n,n.exports,l),n.exports}l.m=s,e=[],l.O=(t,n,r,o)=>{if(!n){var s=1/0;for(u=0;u<e.length;u++){for(var[n,r,o]=e[u],i=!0,c=0;c<n.length;c++)(!1&o||s>=o)&&Object.keys(l.O).every((e=>l.O[e](n[c])))?n.splice(c--,1):(i=!1,o<s&&(s=o));if(i){e.splice(u--,1);var a=r();void 0!==a&&(t=a)}}return t}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[n,r,o]},l.F={},l.E=e=>{Object.keys(l.F).map((t=>{l.F[t](e)}))},l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},n=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,l.t=function(e,r){if(1&r&&(e=this(e)),8&r)return e;if("object"==typeof e&&e){if(4&r&&e.__esModule)return e;if(16&r&&"function"==typeof e.then)return e}var o=Object.create(null);l.r(o);var s={};t=t||[null,n({}),n([]),n(n)];for(var i=2&r&&e;"object"==typeof i&&!~t.indexOf(i);i=n(i))Object.getOwnPropertyNames(i).forEach((t=>s[t]=()=>e[t]));return s.default=()=>e,l.d(o,s),o},l.d=(e,t)=>{for(var n in t)l.o(t,n)&&!l.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},l.f={},l.e=e=>Promise.all(Object.keys(l.f).reduce(((t,n)=>(l.f[n](e,t),t)),[])),l.u=e=>e+"-"+{22:"8084057f48563858b6d9",794:"c63f5343080ab1cca2d1"}[e]+".js",l.miniCssF=e=>{},l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r={},o="hfy-epub:",l.l=(e,t,n,s)=>{if(r[e])r[e].push(t);else{var i,c;if(void 0!==n)for(var a=document.getElementsByTagName("script"),u=0;u<a.length;u++){var d=a[u];if(d.getAttribute("src")==e||d.getAttribute("data-webpack")==o+n){i=d;break}}i||(c=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,l.nc&&i.setAttribute("nonce",l.nc),i.setAttribute("data-webpack",o+n),i.src=e),r[e]=[t];var p=(t,n)=>{i.onerror=i.onload=null,clearTimeout(f);var o=r[e];if(delete r[e],i.parentNode&&i.parentNode.removeChild(i),o&&o.forEach((e=>e(n))),t)return t(n)},f=setTimeout(p.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=p.bind(null,i.onerror),i.onload=p.bind(null,i.onload),c&&document.head.appendChild(i)}},l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="/hfy-epub/",(()=>{var e={792:0};l.f.j=(t,n)=>{var r=l.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var o=new Promise(((n,o)=>r=e[t]=[n,o]));n.push(r[2]=o);var s=l.p+l.u(t),i=new Error;l.l(s,(n=>{if(l.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var o=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.src;i.message="Loading chunk "+t+" failed.\n("+o+": "+s+")",i.name="ChunkLoadError",i.type=o,i.request=s,r[1](i)}}),"chunk-"+t,t)}},l.F.j=t=>{if(!l.o(e,t)||void 0===e[t]){e[t]=null;var n=document.createElement("link");l.nc&&n.setAttribute("nonce",l.nc),n.rel="prefetch",n.as="script",n.href=l.p+l.u(t),document.head.appendChild(n)}},l.O.j=t=>0===e[t];var t=(t,n)=>{var r,o,[s,i,c]=n,a=0;if(s.some((t=>0!==e[t]))){for(r in i)l.o(i,r)&&(l.m[r]=i[r]);if(c)var u=c(l)}for(t&&t(n);a<s.length;a++)o=s[a],l.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return l.O(u)},n=self.webpackChunkhfy_epub=self.webpackChunkhfy_epub||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),l.O(0,[792],(()=>{l.E(794),l.E(22)}),5);var c={};(()=>{"use strict";function e(){}const t=e=>e;function n(e){return e()}function r(){return Object.create(null)}function o(e){e.forEach(n)}function s(e){return"function"==typeof e}function i(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let c;function a(e,t){return e===t||(c||(c=document.createElement("a")),c.href=t,e===c.href)}function u(t,n,r){t.$$.on_destroy.push(function(t,...n){if(null==t){for(const e of n)e(void 0);return e}const r=t.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}(n,r))}function d(e,t,n,r){if(e){const o=p(e,t,n,r);return e[0](o)}}function p(e,t,n,r){return e[1]&&r?function(e,t){for(const n in t)e[n]=t[n];return e}(n.ctx.slice(),e[1](r(t))):n.ctx}function f(e,t,n,r){if(e[2]&&r){const o=e[2](r(n));if(void 0===t.dirty)return o;if("object"==typeof o){const e=[],n=Math.max(t.dirty.length,o.length);for(let r=0;r<n;r+=1)e[r]=t.dirty[r]|o[r];return e}return t.dirty|o}return t.dirty}function h(e,t,n,r,o,s){if(o){const i=p(t,n,r,s);e.p(i,o)}}function m(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let e=0;e<n;e++)t[e]=-1;return t}return-1}function g(t){return t&&s(t.destroy)?t.destroy:e}function $(e){const t="string"==typeof e&&e.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return t?[parseFloat(t[1]),t[2]||"px"]:[e,"px"]}const v="undefined"!=typeof window;let b=v?()=>window.performance.now():()=>Date.now(),y=v?e=>requestAnimationFrame(e):e;const w=new Set;function x(e){w.forEach((t=>{t.c(e)||(w.delete(t),t.f())})),0!==w.size&&y(x)}const E="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;class k{_listeners="WeakMap"in E?new WeakMap:void 0;_observer=void 0;options;constructor(e){this.options=e}observe(e,t){return this._listeners.set(e,t),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){return this._observer??(this._observer=new ResizeObserver((e=>{for(const t of e)k.entries.set(t.target,t),this._listeners.get(t.target)?.(t)})))}}k.entries="WeakMap"in E?new WeakMap:void 0;let T=!1;function S(e,t){e.appendChild(t)}function C(e){if(!e)return document;const t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function O(e){const t=N("style");return t.textContent="/* empty */",function(e,t){S(e.head||e,t),t.sheet}(C(e),t),t.sheet}function _(e,t,n){e.insertBefore(t,n||null)}function D(e){e.parentNode&&e.parentNode.removeChild(e)}function A(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function N(e){return document.createElement(e)}function R(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function L(e){return document.createTextNode(e)}function F(){return L(" ")}function I(){return L("")}function U(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function P(e){return function(t){return t.preventDefault(),e.call(this,t)}}function j(e){return function(t){return t.stopPropagation(),e.call(this,t)}}function M(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function z(e,t){t=""+t,e.data!==t&&(e.data=t)}function G(e,t){e.value=null==t?"":t}function B(e,t,n){e.classList.toggle(t,!!n)}function H(e,t,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:r})}class q{is_svg=!1;e=void 0;n=void 0;t=void 0;a=void 0;constructor(e=!1){this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,n=null){this.e||(this.is_svg?this.e=R(t.nodeName):this.e=N(11===t.nodeType?"TEMPLATE":t.nodeName),this.t="TEMPLATE"!==t.tagName?t:t.content,this.c(e)),this.i(n)}h(e){this.e.innerHTML=e,this.n=Array.from("TEMPLATE"===this.e.nodeName?this.e.content.childNodes:this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)_(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(D)}}const W=new Map;let Y,K=0;function X(e,t,n,r,o,s,i,l=0){const c=16.666/r;let a="{\n";for(let e=0;e<=1;e+=c){const r=t+(n-t)*s(e);a+=100*e+`%{${i(r,1-r)}}\n`}const u=a+`100% {${i(n,1-n)}}\n}`,d=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(u)}_${l}`,p=C(e),{stylesheet:f,rules:h}=W.get(p)||function(e,t){const n={stylesheet:O(t),rules:{}};return W.set(e,n),n}(p,e);h[d]||(h[d]=!0,f.insertRule(`@keyframes ${d} ${u}`,f.cssRules.length));const m=e.style.animation||"";return e.style.animation=`${m?`${m}, `:""}${d} ${r}ms linear ${o}ms 1 both`,K+=1,d}function V(e){Y=e}function J(){if(!Y)throw new Error("Function called outside component initialization");return Y}function Z(e){J().$$.on_mount.push(e)}function Q(e){J().$$.on_destroy.push(e)}function ee(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach((e=>e.call(this,t)))}const te=[],ne=[];let re=[];const oe=[],se=Promise.resolve();let ie=!1;function le(e){re.push(e)}function ce(e){oe.push(e)}const ae=new Set;let ue,de=0;function pe(){if(0!==de)return;const e=Y;do{try{for(;de<te.length;){const e=te[de];de++,V(e),fe(e.$$)}}catch(e){throw te.length=0,de=0,e}for(V(null),te.length=0,de=0;ne.length;)ne.pop()();for(let e=0;e<re.length;e+=1){const t=re[e];ae.has(t)||(ae.add(t),t())}re.length=0}while(te.length);for(;oe.length;)oe.pop()();ie=!1,ae.clear(),V(e)}function fe(e){if(null!==e.fragment){e.update(),o(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(le)}}function he(e,t,n){e.dispatchEvent(H(`${t?"intro":"outro"}${n}`))}const me=new Set;let ge;function $e(){ge={r:0,c:[],p:ge}}function ve(){ge.r||o(ge.c),ge=ge.p}function be(e,t){e&&e.i&&(me.delete(e),e.i(t))}function ye(e,t,n,r){if(e&&e.o){if(me.has(e))return;me.add(e),ge.c.push((()=>{me.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}else r&&r()}const we={duration:0};function xe(n,r,i,l){let c,a=r(n,i,{direction:"both"}),u=l?0:1,d=null,p=null,f=null;function h(){f&&function(e,t){const n=(e.style.animation||"").split(", "),r=n.filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")),o=n.length-r.length;o&&(e.style.animation=r.join(", "),K-=o,K||y((()=>{K||(W.forEach((e=>{const{ownerNode:t}=e.stylesheet;t&&D(t)})),W.clear())})))}(n,f)}function m(e,t){const n=e.b-u;return t*=Math.abs(n),{a:u,b:e.b,d:n,duration:t,start:e.start,end:e.start+t,group:e.group}}function g(r){const{delay:s=0,duration:i=300,easing:l=t,tick:g=e,css:$}=a||we,v={start:b()+s,b:r};r||(v.group=ge,ge.r+=1),"inert"in n&&(r?void 0!==c&&(n.inert=c):(c=n.inert,n.inert=!0)),d||p?p=v:($&&(h(),f=X(n,u,r,i,s,l,$)),r&&g(0,1),d=m(v,i),le((()=>he(n,r,"start"))),function(e){let t;0===w.size&&y(x),new Promise((n=>{w.add(t={c:e,f:n})}))}((e=>{if(p&&e>p.start&&(d=m(p,i),p=null,he(n,d.b,"start"),$&&(h(),f=X(n,u,d.b,d.duration,0,l,a.css))),d)if(e>=d.end)g(u=d.b,1-u),he(n,d.b,"end"),p||(d.b?h():--d.group.r||o(d.group.c)),d=null;else if(e>=d.start){const t=e-d.start;u=d.a+d.d*l(t/d.duration),g(u,1-u)}return!(!d&&!p)})))}return{run(e){s(a)?(ue||(ue=Promise.resolve(),ue.then((()=>{ue=null}))),ue).then((()=>{a=a({direction:e?"in":"out"}),g(e)})):g(e)},end(){h(),d=p=null}}}function Ee(e,t){const n=t.token={};function r(e,r,o,s){if(t.token!==n)return;t.resolved=s;let i=t.ctx;void 0!==o&&(i=i.slice(),i[o]=s);const l=e&&(t.current=e)(i);let c=!1;t.block&&(t.blocks?t.blocks.forEach(((e,n)=>{n!==r&&e&&($e(),ye(e,1,1,(()=>{t.blocks[n]===e&&(t.blocks[n]=null)})),ve())})):t.block.d(1),l.c(),be(l,1),l.m(t.mount(),t.anchor),c=!0),t.block=l,t.blocks&&(t.blocks[r]=l),c&&pe()}if(!(o=e)||"object"!=typeof o&&"function"!=typeof o||"function"!=typeof o.then){if(t.current!==t.then)return r(t.then,1,t.value,e),!0;t.resolved=e}else{const n=J();if(e.then((e=>{V(n),r(t.then,1,t.value,e),V(null)}),(e=>{if(V(n),r(t.catch,2,t.error,e),V(null),!t.hasCatch)throw e})),t.current!==t.pending)return r(t.pending,0),!0}var o}function ke(e,t,n){const r=t.slice(),{resolved:o}=e;e.current===e.then&&(r[e.value]=o),e.current===e.catch&&(r[e.error]=o),e.block.p(r,n)}function Te(e){return void 0!==e?.length?e:Array.from(e)}function Se(e,t){e.d(1),t.delete(e.key)}function Ce(e,t){ye(e,1,1,(()=>{t.delete(e.key)}))}function Oe(e,t,n,r,s,i,l,c,a,u,d,p){let f=e.length,h=i.length,m=f;const g={};for(;m--;)g[e[m].key]=m;const $=[],v=new Map,b=new Map,y=[];for(m=h;m--;){const e=p(s,i,m),o=n(e);let c=l.get(o);c?r&&y.push((()=>c.p(e,t))):(c=u(o,e),c.c()),v.set(o,$[m]=c),o in g&&b.set(o,Math.abs(m-g[o]))}const w=new Set,x=new Set;function E(e){be(e,1),e.m(c,d),l.set(e.key,e),d=e.first,h--}for(;f&&h;){const t=$[h-1],n=e[f-1],r=t.key,o=n.key;t===n?(d=t.first,f--,h--):v.has(o)?!l.has(r)||w.has(r)?E(t):x.has(o)?f--:b.get(r)>b.get(o)?(x.add(r),E(t)):(w.add(o),f--):(a(n,l),f--)}for(;f--;){const t=e[f];v.has(t.key)||a(t,l)}for(;h;)E($[h-1]);return o(y),$}let _e;function De(e,t,n){const r=e.$$.props[t];void 0!==r&&(e.$$.bound[r]=n,n(e.$$.ctx[r]))}function Ae(e){e&&e.c()}function Ne(e,t,r){const{fragment:i,after_update:l}=e.$$;i&&i.m(t,r),le((()=>{const t=e.$$.on_mount.map(n).filter(s);e.$$.on_destroy?e.$$.on_destroy.push(...t):o(t),e.$$.on_mount=[]})),l.forEach(le)}function Re(e,t){const n=e.$$;null!==n.fragment&&(function(e){const t=[],n=[];re.forEach((r=>-1===e.indexOf(r)?t.push(r):n.push(r))),n.forEach((e=>e())),re=t}(n.after_update),o(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Le(t,n,s,i,l,c,a=null,u=[-1]){const d=Y;V(t);const p=t.$$={fragment:null,ctx:[],props:c,update:e,not_equal:l,bound:r(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(d?d.$$.context:[])),callbacks:r(),dirty:u,skip_bound:!1,root:n.target||d.$$.root};a&&a(p.root);let f=!1;if(p.ctx=s?s(t,n.props||{},((e,n,...r)=>{const o=r.length?r[0]:n;return p.ctx&&l(p.ctx[e],p.ctx[e]=o)&&(!p.skip_bound&&p.bound[e]&&p.bound[e](o),f&&function(e,t){-1===e.$$.dirty[0]&&(te.push(e),ie||(ie=!0,se.then(pe)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(t,e)),n})):[],p.update(),f=!0,o(p.before_update),p.fragment=!!i&&i(p.ctx),n.target){if(n.hydrate){T=!0;const e=(h=n.target,Array.from(h.childNodes));p.fragment&&p.fragment.l(e),e.forEach(D)}else p.fragment&&p.fragment.c();n.intro&&be(t.$$.fragment),Ne(t,n.target,n.anchor),T=!1,pe()}var h;V(d)}function Fe(e,t,n,r){const o=n[e]?.type;if(t="Boolean"===o&&"boolean"!=typeof t?null!=t:t,!r||!n[e])return t;if("toAttribute"===r)switch(o){case"Object":case"Array":return null==t?null:JSON.stringify(t);case"Boolean":return t?"":null;case"Number":return null==t?null:t;default:return t}else switch(o){case"Object":case"Array":return t&&JSON.parse(t);case"Boolean":default:return t;case"Number":return null!=t?+t:t}}new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]),"function"==typeof HTMLElement&&(_e=class extends HTMLElement{$$ctor;$$s;$$c;$$cn=!1;$$d={};$$r=!1;$$p_d={};$$l={};$$l_u=new Map;constructor(e,t,n){super(),this.$$ctor=e,this.$$s=t,n&&this.attachShadow({mode:"open"})}addEventListener(e,t,n){if(this.$$l[e]=this.$$l[e]||[],this.$$l[e].push(t),this.$$c){const n=this.$$c.$on(e,t);this.$$l_u.set(t,n)}super.addEventListener(e,t,n)}removeEventListener(e,t,n){if(super.removeEventListener(e,t,n),this.$$c){const e=this.$$l_u.get(t);e&&(e(),this.$$l_u.delete(t))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){if(await Promise.resolve(),!this.$$cn||this.$$c)return;function e(e){return()=>{let t;return{c:function(){t=N("slot"),"default"!==e&&M(t,"name",e)},m:function(e,n){_(e,t,n)},d:function(e){e&&D(t)}}}}const t={},n=function(e){const t={};return e.childNodes.forEach((e=>{t[e.slot||"default"]=!0})),t}(this);for(const o of this.$$s)o in n&&(t[o]=[e(o)]);for(const s of this.attributes){const i=this.$$g_p(s.name);i in this.$$d||(this.$$d[i]=Fe(i,s.value,this.$$p_d,"toProp"))}for(const l in this.$$p_d)l in this.$$d||void 0===this[l]||(this.$$d[l]=this[l],delete this[l]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:t,$$scope:{ctx:[]}}});const r=()=>{this.$$r=!0;for(const e in this.$$p_d)if(this.$$d[e]=this.$$c.$$.ctx[this.$$c.$$.props[e]],this.$$p_d[e].reflect){const t=Fe(e,this.$$d[e],this.$$p_d,"toAttribute");null==t?this.removeAttribute(this.$$p_d[e].attribute||e):this.setAttribute(this.$$p_d[e].attribute||e,t)}this.$$r=!1};this.$$c.$$.after_update.push(r),r();for(const c in this.$$l)for(const a of this.$$l[c]){const u=this.$$c.$on(c,a);this.$$l_u.set(a,u)}this.$$l={}}}attributeChangedCallback(e,t,n){this.$$r||(e=this.$$g_p(e),this.$$d[e]=Fe(e,n,this.$$p_d,"toProp"),this.$$c?.$set({[e]:this.$$d[e]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then((()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)}))}$$g_p(e){return Object.keys(this.$$p_d).find((t=>this.$$p_d[t].attribute===e||!this.$$p_d[t].attribute&&t.toLowerCase()===e))||e}});class Ie{$$=void 0;$$set=void 0;$destroy(){Re(this,1),this.$destroy=e}$on(t,n){if(!s(n))return e;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const e=r.indexOf(n);-1!==e&&r.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function Ue(e){let t,n,r,o;const i=e[2].default,l=d(i,e,e[1],null);return{c(){t=N("form"),l&&l.c(),M(t,"class","column-card svelte-y86hrj")},m(i,c){_(i,t,c),l&&l.m(t,null),n=!0,r||(o=U(t,"submit",P((function(){s(e[0])&&e[0].apply(this,arguments)}))),r=!0)},p(t,[r]){e=t,l&&l.p&&(!n||2&r)&&h(l,i,e,e[1],n?f(i,e[1],r,null):m(e[1]),null)},i(e){n||(be(l,e),n=!0)},o(e){ye(l,e),n=!1},d(e){e&&D(t),l&&l.d(e),r=!1,o()}}}function Pe(e,t,n){let{$$slots:r={},$$scope:o}=t,{onSubmit:s}=t;return e.$$set=e=>{"onSubmit"in e&&n(0,s=e.onSubmit),"$$scope"in e&&n(1,o=e.$$scope)},[s,o,r]}"undefined"!=typeof window&&(window.__svelte||(window.__svelte={v:new Set})).v.add("4");const je=class extends Ie{constructor(e){super(),Le(this,e,Pe,Ue,i,{onSubmit:0})}};function Me(e,t,n){const r=e.slice();return r[6]=t[n],r}function ze(e,t){let n,r,o,s,i,l,c,a,u,d=!1,p=t[6].label+"";return c=function(e){let t;return{p(...n){t=n,t.forEach((t=>e.push(t)))},r(){t.forEach((t=>e.splice(e.indexOf(t),1)))}}}(t[5][0]),{key:e,first:null,c(){n=N("label"),r=N("input"),i=F(),l=L(p),M(r,"type","radio"),M(r,"name",t[2]),r.__value=o=t[6].value,G(r,r.__value),r.checked=s=t[0]===t[6].value,M(n,"class","svelte-1tapr9t"),B(n,"selected",t[0]===t[6].value),c.p(r),this.first=n},m(e,o){_(e,n,o),S(n,r),r.checked=r.__value===t[0],S(n,i),S(n,l),a||(u=U(r,"change",t[4]),a=!0)},p(e,i){t=e,4&i&&M(r,"name",t[2]),2&i&&o!==(o=t[6].value)&&(r.__value=o,G(r,r.__value),d=!0),3&i&&s!==(s=t[0]===t[6].value)&&(r.checked=s),(d||3&i)&&(r.checked=r.__value===t[0]),2&i&&p!==(p=t[6].label+"")&&z(l,p),3&i&&B(n,"selected",t[0]===t[6].value)},d(e){e&&D(n),c.r(),a=!1,u()}}}function Ge(t){let n,r=[],o=new Map,s=Te(t[1]);const i=e=>e[6].value;for(let e=0;e<s.length;e+=1){let n=Me(t,s,e),l=i(n);o.set(l,r[e]=ze(l,n))}return{c(){n=N("div");for(let e=0;e<r.length;e+=1)r[e].c();M(n,"role","radiogroup"),M(n,"class",t[3])},m(e,t){_(e,n,t);for(let e=0;e<r.length;e+=1)r[e]&&r[e].m(n,null)},p(e,[t]){7&t&&(s=Te(e[1]),r=Oe(r,t,i,1,e,s,o,n,Se,ze,null,Me)),8&t&&M(n,"class",e[3])},i:e,o:e,d(e){e&&D(n);for(let e=0;e<r.length;e+=1)r[e].d()}}}function Be(e,t,n){let{options:r}=t,{selected:o}=t,{name:s=`radio-${Math.random().toString().slice(2)}`}=t,{class:i}=t;return e.$$set=e=>{"options"in e&&n(1,r=e.options),"selected"in e&&n(0,o=e.selected),"name"in e&&n(2,s=e.name),"class"in e&&n(3,i=e.class)},[o,r,s,i,function(){o=this.__value,n(0,o)},[[]]]}const He=class extends Ie{constructor(e){super(),Le(this,e,Be,Ge,i,{options:1,selected:0,name:2,class:3})}},qe=[];function We(t,n=e){let r;const o=new Set;function s(e){if(i(t,e)&&(t=e,r)){const e=!qe.length;for(const e of o)e[1](),qe.push(e,t);if(e){for(let e=0;e<qe.length;e+=2)qe[e][0](qe[e+1]);qe.length=0}}}function l(e){s(e(t))}return{set:s,update:l,subscribe:function(i,c=e){const a=[i,c];return o.add(a),1===o.size&&(r=n(s,l)||e),i(t),()=>{o.delete(a),0===o.size&&r&&(r(),r=null)}}}}var Ye,Ke;!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.REGEXP=1]="REGEXP",e[e.FUNCTION=2]="FUNCTION"}(Ye||(Ye={})),function(e){e[e.NONE=0]="NONE",e[e.REGEXP=1]="REGEXP",e[e.SELECTOR=2]="SELECTOR",e[e.FUNCTION=3]="FUNCTION"}(Ke||(Ke={}));const Xe={useTiny:!1,nextLink:Ye.DEFAULT,nextLinkRegex:'href="([^"]+)"[^>]*>\\s*Next',nextLinkFn:'return "https://www.reddit.com/r/HFY/comments/f94rak/oc_pthok_eats_an_ice_cream_cone/" // use `document` or `html` to extract',transform:Ke.NONE,transformRegex:".md",transformSelector:"",transformFn:'title = "P\'Thok Eats an Ice Cream Cone" // or read from `title`\nhtml = "https://www.reddit.com/r/HFY/comments/f94rak/oc_pthok_eats_an_ice_cream_cone/" // use `document`, `html`, `url`'},Ve=We(Xe),Je=e=>{const t=new Function("sandbox",`with (sandbox) {${e}\n}`),n=Object.create(null);n.console={log:console.log,table:console.table,error:console.error,assert:console.assert};const r=new Proxy(n,{has:Ze,get:Qe});return e=>(e&&Object.defineProperties(r,e),{proxy:r,ret:t(r)})};function Ze(e,t){return!0}function Qe(e,t){if(t!==Symbol.unscopables)return e[t]}function et(e){let t,n,r,o,s,i,l,c,a,u;return{c(){t=N("label"),n=L("Function: "),r=N("span"),r.textContent="Only input code you trust!",o=F(),s=N("textarea"),l=F(),c=N("span"),c.innerHTML="Globals <code>document</code> and <code>html</code> are available; Must produce the url as <code>return</code>",M(r,"class","small warning svelte-5v9ihf"),M(s,"rows","5"),M(s,"placeholder",i=Xe.nextLinkFn),M(s,"class","svelte-5v9ihf"),M(c,"class","small svelte-5v9ihf"),M(t,"class","field svelte-5v9ihf")},m(i,d){_(i,t,d),S(t,n),S(t,r),S(t,o),S(t,s),G(s,e[0].nextLinkFn),S(t,l),S(t,c),a||(u=U(s,"input",e[7]),a=!0)},p(e,t){1&t&&G(s,e[0].nextLinkFn)},d(e){e&&D(t),a=!1,u()}}}function tt(e){let t,n,r,o,s,i,l,c;return{c(){t=N("label"),n=L("Regex:\n          "),r=N("input"),s=F(),i=N("span"),i.textContent="Must produce the url in the first group",M(r,"type","text"),M(r,"placeholder",o=Xe.nextLinkRegex),M(r,"class","svelte-5v9ihf"),M(i,"class","small svelte-5v9ihf"),M(t,"class","field svelte-5v9ihf")},m(o,a){_(o,t,a),S(t,n),S(t,r),G(r,e[0].nextLinkRegex),S(t,s),S(t,i),l||(c=U(r,"input",e[6]),l=!0)},p(e,t){1&t&&r.value!==e[0].nextLinkRegex&&G(r,e[0].nextLinkRegex)},d(e){e&&D(t),l=!1,c()}}}function nt(t){let n;return{c(){n=N("span"),n.textContent='Finds a "First" link, with fallback to other links that aren\'t "Previous" or "Index" or "First"',M(n,"class","small svelte-5v9ihf")},m(e,t){_(e,n,t)},p:e,d(e){e&&D(n)}}}function rt(e){let t,n,r,o,s,i,l,c,a,u;return{c(){t=N("label"),n=L("Function: "),r=N("span"),r.textContent="Only input code you trust!",o=F(),s=N("textarea"),l=F(),c=N("span"),c.innerHTML="Globals <code>document</code>, <code>html</code>, <code>title</code> and <code>url</code> are available; Modify the latter three to transform",M(r,"class","small warning svelte-5v9ihf"),M(s,"rows","5"),M(s,"placeholder",i=Xe.transformFn),M(s,"class","svelte-5v9ihf"),M(c,"class","small svelte-5v9ihf"),M(t,"class","field svelte-5v9ihf")},m(i,d){_(i,t,d),S(t,n),S(t,r),S(t,o),S(t,s),G(s,e[0].transformFn),S(t,l),S(t,c),a||(u=U(s,"input",e[11]),a=!0)},p(e,t){1&t&&G(s,e[0].transformFn)},d(e){e&&D(t),a=!1,u()}}}function ot(e){let t,n,r,o,s,i;return{c(){t=N("label"),n=L("Selector:\n          "),r=N("input"),M(r,"type","text"),M(r,"placeholder",o=Xe.transformSelector),M(r,"class","svelte-5v9ihf"),M(t,"class","field svelte-5v9ihf")},m(o,l){_(o,t,l),S(t,n),S(t,r),G(r,e[0].transformSelector),s||(i=U(r,"input",e[10]),s=!0)},p(e,t){1&t&&r.value!==e[0].transformSelector&&G(r,e[0].transformSelector)},d(e){e&&D(t),s=!1,i()}}}function st(e){let t,n,r,o,s,i,l,c;return{c(){t=N("label"),n=L("Regex:\n          "),r=N("input"),s=F(),i=N("span"),i.textContent="Must produce the new html in the first group",M(r,"type","text"),M(r,"placeholder",o=Xe.transformRegex),M(r,"class","svelte-5v9ihf"),M(i,"class","small svelte-5v9ihf"),M(t,"class","field svelte-5v9ihf")},m(o,a){_(o,t,a),S(t,n),S(t,r),G(r,e[0].transformRegex),S(t,s),S(t,i),l||(c=U(r,"input",e[9]),l=!0)},p(e,t){1&t&&r.value!==e[0].transformRegex&&G(r,e[0].transformRegex)},d(e){e&&D(t),l=!1,c()}}}function it(e){let t,n,r,o,s,i,l,c,a,u,d,p,f,h,m,g,$,v,b,y,w,x,E,k,T,C,O;function A(t){e[5](t)}let R={options:[{value:Ye.DEFAULT,label:"Default"},{value:Ye.REGEXP,label:"Regex"},{value:Ye.FUNCTION,label:"Function"}],name:"radio-next-type"};function I(e,t){return e[0].nextLink===Ye.DEFAULT?nt:e[0].nextLink===Ye.REGEXP?tt:e[0].nextLink===Ye.FUNCTION?et:void 0}void 0!==e[0].nextLink&&(R.selected=e[0].nextLink),f=new He({props:R}),ne.push((()=>De(f,"selected",A)));let P=I(e),j=P&&P(e);function z(t){e[8](t)}let G={options:[{value:Ke.NONE,label:"No transform"},{value:Ke.REGEXP,label:"Regex"},{value:Ke.SELECTOR,label:"Query-Selector"},{value:Ke.FUNCTION,label:"Function"}],name:"radio-transform"};function B(e,t){return e[0].transform===Ke.REGEXP?st:e[0].transform===Ke.SELECTOR?ot:e[0].transform===Ke.FUNCTION?rt:void 0}void 0!==e[0].transform&&(G.selected=e[0].transform),x=new He({props:G}),ne.push((()=>De(x,"selected",z)));let H=B(e),q=H&&H(e);return{c(){t=N("h3"),t.textContent="Editor",n=F(),r=N("div"),o=N("label"),s=N("input"),i=L("\n        Use TinyMCE, a powerful HTML editor, for editing chapters"),l=F(),c=N("h3"),c.textContent="Next chapter",a=F(),u=N("div"),d=N("p"),d.textContent="Specify how next chapter links are extracted.",p=F(),Ae(f.$$.fragment),m=F(),j&&j.c(),g=F(),$=N("h3"),$.textContent="Chapter transform",v=F(),b=N("div"),y=N("p"),y.textContent="Automatically transform chapter contents.",w=F(),Ae(x.$$.fragment),k=F(),q&&q.c(),M(s,"type","checkbox"),M(s,"class","svelte-5v9ihf"),M(o,"class","field svelte-5v9ihf")},m(h,E){_(h,t,E),_(h,n,E),_(h,r,E),S(r,o),S(o,s),s.checked=e[0].useTiny,S(o,i),_(h,l,E),_(h,c,E),_(h,a,E),_(h,u,E),S(u,d),S(u,p),Ne(f,u,null),S(u,m),j&&j.m(u,null),_(h,g,E),_(h,$,E),_(h,v,E),_(h,b,E),S(b,y),S(b,w),Ne(x,b,null),S(b,k),q&&q.m(b,null),T=!0,C||(O=U(s,"change",e[4]),C=!0)},p(e,t){1&t&&(s.checked=e[0].useTiny);const n={};!h&&1&t&&(h=!0,n.selected=e[0].nextLink,ce((()=>h=!1))),f.$set(n),P===(P=I(e))&&j?j.p(e,t):(j&&j.d(1),j=P&&P(e),j&&(j.c(),j.m(u,null)));const r={};!E&&1&t&&(E=!0,r.selected=e[0].transform,ce((()=>E=!1))),x.$set(r),H===(H=B(e))&&q?q.p(e,t):(q&&q.d(1),q=H&&H(e),q&&(q.c(),q.m(b,null)))},i(e){T||(be(f.$$.fragment,e),be(x.$$.fragment,e),T=!0)},o(e){ye(f.$$.fragment,e),ye(x.$$.fragment,e),T=!1},d(e){e&&(D(t),D(n),D(r),D(l),D(c),D(a),D(u),D(g),D($),D(v),D(b)),Re(f),j&&j.d(),Re(x),q&&q.d(),C=!1,O()}}}function lt(e){let t,n,r,o;return{c(){t=N("span"),n=L("Transform Function invalid: "),r=N("code"),o=L(e[3]),M(t,"class","small error svelte-5v9ihf")},m(e,s){_(e,t,s),S(t,n),S(t,r),S(r,o)},p(e,t){8&t&&z(o,e[3])},d(e){e&&D(t)}}}function ct(e){let t,n,r,o;return{c(){t=N("span"),n=L("Transform Selector invalid: "),r=N("code"),o=L(e[3]),M(t,"class","small error svelte-5v9ihf")},m(e,s){_(e,t,s),S(t,n),S(t,r),S(r,o)},p(e,t){8&t&&z(o,e[3])},d(e){e&&D(t)}}}function at(e){let t,n,r,o;return{c(){t=N("span"),n=L("Transform Regex invalid: "),r=N("code"),o=L(e[3]),M(t,"class","small error svelte-5v9ihf")},m(e,s){_(e,t,s),S(t,n),S(t,r),S(r,o)},p(e,t){8&t&&z(o,e[3])},d(e){e&&D(t)}}}function ut(e){let t,n,r,o;return{c(){t=N("span"),n=L("Chapter Function invalid: "),r=N("code"),o=L(e[2]),M(t,"class","small error svelte-5v9ihf")},m(e,s){_(e,t,s),S(t,n),S(t,r),S(r,o)},p(e,t){4&t&&z(o,e[2])},d(e){e&&D(t)}}}function dt(e){let t,n,r,o;return{c(){t=N("span"),n=L("Chapter Regex invalid: "),r=N("code"),o=L(e[2]),M(t,"class","small error svelte-5v9ihf")},m(e,s){_(e,t,s),S(t,n),S(t,r),S(r,o)},p(e,t){4&t&&z(o,e[2])},d(e){e&&D(t)}}}function pt(e){let t,n,r,o,s,i,l,c,a,u;function d(e,t){return e[1]&&e[0].nextLink===Ye.REGEXP&&e[2]?dt:e[1]&&e[0].nextLink===Ye.FUNCTION&&e[2]?ut:e[1]&&e[0].transform===Ke.REGEXP&&e[3]?at:e[1]&&e[0].transform===Ke.SELECTOR&&e[3]?ct:e[1]&&e[0].transform===Ke.FUNCTION&&e[3]?lt:void 0}n=new je({props:{$$slots:{default:[it]},$$scope:{ctx:e}}});let p=d(e),f=p&&p(e);return{c(){t=N("div"),Ae(n.$$.fragment),r=F(),o=N("button"),s=L("Save"),i=F(),f&&f.c(),l=I(),M(t,"class","settings svelte-5v9ihf"),M(o,"type","submit"),o.disabled=e[1]},m(d,p){_(d,t,p),Ne(n,t,null),_(d,r,p),_(d,o,p),S(o,s),_(d,i,p),f&&f.m(d,p),_(d,l,p),c=!0,a||(u=U(o,"click",e[12]),a=!0)},p(e,[t]){const r={};262145&t&&(r.$$scope={dirty:t,ctx:e}),n.$set(r),(!c||2&t)&&(o.disabled=e[1]),p===(p=d(e))&&f?f.p(e,t):(f&&f.d(1),f=p&&p(e),f&&(f.c(),f.m(l.parentNode,l)))},i(e){c||(be(n.$$.fragment,e),c=!0)},o(e){ye(n.$$.fragment,e),c=!1},d(e){e&&(D(t),D(r),D(o),D(i),D(l)),Re(n),f&&f.d(e),a=!1,u()}}}function ft(e,t,n){let r;u(e,Ve,(e=>n(13,r=e)));const o=Object.assign({},r),s=Object.assign({},r),i=(e,t)=>{if(!e.trim().length)return{error:"Must specify a regular expression",disableSave:!0};try{return new RegExp(e,"i"),{error:void 0,disableSave:t}}catch(e){return{error:e,disableSave:!0}}},l=(e,t)=>{if(!e.trim().length)return{error:"Must specify a function",disableSave:!0};try{return Je(e),{error:void 0,disableSave:t}}catch(e){return{error:e,disableSave:!0}}};let c,a,d=!1;return Z((()=>n(1,d=!0))),e.$$.update=()=>{1&e.$$.dirty&&n(1,d=o.nextLink===s.nextLink&&o.nextLinkRegex===s.nextLinkRegex&&o.nextLinkFn===s.nextLinkFn&&o.transform===s.transform&&o.transformRegex===s.transformRegex&&o.transformSelector===s.transformSelector&&o.transformFn===s.transformFn&&o.useTiny===s.useTiny),3&e.$$.dirty&&o.nextLink===Ye.REGEXP&&n(1,({disableSave:d,error:c}=i(o.nextLinkRegex,d)),d,(n(2,c),n(0,o),n(1,d))),3&e.$$.dirty&&o.nextLink===Ye.FUNCTION&&n(1,({disableSave:d,error:c}=l(o.nextLinkFn,d)),d,(n(2,c),n(0,o),n(1,d))),3&e.$$.dirty&&o.transform===Ke.REGEXP&&n(1,({disableSave:d,error:a}=i(o.transformRegex,d)),d,(n(3,a),n(0,o),n(1,d))),3&e.$$.dirty&&o.transform===Ke.SELECTOR&&n(1,({disableSave:d,error:a}=((e,t)=>{if(!e.trim().length)return{error:"Must specify a selector",disableSave:!0};try{return document.querySelector(e),{error:void 0,disableSave:t}}catch(e){return{error:e,disableSave:!0}}})(o.transformSelector,d)),d,(n(3,a),n(0,o),n(1,d))),3&e.$$.dirty&&o.transform===Ke.FUNCTION&&n(1,({disableSave:d,error:a}=l(o.transformFn,d)),d,(n(3,a),n(0,o),n(1,d)))},[o,d,c,a,function(){o.useTiny=this.checked,n(0,o)},function(t){e.$$.not_equal(o.nextLink,t)&&(o.nextLink=t,n(0,o))},function(){o.nextLinkRegex=this.value,n(0,o)},function(){o.nextLinkFn=this.value,n(0,o)},function(t){e.$$.not_equal(o.transform,t)&&(o.transform=t,n(0,o))},function(){o.transformRegex=this.value,n(0,o)},function(){o.transformSelector=this.value,n(0,o)},function(){o.transformFn=this.value,n(0,o)},()=>{Ve.set(o),n(1,d=!0)}]}const ht=class extends Ie{constructor(e){super(),Le(this,e,ft,pt,i,{})}};var mt=l(3),gt=l.n(mt);function $t(e){let t,n,r;return{c(){t=N("a"),t.textContent="Back to Search",M(t,"href","#search"),M(t,"class","small")},m(o,i){_(o,t,i),n||(r=U(t,"click",P((function(){s(e[0])&&e[0].apply(this,arguments)}))),n=!0)},p(t,n){e=t},d(e){e&&D(t),n=!1,r()}}}function vt(t){let n,r=t[0]&&$t(t);return{c(){r&&r.c(),n=I()},m(e,t){r&&r.m(e,t),_(e,n,t)},p(e,[t]){e[0]?r?r.p(e,t):(r=$t(e),r.c(),r.m(n.parentNode,n)):r&&(r.d(1),r=null)},i:e,o:e,d(e){e&&D(n),r&&r.d(e)}}}function bt(e,t,n){let{backToSearch:r}=t;return e.$$set=e=>{"backToSearch"in e&&n(0,r=e.backToSearch)},[r]}const yt=class extends Ie{constructor(e){super(),Le(this,e,bt,vt,i,{backToSearch:0})}};function wt(e,t,n){const r=e.slice();return r[4]=t[n],r}function xt(t){let n;return{c(){n=N("span"),n.textContent=`Sorry, can't process that${t[4]?": ":""}${t[4].message||t[4]}`,M(n,"class","error svelte-m4i2yw")},m(e,t){_(e,n,t)},p:e,d(e){e&&D(n)}}}function Et(e){let t,n,r;return{c(){t=N("button"),t.textContent="Retry"},m(o,i){_(o,t,i),n||(r=U(t,"click",(function(){s(e[0])&&e[0].apply(this,arguments)})),n=!0)},p(t,n){e=t},d(e){e&&D(t),n=!1,r()}}}function kt(e){let t,n,r;return{c(){t=N("a"),t.textContent="back",M(t,"href","#back")},m(o,i){_(o,t,i),n||(r=U(t,"click",P((function(){s(e[1])&&e[1].apply(this,arguments)}))),n=!0)},p(t,n){e=t},d(e){e&&D(t),n=!1,r()}}}function Tt(t){let n,r,o,s,i=Te(t[2]),l=[];for(let e=0;e<i.length;e+=1)l[e]=xt(wt(t,i,e));let c=t[0]&&Et(t),a=t[1]&&kt(t);return{c(){n=N("p");for(let e=0;e<l.length;e+=1)l[e].c();r=F(),c&&c.c(),o=F(),a&&a.c(),s=I()},m(e,t){_(e,n,t);for(let e=0;e<l.length;e+=1)l[e]&&l[e].m(n,null);_(e,r,t),c&&c.m(e,t),_(e,o,t),a&&a.m(e,t),_(e,s,t)},p(e,[t]){if(4&t){let r;for(i=Te(e[2]),r=0;r<i.length;r+=1){const o=wt(e,i,r);l[r]?l[r].p(o,t):(l[r]=xt(o),l[r].c(),l[r].m(n,null))}for(;r<l.length;r+=1)l[r].d(1);l.length=i.length}e[0]?c?c.p(e,t):(c=Et(e),c.c(),c.m(o.parentNode,o)):c&&(c.d(1),c=null),e[1]?a?a.p(e,t):(a=kt(e),a.c(),a.m(s.parentNode,s)):a&&(a.d(1),a=null)},i:e,o:e,d(e){e&&(D(n),D(r),D(o),D(s)),A(l,e),c&&c.d(e),a&&a.d(e)}}}function St(e,t,n){let{error:r}=t,{retry:o}=t,{back:s}=t,i=Array.isArray(r)?r:[r];return e.$$set=e=>{"error"in e&&n(3,r=e.error),"retry"in e&&n(0,o=e.retry),"back"in e&&n(1,s=e.back)},[o,s,i,r]}const Ct=class extends Ie{constructor(e){super(),Le(this,e,St,Tt,i,{error:3,retry:0,back:1})}};function Ot(e){let t,n,r,o,s;const i=e[1].default,l=d(i,e,e[0],null),c=l||function(){let e;return{c(){e=L("Loading...")},m(t,n){_(t,e,n)},d(t){t&&D(e)}}}();return{c(){t=N("div"),n=N("div"),n.innerHTML='<span class="loading-slider svelte-w1n7v1">•</span>',r=F(),o=N("p"),c&&c.c(),M(n,"class","loading-slider-container svelte-w1n7v1"),M(o,"class","loading svelte-w1n7v1"),M(t,"class","loading-container svelte-w1n7v1")},m(e,i){_(e,t,i),S(t,n),S(t,r),S(t,o),c&&c.m(o,null),s=!0},p(e,[t]){l&&l.p&&(!s||1&t)&&h(l,i,e,e[0],s?f(i,e[0],t,null):m(e[0]),null)},i(e){s||(be(c,e),s=!0)},o(e){ye(c,e),s=!1},d(e){e&&D(t),c&&c.d(e)}}}function _t(e,t,n){let{$$slots:r={},$$scope:o}=t;return e.$$set=e=>{"$$scope"in e&&n(0,o=e.$$scope)},[o,r]}const Dt=class extends Ie{constructor(e){super(),Le(this,e,_t,Ot,i,{})}};let At=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&n[e]];return t};const Nt=async(e,t)=>{const n="undefined"!=typeof AbortController?new AbortController:{},r=setTimeout((()=>n.abort&&n.abort()),t);try{return await fetch(e,{signal:n.signal})}finally{clearTimeout(r)}},Rt=async(e,t=1e4,n=3)=>{for(let r=0;r<n-1;r++)try{return await Nt(e,t)}catch(t){console.log(`Failed to fetch \`${e}\` ${r+1} ${0===r?"time":"times"}. Retrying...`)}return Nt(e,t)},Lt=async(e,t,n=1e4,r=3)=>{const o=new URL(e,t);for(let e=0;e<r-1;e++)try{return await Nt(o,n)}catch(t){console.log(`Failed to fetch \`${o}\` ${e+1} ${0===e?"time":"times"}. Retrying...`)}return Nt(o,n)};function Ft(e){const t=e-1;return t*t*t+1}const It="www.reddit.com",Ut=e=>(e instanceof URL||(e=new URL(e)),e.hostname=It,e.pathname.endsWith("/")?e.pathname=`${e.pathname.slice(0,e.pathname.length-1)}.json`:e.pathname.endsWith(".json")||(e.pathname+=".json"),e.protocol="https",e.search="",e.hash="",e.toString()),Pt=e=>{const t=new URL(e);return("reddit.com"===t.host||t.host.match(/\.reddit\.com$/))&&e.match(".json$")?e.slice(0,-5).replace("https://api","https://www"):e},jt=(()=>{const e=new DOMParser;return t=>{var n;return null!==(n=e.parseFromString(t,"text/html").documentElement.textContent)&&void 0!==n?n:""}})(),Mt=(()=>{const e=new DOMParser;return t=>e.parseFromString(t,"text/html")})();function zt(e){return"string"==typeof e||e instanceof String}function Gt(e,{delay:t=0,duration:n=200,prop:r="height",easing:o=Ft}={}){const s=getComputedStyle(e)[r];if(!zt(s)||!s.endsWith("px"))throw new Error(`invalid property '${r}' does not return pixels`);const i=+s.slice(0,-2);return{delay:t,duration:n,easing:o,css:e=>`overflow: hidden; ${r}: ${e*i}px`}}const Bt=/(?:https?:\/\/(?:[^.]+\.)?reddit\.com)?\/r\/([^\/]+)\/comments\/.+/i,Ht=/href="((?:https?:\/\/(?:[^.]+\.)?reddit\.com)?\/r\/([^\/]+)\/comments\/[^"]+)"[^>]*>\s*([^<]+)/gim,qt=/href="([^"]+)"[^>]*>\s*(.+)<\/a>/gim,Wt=/^https?:\/\/(?:[^.]+\.)?reddit\.com\/r\/hfy\/wiki\/series\//i,Yt=async e=>{const t=await Rt(new URL(`https://${It}/r/hfy/wiki/series.json`)),n=await t.json();if(!t.ok)throw n.message;const r=[...n.data.content_md.matchAll(/\[([^\]]+)\]\s*\(((?:https?:\/\/(?:[^.]+\.)?reddit\.com)?\/r\/hfy\/wiki\/series\/[^)]+)\)\s*(?:\[\*([^\]]+)\*\])?/gim)].map((e=>({title:e[1],author:e[3],url:Ut(e[2].startsWith("http")?e[2]:`https://${It}${e[2]}`)})));if(!e)return r;const o=e.toLowerCase();return r.filter((e=>-1!==e.title.toLowerCase().indexOf(o)))},Kt=/^https?:\/\/(?:[^.]+\.)?reddit\.com\/r\/([^/]+)\/comments\//i,Xt=e=>({id:e[0].data.children[0].data.id,title:e[0].data.children[0].data.title,content:jt(e[0].data.children[0].data.selftext_html),apiUrl:Ut(e[0].data.children[0].data.url),displayUrl:e[0].data.children[0].data.url,needsFetching:!1});var Vt;!function(e){e[e.HFY_SERIES=0]="HFY_SERIES",e[e.POST=1]="POST",e[e.GENERIC=2]="GENERIC",e[e.SEARCH=3]="SEARCH"}(Vt||(Vt={}));const Jt=new DOMParser,Zt=(e,t)=>e===Vt.GENERIC?t:Ut(t),Qt=(e,t)=>e.type===Vt.GENERIC?t.text():t.json(),en=(e,t,n)=>{switch(e){case Vt.POST:case Vt.HFY_SERIES:return Xt(t);case Vt.GENERIC:return((e,t)=>{const n=Mt(e);return{id:At(),apiUrl:t,displayUrl:t,title:n.title,content:n.body.innerHTML,needsFetching:!1}})(t,n)}throw new Error(`Getting data from source type \`${Vt[e]}\` not supported, this should never happen`)};let tn,nn;const rn=(e,t)=>{switch(e.nextLink){case Ye.DEFAULT:return(e=>{const t=e.match(/href="([^"]+)"[^>]*>\s*Next/i);if(t)return t[1];const n=[...e.matchAll(Ht)].reverse().find((e=>{const t=e[3].toLowerCase();return!t.startsWith("first")&&!t.startsWith("prev")&&!t.startsWith("index")}));if(n)return n[1];const r=[...e.matchAll(qt)],o=r.find((e=>-1!==e[2].toLowerCase().indexOf("next")));if(o)return o[1];const s=r.reverse().find((e=>{const t=e[2].toLowerCase();return!t.startsWith("first")&&!t.startsWith("prev")&&!t.startsWith("index")}));return s?s[1]:void 0})(t);case Ye.REGEXP:return(e=>{const t=e.match(tn);if(t&&t.length>1)return t[1]})(t);case Ye.FUNCTION:return(e=>{let t;return nn({document:{get:()=>t=null!=t?t:Jt.parseFromString(e,"text/html"),configurable:!0},html:{writable:!1,value:e,configurable:!0}}).ret})(t)}};let on;const sn=e=>{const t=e.match(on);return t&&t.length>1&&(e=t[1]),e};let ln;const cn=(e,t)=>{switch(e.transform){case Ke.NONE:return Object.assign(Object.assign({},t),{transformedContent:t.content});case Ke.REGEXP:return Object.assign(Object.assign({},t),{transformedContent:sn(t.content||"")});case Ke.SELECTOR:return Object.assign(Object.assign({},t),{transformedContent:(n=e.transformSelector,r=t.content||"",null===(o=Jt.parseFromString(r,"text/html").querySelector(n))||void 0===o?void 0:o.innerHTML)});case Ke.FUNCTION:return(e=>{let t;const n={document:{get:()=>t=null!=t?t:Jt.parseFromString(e.content||"","text/html"),configurable:!0},title:{writable:!0,value:e.title,configurable:!0},html:{writable:!0,value:e.content,configurable:!0},url:{writable:!0,value:e.displayUrl,configurable:!0}},{proxy:r}=ln(n);return Object.assign(Object.assign({},e),{title:zt(r.title)?r.title:e.title,transformedContent:zt(r.html)?r.html:e.content,displayUrl:zt(r.url)?r.url:e.displayUrl})})(t)}var n,r,o},an=(e,t)=>t.map(cn.bind(null,e));var un;Ve.subscribe((e=>{try{tn=new RegExp(e.nextLinkRegex,"i"),on=new RegExp(e.transformRegex,"i"),nn=Je(e.nextLinkFn),ln=Je(e.transformFn)}catch(e){console.error(e)}})),function(e){e[e.INPUT=0]="INPUT",e[e.SEARCH=1]="SEARCH",e[e.BOOK_DATA=2]="BOOK_DATA",e[e.EDIT_DATA=3]="EDIT_DATA",e[e.FIND_CHAPTERS=4]="FIND_CHAPTERS",e[e.DOWNLOAD_CHAPTERS=5]="DOWNLOAD_CHAPTERS",e[e.RESULT=6]="RESULT",e[e.SETTINGS=7]="SETTINGS",e[e._404=8]="_404"}(un||(un={}));const dn=e=>e===un.INPUT?l.p:`${l.p}${un[e].toLowerCase().replace(/_/g,"-")}`;class pn{constructor(){this.stage=un.INPUT}dump(){return[]}}class fn extends pn{constructor(){super(...arguments),this.stage=un.INPUT}next(e){const t=(e=>{try{return new URL(e),(e=>!!e.match(Wt))(e)?Vt.HFY_SERIES:(e=>!!e.match(Kt))(e)?Vt.POST:Vt.GENERIC}catch(e){}return Vt.SEARCH})(e);return console.debug("Input",e,"resulted in type",t),Sn.update((n=>Object.assign(Object.assign({},n),{search:e,series:t!==Vt.SEARCH?{url:Zt(t,e),type:t}:n.series}))),Cn.update((()=>{})),t===Vt.SEARCH?xn(hn):xn(mn)}fromList(e){const t=e.split("\n");return Sn.update((e=>Object.assign(Object.assign({},e),{series:{url:t[0],type:Vt.GENERIC}}))),Cn.update((()=>({author:"unknown",title:"unknown",chapters:t.map(((e,t)=>({apiUrl:e,id:At(),title:`Chapter ${t}`,displayUrl:e})))}))),xn(mn)}fromJSON({series:e,bookData:t}){return Sn.update((t=>Object.assign(Object.assign({},t),{series:e}))),Cn.update((()=>t)),xn(mn)}}class hn extends pn{constructor(){super(...arguments),this.stage=un.SEARCH}next(e){return Sn.update((t=>Object.assign(Object.assign({},t),{series:e}))),Cn.update((()=>{})),xn(mn)}}class mn extends pn{constructor(e=void 0){super(),this.newChapters=e,this.stage=un.BOOK_DATA}next(){return xn(bn)}edit(){return xn(gn)}findMore(){return xn($n)}downloadAll(){return xn(vn)}dump(){return[this.newChapters]}}class gn extends pn{constructor(){super(...arguments),this.stage=un.EDIT_DATA,this.needsSaving=!0}next(e){return Cn.update((()=>e)),xn(mn)}fetch(e){return Cn.update((()=>e)),xn(vn)}}class $n extends pn{constructor(){super(...arguments),this.stage=un.FIND_CHAPTERS,this.needsSaving=!0}next(e,t){return Cn.update((()=>e)),xn(mn,t)}}class vn extends pn{constructor(){super(...arguments),this.stage=un.DOWNLOAD_CHAPTERS,this.needsSaving=!0}next(e){return Cn.update((()=>e)),xn(mn)}}class bn extends pn{constructor(){super(...arguments),this.stage=un.RESULT}next(){return xn(mn)}}class yn extends pn{constructor(){super(...arguments),this.stage=un.SETTINGS}next(){return kn()}}const wn={[un.INPUT]:fn,[un.SEARCH]:hn,[un.BOOK_DATA]:mn,[un.EDIT_DATA]:gn,[un.FIND_CHAPTERS]:$n,[un.DOWNLOAD_CHAPTERS]:vn,[un.RESULT]:bn,[un.SETTINGS]:yn,[un._404]:class extends pn{constructor(){super(...arguments),this.stage=un._404}next(){return kn()}}};function xn(e,...t){Sn.update((n=>{const r=new e(...t);r.from=n.stage;const o=r.dump();try{r.stage===un.SETTINGS?history.pushState({data:o,search:n.search,series:n.series},"",dn(r.stage)):history.replaceState({data:o,search:n.search,series:n.series},"",dn(r.stage))}catch(e){console.error("Data too large! Caution, forwards/backwards won't work as expected!"),o.length>0&&(o[0]=void 0),r.stage===un.SETTINGS?history.pushState({data:o,search:n.search,series:n.series},"",dn(r.stage)):history.replaceState({data:o,search:n.search,series:n.series},"",dn(r.stage))}return Object.assign(Object.assign({},n),{stage:r,lastBookData:e.usesBookData?r.bookData:n.lastBookData})}))}function En(e,{data:t,search:n,series:r}={series:{type:Vt.GENERIC,url:""}}){t=t||[],Sn.update((o=>{try{const s=new wn[e](...t);return s.stage===o.stage.stage?o:(s.from=o.stage,Object.assign(Object.assign({},o),{search:n,series:r,stage:s}))}catch(r){return console.group("Failed to update page"),console.error(r),console.log("Parameters:",e,t,n),console.groupEnd(),history.pushState({data:[],search:o.search,series:o.series},"","/"),o}}))}function kn(){history.back()}function Tn(e,t){return!!e&&e.stage===t}const Sn=We({stage:new fn,series:{type:Vt.GENERIC,url:""}}),Cn=We(void 0),On=new RegExp("^"+l.p.replace("/","/")),_n=()=>{const e=location.pathname.replace(On,"").split("/")[0]||"";if(e.length>60)return;if(""===e)return En(un.INPUT);const t=e.toUpperCase().replace(/-/g,"_"),n=(()=>{var e;try{return JSON.parse(null!==(e=localStorage.getItem("state"))&&void 0!==e?e:"")}catch(e){return}})(),r=Object.assign(Object.assign({},n),history.state||{});return t in un?En(un[t],r):En(un._404)},Dn=e=>{const t=Object.assign(Object.assign({},e),{cover:void 0});return e.cover&&(t.cover=new File([new Uint8Array(e.cover.data)],e.cover.name)),t},An=async e=>{const t=Object.assign(Object.assign({},e),{cover:void 0});if(e.cover){const n=await e.cover.arrayBuffer();t.cover={name:e.cover.name,data:Array.from(new Uint8Array(n))}}return t};function Nn(e,t,n){const r=e.slice();return r[9]=t[n][0],r[10]=t[n][1],r[11]=t[n][2],r}function Rn(e,t,n){const r=e.slice();return r[9]=t[n][0],r[10]=t[n][1],r[11]=t[n][2],r}function Ln(e){let t,n,r,o,i,l,c,a;return t=new Ct({props:{error:e[17],retry:e[7]}}),i=new yt({props:{backToSearch:e[1]}}),{c(){Ae(t.$$.fragment),n=F(),r=N("button"),r.textContent="Back to book",o=F(),Ae(i.$$.fragment)},m(u,d){Ne(t,u,d),_(u,n,d),_(u,r,d),_(u,o,d),Ne(i,u,d),l=!0,c||(a=U(r,"click",(function(){s(e[0].next.bind(e[0]))&&e[0].next.bind(e[0]).apply(this,arguments)})),c=!0)},p(n,r){e=n;const o={};8&r&&(o.error=e[17]),8&r&&(o.retry=e[7]),t.$set(o);const s={};2&r&&(s.backToSearch=e[1]),i.$set(s)},i(e){l||(be(t.$$.fragment,e),be(i.$$.fragment,e),l=!0)},o(e){ye(t.$$.fragment,e),ye(i.$$.fragment,e),l=!1},d(e){e&&(D(n),D(r),D(o)),Re(t,e),Re(i,e),c=!1,a()}}}function Fn(e){let t,n,r,i,l,c,a,u,d,p,f,h,m=e[2].find(qn);function g(){return e[6](e[14])}a=new yt({props:{backToSearch:e[1]}});let $=m&&In(e);return{c(){t=N("h3"),t.textContent="Your e-book is ready!",n=F(),r=N("button"),r.textContent="Download",i=F(),l=N("button"),l.textContent="Back to book",c=F(),Ae(a.$$.fragment),u=F(),$&&$.c(),d=I(),M(t,"class","valid svelte-ardw9p")},m(o,m){_(o,t,m),_(o,n,m),_(o,r,m),_(o,i,m),_(o,l,m),_(o,c,m),Ne(a,o,m),_(o,u,m),$&&$.m(o,m),_(o,d,m),p=!0,f||(h=[U(r,"click",g),U(l,"click",(function(){s(e[0].next.bind(e[0]))&&e[0].next.bind(e[0]).apply(this,arguments)}))],f=!0)},p(t,n){e=t;const r={};2&n&&(r.backToSearch=e[1]),a.$set(r),4&n&&(m=e[2].find(qn)),m?$?$.p(e,n):($=In(e),$.c(),$.m(d.parentNode,d)):$&&($.d(1),$=null)},i(e){p||(be(a.$$.fragment,e),p=!0)},o(e){ye(a.$$.fragment,e),p=!1},d(e){e&&(D(t),D(n),D(r),D(i),D(l),D(c),D(u),D(d)),Re(a,e),$&&$.d(e),f=!1,o(h)}}}function In(e){let t,n=Te(e[2]),r=[];for(let t=0;t<n.length;t+=1)r[t]=jn(Nn(e,n,t));return{c(){t=N("div");for(let e=0;e<r.length;e+=1)r[e].c();M(t,"class","logs svelte-ardw9p")},m(e,n){_(e,t,n);for(let e=0;e<r.length;e+=1)r[e]&&r[e].m(t,null)},p(e,o){if(4&o){let s;for(n=Te(e[2]),s=0;s<n.length;s+=1){const i=Nn(e,n,s);r[s]?r[s].p(i,o):(r[s]=jn(i),r[s].c(),r[s].m(t,null))}for(;s<r.length;s+=1)r[s].d(1);r.length=n.length}},d(e){e&&D(t),A(r,e)}}}function Un(e){let t,n,r=e[10]+"",o=e[11]>1&&Pn(e);return{c(){t=N("p"),n=L(r),o&&o.c(),M(t,"class","small warning svelte-ardw9p")},m(e,r){_(e,t,r),S(t,n),o&&o.m(t,null)},p(e,s){4&s&&r!==(r=e[10]+"")&&z(n,r),e[11]>1?o?o.p(e,s):(o=Pn(e),o.c(),o.m(t,null)):o&&(o.d(1),o=null)},d(e){e&&D(t),o&&o.d()}}}function Pn(e){let t,n,r,o=e[11]+"";return{c(){t=L(" ("),n=L(o),r=L(" times)")},m(e,o){_(e,t,o),_(e,n,o),_(e,r,o)},p(e,t){4&t&&o!==(o=e[11]+"")&&z(n,o)},d(e){e&&(D(t),D(n),D(r))}}}function jn(e){let t,n="warn"===e[9]&&Un(e);return{c(){n&&n.c(),t=I()},m(e,r){n&&n.m(e,r),_(e,t,r)},p(e,r){"warn"===e[9]?n?n.p(e,r):(n=Un(e),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(e){e&&D(t),n&&n.d(e)}}}function Mn(e){let t,n,r,o;t=new Dt({props:{$$slots:{default:[zn]},$$scope:{ctx:e}}});let s=Te(e[2]),i=[];for(let t=0;t<s.length;t+=1)i[t]=Bn(Rn(e,s,t));return{c(){Ae(t.$$.fragment),n=F(),r=N("div");for(let e=0;e<i.length;e+=1)i[e].c();M(r,"class","logs svelte-ardw9p")},m(e,s){Ne(t,e,s),_(e,n,s),_(e,r,s);for(let e=0;e<i.length;e+=1)i[e]&&i[e].m(r,null);o=!0},p(e,n){const o={};if(262144&n&&(o.$$scope={dirty:n,ctx:e}),t.$set(o),4&n){let t;for(s=Te(e[2]),t=0;t<s.length;t+=1){const o=Rn(e,s,t);i[t]?i[t].p(o,n):(i[t]=Bn(o),i[t].c(),i[t].m(r,null))}for(;t<i.length;t+=1)i[t].d(1);i.length=s.length}},i(e){o||(be(t.$$.fragment,e),o=!0)},o(e){ye(t.$$.fragment,e),o=!1},d(e){e&&(D(n),D(r)),Re(t,e),A(i,e)}}}function zn(e){let t;return{c(){t=L("Please wait, generating e-book...")},m(e,n){_(e,t,n)},d(e){e&&D(t)}}}function Gn(e){let t,n,r,o=e[11]+"";return{c(){t=L(" ("),n=L(o),r=L(" times)")},m(e,o){_(e,t,o),_(e,n,o),_(e,r,o)},p(e,t){4&t&&o!==(o=e[11]+"")&&z(n,o)},d(e){e&&(D(t),D(n),D(r))}}}function Bn(e){let t,n,r=e[10]+"",o=e[11]>1&&Gn(e);return{c(){t=N("p"),n=L(r),o&&o.c(),M(t,"class","small svelte-ardw9p"),B(t,"warning","warn"===e[9])},m(e,r){_(e,t,r),S(t,n),o&&o.m(t,null)},p(e,s){4&s&&r!==(r=e[10]+"")&&z(n,r),e[11]>1?o?o.p(e,s):(o=Gn(e),o.c(),o.m(t,null)):o&&(o.d(1),o=null),4&s&&B(t,"warning","warn"===e[9])},d(e){e&&D(t),o&&o.d()}}}function Hn(e){let t,n,r,o={ctx:e,current:null,token:null,hasCatch:!0,pending:Mn,then:Fn,catch:Ln,value:14,error:17,blocks:[,,,]};return Ee(n=e[3],o),{c(){t=I(),o.block.c()},m(e,n){_(e,t,n),o.block.m(e,o.anchor=n),o.mount=()=>t.parentNode,o.anchor=t,r=!0},p(t,[r]){e=t,o.ctx=e,8&r&&n!==(n=e[3])&&Ee(n,o)||ke(o,e,r)},i(e){r||(be(o.block),r=!0)},o(e){for(let e=0;e<3;e+=1)ye(o.blocks[e]);r=!1},d(e){e&&D(t),o.block.d(e),o.token=null,o=null}}}const qn=([e])=>"warn"===e;function Wn(e,t,n){let r;u(e,Cn,(e=>n(4,r=e)));let{stage:o}=t,{backToSearch:s}=t;const i=Promise.all([l.e(794),l.e(22)]).then(l.t.bind(l,794,23));if(!r)throw new Error("Inconsistent state, expected to have book data");let c=[];const a=async()=>{n(2,c=[]);const{default:e}=await i;return await e({title:r.title,author:r.author,description:r.description,cover:r.cover,ignoreFailedDownloads:!0,verbose:(e,t,...r)=>{const o=[t,...r].join(" "),s=c.find((e=>e[1]===o));s?++s[2]:c.push([e,o,1]),n(2,c)}},r.chapters.map((e=>{var t;return{title:e.title,content:null!==(t=e.transformedContent)&&void 0!==t?t:"<i>Content missing</i>",url:e.displayUrl}})))};let d=a();return e.$$set=e=>{"stage"in e&&n(0,o=e.stage),"backToSearch"in e&&n(1,s=e.backToSearch)},[o,s,c,d,r,a,e=>gt()(e,`${r.author} - ${r.title}.epub`,"application/epub+zip"),()=>n(3,d=a())]}const Yn=class extends Ie{constructor(e){super(),Le(this,e,Wn,Hn,i,{stage:0,backToSearch:1})}};function Kn(e,t,n){const r=e.slice();return r[12]=t[n],r}function Xn(e,t,n){const r=e.slice();return r[12]=t[n],r}function Vn(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function Jn(e){let t,n,r,o,s,i=!e[3].length&&Zn(e),l=Te(e[1]),c=[];for(let t=0;t<l.length;t+=1)c[t]=er(Kn(e,l,t));let a=e[3].length&&tr(e);return{c(){i&&i.c(),t=F(),n=N("div");for(let e=0;e<c.length;e+=1)c[e].c();r=F(),a&&a.c(),o=I(),M(n,"class","chapters svelte-1rrnlr6")},m(e,l){i&&i.m(e,l),_(e,t,l),_(e,n,l);for(let e=0;e<c.length;e+=1)c[e]&&c[e].m(n,null);_(e,r,l),a&&a.m(e,l),_(e,o,l),s=!0},p(e,r){if(e[3].length?i&&(i.d(1),i=null):i?i.p(e,r):(i=Zn(e),i.c(),i.m(t.parentNode,t)),2&r){let t;for(l=Te(e[1]),t=0;t<l.length;t+=1){const o=Kn(e,l,t);c[t]?c[t].p(o,r):(c[t]=er(o),c[t].c(),c[t].m(n,null))}for(;t<c.length;t+=1)c[t].d(1);c.length=l.length}e[3].length?a?(a.p(e,r),8&r&&be(a,1)):(a=tr(e),a.c(),be(a,1),a.m(o.parentNode,o)):a&&($e(),ye(a,1,1,(()=>{a=null})),ve())},i(e){s||(be(a),s=!0)},o(e){ye(a),s=!1},d(e){e&&(D(t),D(n),D(r),D(o)),i&&i.d(e),A(c,e),a&&a.d(e)}}}function Zn(e){let t,n=e[0].next(e[15])+"";return{c(){t=L(n)},m(e,n){_(e,t,n)},p(e,r){17&r&&n!==(n=e[0].next(e[15])+"")&&z(t,n)},d(e){e&&D(t)}}}function Qn(e){let t,n,r=e[12].title+"";return{c(){t=N("p"),n=L(r),M(t,"class","valid small svelte-1rrnlr6")},m(e,r){_(e,t,r),S(t,n)},p(e,t){2&t&&r!==(r=e[12].title+"")&&z(n,r)},d(e){e&&D(t)}}}function er(e){let t,n=e[12]&&!0===e[12].new&&Qn(e);return{c(){n&&n.c(),t=I()},m(e,r){n&&n.m(e,r),_(e,t,r)},p(e,r){e[12]&&!0===e[12].new?n?n.p(e,r):(n=Qn(e),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(e){e&&D(t),n&&n.d(e)}}}function tr(t){let n,r,o=t[3],s=nr(t);return{c(){s.c(),n=I()},m(e,t){s.m(e,t),_(e,n,t),r=!0},p(t,r){8&r&&i(o,o=t[3])?($e(),ye(s,1,1,e),ve(),s=nr(t),s.c(),be(s,1),s.m(n.parentNode,n)):s.p(t,r)},i(e){r||(be(s),r=!0)},o(e){ye(s),r=!1},d(e){e&&D(n),s.d(e)}}}function nr(e){let t,n;return t=new Ct({props:{error:e[3],retry:e[8],back:e[9]}}),{c(){Ae(t.$$.fragment)},m(e,r){Ne(t,e,r),n=!0},p(e,n){const r={};8&n&&(r.error=e[3]),16&n&&(r.retry=e[8]),35&n&&(r.back=e[9]),t.$set(r)},i(e){n||(be(t.$$.fragment,e),n=!0)},o(e){ye(t.$$.fragment,e),n=!1},d(e){Re(t,e)}}}function rr(e){let t,n,r,o,s,i,l,c,a,u,d;t=new Dt({props:{$$slots:{default:[or]},$$scope:{ctx:e}}});let p=Te(e[1]),f=[];for(let t=0;t<p.length;t+=1)f[t]=ir(Xn(e,p,t));let h=e[3].length&&lr(e);return{c(){Ae(t.$$.fragment),n=F(),r=N("button"),o=L("Cancel"),s=F(),i=N("div");for(let e=0;e<f.length;e+=1)f[e].c();l=F(),h&&h.c(),c=I(),r.disabled=e[2],M(i,"class","chapters svelte-1rrnlr6")},m(p,m){Ne(t,p,m),_(p,n,m),_(p,r,m),S(r,o),_(p,s,m),_(p,i,m);for(let e=0;e<f.length;e+=1)f[e]&&f[e].m(i,null);_(p,l,m),h&&h.m(p,m),_(p,c,m),a=!0,u||(d=U(r,"click",P(e[7])),u=!0)},p(e,n){const o={};if(262144&n&&(o.$$scope={dirty:n,ctx:e}),t.$set(o),(!a||4&n)&&(r.disabled=e[2]),2&n){let t;for(p=Te(e[1]),t=0;t<p.length;t+=1){const r=Xn(e,p,t);f[t]?f[t].p(r,n):(f[t]=ir(r),f[t].c(),f[t].m(i,null))}for(;t<f.length;t+=1)f[t].d(1);f.length=p.length}e[3].length?h?(h.p(e,n),8&n&&be(h,1)):(h=lr(e),h.c(),be(h,1),h.m(c.parentNode,c)):h&&($e(),ye(h,1,1,(()=>{h=null})),ve())},i(e){a||(be(t.$$.fragment,e),be(h),a=!0)},o(e){ye(t.$$.fragment,e),ye(h),a=!1},d(e){e&&(D(n),D(r),D(s),D(i),D(l),D(c)),Re(t,e),A(f,e),h&&h.d(e),u=!1,d()}}}function or(e){let t;return{c(){t=L("Please wait, fetching chapters...")},m(e,n){_(e,t,n)},d(e){e&&D(t)}}}function sr(e){let t,n,r=e[12].title+"";return{c(){t=N("p"),n=L(r),M(t,"class","valid small svelte-1rrnlr6")},m(e,r){_(e,t,r),S(t,n)},p(e,t){2&t&&r!==(r=e[12].title+"")&&z(n,r)},d(e){e&&D(t)}}}function ir(e){let t,n=e[12]&&!0===e[12].new&&sr(e);return{c(){n&&n.c(),t=I()},m(e,r){n&&n.m(e,r),_(e,t,r)},p(e,r){e[12]&&!0===e[12].new?n?n.p(e,r):(n=sr(e),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(e){e&&D(t),n&&n.d(e)}}}function lr(t){let n,r,o=t[3],s=cr(t);return{c(){s.c(),n=I()},m(e,t){s.m(e,t),_(e,n,t),r=!0},p(t,r){8&r&&i(o,o=t[3])?($e(),ye(s,1,1,e),ve(),s=cr(t),s.c(),be(s,1),s.m(n.parentNode,n)):s.p(t,r)},i(e){r||(be(s),r=!0)},o(e){ye(s),r=!1},d(e){e&&D(n),s.d(e)}}}function cr(e){let t,n;return t=new Ct({props:{error:e[3]}}),{c(){Ae(t.$$.fragment)},m(e,r){Ne(t,e,r),n=!0},p(e,n){const r={};8&n&&(r.error=e[3]),t.$set(r)},i(e){n||(be(t.$$.fragment,e),n=!0)},o(e){ye(t.$$.fragment,e),n=!1},d(e){Re(t,e)}}}function ar(e){let t,n,r,o={ctx:e,current:null,token:null,hasCatch:!1,pending:rr,then:Jn,catch:Vn,value:15,blocks:[,,,]};return Ee(n=e[4],o),{c(){t=I(),o.block.c()},m(e,n){_(e,t,n),o.block.m(e,o.anchor=n),o.mount=()=>t.parentNode,o.anchor=t,r=!0},p(t,[r]){e=t,o.ctx=e,16&r&&n!==(n=e[4])&&Ee(n,o)||ke(o,e,r)},i(e){r||(be(o.block),r=!0)},o(e){for(let e=0;e<3;e+=1)ye(o.blocks[e]);r=!1},d(e){e&&D(t),o.block.d(e),o.token=null,o=null}}}function ur(e,t,n){let r,o,s;u(e,Cn,(e=>n(5,r=e))),u(e,Sn,(e=>n(10,o=e))),u(e,Ve,(e=>n(11,s=e)));let{stage:i}=t;if(!r)throw new Error("Inconsistent state, expected to have book data");let l=[...r.chapters.map((e=>Object.assign(Object.assign({},e),{new:!1})))],c=!1,a=[];const d=async()=>{let e,t=l;for(n(1,l=new Array(l.length)),n(3,a=[]),e=0;e<t.length&&!c;e+=10)await Promise.all(t.slice(e,e+10).map((async(r,i)=>{var c,u;if(n(1,l[i+e]=Object.assign({},t[i+e]),l),!1!==r.needsFetching)try{const t=await Lt(r.apiUrl,new URL(o.series.url).origin),a=await Qt(o.series,t);if(!t.ok)throw""+(null!==(u=null!==(c=a.message)&&void 0!==c?c:t.statusText)&&void 0!==u?u:t.status);n(1,l[i+e]=Object.assign(Object.assign({},cn(s,en(o.series.type,a,r.apiUrl))),{new:!0}),l),n(1,l)}catch(e){a.push(e),n(3,a)}})));for(;e<t.length;e++)n(1,l[e]=Object.assign({},t[e]),l);return Object.assign(Object.assign({},r),{chapters:l})};let p=d();return e.$$set=e=>{"stage"in e&&n(0,i=e.stage)},[i,l,c,a,p,r,d,()=>n(2,c=!0),()=>n(4,p=d()),()=>i.next({...r,chapters:l})]}const dr=class extends Ie{constructor(e){super(),Le(this,e,ur,ar,i,{stage:0})}};function pr(e,t,n){const r=e.slice();return r[15]=t[n],r}function fr(e){let t,n;return t=new Ct({props:{error:e[19],retry:e[10],back:e[11]}}),{c(){Ae(t.$$.fragment)},m(e,r){Ne(t,e,r),n=!0},p(e,n){const r={};16&n&&(r.error=e[19]),16&n&&(r.retry=e[10]),71&n&&(r.back=e[11]),t.$set(r)},i(e){n||(be(t.$$.fragment,e),n=!0)},o(e){ye(t.$$.fragment,e),n=!1},d(e){Re(t,e)}}}function hr(t){let n,r=t[0].next(t[18],t[1].length)+"";return{c(){n=L(r)},m(e,t){_(e,n,t)},p(e,t){19&t&&r!==(r=e[0].next(e[18],e[1].length)+"")&&z(n,r)},i:e,o:e,d(e){e&&D(n)}}}function mr(e){let t,n,r,i,l,c,a,u,d,p;t=new Dt({props:{$$slots:{default:[gr]},$$scope:{ctx:e}}});let f=Te(e[1]),h=[];for(let t=0;t<f.length;t+=1)h[t]=$r(pr(e,f,t));return{c(){Ae(t.$$.fragment),n=F(),r=N("div");for(let e=0;e<h.length;e+=1)h[e].c();l=F(),c=N("button"),a=L("Cancel"),M(r,"class","chapters"),c.disabled=e[3]},m(o,s){Ne(t,o,s),_(o,n,s),_(o,r,s);for(let e=0;e<h.length;e+=1)h[e]&&h[e].m(r,null);_(o,l,s),_(o,c,s),S(c,a),u=!0,d||(p=[g(i=e[8].call(null,r,{newchapters:e[1],scroll:e[5]})),U(c,"click",P(e[9]))],d=!0)},p(e,n){const o={};if(1048576&n&&(o.$$scope={dirty:n,ctx:e}),t.$set(o),2&n){let t;for(f=Te(e[1]),t=0;t<f.length;t+=1){const o=pr(e,f,t);h[t]?h[t].p(o,n):(h[t]=$r(o),h[t].c(),h[t].m(r,null))}for(;t<h.length;t+=1)h[t].d(1);h.length=f.length}i&&s(i.update)&&34&n&&i.update.call(null,{newchapters:e[1],scroll:e[5]}),(!u||8&n)&&(c.disabled=e[3])},i(e){u||(be(t.$$.fragment,e),u=!0)},o(e){ye(t.$$.fragment,e),u=!1},d(e){e&&(D(n),D(r),D(l),D(c)),Re(t,e),A(h,e),d=!1,o(p)}}}function gr(e){let t;return{c(){t=L("Please wait, fetching chapters...")},m(e,n){_(e,t,n)},d(e){e&&D(t)}}}function $r(e){let t,n,r,o,s,i,l=e[15].from+"",c=e[15].url+"";return{c(){t=N("p"),n=L(l),r=L(": Found "),o=N("a"),s=L(c),M(o,"href",i=e[15].url),M(t,"class","valid small svelte-tsai6h")},m(e,i){_(e,t,i),S(t,n),S(t,r),S(t,o),S(o,s)},p(e,t){2&t&&l!==(l=e[15].from+"")&&z(n,l),2&t&&c!==(c=e[15].url+"")&&z(s,c),2&t&&i!==(i=e[15].url)&&M(o,"href",i)},d(e){e&&D(t)}}}function vr(e){let t,n,r,o={ctx:e,current:null,token:null,hasCatch:!0,pending:mr,then:hr,catch:fr,value:18,error:19,blocks:[,,,]};return Ee(n=e[4],o),{c(){t=I(),o.block.c()},m(e,n){_(e,t,n),o.block.m(e,o.anchor=n),o.mount=()=>t.parentNode,o.anchor=t,r=!0},p(t,[r]){e=t,o.ctx=e,16&r&&n!==(n=e[4])&&Ee(n,o)||ke(o,e,r)},i(e){r||(be(o.block),r=!0)},o(e){for(let e=0;e<3;e+=1)ye(o.blocks[e]);r=!1},d(e){e&&D(t),o.block.d(e),o.token=null,o=null}}}function br(e,t,n){let r,o,s;u(e,Cn,(e=>n(6,r=e))),u(e,Sn,(e=>n(12,o=e))),u(e,Ve,(e=>n(13,s=e)));let{stage:i}=t;if(!r)throw new Error("Inconsistent state, expected to have book data");let l,c=[],a=!1;const d=async()=>{var e,t,i,u,d,p;for(n(2,l=r.chapters.map((e=>Object.assign({},e))));!a;){let r=l[l.length-1];if(!1!==r.needsFetching){const n=await Lt(r.apiUrl,new URL(o.series.url).origin),i=await Qt(o.series,n);if(!n.ok)throw""+(null!==(t=null!==(e=i.message)&&void 0!==e?e:n.statusText)&&void 0!==t?t:n.status);l.splice(-1,1,r=cn(s,en(o.series.type,i,r.apiUrl)))}let a=rn(s,null!==(i=r.transformedContent)&&void 0!==i?i:"");if(a||(a=rn(s,null!==(u=r.content)&&void 0!==u?u:"")),!a)break;const f=Zt(o.series.type,a);if(l.find((e=>e.apiUrl===f)))break;c.push({from:r.title,url:a}),n(1,c);const h=await Lt(f,new URL(o.series.url).origin),m=await Qt(o.series,h);if(!h.ok)throw""+(null!==(p=null!==(d=m.message)&&void 0!==d?d:h.statusText)&&void 0!==p?p:h.status);l.push(cn(s,en(o.series.type,m,f)))}return Object.assign(Object.assign({},r),{chapters:l})};let p=d(),f=!0;function h(){const e=document.documentElement.scrollHeight-document.documentElement.scrollTop;n(5,f=Math.abs(document.documentElement.clientHeight-e)<1)}return window.addEventListener("scroll",h),Q((()=>{window.removeEventListener("scroll",h)})),e.$$set=e=>{"stage"in e&&n(0,i=e.stage)},[i,c,l,a,p,f,r,d,(e,t)=>({update:({scroll:e})=>{e&&document.querySelector("footer").scrollIntoView()}}),()=>n(3,a=!0),()=>n(4,p=d()),()=>i.next({...r,chapters:l},c.length)]}const yr=class extends Ie{constructor(e){super(),Le(this,e,br,vr,i,{stage:0})}},wr="finalize",xr="consider";function Er(e,t,n){e.dispatchEvent(new CustomEvent(wr,{detail:{items:t,info:n}}))}function kr(e,t,n){e.dispatchEvent(new CustomEvent(xr,{detail:{items:t,info:n}}))}const Tr="draggedEntered",Sr="draggedLeft",Cr="draggedOverIndex",Or="draggedLeftDocument",_r={LEFT_FOR_ANOTHER:"leftForAnother",OUTSIDE_OF_ANY:"outsideOfAny"};function Dr(e,t,n){e.dispatchEvent(new CustomEvent(Tr,{detail:{indexObj:t,draggedEl:n}}))}function Ar(e,t,n){e.dispatchEvent(new CustomEvent(Sr,{detail:{draggedEl:t,type:_r.LEFT_FOR_ANOTHER,theOtherDz:n}}))}function Nr(e,t,n){e.dispatchEvent(new CustomEvent(Cr,{detail:{indexObj:t,draggedEl:n}}))}const Rr={DRAG_STARTED:"dragStarted",DRAGGED_ENTERED:Tr,DRAGGED_ENTERED_ANOTHER:"dragEnteredAnother",DRAGGED_OVER_INDEX:Cr,DRAGGED_LEFT:Sr,DRAGGED_LEFT_ALL:"draggedLeftAll",DROPPED_INTO_ZONE:"droppedIntoZone",DROPPED_INTO_ANOTHER:"droppedIntoAnother",DROPPED_OUTSIDE_OF_ANY:"droppedOutsideOfAny",DRAG_STOPPED:"dragStopped"},Lr={POINTER:"pointer",KEYBOARD:"keyboard"},Fr="isDndShadowItem",Ir="data-is-dnd-shadow-item-internal",Ur="data-is-dnd-shadow-item-hint",Pr="id:dnd-shadow-placeholder-0000",jr="dnd-action-dragged-el";let Mr="id",zr=0;function Gr(){zr++}function Br(){if(0===zr)throw new Error("Bug! trying to decrement when there are no dropzones");zr--}const Hr="undefined"==typeof window;let qr,Wr=()=>{};function Yr(e){let t;const n=e.getBoundingClientRect(),r=getComputedStyle(e),o=r.transform;if(o){let s,i,l,c;if(o.startsWith("matrix3d("))t=o.slice(9,-1).split(/, /),s=+t[0],i=+t[5],l=+t[12],c=+t[13];else{if(!o.startsWith("matrix("))return n;t=o.slice(7,-1).split(/, /),s=+t[0],i=+t[3],l=+t[4],c=+t[5]}const a=r.transformOrigin,u=n.x-l-(1-s)*parseFloat(a),d=n.y-c-(1-i)*parseFloat(a.slice(a.indexOf(" ")+1)),p=s?n.width/s:e.offsetWidth,f=i?n.height/i:e.offsetHeight;return{x:u,y:d,width:p,height:f,top:d,right:u+p,bottom:d+f,left:u}}return n}function Kr(e){const t=Yr(e);return{top:t.top+window.scrollY,bottom:t.bottom+window.scrollY,left:t.left+window.scrollX,right:t.right+window.scrollX}}function Xr(e){const t=e.getBoundingClientRect();return{top:t.top+window.scrollY,bottom:t.bottom+window.scrollY,left:t.left+window.scrollX,right:t.right+window.scrollX}}function Vr(e){return{x:(e.left+e.right)/2,y:(e.top+e.bottom)/2}}function Jr(e,t){return e.y<=t.bottom&&e.y>=t.top&&e.x>=t.left&&e.x<=t.right}function Zr(e){return Vr(Xr(e))}function Qr(e,t){return Jr(Zr(e),Kr(t))}function eo(){Wr((()=>"resetting indexes cache")),qr=new Map}function to(e,t){if(!Qr(e,t))return null;const n=t.children;if(0===n.length)return{index:0,isProximityBased:!0};const r=function(e){const t=Array.from(e.children).findIndex((e=>e.getAttribute(Ir)));if(t>=0)return qr.has(e)||qr.set(e,new Map),qr.get(e).set(t,Kr(e.children[t])),t}(t);for(let o=0;o<n.length;o++)if(Qr(e,n[o])){const n=qr.has(t)&&qr.get(t).get(o);return n&&!Jr(Zr(e),n)?{index:r,isProximityBased:!1}:{index:o,isProximityBased:!1}}let o,s=Number.MAX_VALUE;for(let t=0;t<n.length;t++){const r=(i=e,l=n[t],c=void 0,a=void 0,c=Zr(i),a=Zr(l),Math.sqrt(Math.pow(c.x-a.x,2)+Math.pow(c.y-a.y,2)));r<s&&(s=r,o=t)}var i,l,c,a;return{index:o,isProximityBased:!0}}function no(e){return JSON.stringify(e,null,2)}function ro(e){if(!e)throw new Error("cannot get depth of a falsy node");return oo(e,0)}function oo(e,t=0){return e.parentElement?oo(e.parentElement,t+1):t-1}eo();const so=200,io=10;let lo;const co=30;function ao(){let e;function t(){e={directionObj:void 0,stepPx:0}}function n(t){const{directionObj:r,stepPx:o}=e;r&&(t.scrollBy(r.x*o,r.y*o),window.requestAnimationFrame((()=>n(t))))}function r(e){return co-e}return t(),{scrollIfNeeded:function(o,s){if(!s)return!1;const i=function(e,t){const n=t===document.scrollingElement?{top:0,bottom:window.innerHeight,left:0,right:window.innerWidth}:t.getBoundingClientRect();return Jr(e,n)?{top:e.y-n.top,bottom:n.bottom-e.y,left:e.x-n.left,right:n.right-e.x}:null}(o,s),l=!!e.directionObj;if(null===i)return l&&t(),!1;let[c,a]=[!1,!1];return s.scrollHeight>s.clientHeight&&(i.bottom<co?(c=!0,e.directionObj={x:0,y:1},e.stepPx=r(i.bottom)):i.top<co&&(c=!0,e.directionObj={x:0,y:-1},e.stepPx=r(i.top)),!l&&c)||s.scrollWidth>s.clientWidth&&(i.right<co?(a=!0,e.directionObj={x:1,y:0},e.stepPx=r(i.right)):i.left<co&&(a=!0,e.directionObj={x:-1,y:0},e.stepPx=r(i.left)),!l&&a)?(n(s),!0):(t(),!1)},resetScrolling:t}}function uo(e){if(!e)return[];const t=[];let n=e;for(;n;){const{overflow:e}=window.getComputedStyle(n);e.split(" ").some((e=>e.includes("auto")||e.includes("scroll")))&&t.push(n),n=n.parentElement}return t}const po=Object.freeze({USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT:"USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT"}),fo={[po.USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT]:!1};function ho(e){if(!po[e])throw new Error(`Can't get non existing feature flag ${e}! Supported flags: ${Object.keys(po)}`);return fo[e]}const mo=.2;function go(e){return`${e} ${mo}s ease`}function $o(e,t,n,r){vo(t,e);const o=t.getBoundingClientRect(),s=e.getBoundingClientRect(),i=o.width-s.width,l=o.height-s.height;if(i||l){const t={left:(n-s.left)/s.width,top:(r-s.top)/s.height};ho(po.USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT)||(e.style.height=`${o.height}px`,e.style.width=`${o.width}px`),e.style.left=parseFloat(e.style.left)-t.left*i+"px",e.style.top=parseFloat(e.style.top)-t.top*l+"px"}}function vo(e,t){const n=window.getComputedStyle(e);Array.from(n).filter((e=>e.startsWith("background")||e.startsWith("padding")||e.startsWith("font")||e.startsWith("text")||e.startsWith("align")||e.startsWith("justify")||e.startsWith("display")||e.startsWith("flex")||e.startsWith("border")||"opacity"===e||"color"===e||"list-style-type"===e||ho(po.USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT)&&("width"===e||"height"===e))).forEach((e=>t.style.setProperty(e,n.getPropertyValue(e),n.getPropertyPriority(e))))}function bo(e,t){e.draggable=!1,e.ondragstart=()=>!1,t?(e.style.userSelect="",e.style.WebkitUserSelect="",e.style.cursor=""):(e.style.userSelect="none",e.style.WebkitUserSelect="none",e.style.cursor="grab")}function yo(e){e.style.display="none",e.style.position="fixed",e.style.zIndex="-5"}function wo(e,t=()=>{},n=()=>[]){e.forEach((e=>{const r=t(e);Object.keys(r).forEach((t=>{e.style[t]=r[t]})),n(e).forEach((t=>e.classList.add(t)))}))}function xo(e,t=()=>{},n=()=>[]){e.forEach((e=>{const r=t(e);Object.keys(r).forEach((t=>{e.style[t]=""})),n(e).forEach((t=>e.classList.contains(t)&&e.classList.remove(t)))}))}const Eo="--any--",ko=100,To=20,So=3,Co={outline:"rgba(255, 255, 102, 0.7) solid 2px"},Oo="data-is-dnd-original-dragged-item";let _o,Do,Ao,No,Ro,Lo,Fo,Io,Uo,Po,jo,Mo,zo=!1,Go=!1,Bo=!1,Ho=[];const qo=new Map,Wo=new Map,Yo=new WeakMap;function Ko(e,t){qo.get(t).delete(e),Br(),0===qo.get(t).size&&qo.delete(t)}function Xo(e){return e.findIndex((e=>!!e[Fr]))}function Vo(e){Wr((()=>["dragged entered",e.currentTarget,e.detail]));let{items:t,dropFromOthersDisabled:n}=Wo.get(e.currentTarget);if(n&&e.currentTarget!==Ro)return void Wr((()=>"ignoring dragged entered because drop is currently disabled"));if(Bo=!1,t=t.filter((e=>e[Mr]!==Fo[Mr])),Wr((()=>`dragged entered items ${no(t)}`)),Ro!==e.currentTarget){const e=Wo.get(Ro).items.filter((e=>!e[Fr]));kr(Ro,e,{trigger:Rr.DRAGGED_ENTERED_ANOTHER,id:Ao[Mr],source:Lr.POINTER})}const{index:r,isProximityBased:o}=e.detail.indexObj,s=o&&r===e.currentTarget.children.length-1?r+1:r;Io=e.currentTarget,t.splice(s,0,Fo),kr(e.currentTarget,t,{trigger:Rr.DRAGGED_ENTERED,id:Ao[Mr],source:Lr.POINTER})}function Jo(e){if(!zo)return;Wr((()=>["dragged left",e.currentTarget,e.detail]));const{items:t,dropFromOthersDisabled:n}=Wo.get(e.currentTarget);if(n&&e.currentTarget!==Ro&&e.currentTarget!==Io)return void Wr((()=>"drop is currently disabled"));const r=[...t],o=Xo(r);-1!==o&&r.splice(o,1);const s=Io;Io=void 0;const{type:i,theOtherDz:l}=e.detail;if(i===_r.OUTSIDE_OF_ANY||i===_r.LEFT_FOR_ANOTHER&&l!==Ro&&Wo.get(l).dropFromOthersDisabled){Wr((()=>"dragged left all, putting shadow element back in the origin dz")),Bo=!0,Io=Ro;const e=s===Ro?r:[...Wo.get(Ro).items];e.splice(Lo,0,Fo),kr(Ro,e,{trigger:Rr.DRAGGED_LEFT_ALL,id:Ao[Mr],source:Lr.POINTER})}kr(e.currentTarget,r,{trigger:Rr.DRAGGED_LEFT,id:Ao[Mr],source:Lr.POINTER})}function Zo(e){Wr((()=>["dragged is over index",e.currentTarget,e.detail]));const{items:t,dropFromOthersDisabled:n}=Wo.get(e.currentTarget);if(n&&e.currentTarget!==Ro)return void Wr((()=>"drop is currently disabled"));const r=[...t];Bo=!1;const{index:o}=e.detail.indexObj,s=Xo(r);-1!==s&&r.splice(s,1),r.splice(o,0,Fo),kr(e.currentTarget,r,{trigger:Rr.DRAGGED_OVER_INDEX,id:Ao[Mr],source:Lr.POINTER})}function Qo(e){e.preventDefault();const t=e.touches?e.touches[0]:e;Po={x:t.clientX,y:t.clientY},Do.style.transform=`translate3d(${Po.x-Uo.x}px, ${Po.y-Uo.y}px, 0)`}function es(){Wr((()=>"dropped")),Go=!0,window.removeEventListener("mousemove",Qo),window.removeEventListener("touchmove",Qo),window.removeEventListener("mouseup",es),window.removeEventListener("touchend",es),function(){Wr((()=>"unwatching dragged element"));const e=qo.get(No);for(const t of e)t.removeEventListener(Tr,Vo),t.removeEventListener(Sr,Jo),t.removeEventListener(Cr,Zo);window.removeEventListener(Or,es),Mo.destroy(),Mo=void 0,Wr((()=>"unobserving")),clearTimeout(lo),eo()}(),function(e){e.style.cursor="grab"}(Do),Io||(Wr((()=>"element was dropped right after it left origin but before entering somewhere else")),Io=Ro),Wr((()=>["dropped in dz",Io]));let{items:e,type:t}=Wo.get(Io);xo(qo.get(t),(e=>Wo.get(e).dropTargetStyle),(e=>Wo.get(e).dropTargetClasses));let n=Xo(e);-1===n&&Io===Ro&&(n=Lo),e=e.map((e=>e[Fr]?Ao:e)),function(e,t){const n=Yr(e>-1?Io.children[e]:Io),r=n.left-parseFloat(Do.style.left),o=n.top-parseFloat(Do.style.top),{dropAnimationDurationMs:s}=Wo.get(Io),i=`transform ${s}ms ease`;Do.style.transition=Do.style.transition?Do.style.transition+","+i:i,Do.style.transform=`translate3d(${r}px, ${o}px, 0)`,window.setTimeout(t,s)}(n,(function(){var t;jo(),Er(Io,e,{trigger:Bo?Rr.DROPPED_OUTSIDE_OF_ANY:Rr.DROPPED_INTO_ZONE,id:Ao[Mr],source:Lr.POINTER}),Io!==Ro&&Er(Ro,Wo.get(Ro).items,{trigger:Rr.DROPPED_INTO_ANOTHER,id:Ao[Mr],source:Lr.POINTER}),-1!==n&&((t=Io.children[n]).style.visibility="",t.removeAttribute(Ir)),Do.remove(),_o.remove(),Ho.length&&(Wr((()=>["will destroy zones that were removed during drag",Ho])),Ho.forEach((({dz:e,destroy:t})=>{t(),e.remove()})),Ho=[]),Do=void 0,_o=void 0,Ao=void 0,No=void 0,Ro=void 0,Lo=void 0,Fo=void 0,Io=void 0,Uo=void 0,Po=void 0,zo=!1,Go=!1,jo=void 0,Bo=!1}))}function ts(e,t){let n=!1;const r={items:void 0,type:void 0,flipDurationMs:0,dragDisabled:!1,morphDisabled:!1,dropFromOthersDisabled:!1,dropTargetStyle:Co,dropTargetClasses:[],transformDraggedElement:()=>{},centreDraggedOnCursor:!1};Wr((()=>[`dndzone good to go options: ${no(t)}, config: ${no(r)}`,{node:e}]));let o=new Map;function s(){window.removeEventListener("mousemove",l),window.removeEventListener("touchmove",l),window.removeEventListener("mouseup",i),window.removeEventListener("touchend",i)}function i(e){s(),_o=void 0,Uo=void 0,Po=void 0,"touchend"===e.type&&e.target.click()}function l(e){e.preventDefault();const t=e.touches?e.touches[0]:e;Po={x:t.clientX,y:t.clientY},(Math.abs(Po.x-Uo.x)>=So||Math.abs(Po.y-Uo.y)>=So)&&(s(),function(){Wr((()=>[`drag start config: ${no(r)}`,_o])),zo=!0;const e=o.get(_o);Lo=e,Ro=_o.parentElement;const t=Ro.closest("dialog")||Ro.getRootNode(),n=t.body||t,{items:s,type:i,centreDraggedOnCursor:l}=r,c=[...s];Ao=c[e],No=i,Fo=function(e){return{...e,[Fr]:!0,[Mr]:Pr}}(Ao),Do=function(e,t){const n=e.getBoundingClientRect(),r=function(e){const t=e.cloneNode(!0),n=[],r="SELECT"===e.tagName,o=r?[e]:[...e.querySelectorAll("select")];for(const e of o)n.push(e.value);if(o.length>0){const e=r?[t]:[...t.querySelectorAll("select")];for(let t=0;t<e.length;t++){const r=e[t],o=n[t],s=r.querySelector(`option[value="${o}"`);s&&s.setAttribute("selected",!0)}}const s="CANVAS"===e.tagName,i=s?[e]:[...e.querySelectorAll("canvas")];if(i.length>0){const e=s?[t]:[...t.querySelectorAll("canvas")];for(let t=0;t<e.length;t++){const n=i[t],r=e[t];r.width=n.width,r.height=n.height,n.width>0&&n.height>0&&r.getContext("2d").drawImage(n,0,0)}}return t}(e);vo(e,r),r.id=jr,r.style.position="fixed";let o=n.top,s=n.left;if(r.style.top=`${o}px`,r.style.left=`${s}px`,t){const e=Vr(n);o-=e.y-t.y,s-=e.x-t.x,window.setTimeout((()=>{r.style.top=`${o}px`,r.style.left=`${s}px`}),0)}return r.style.margin="0",r.style.boxSizing="border-box",r.style.height=`${n.height}px`,r.style.width=`${n.width}px`,r.style.transition=`${go("top")}, ${go("left")}, ${go("background-color")}, ${go("opacity")}, ${go("color")} `,window.setTimeout((()=>r.style.transition+=`, ${go("width")}, ${go("height")}`),0),r.style.zIndex="9999",r.style.cursor="grabbing",r}(_o,l&&Po),_o.setAttribute(Oo,!0),window.requestAnimationFrame((function e(){Do.parentElement?window.requestAnimationFrame(e):(n.appendChild(Do),Do.focus(),function(){Wr((()=>"watching dragged element"));const e=qo.get(No);for(const t of e)t.addEventListener(Tr,Vo),t.addEventListener(Sr,Jo),t.addEventListener(Cr,Zo);window.addEventListener(Or,es);const t=Math.max(...Array.from(e.keys()).map((e=>Wo.get(e).dropAnimationDurationMs))),n=0===t?To:Math.max(t,ko);Mo=function(e=[],t){Wr((()=>"creating multi-scroller"));const n=function(e){const t=new Set;for(let n of e)uo(n).forEach((e=>t.add(e)));return(document.scrollingElement.scrollHeight>document.scrollingElement.clientHeight||document.scrollingElement.scrollWidth>document.scrollingElement.clientHeight)&&t.add(document.scrollingElement),t}(e),r=Array.from(n).sort(((e,t)=>ro(t)-ro(e))),{scrollIfNeeded:o,resetScrolling:s}=ao();return{multiScrollIfNeeded:n.size>0?function(){const e=t();if(!e||!r)return!1;const n=r.filter((t=>Jr(e,t.getBoundingClientRect())||t===document.scrollingElement));for(let t=0;t<n.length;t++)if(o(e,n[t]))return!0;return!1}:()=>!1,destroy:()=>s()}}(e,(()=>Po)),function(e,t,n=so,r){let o,s,i,l=!1;const c=Array.from(t).sort(((e,t)=>ro(t)-ro(e)));!function t(){const a=Zr(e),u=r.multiScrollIfNeeded();if(!u&&i&&Math.abs(i.x-a.x)<io&&Math.abs(i.y-a.y)<io)return void(lo=window.setTimeout(t,n));if(function(e){const t=Xr(e);return t.right<0||t.left>document.documentElement.scrollWidth||t.bottom<0||t.top>document.documentElement.scrollHeight}(e))return Wr((()=>"off document")),void function(e){window.dispatchEvent(new CustomEvent(Or,{detail:{draggedEl:e}}))}(e);i=a;let d=!1;for(const t of c){u&&eo();const n=to(e,t);if(null===n)continue;const{index:r}=n;d=!0,t!==o?(o&&Ar(o,e,t),Dr(t,n,e),o=t):r!==s&&(Nr(t,n,e),s=r);break}!d&&l&&o?(function(e,t){e.dispatchEvent(new CustomEvent(Sr,{detail:{draggedEl:t,type:_r.OUTSIDE_OF_ANY}}))}(o,e),o=void 0,s=void 0,l=!1):l=!0,lo=window.setTimeout(t,n)}()}(Do,e,1.07*n,Mo)}(),yo(_o),n.appendChild(_o),Fo[Mr]=Ao[Mr])})),wo(Array.from(qo.get(r.type)).filter((e=>e===Ro||!Wo.get(e).dropFromOthersDisabled)),(e=>Wo.get(e).dropTargetStyle),(e=>Wo.get(e).dropTargetClasses)),c.splice(e,1,Fo),jo=function(e){const t=e.style.minHeight;e.style.minHeight=window.getComputedStyle(e).getPropertyValue("height");const n=e.style.minWidth;return e.style.minWidth=window.getComputedStyle(e).getPropertyValue("width"),function(){e.style.minHeight=t,e.style.minWidth=n}}(Ro),kr(Ro,c,{trigger:Rr.DRAG_STARTED,id:Ao[Mr],source:Lr.POINTER}),window.addEventListener("mousemove",Qo,{passive:!1}),window.addEventListener("touchmove",Qo,{passive:!1,capture:!1}),window.addEventListener("mouseup",es,{passive:!1}),window.addEventListener("touchend",es,{passive:!1})}())}function c(e){if(e.target!==e.currentTarget&&(void 0!==e.target.value||e.target.isContentEditable))return void Wr((()=>"won't initiate drag on a nested input element"));if(e.button)return void Wr((()=>`ignoring none left click button: ${e.button}`));if(zo)return void Wr((()=>"cannot start a new drag before finalizing previous one"));e.preventDefault(),e.stopPropagation();const t=e.touches?e.touches[0]:e;Uo={x:t.clientX,y:t.clientY},Po={...Uo},_o=e.currentTarget,window.addEventListener("mousemove",l,{passive:!1}),window.addEventListener("touchmove",l,{passive:!1,capture:!1}),window.addEventListener("mouseup",i,{passive:!1}),window.addEventListener("touchend",i,{passive:!1})}function a({items:t,flipDurationMs:s=0,type:i=Eo,dragDisabled:l=!1,morphDisabled:a=!1,dropFromOthersDisabled:u=!1,dropTargetStyle:d=Co,dropTargetClasses:p=[],transformDraggedElement:f=()=>{},centreDraggedOnCursor:h=!1}){function m(e,t){return Wo.get(e)?Wo.get(e)[t]:r[t]}var g,$;r.dropAnimationDurationMs=s,r.type&&i!==r.type&&Ko(e,r.type),r.type=i,r.items=[...t],r.dragDisabled=l,r.morphDisabled=a,r.transformDraggedElement=f,r.centreDraggedOnCursor=h,!n||!zo||Go||function(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(!{}.hasOwnProperty.call(t,n)||t[n]!==e[n])return!1;return!0}(d,r.dropTargetStyle)&&function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}(p,r.dropTargetClasses)||(xo([e],(()=>r.dropTargetStyle),(()=>p)),wo([e],(()=>d),(()=>p))),r.dropTargetStyle=d,r.dropTargetClasses=[...p],n&&zo&&r.dropFromOthersDisabled!==u&&(u?xo([e],(e=>m(e,"dropTargetStyle")),(e=>m(e,"dropTargetClasses"))):wo([e],(e=>m(e,"dropTargetStyle")),(e=>m(e,"dropTargetClasses")))),r.dropFromOthersDisabled=u,Wo.set(e,r),g=e,$=i,Wr((()=>"registering drop-zone if absent")),qo.has($)||qo.set($,new Set),qo.get($).has(g)||(qo.get($).add(g),Gr());const v=Xo(r.items);for(let t=0;t<e.children.length;t++){const s=e.children[t];bo(s,l),t!==v?(s.removeEventListener("mousedown",Yo.get(s)),s.removeEventListener("touchstart",Yo.get(s)),l||(s.addEventListener("mousedown",c),s.addEventListener("touchstart",c),Yo.set(s,c)),o.set(s,t),n||(n=!0)):(a||$o(Do,s,Po.x,Po.y),r.transformDraggedElement(Do,Ao,t),(b=s).style.visibility="hidden",b.setAttribute(Ir,"true"))}var b}return a(t),{update:e=>{Wr((()=>`pointer dndzone will update newOptions: ${no(e)}`)),a(e)},destroy:()=>{function t(){Wr((()=>"pointer dndzone will destroy")),Ko(e,Wo.get(e).type),Wo.delete(e)}var n,r;zo&&!e.closest(`[${Oo}]`)?(Wr((()=>"pointer dndzone will be scheduled for destruction")),n=e,r=t,Ho.push({dz:n,destroy:r}),window.requestAnimationFrame((()=>{yo(n),document.body.appendChild(n)}))):t()}}}const ns={DND_ZONE_ACTIVE:"dnd-zone-active",DND_ZONE_DRAG_DISABLED:"dnd-zone-drag-disabled"},rs={[ns.DND_ZONE_ACTIVE]:"Tab to one the items and press space-bar or enter to start dragging it",[ns.DND_ZONE_DRAG_DISABLED]:"This is a disabled drag and drop list"},os="dnd-action-aria-alert";let ss;function is(){ss||(ss=document.createElement("div"),ss.id=os,ss.style.position="fixed",ss.style.bottom="0",ss.style.left="0",ss.style.zIndex="-5",ss.style.opacity="0",ss.style.height="0",ss.style.width="0",ss.setAttribute("role","alert"),document.body.prepend(ss),Object.entries(rs).forEach((([e,t])=>document.body.prepend(function(e,t){const n=document.createElement("div");return n.id=e,n.innerHTML=`<p>${t}</p>`,n.style.display="none",n.style.position="fixed",n.style.zIndex="-5",n}(e,t)))))}function ls(e){if(Hr)return;ss||is(),ss.innerHTML="";const t=document.createTextNode(e);ss.appendChild(t),ss.style.display="none",ss.style.display="inline"}const cs="--any--",as={outline:"rgba(255, 255, 102, 0.7) solid 2px"};let us,ds,ps,fs,hs=!1,ms="",gs="";const $s=new WeakSet,vs=new WeakMap,bs=new WeakMap,ys=new Map,ws=new Map,xs=new Map;let Es;function ks(e,t){Wr((()=>"unregistering drop-zone")),ds===e&&_s(),xs.get(t).delete(e),Br(),0===xs.get(t).size&&xs.delete(t),0===xs.size&&(Wr((()=>"removing global keydown and click handlers")),window.removeEventListener("keydown",Ts),window.removeEventListener("click",Ss),Es=void 0,!Hr&&ss&&(Object.keys(rs).forEach((e=>document.getElementById(e)?.remove())),ss.remove(),ss=void 0))}function Ts(e){hs&&"Escape"===e.key&&_s()}function Ss(){hs&&($s.has(document.activeElement)||(Wr((()=>"clicked outside of any draggable")),_s()))}function Cs(e){if(Wr((()=>"zone focus")),!hs)return;const t=e.currentTarget;if(t===ds)return;ms=t.getAttribute("aria-label")||"";const{items:n}=ws.get(ds),r=n.find((e=>e[Mr]===fs)),o=n.indexOf(r),s=n.splice(o,1)[0],{items:i,autoAriaDisabled:l}=ws.get(t);t.getBoundingClientRect().top<ds.getBoundingClientRect().top||t.getBoundingClientRect().left<ds.getBoundingClientRect().left?(i.push(s),l||ls(`Moved item ${gs} to the end of the list ${ms}`)):(i.unshift(s),l||ls(`Moved item ${gs} to the beginning of the list ${ms}`)),Er(ds,n,{trigger:Rr.DROPPED_INTO_ANOTHER,id:fs,source:Lr.KEYBOARD}),Er(t,i,{trigger:Rr.DROPPED_INTO_ZONE,id:fs,source:Lr.KEYBOARD}),ds=t}function Os(){ys.forEach((({update:e},t)=>e(ws.get(t))))}function _s(e=!0){Wr((()=>"drop")),ws.get(ds).autoAriaDisabled||ls(`Stopped dragging item ${gs}`),$s.has(document.activeElement)&&document.activeElement.blur(),e&&kr(ds,ws.get(ds).items,{trigger:Rr.DRAG_STOPPED,id:fs,source:Lr.KEYBOARD}),xo(xs.get(us),(e=>ws.get(e).dropTargetStyle),(e=>ws.get(e).dropTargetClasses)),ps=null,fs=null,gs="",us=null,ds=null,ms="",hs=!1,Os()}function Ds(e,t){const n={items:void 0,type:void 0,dragDisabled:!1,zoneTabIndex:0,zoneItemTabIndex:0,dropFromOthersDisabled:!1,dropTargetStyle:as,dropTargetClasses:[],autoAriaDisabled:!1};function r(e,t,n){e.length<=1||e.splice(n,1,e.splice(t,1,e[n])[0])}function o(t){switch(Wr((()=>["handling key down",t.key])),t.key){case"Enter":case" ":if((void 0!==t.target.disabled||t.target.href||t.target.isContentEditable)&&!$s.has(t.target))return;t.preventDefault(),t.stopPropagation(),hs?_s():s(t);break;case"ArrowDown":case"ArrowRight":{if(!hs)return;t.preventDefault(),t.stopPropagation();const{items:o}=ws.get(e),s=Array.from(e.children),i=s.indexOf(t.currentTarget);Wr((()=>["arrow down",i])),i<s.length-1&&(n.autoAriaDisabled||ls(`Moved item ${gs} to position ${i+2} in the list ${ms}`),r(o,i,i+1),Er(e,o,{trigger:Rr.DROPPED_INTO_ZONE,id:fs,source:Lr.KEYBOARD}));break}case"ArrowUp":case"ArrowLeft":{if(!hs)return;t.preventDefault(),t.stopPropagation();const{items:o}=ws.get(e),s=Array.from(e.children).indexOf(t.currentTarget);Wr((()=>["arrow up",s])),s>0&&(n.autoAriaDisabled||ls(`Moved item ${gs} to position ${s} in the list ${ms}`),r(o,s,s-1),Er(e,o,{trigger:Rr.DROPPED_INTO_ZONE,id:fs,source:Lr.KEYBOARD}));break}}}function s(t){Wr((()=>"drag start")),function(t){const{items:r}=ws.get(e),o=Array.from(e.children),s=o.indexOf(t);ps=t,ps.tabIndex=n.zoneItemTabIndex,fs=r[s][Mr],gs=o[s].getAttribute("aria-label")||""}(t.currentTarget),ds=e,us=n.type,hs=!0;const r=Array.from(xs.get(n.type)).filter((e=>e===ds||!ws.get(e).dropFromOthersDisabled));if(wo(r,(e=>ws.get(e).dropTargetStyle),(e=>ws.get(e).dropTargetClasses)),!n.autoAriaDisabled){let e=`Started dragging item ${gs}. Use the arrow keys to move it within its list ${ms}`;r.length>1&&(e+=", or tab to another list in order to move the item into it"),ls(e)}kr(e,ws.get(e).items,{trigger:Rr.DRAG_STARTED,id:fs,source:Lr.KEYBOARD}),Os()}function i(e){hs&&e.currentTarget!==ps&&(e.stopPropagation(),_s(!1),s(e))}function l({items:t=[],type:r=cs,dragDisabled:s=!1,zoneTabIndex:l=0,zoneItemTabIndex:c=0,dropFromOthersDisabled:a=!1,dropTargetStyle:u=as,dropTargetClasses:d=[],autoAriaDisabled:p=!1}){var f,h;n.items=[...t],n.dragDisabled=s,n.dropFromOthersDisabled=a,n.zoneTabIndex=l,n.zoneItemTabIndex=c,n.dropTargetStyle=u,n.dropTargetClasses=d,n.autoAriaDisabled=p,n.type&&r!==n.type&&ks(e,n.type),n.type=r,f=e,h=r,Wr((()=>"registering drop-zone if absent")),0===xs.size&&(Wr((()=>"adding global keydown and click handlers")),Es=Hr?null:("complete"===document.readyState?is():window.addEventListener("DOMContentLoaded",is),{...ns}),window.addEventListener("keydown",Ts),window.addEventListener("click",Ss)),xs.has(h)||xs.set(h,new Set),xs.get(h).has(f)||(xs.get(h).add(f),Gr()),p||(e.setAttribute("aria-disabled",s),e.setAttribute("role","list"),e.setAttribute("aria-describedby",s?Es.DND_ZONE_DRAG_DISABLED:Es.DND_ZONE_ACTIVE)),ws.set(e,n),e.tabIndex=hs?e===ds||ps.contains(e)||n.dropFromOthersDisabled||ds&&n.type!==ws.get(ds).type?-1:0:n.zoneTabIndex,e.addEventListener("focus",Cs);for(let t=0;t<e.children.length;t++){const r=e.children[t];$s.add(r),r.tabIndex=hs?-1:n.zoneItemTabIndex,p||r.setAttribute("role","listitem"),r.removeEventListener("keydown",vs.get(r)),r.removeEventListener("click",bs.get(r)),s||(r.addEventListener("keydown",o),vs.set(r,o),r.addEventListener("click",i),bs.set(r,i)),hs&&n.items[t][Mr]===fs&&(Wr((()=>["focusing on",{i:t,focusedItemId:fs}])),ps=r,ps.tabIndex=n.zoneItemTabIndex,r.focus())}}l(t);const c={update:e=>{Wr((()=>`keyboard dndzone will update newOptions: ${no(e)}`)),l(e)},destroy:()=>{Wr((()=>"keyboard dndzone will destroy")),ks(e,n.type),ws.delete(e),ys.delete(e)}};return ys.set(e,c),c}function As(e,t){if(function(e){return!!e.closest(`[${Ur}="true"]`)}(e))return{update:()=>{},destroy:()=>{}};Ns(t);const n=ts(e,t),r=Ds(e,t);return{update:e=>{Ns(e),n.update(e),r.update(e)},destroy:()=>{n.destroy(),r.destroy()}}}function Ns(e){const{items:t,flipDurationMs:n,type:r,dragDisabled:o,morphDisabled:s,dropFromOthersDisabled:i,zoneTabIndex:l,zoneItemTabIndex:c,dropTargetStyle:a,dropTargetClasses:u,transformDraggedElement:d,autoAriaDisabled:p,centreDraggedOnCursor:f,...h}=e;if(Object.keys(h).length>0&&console.warn("dndzone will ignore unknown options",h),!t)throw new Error("no 'items' key provided to dndzone");const m=t.find((e=>!{}.hasOwnProperty.call(e,Mr)));if(m)throw new Error(`missing '${Mr}' property for item ${no(m)}`);if(u&&!Array.isArray(u))throw new Error(`dropTargetClasses should be an array but instead it is a ${typeof u}, ${no(u)}`);if(l&&!Rs(l))throw new Error(`zoneTabIndex should be a number but instead it is a ${typeof l}, ${no(l)}`);if(c&&!Rs(c))throw new Error(`zoneItemTabIndex should be a number but instead it is a ${typeof c}, ${no(c)}`)}function Rs(e){return!isNaN(e)&&(0|(t=parseFloat(e)))===t;var t}function Ls(e,{delay:n=0,duration:r=400,easing:o=t}={}){const s=+getComputedStyle(e).opacity;return{delay:n,duration:r,easing:o,css:e=>"opacity: "+e*s}}function Fs(e,{delay:t=0,duration:n=400,easing:r=Ft,x:o=0,y:s=0,opacity:i=0}={}){const l=getComputedStyle(e),c=+l.opacity,a="none"===l.transform?"":l.transform,u=c*(1-i),[d,p]=$(o),[f,h]=$(s);return{delay:t,duration:n,easing:r,css:(e,t)=>`\n\t\t\ttransform: ${a} translate(${(1-e)*d}${p}, ${(1-e)*f}${h});\n\t\t\topacity: ${c-u*t}`}}function Is(t){let n,r,o;return{c(){n=R("svg"),r=R("g"),o=R("path"),M(o,"d","M38,52a2,2,0,0,1-1.41-.59l-24-24a2,2,0,0,1,0-2.82l24-24a2,2,0,0,1,2.82,0,2,2,0,0,1,0,2.82L16.83,26,39.41,48.59A2,2,0,0,1,38,52Z"),M(n,"version","1.1"),M(n,"xmlns","http://www.w3.org/2000/svg"),M(n,"xmlns:xlink","http://www.w3.org/1999/xlink"),M(n,"x","0px"),M(n,"y","0px"),M(n,"viewBox","0 0 52 52"),M(n,"xml:space","preserve")},m(e,t){_(e,n,t),S(n,r),S(r,o)},p:e,i:e,o:e,d(e){e&&D(n)}}}new Set;const Us=class extends Ie{constructor(e){super(),Le(this,e,null,Is,i,{})}};function Ps(t){let n,r;return{c(){n=R("svg"),r=R("polygon"),M(r,"points","0,490 490,490 245,0"),M(n,"version","1.1"),M(n,"xmlns","http://www.w3.org/2000/svg"),M(n,"xmlns:xlink","http://www.w3.org/1999/xlink"),M(n,"x","0px"),M(n,"y","0px"),M(n,"viewBox","0 0 490 490"),M(n,"xml:space","preserve")},m(e,t){_(e,n,t),S(n,r)},p:e,i:e,o:e,d(e){e&&D(n)}}}const js=class extends Ie{constructor(e){super(),Le(this,e,null,Ps,i,{})}};function Ms(e){let t,n,r,i,l,c,a,u,d,p,f,h,m;return r=new js({}),a=new js({}),{c(){t=N("div"),n=N("a"),Ae(r.$$.fragment),i=L(" move up"),l=F(),c=N("a"),Ae(a.$$.fragment),u=L(" move down"),d=F(),p=N("a"),p.textContent="remove",M(n,"href","#up"),M(n,"class","small up svelte-1uea1m1"),B(n,"control-disabled",!e[0]),M(c,"href","#dowm"),M(c,"class","small down svelte-1uea1m1"),B(c,"control-disabled",!e[1]),M(p,"href","#remove"),M(p,"class","small remove svelte-1uea1m1"),B(p,"control-disabled",!e[2]),M(t,"class","controls svelte-1uea1m1")},m(o,g){_(o,t,g),S(t,n),Ne(r,n,null),S(n,i),S(t,l),S(t,c),Ne(a,c,null),S(c,u),S(t,d),S(t,p),f=!0,h||(m=[U(n,"click",j(P((function(){s(e[0])&&e[0].apply(this,arguments)})))),U(c,"click",j(P((function(){s(e[1])&&e[1].apply(this,arguments)})))),U(p,"click",j(P((function(){s(e[2])&&e[2].apply(this,arguments)}))))],h=!0)},p(t,[r]){e=t,(!f||1&r)&&B(n,"control-disabled",!e[0]),(!f||2&r)&&B(c,"control-disabled",!e[1]),(!f||4&r)&&B(p,"control-disabled",!e[2])},i(e){f||(be(r.$$.fragment,e),be(a.$$.fragment,e),f=!0)},o(e){ye(r.$$.fragment,e),ye(a.$$.fragment,e),f=!1},d(e){e&&D(t),Re(r),Re(a),h=!1,o(m)}}}function zs(e,t,n){let{moveUp:r}=t,{moveDown:o}=t,{remove:s}=t;return e.$$set=e=>{"moveUp"in e&&n(0,r=e.moveUp),"moveDown"in e&&n(1,o=e.moveDown),"remove"in e&&n(2,s=e.remove)},[r,o,s]}const Gs=class extends Ie{constructor(e){super(),Le(this,e,zs,Ms,i,{moveUp:0,moveDown:1,remove:2})}},Bs=["Activate","AddUndo","BeforeAddUndo","BeforeExecCommand","BeforeGetContent","BeforeRenderUI","BeforeSetContent","BeforePaste","Blur","Change","ClearUndos","Click","CommentChange","CompositionEnd","CompositionStart","CompositionUpdate","ContextMenu","Copy","Cut","Dblclick","Deactivate","Dirty","Drag","DragDrop","DragEnd","DragGesture","DragOver","Drop","ExecCommand","Focus","FocusIn","FocusOut","GetContent","Hide","Init","Input","KeyDown","KeyPress","KeyUp","LoadContent","MouseDown","MouseEnter","MouseLeave","MouseMove","MouseOut","MouseOver","MouseUp","NodeChange","ObjectResizeStart","ObjectResized","ObjectSelected","Paste","PostProcess","PostRender","PreProcess","ProgressState","Redo","Remove","Reset","ResizeEditor","SaveContent","SelectionChange","SetAttrib","SetContent","Show","Submit","Undo","VisualAid"];function Hs(e){let t;return{c(){var n,r;t=N("textarea"),M(t,"id",e[0]),n=t,r="visibility",null=="hidden"?n.style.removeProperty(r):n.style.setProperty(r,"hidden","")},m(n,r){_(n,t,r),e[19](t)},p(e,n){1&n&&M(t,"id",e[0])},d(n){n&&D(t),e[19](null)}}}function qs(e){let t;return{c(){t=N("div"),M(t,"id",e[0])},m(n,r){_(n,t,r),e[18](t)},p(e,n){1&n&&M(t,"id",e[0])},d(n){n&&D(t),e[18](null)}}}function Ws(t){let n;function r(e,t){return e[1]?qs:Hs}let o=r(t),s=o(t);return{c(){n=N("div"),s.c(),M(n,"class",t[2])},m(e,r){_(e,n,r),s.m(n,null),t[20](n)},p(e,[t]){o===(o=r(e))&&s?s.p(e,t):(s.d(1),s=o(e),s&&(s.c(),s.m(n,null))),4&t&&M(n,"class",e[2])},i:e,o:e,d(e){e&&D(n),s.d(),t[20](null)}}}const Ys=e=>e+"_"+Math.floor(1e9*Math.random())+String(Date.now());let Ks=(()=>{let e={listeners:[],scriptId:Ys("tiny-script"),scriptLoaded:!1,injected:!1};return{load:(t,n,r)=>{e.scriptLoaded?r():(e.listeners.push(r),e.injected||((t,n,r)=>{e.injected=!0;const o=n.createElement("script");o.referrerPolicy="origin",o.type="application/javascript",o.src=r,o.onload=()=>{e.listeners.forEach((e=>e())),e.scriptLoaded=!0},n.head&&n.head.appendChild(o)})(e.scriptId,t,n))}}})();function Xs(e,t,n){var r;let o,s,i,{id:c=Ys("tinymce-svelte")}=t,{inline:a}=t,{disabled:u=!1}=t,{apiKey:d="no-api-key"}=t,{licenseKey:p}=t,{channel:f="7"}=t,{scriptSrc:h}=t,{conf:m={}}=t,{modelEvents:g="change input undo redo"}=t,{value:$=""}=t,{text:v=""}=t,{cssClass:b="tinymce-wrapper"}=t,y=$,w=u;const x=function(){const e=J();return(t,n,{cancelable:r=!1}={})=>{const o=e.$$.callbacks[t];if(o){const s=H(t,n,{cancelable:r});return o.slice().forEach((t=>{t.call(e,s)})),!s.defaultPrevented}return!0}}(),E=()=>{const e="undefined"!=typeof window?window:l.g;return e&&e.tinymce?e.tinymce:null},k=()=>{const e=Object.assign(Object.assign({},m),{target:s,inline:void 0!==a?a:void 0!==m.inline&&m.inline,readonly:u,license_key:p,setup:e=>{n(15,i=e),e.on("init",(()=>{e.setContent($),e.on(g,(()=>{n(16,y=e.getContent()),y!==$&&(n(5,$=y),n(6,v=e.getContent({format:"text"})))}))})),((e,t)=>{Bs.forEach((n=>{e.on(n,(r=>{t(n.toLowerCase(),{eventName:n,event:r,editor:e})}))}))})(e,x),"function"==typeof m.setup&&m.setup(e)}});n(4,s.style.visibility="",s),E().init(e)};return Z((()=>{if(null!==E())setTimeout(k,0);else{const e=h||`https://cdn.tiny.cloud/1/${d}/tinymce/${f}/tinymce.min.js`;Ks.load(o.ownerDocument,e,(()=>{k()}))}})),Q((()=>{var e;i&&(null===(e=E())||void 0===e||e.remove(i))})),e.$$set=e=>{"id"in e&&n(0,c=e.id),"inline"in e&&n(1,a=e.inline),"disabled"in e&&n(7,u=e.disabled),"apiKey"in e&&n(8,d=e.apiKey),"licenseKey"in e&&n(9,p=e.licenseKey),"channel"in e&&n(10,f=e.channel),"scriptSrc"in e&&n(11,h=e.scriptSrc),"conf"in e&&n(12,m=e.conf),"modelEvents"in e&&n(13,g=e.modelEvents),"value"in e&&n(5,$=e.value),"text"in e&&n(6,v=e.text),"cssClass"in e&&n(2,b=e.cssClass)},e.$$.update=()=>{245920&e.$$.dirty&&(i&&y!==$&&(i.setContent($),n(6,v=i.getContent({format:"text"}))),i&&u!==w&&(n(17,w=u),"function"==typeof(null===n(14,r=i.mode)||void 0===r?void 0:r.set)?i.mode.set(u?"readonly":"design"):i.setMode(u?"readonly":"design")))},[c,a,b,o,s,$,v,u,d,p,f,h,m,g,r,i,y,w,function(e){ne[e?"unshift":"push"]((()=>{s=e,n(4,s)}))},function(e){ne[e?"unshift":"push"]((()=>{s=e,n(4,s)}))},function(e){ne[e?"unshift":"push"]((()=>{o=e,n(3,o)}))}]}const Vs=class extends Ie{constructor(e){super(),Le(this,e,Xs,Ws,i,{id:0,inline:1,disabled:7,apiKey:8,licenseKey:9,channel:10,scriptSrc:11,conf:12,modelEvents:13,value:5,text:6,cssClass:2})}};function Js(e){let t,n,r;function o(t){e[4](t)}let s={apiKey:"okcf1pz4foebbixgcdydveaavknj41e62etldhxguuyug0v3",scriptSrc:e[3],conf:e[2],disabled:e[1]};return void 0!==e[0]&&(s.value=e[0]),t=new Vs({props:s}),ne.push((()=>De(t,"value",o))),{c(){Ae(t.$$.fragment)},m(e,n){Ne(t,e,n),r=!0},p(e,[r]){const o={};2&r&&(o.disabled=e[1]),!n&&1&r&&(n=!0,o.value=e[0],ce((()=>n=!1))),t.$set(o)},i(e){r||(be(t.$$.fragment,e),r=!0)},o(e){ye(t.$$.fragment,e),r=!1},d(e){Re(t,e)}}}function Zs(e,t,n){let{value:r}=t,{disabled:o=!1}=t;const s=`${l.p.slice(1)}tinymce/tinymce.min.js`;return e.$$set=e=>{"value"in e&&n(0,r=e.value),"disabled"in e&&n(1,o=e.disabled)},[r,o,{plugins:"code",toolbar:"undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | outdent indent | code",promotion:!1},s,function(e){r=e,n(0,r)}]}const Qs=class extends Ie{constructor(e){super(),Le(this,e,Zs,Js,i,{value:0,disabled:1})}};function ei(e){let t,n,r,s,i,l;return{c(){t=N("div"),n=N("span"),n.textContent="URL",r=F(),s=N("span"),M(n,"class","label svelte-1bcq7l1"),M(s,"class","url svelte-1bcq7l1"),M(s,"aria-label","URL"),M(s,"contenteditable",""),M(s,"role","textbox"),M(s,"tabindex","0"),void 0===e[3]&&le((()=>e[13].call(s))),M(t,"class","field svelte-1bcq7l1")},m(o,c){_(o,t,c),S(t,n),S(t,r),S(t,s),void 0!==e[3]&&(s.innerText=e[3]),i||(l=[U(s,"input",e[13]),U(s,"keydown",e[11])],i=!0)},p(e,t){8&t&&e[3]!==s.innerText&&(s.innerText=e[3])},d(e){e&&D(t),i=!1,o(l)}}}function ti(t){let n,r,o,s;return{c(){n=N("textarea"),n.disabled=r=t[2]&&t[4],M(n,"class","svelte-1bcq7l1")},m(e,r){_(e,n,r),G(n,t[1]),o||(s=U(n,"input",t[15]),o=!0)},p(e,t){20&t&&r!==(r=e[2]&&e[4])&&(n.disabled=r),2&t&&G(n,e[1])},i:e,o:e,d(e){e&&D(n),o=!1,s()}}}function ni(e){let t,n,r;function o(t){e[14](t)}let s={disabled:e[2]&&e[4]};return void 0!==e[1]&&(s.value=e[1]),t=new Qs({props:s}),ne.push((()=>De(t,"value",o))),{c(){Ae(t.$$.fragment)},m(e,n){Ne(t,e,n),r=!0},p(e,r){const o={};20&r&&(o.disabled=e[2]&&e[4]),!n&&2&r&&(n=!0,o.value=e[1],ce((()=>n=!1))),t.$set(o)},i(e){r||(be(t.$$.fragment,e),r=!0)},o(e){ye(t.$$.fragment,e),r=!1},d(e){Re(t,e)}}}function ri(e){let t,n,r,o,s;return{c(){t=N("label"),n=N("input"),r=L(" Fetch contents"),M(n,"type","checkbox"),M(n,"class","svelte-1bcq7l1"),M(t,"class","svelte-1bcq7l1")},m(i,l){_(i,t,l),S(t,n),n.checked=e[2],S(t,r),o||(s=U(n,"change",e[16]),o=!0)},p(e,t){4&t&&(n.checked=e[2])},d(e){e&&D(t),o=!1,s()}}}function oi(e){let t,n,r,o;return r=new Gs({props:{moveUp:e[6],moveDown:e[7],remove:e[8]}}),{c(){t=N("span"),n=F(),Ae(r.$$.fragment)},m(e,s){_(e,t,s),_(e,n,s),Ne(r,e,s),o=!0},p(e,t){const n={};64&t&&(n.moveUp=e[6]),128&t&&(n.moveDown=e[7]),256&t&&(n.remove=e[8]),r.$set(n)},i(e){o||(be(r.$$.fragment,e),o=!0)},o(e){ye(r.$$.fragment,e),o=!1},d(e){e&&(D(t),D(n)),Re(r,e)}}}function si(e){let t,n,r,i,l,c,a,u,d,p,f,h,m,g,$,v,b,y,w,x;r=new Us({});let E=void 0!==e[3]&&ei(e);const k=[ni,ti],T=[];function C(e,t){return e[10].useTiny?0:1}m=C(e),g=T[m]=k[m](e);let O=e[4]&&ri(e),A=!e[9]&&oi(e);return{c(){t=N("h3"),n=N("a"),Ae(r.$$.fragment),i=L(" back"),l=F(),c=N("div"),a=N("div"),u=N("span"),u.textContent="Title",d=F(),p=N("span"),f=F(),E&&E.c(),h=F(),g.c(),$=F(),O&&O.c(),v=F(),A&&A.c(),b=I(),M(n,"href","#home"),M(n,"class","homelink svelte-1bcq7l1"),M(t,"class","back svelte-1bcq7l1"),M(u,"class","label svelte-1bcq7l1"),M(p,"class","title svelte-1bcq7l1"),M(p,"aria-label","Title"),M(p,"contenteditable",""),M(p,"role","textbox"),M(p,"tabindex","0"),void 0===e[0]&&le((()=>e[12].call(p))),M(a,"class","field svelte-1bcq7l1"),M(c,"class","chapter edit svelte-1bcq7l1")},m(o,g){_(o,t,g),S(t,n),Ne(r,n,null),S(n,i),_(o,l,g),_(o,c,g),S(c,a),S(a,u),S(a,d),S(a,p),void 0!==e[0]&&(p.innerText=e[0]),S(c,f),E&&E.m(c,null),S(c,h),T[m].m(c,null),S(c,$),O&&O.m(c,null),_(o,v,g),A&&A.m(o,g),_(o,b,g),y=!0,w||(x=[U(n,"click",P((function(){s(e[5])&&e[5].apply(this,arguments)}))),U(p,"input",e[12]),U(p,"keydown",e[11])],w=!0)},p(t,n){e=t,1&n&&e[0]!==p.innerText&&(p.innerText=e[0]),void 0!==e[3]?E?E.p(e,n):(E=ei(e),E.c(),E.m(c,h)):E&&(E.d(1),E=null);let r=m;m=C(e),m===r?T[m].p(e,n):($e(),ye(T[r],1,1,(()=>{T[r]=null})),ve(),g=T[m],g?g.p(e,n):(g=T[m]=k[m](e),g.c()),be(g,1),g.m(c,$)),e[4]?O?O.p(e,n):(O=ri(e),O.c(),O.m(c,null)):O&&(O.d(1),O=null),e[9]?A&&($e(),ye(A,1,1,(()=>{A=null})),ve()):A?(A.p(e,n),512&n&&be(A,1)):(A=oi(e),A.c(),be(A,1),A.m(b.parentNode,b))},i(e){y||(be(r.$$.fragment,e),be(g),be(A),y=!0)},o(e){ye(r.$$.fragment,e),ye(g),ye(A),y=!1},d(e){e&&(D(t),D(l),D(c),D(v),D(b)),Re(r),E&&E.d(),T[m].d(),O&&O.d(),A&&A.d(e),w=!1,o(x)}}}function ii(e){let t,n;return t=new je({props:{onSubmit:e[5],$$slots:{default:[si]},$$scope:{ctx:e}}}),{c(){Ae(t.$$.fragment)},m(e,r){Ne(t,e,r),n=!0},p(e,[n]){const r={};32&n&&(r.onSubmit=e[5]),133119&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(be(t.$$.fragment,e),n=!0)},o(e){ye(t.$$.fragment,e),n=!1},d(e){Re(t,e)}}}function li(e,t,n){let r;u(e,Ve,(e=>n(10,r=e)));let{title:o}=t,{content:s}=t,{needsFetching:i}=t,{url:l}=t,{canFetch:c=!1}=t,{close:a}=t,{moveUp:d}=t,{moveDown:p}=t,{remove:f}=t,{hideControls:h=!1}=t;return i=null==i||i,s=null!=s?s:"",e.$$set=e=>{"title"in e&&n(0,o=e.title),"content"in e&&n(1,s=e.content),"needsFetching"in e&&n(2,i=e.needsFetching),"url"in e&&n(3,l=e.url),"canFetch"in e&&n(4,c=e.canFetch),"close"in e&&n(5,a=e.close),"moveUp"in e&&n(6,d=e.moveUp),"moveDown"in e&&n(7,p=e.moveDown),"remove"in e&&n(8,f=e.remove),"hideControls"in e&&n(9,h=e.hideControls)},[o,s,i,l,c,a,d,p,f,h,r,e=>{"Enter"!==e.key&&13!==e.keyCode||e.preventDefault()},function(){o=this.innerText,n(0,o)},function(){l=this.innerText,n(3,l)},function(e){s=e,n(1,s)},function(){s=this.value,n(1,s)},function(){i=this.checked,n(2,i)}]}const ci=class extends Ie{constructor(e){super(),Le(this,e,li,ii,i,{title:0,content:1,needsFetching:2,url:3,canFetch:4,close:5,moveUp:6,moveDown:7,remove:8,hideControls:9})}};function ai(e){let t,n;return{c(){t=N("span"),n=L(e[5]),M(t,"class","content svelte-1peomaw")},m(e,r){_(e,t,r),S(t,n)},p(e,t){32&t&&z(n,e[5])},d(e){e&&D(t)}}}function ui(e){let t,n,r,i,l,c,a,u,d,p,f,h,m,g=!e[6]&&ai(e);return p=new Gs({props:{moveUp:e[2],moveDown:e[3],remove:e[4]}}),{c(){t=N("div"),n=N("div"),r=N("span"),i=L(e[0]),l=F(),g&&g.c(),c=F(),a=N("a"),a.textContent="×",u=F(),d=N("div"),Ae(p.$$.fragment),M(r,"class","title svelte-1peomaw"),M(r,"aria-label","Title"),M(a,"class","small remove svelte-1peomaw"),M(a,"href","#remove"),M(n,"class","preview svelte-1peomaw"),B(n,"empty",e[6]),M(d,"class","more svelte-1peomaw"),M(t,"class","chapter svelte-1peomaw"),M(t,"tabindex","0"),M(t,"title",e[0]),M(t,"role","button")},m(o,$){_(o,t,$),S(t,n),S(n,r),S(r,i),S(n,l),g&&g.m(n,null),S(n,c),S(n,a),S(t,u),S(t,d),Ne(p,d,null),f=!0,h||(m=[U(a,"click",P((function(){s(e[4])&&e[4].apply(this,arguments)}))),U(t,"click",(function(){s(e[1])&&e[1].apply(this,arguments)})),U(t,"keydown",e[7]),U(t,"contextmenu",P(e[9]))],h=!0)},p(r,[o]){e=r,(!f||1&o)&&z(i,e[0]),e[6]?g&&(g.d(1),g=null):g?g.p(e,o):(g=ai(e),g.c(),g.m(n,c)),(!f||64&o)&&B(n,"empty",e[6]);const s={};4&o&&(s.moveUp=e[2]),8&o&&(s.moveDown=e[3]),16&o&&(s.remove=e[4]),p.$set(s),(!f||1&o)&&M(t,"title",e[0])},i(e){f||(be(p.$$.fragment,e),f=!0)},o(e){ye(p.$$.fragment,e),f=!1},d(e){e&&D(t),g&&g.d(),Re(p),h=!1,o(m)}}}function di(e,t,n){let r,{title:o}=t,{content:s}=t,{select:i}=t,{moveUp:l}=t,{moveDown:c}=t,{remove:a}=t;s=null!=s?s:"";let u="";return e.$$set=e=>{"title"in e&&n(0,o=e.title),"content"in e&&n(8,s=e.content),"select"in e&&n(1,i=e.select),"moveUp"in e&&n(2,l=e.moveUp),"moveDown"in e&&n(3,c=e.moveDown),"remove"in e&&n(4,a=e.remove)},e.$$.update=()=>{256&e.$$.dirty&&n(6,r=!s||!s.trim().length),256&e.$$.dirty&&setTimeout((()=>n(5,u=jt(s||""))),0)},[o,i,l,c,a,u,r,e=>{"Enter"!==e.key&&13!==e.keyCode||i()},s,function(t){ee.call(this,e,t)}]}const pi=class extends Ie{constructor(e){super(),Le(this,e,di,ui,i,{title:0,content:8,select:1,moveUp:2,moveDown:3,remove:4})}};function fi(e){let t,n,r;return{c(){t=N("span"),M(t,"class","edit svelte-3l8ef2"),M(t,"contenteditable",""),M(t,"role","textbox"),M(t,"tabindex","0"),void 0===e[0].title&&le((()=>e[13].call(t)))},m(o,s){_(o,t,s),void 0!==e[0].title&&(t.innerText=e[0].title),n||(r=[U(t,"input",e[13]),U(t,"keydown",e[8])],n=!0)},p(e,n){1&n&&e[0].title!==t.innerText&&(t.innerText=e[0].title)},d(e){e&&D(t),n=!1,o(r)}}}function hi(e){let t,n,r,o=e[0].title+"";return{c(){t=N("a"),n=L(o),M(t,"href",r=Pt(e[2])),M(t,"target","_blank")},m(e,r){_(e,t,r),S(t,n)},p(e,s){1&s&&o!==(o=e[0].title+"")&&z(n,o),4&s&&r!==(r=Pt(e[2]))&&M(t,"href",r)},d(e){e&&D(t)}}}function mi(e){let t,n,r;return{c(){t=N("span"),M(t,"class","edit svelte-3l8ef2"),M(t,"contenteditable",""),M(t,"role","textbox"),M(t,"tabindex","0"),void 0===e[0].author&&le((()=>e[14].call(t)))},m(o,s){_(o,t,s),void 0!==e[0].author&&(t.innerText=e[0].author),n||(r=[U(t,"input",e[14]),U(t,"keydown",e[8])],n=!0)},p(e,n){1&n&&e[0].author!==t.innerText&&(t.innerText=e[0].author)},d(e){e&&D(t),n=!1,o(r)}}}function gi(e){let t,n=e[0].author+"";return{c(){t=L(n)},m(e,n){_(e,t,n)},p(e,r){1&r&&n!==(n=e[0].author+"")&&z(t,n)},d(e){e&&D(t)}}}function $i(t){let n;return{c(){n=N("i"),n.textContent="None set"},m(e,t){_(e,n,t)},p:e,d(e){e&&D(n)}}}function vi(e){let t,n;return{c(){t=N("img"),a(t.src,n=e[6])||M(t,"src",n),M(t,"alt","cover"),M(t,"class","svelte-3l8ef2")},m(e,n){_(e,t,n)},p(e,r){64&r&&!a(t.src,n=e[6])&&M(t,"src",n)},d(e){e&&D(t)}}}function bi(t){let n,r,s,i,l;return{c(){n=N("input"),r=F(),s=N("input"),M(n,"type","file"),M(n,"accept","image/*"),M(s,"type","button"),s.value="Clear"},m(e,o){_(e,n,o),_(e,r,o),_(e,s,o),i||(l=[U(n,"change",t[9]),U(s,"click",P(t[15]))],i=!0)},p:e,d(e){e&&(D(n),D(r),D(s)),i=!1,o(l)}}}function yi(t){let n,r,o;return{c(){n=N("textarea")},m(e,s){_(e,n,s),G(n,t[0].description),r||(o=U(n,"input",t[17]),r=!0)},p(e,t){1&t&&G(n,e[0].description)},i:e,o:e,d(e){e&&D(n),r=!1,o()}}}function wi(e){let t,n,r;function o(t){e[16](t)}let s={};return void 0!==e[0].description&&(s.value=e[0].description),t=new Qs({props:s}),ne.push((()=>De(t,"value",o))),{c(){Ae(t.$$.fragment)},m(e,n){Ne(t,e,n),r=!0},p(e,r){const o={};!n&&1&r&&(n=!0,o.value=e[0].description,ce((()=>n=!1))),t.$set(o)},i(e){r||(be(t.$$.fragment,e),r=!0)},o(e){ye(t.$$.fragment,e),r=!1},d(e){Re(t,e)}}}function xi(t){let n;return{c(){n=N("i"),n.textContent="None set"},m(e,t){_(e,n,t)},p:e,i:e,o:e,d(e){e&&D(n)}}}function Ei(t){let n,r,o=t[0].description+"";return{c(){n=new q(!1),r=I(),n.a=r},m(e,t){n.m(o,e,t),_(e,r,t)},p(e,t){1&t&&o!==(o=e[0].description+"")&&n.p(o)},i:e,o:e,d(e){e&&(D(r),n.d())}}}function ki(e){let t,n,r,i,l,c,a,u;return{c(){t=N("h3"),t.textContent="Actions",n=F(),r=N("p"),i=N("button"),i.textContent="Transform all",l=F(),c=N("button"),c.textContent="Fetch all"},m(o,d){_(o,t,d),_(o,n,d),_(o,r,d),S(r,i),S(r,l),S(r,c),a||(u=[U(i,"click",P((function(){s(e[4])&&e[4].apply(this,arguments)}))),U(c,"click",P((function(){s(e[5])&&e[5].apply(this,arguments)})))],a=!0)},p(t,n){e=t},d(e){e&&(D(t),D(n),D(r)),a=!1,o(u)}}}function Ti(e){let t,n,r,o;const s=e[12].default,i=d(s,e,e[18],null);return{c(){t=N("h3"),t.textContent="Chapters",n=F(),r=N("div"),i&&i.c()},m(e,s){_(e,t,s),_(e,n,s),_(e,r,s),i&&i.m(r,null),o=!0},p(e,t){i&&i.p&&(!o||262144&t)&&h(i,s,e,e[18],o?f(s,e[18],t,null):m(e[18]),null)},i(e){o||(be(i,e),o=!0)},o(e){ye(i,e),o=!1},d(e){e&&(D(t),D(n),D(r)),i&&i.d(e)}}}function Si(e){let t,n,r,o,s,i,l,c,a,u,d,p,f,h,m,g,$,v,b,y,w,x;function E(e,t){return e[1]?fi:hi}let k=E(e),T=k(e);function C(e,t){return e[1]?mi:gi}let O=C(e),A=O(e);function R(e,t){return e[0].cover?vi:$i}let L=R(e),U=L(e),P=e[1]&&bi(e);const j=[Ei,xi,wi,yi],z=[];function G(e,t){return!e[1]&&e[0].description?0:e[1]?e[7].useTiny?2:3:1}$=G(e),v=z[$]=j[$](e);let B=e[1]&&ki(e),H=e[10].default&&Ti(e);return{c(){t=N("h3"),t.textContent="Title",n=F(),r=N("p"),T.c(),o=F(),s=N("h3"),s.textContent="Author",i=F(),l=N("p"),A.c(),c=F(),a=N("h3"),a.textContent="Cover",u=F(),d=N("p"),U.c(),p=F(),P&&P.c(),f=F(),h=N("h3"),h.textContent="Description",m=F(),g=N("div"),v.c(),b=F(),B&&B.c(),y=F(),H&&H.c(),w=I(),M(g,"class","wrap svelte-3l8ef2")},m(e,v){_(e,t,v),_(e,n,v),_(e,r,v),T.m(r,null),_(e,o,v),_(e,s,v),_(e,i,v),_(e,l,v),A.m(l,null),_(e,c,v),_(e,a,v),_(e,u,v),_(e,d,v),U.m(d,null),S(d,p),P&&P.m(d,null),_(e,f,v),_(e,h,v),_(e,m,v),_(e,g,v),z[$].m(g,null),_(e,b,v),B&&B.m(e,v),_(e,y,v),H&&H.m(e,v),_(e,w,v),x=!0},p(e,t){k===(k=E(e))&&T?T.p(e,t):(T.d(1),T=k(e),T&&(T.c(),T.m(r,null))),O===(O=C(e))&&A?A.p(e,t):(A.d(1),A=O(e),A&&(A.c(),A.m(l,null))),L===(L=R(e))&&U?U.p(e,t):(U.d(1),U=L(e),U&&(U.c(),U.m(d,p))),e[1]?P?P.p(e,t):(P=bi(e),P.c(),P.m(d,null)):P&&(P.d(1),P=null);let n=$;$=G(e),$===n?z[$].p(e,t):($e(),ye(z[n],1,1,(()=>{z[n]=null})),ve(),v=z[$],v?v.p(e,t):(v=z[$]=j[$](e),v.c()),be(v,1),v.m(g,null)),e[1]?B?B.p(e,t):(B=ki(e),B.c(),B.m(y.parentNode,y)):B&&(B.d(1),B=null),e[10].default?H?(H.p(e,t),1024&t&&be(H,1)):(H=Ti(e),H.c(),be(H,1),H.m(w.parentNode,w)):H&&($e(),ye(H,1,1,(()=>{H=null})),ve())},i(e){x||(be(v),be(H),x=!0)},o(e){ye(v),ye(H),x=!1},d(e){e&&(D(t),D(n),D(r),D(o),D(s),D(i),D(l),D(c),D(a),D(u),D(d),D(f),D(h),D(m),D(g),D(b),D(y),D(w)),T.d(),A.d(),U.d(),P&&P.d(),z[$].d(),B&&B.d(e),H&&H.d(e)}}}function Ci(e){let t,n;return t=new je({props:{onSubmit:e[3],$$slots:{default:[Si]},$$scope:{ctx:e}}}),{c(){Ae(t.$$.fragment)},m(e,r){Ne(t,e,r),n=!0},p(e,[n]){const r={};8&n&&(r.onSubmit=e[3]),263415&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(be(t.$$.fragment,e),n=!0)},o(e){ye(t.$$.fragment,e),n=!1},d(e){Re(t,e)}}}function Oi(e,t,n){let r;u(e,Ve,(e=>n(7,r=e)));let{$$slots:o={},$$scope:s}=t;const i=function(e){const t={};for(const n in e)t[n]=!0;return t}(o);let l,{edit:c=!1}=t,{data:a}=t,{url:d=""}=t,{onSubmit:p}=t,{onTransformAll:f}=t,{onFetchAll:h}=t;const m=new FileReader;return m.onload=()=>n(6,l=m.result),e.$$set=e=>{"edit"in e&&n(1,c=e.edit),"data"in e&&n(0,a=e.data),"url"in e&&n(2,d=e.url),"onSubmit"in e&&n(3,p=e.onSubmit),"onTransformAll"in e&&n(4,f=e.onTransformAll),"onFetchAll"in e&&n(5,h=e.onFetchAll),"$$scope"in e&&n(18,s=e.$$scope)},e.$$.update=()=>{if(2049&e.$$.dirty&&(l&&URL.revokeObjectURL(l),a.cover))try{m.abort(),m.readAsDataURL(a.cover)}catch(e){console.error(e),n(0,a.cover=void 0,a)}},[a,c,d,p,f,h,l,r,e=>{"Enter"!==e.key&&13!==e.keyCode||e.preventDefault()},async e=>{e.currentTarget.files&&e.currentTarget.files.length?n(0,a.cover=e.currentTarget.files[0],a):n(0,a.cover=void 0,a)},i,m,o,function(){a.title=this.innerText,n(0,a),n(11,m)},function(){a.author=this.innerText,n(0,a),n(11,m)},()=>n(0,a.cover=void 0,a),function(t){e.$$.not_equal(a.description,t)&&(a.description=t,n(0,a),n(11,m))},function(){a.description=this.value,n(0,a),n(11,m)},s]}const _i=class extends Ie{constructor(e){super(),Le(this,e,Oi,Ci,i,{edit:1,data:0,url:2,onSubmit:3,onTransformAll:4,onFetchAll:5})}};function Di(e,t,n){const r=e.slice();return r[57]=t[n],r}function Ai(e,t,n){const r=e.slice();return r[60]=t[n],r[62]=n,r}function Ni(e,t){let n,r,o;function s(){return t[23](t[62])}return r=new pi({props:{title:t[60].title,content:t[60].transformedContent,select:s,moveUp:t[2]>0||t[62]>0?t[14].bind(null,t[13](t[62])):void 0,moveDown:t[2]<t[3]||t[62]<t[8].length-1?t[15].bind(null,t[13](t[62])):void 0,remove:t[16].bind(null,t[13](t[62]))}}),{key:e,first:null,c(){n=I(),Ae(r.$$.fragment),this.first=n},m(e,t){_(e,n,t),Ne(r,e,t),o=!0},p(e,n){t=e;const o={};256&n[0]&&(o.title=t[60].title),256&n[0]&&(o.content=t[60].transformedContent),272&n[0]&&(o.select=s),260&n[0]&&(o.moveUp=t[2]>0||t[62]>0?t[14].bind(null,t[13](t[62])):void 0),268&n[0]&&(o.moveDown=t[2]<t[3]||t[62]<t[8].length-1?t[15].bind(null,t[13](t[62])):void 0),256&n[0]&&(o.remove=t[16].bind(null,t[13](t[62]))),r.$set(o)},i(e){o||(be(r.$$.fragment,e),o=!0)},o(e){ye(r.$$.fragment,e),o=!1},d(e){e&&D(n),Re(r,e)}}}function Ri(e){let t,n,r,i,l,c,a,u,d,p=null!==e[7].pre&&Li(e),f=Te(e[7].pages),h=[];for(let t=0;t<f.length;t+=1)h[t]=Fi(Di(e,f,t));let m=null!==e[7].post&&Ii(e);return{c(){t=N("nav"),n=N("a"),n.textContent="Previous",r=L("\n          ::\n          "),p&&p.c(),i=F();for(let e=0;e<h.length;e+=1)h[e].c();l=F(),m&&m.c(),c=L("\n          ::\n          "),a=N("a"),a.textContent="Next",M(n,"class","small svelte-4zf6uq"),M(n,"href","#prevous"),B(n,"disabled",e[2]<=0),M(a,"class","small svelte-4zf6uq"),M(a,"href","#next"),B(a,"disabled",e[2]>=e[3]),M(t,"class","svelte-4zf6uq")},m(o,f){_(o,t,f),S(t,n),S(t,r),p&&p.m(t,null),S(t,i);for(let e=0;e<h.length;e+=1)h[e]&&h[e].m(t,null);S(t,l),m&&m.m(t,null),S(t,c),S(t,a),u||(d=[U(n,"click",P((function(){s(e[17].bind(null,e[2]-1))&&e[17].bind(null,e[2]-1).apply(this,arguments)}))),U(a,"click",P((function(){s(e[17].bind(null,e[2]+1))&&e[17].bind(null,e[2]+1).apply(this,arguments)})))],u=!0)},p(r,o){if(e=r,4&o[0]&&B(n,"disabled",e[2]<=0),null!==e[7].pre?p?p.p(e,o):(p=Li(e),p.c(),p.m(t,i)):p&&(p.d(1),p=null),131204&o[0]){let n;for(f=Te(e[7].pages),n=0;n<f.length;n+=1){const r=Di(e,f,n);h[n]?h[n].p(r,o):(h[n]=Fi(r),h[n].c(),h[n].m(t,l))}for(;n<h.length;n+=1)h[n].d(1);h.length=f.length}null!==e[7].post?m?m.p(e,o):(m=Ii(e),m.c(),m.m(t,c)):m&&(m.d(1),m=null),12&o[0]&&B(a,"disabled",e[2]>=e[3])},d(e){e&&D(t),p&&p.d(),A(h,e),m&&m.d(),u=!1,o(d)}}}function Li(e){let t,n,r,o,i,l,c=e[7].pre+"";return{c(){t=N("a"),n=L(c),o=L("\n            ."),M(t,"class","small svelte-4zf6uq"),M(t,"href",r=`#page ${e[7].pre}`)},m(r,c){_(r,t,c),S(t,n),_(r,o,c),i||(l=U(t,"click",P((function(){s(e[17].bind(null,e[7].pre-1))&&e[17].bind(null,e[7].pre-1).apply(this,arguments)}))),i=!0)},p(o,s){e=o,128&s[0]&&c!==(c=e[7].pre+"")&&z(n,c),128&s[0]&&r!==(r=`#page ${e[7].pre}`)&&M(t,"href",r)},d(e){e&&(D(t),D(o)),i=!1,l()}}}function Fi(e){let t,n,r,o,i,l=e[57]+1+"";return{c(){t=N("a"),n=L(l),M(t,"class","small svelte-4zf6uq"),M(t,"href",r=`#page ${e[57]+1}`),B(t,"current",e[57]==e[2])},m(r,l){_(r,t,l),S(t,n),o||(i=U(t,"click",P((function(){s(e[17].bind(null,e[57]))&&e[17].bind(null,e[57]).apply(this,arguments)}))),o=!0)},p(o,s){e=o,128&s[0]&&l!==(l=e[57]+1+"")&&z(n,l),128&s[0]&&r!==(r=`#page ${e[57]+1}`)&&M(t,"href",r),132&s[0]&&B(t,"current",e[57]==e[2])},d(e){e&&D(t),o=!1,i()}}}function Ii(e){let t,n,r,o,i,l,c=e[7].post+"";return{c(){t=L(".\n            "),n=N("a"),r=L(c),M(n,"class","small svelte-4zf6uq"),M(n,"href",o=`#page ${e[7].post}`)},m(o,c){_(o,t,c),_(o,n,c),S(n,r),i||(l=U(n,"click",P((function(){s(e[17].bind(null,e[7].post-1))&&e[17].bind(null,e[7].post-1).apply(this,arguments)}))),i=!0)},p(t,s){e=t,128&s[0]&&c!==(c=e[7].post+"")&&z(r,c),128&s[0]&&o!==(o=`#page ${e[7].post}`)&&M(n,"href",o)},d(e){e&&(D(t),D(n)),i=!1,l()}}}function Ui(e){let t,n,r,i,l,c,a,u,d,p,f,h,m=[],$=new Map,v=Te(e[8]);const b=e=>e[60].id;for(let t=0;t<v.length;t+=1){let n=Ai(e,v,t),r=b(n);$.set(r,m[t]=Ni(r,n))}let y=e[1].chapters.length>0&&Ri(e);return{c(){t=N("div");for(let e=0;e<m.length;e+=1)m[e].c();r=F(),y&&y.c(),i=F(),l=N("button"),l.textContent="Add new",c=F(),a=N("button"),a.textContent="Add bulk",u=F(),d=N("a"),d.textContent="Remove all",M(t,"class","chapters svelte-4zf6uq"),M(d,"class","small remove svelte-4zf6uq"),M(d,"href","#clear")},m(o,s){_(o,t,s);for(let e=0;e<m.length;e+=1)m[e]&&m[e].m(t,null);_(o,r,s),y&&y.m(o,s),_(o,i,s),_(o,l,s),_(o,c,s),_(o,a,s),_(o,u,s),_(o,d,s),p=!0,f||(h=[g(n=As.call(null,t,{items:e[8],flipDurationMs:Hi})),U(t,"consider",e[18]),U(t,"finalize",e[18]),U(l,"click",P(e[24])),U(a,"click",P(e[25])),U(d,"click",P(e[26]))],f=!0)},p(e,r){123164&r[0]&&(v=Te(e[8]),$e(),m=Oe(m,r,b,1,e,v,$,t,Ce,Ni,null,Ai),ve()),n&&s(n.update)&&256&r[0]&&n.update.call(null,{items:e[8],flipDurationMs:Hi}),e[1].chapters.length>0?y?y.p(e,r):(y=Ri(e),y.c(),y.m(i.parentNode,i)):y&&(y.d(1),y=null)},i(e){if(!p){for(let e=0;e<v.length;e+=1)be(m[e]);p=!0}},o(e){for(let e=0;e<m.length;e+=1)ye(m[e]);p=!1},d(e){e&&(D(t),D(r),D(i),D(l),D(c),D(a),D(u),D(d));for(let e=0;e<m.length;e+=1)m[e].d();y&&y.d(e),f=!1,o(h)}}}function Pi(e){let t,n,r,s,i,l,c,a,u,d;function p(t){e[29](t)}function f(t){e[30](t)}function h(t){e[31](t)}function m(t){e[32](t)}let g={canFetch:!!e[5].apiUrl,close:e[28],moveUp:e[2]>0||e[4]>0?e[14].bind(null,e[4]):void 0,moveDown:e[2]<e[3]||e[4]<e[8].length-1?e[15].bind(null,e[4]):void 0,remove:e[16].bind(null,e[4])};return void 0!==e[5].title&&(g.title=e[5].title),void 0!==e[5].transformedContent&&(g.content=e[5].transformedContent),void 0!==e[5].needsFetching&&(g.needsFetching=e[5].needsFetching),void 0!==e[5].displayUrl&&(g.url=e[5].displayUrl),n=new ci({props:g}),ne.push((()=>De(n,"title",p))),ne.push((()=>De(n,"content",f))),ne.push((()=>De(n,"needsFetching",h))),ne.push((()=>De(n,"url",m))),{c(){t=N("div"),Ae(n.$$.fragment),M(t,"class","svelte-4zf6uq"),B(t,"float",e[11])},m(r,o){_(r,t,o),Ne(n,t,null),a=!0,u||(d=[U(t,"introend",e[33]),U(t,"outrostart",e[34]),U(t,"outroend",e[35])],u=!0)},p(e,o){const c={};32&o[0]&&(c.canFetch=!!e[5].apiUrl),48&o[0]&&(c.close=e[28]),20&o[0]&&(c.moveUp=e[2]>0||e[4]>0?e[14].bind(null,e[4]):void 0),284&o[0]&&(c.moveDown=e[2]<e[3]||e[4]<e[8].length-1?e[15].bind(null,e[4]):void 0),16&o[0]&&(c.remove=e[16].bind(null,e[4])),!r&&32&o[0]&&(r=!0,c.title=e[5].title,ce((()=>r=!1))),!s&&32&o[0]&&(s=!0,c.content=e[5].transformedContent,ce((()=>s=!1))),!i&&32&o[0]&&(i=!0,c.needsFetching=e[5].needsFetching,ce((()=>i=!1))),!l&&32&o[0]&&(l=!0,c.url=e[5].displayUrl,ce((()=>l=!1))),n.$set(c),(!a||2048&o[0])&&B(t,"float",e[11])},i(e){a||(be(n.$$.fragment,e),e&&le((()=>{a&&(c||(c=xe(t,Fs,{x:50,duration:200},!0)),c.run(1))})),a=!0)},o(e){ye(n.$$.fragment,e),e&&(c||(c=xe(t,Fs,{x:50,duration:200},!1)),c.run(0)),a=!1},d(e){e&&D(t),Re(n),e&&c&&c.end(),u=!1,o(d)}}}function ji(e){let t,n,r,s,i,l,c,a,u,d;function p(t){e[37](t)}function f(t){e[38](t)}function h(t){e[39](t)}function m(t){e[40](t)}let g={canFetch:!!e[6].apiUrl,hideControls:!0,close:e[36]};return void 0!==e[6].title&&(g.title=e[6].title),void 0!==e[6].transformedContent&&(g.content=e[6].transformedContent),void 0!==e[6].needsFetching&&(g.needsFetching=e[6].needsFetching),void 0!==e[6].displayUrl&&(g.url=e[6].displayUrl),n=new ci({props:g}),ne.push((()=>De(n,"title",p))),ne.push((()=>De(n,"content",f))),ne.push((()=>De(n,"needsFetching",h))),ne.push((()=>De(n,"url",m))),{c(){t=N("div"),Ae(n.$$.fragment),M(t,"class","svelte-4zf6uq"),B(t,"float",e[11])},m(r,o){_(r,t,o),Ne(n,t,null),a=!0,u||(d=[U(t,"introend",e[41]),U(t,"outrostart",e[42]),U(t,"outroend",e[43])],u=!0)},p(e,o){const c={};64&o[0]&&(c.canFetch=!!e[6].apiUrl),66&o[0]&&(c.close=e[36]),!r&&64&o[0]&&(r=!0,c.title=e[6].title,ce((()=>r=!1))),!s&&64&o[0]&&(s=!0,c.content=e[6].transformedContent,ce((()=>s=!1))),!i&&64&o[0]&&(i=!0,c.needsFetching=e[6].needsFetching,ce((()=>i=!1))),!l&&64&o[0]&&(l=!0,c.url=e[6].displayUrl,ce((()=>l=!1))),n.$set(c),(!a||2048&o[0])&&B(t,"float",e[11])},i(e){a||(be(n.$$.fragment,e),e&&le((()=>{a&&(c||(c=xe(t,Fs,{x:50,duration:200},!0)),c.run(1))})),a=!0)},o(e){ye(n.$$.fragment,e),e&&(c||(c=xe(t,Fs,{x:50,duration:200},!1)),c.run(0)),a=!1},d(e){e&&D(t),Re(n),e&&c&&c.end(),u=!1,o(d)}}}function Mi(e){let t,n,r,s,i,l;return n=new je({props:{onSubmit:e[22],$$slots:{default:[zi]},$$scope:{ctx:e}}}),{c(){t=N("div"),Ae(n.$$.fragment),M(t,"class","svelte-4zf6uq"),B(t,"float",e[11])},m(r,o){_(r,t,o),Ne(n,t,null),s=!0,i||(l=[U(t,"introend",e[46]),U(t,"outrostart",e[47]),U(t,"outroend",e[48])],i=!0)},p(e,r){const o={};512&r[0]|2&r[2]&&(o.$$scope={dirty:r,ctx:e}),n.$set(o),(!s||2048&r[0])&&B(t,"float",e[11])},i(e){s||(be(n.$$.fragment,e),e&&le((()=>{s&&(r||(r=xe(t,Fs,{x:50,duration:200},!0)),r.run(1))})),s=!0)},o(e){ye(n.$$.fragment,e),e&&(r||(r=xe(t,Fs,{x:50,duration:200},!1)),r.run(0)),s=!1},d(e){e&&D(t),Re(n),e&&r&&r.end(),i=!1,o(l)}}}function zi(e){let t,n,r,s,i,l,c,a,u,d,p,f,h,m,g,$,v,b;return r=new Us({}),{c(){t=N("h3"),n=N("a"),Ae(r.$$.fragment),s=L(" back"),i=F(),l=N("div"),c=N("p"),c.textContent="Enter list of URLs:",a=F(),u=N("textarea"),d=F(),p=N("p"),p.textContent="One URL per line",f=F(),h=N("p"),m=N("input"),M(n,"href","#home"),M(n,"class","homelink svelte-4zf6uq"),M(t,"class","back svelte-4zf6uq"),M(u,"rows","5"),M(u,"class","svelte-4zf6uq"),M(p,"class","small"),M(m,"type","submit"),m.value="Add all",M(m,"class","submit"),m.disabled=g=void 0===e[9]||!e[9].trim().length},m(o,g){_(o,t,g),S(t,n),Ne(r,n,null),S(n,s),_(o,i,g),_(o,l,g),S(l,c),S(l,a),S(l,u),G(u,e[9]),S(l,d),S(l,p),S(l,f),S(l,h),S(h,m),$=!0,v||(b=[U(n,"click",P(e[44])),U(u,"input",e[45])],v=!0)},p(e,t){512&t[0]&&G(u,e[9]),(!$||512&t[0]&&g!==(g=void 0===e[9]||!e[9].trim().length))&&(m.disabled=g)},i(e){$||(be(r.$$.fragment,e),$=!0)},o(e){ye(r.$$.fragment,e),$=!1},d(e){e&&(D(t),D(i),D(l)),Re(r),v=!1,o(b)}}}function Gi(e){let t,n,r,s,i,l,c,a,u,d,p,f,h,m;s=new _i({props:{data:e[1],edit:!0,onSubmit:e[27],onTransformAll:e[20],onFetchAll:e[21],$$slots:{default:[Ui]},$$scope:{ctx:e}}});let g=e[5]&&Pi(e),$=e[6]&&ji(e),v=void 0!==e[9]&&Mi(e);return{c(){t=L("You are editing:\n\n"),n=N("div"),r=N("div"),Ae(s.$$.fragment),i=F(),g&&g.c(),l=F(),$&&$.c(),c=F(),v&&v.c(),a=F(),u=N("button"),u.textContent="Save",d=F(),p=N("a"),p.textContent="Cancel",M(r,"class","svelte-4zf6uq"),B(r,"hide",e[10]),M(n,"class","list svelte-4zf6uq"),M(u,"type","submit"),M(p,"href","#cancel"),M(p,"class","small")},m(o,b){_(o,t,b),_(o,n,b),S(n,r),Ne(s,r,null),S(n,i),g&&g.m(n,null),S(n,l),$&&$.m(n,null),S(n,c),v&&v.m(n,null),_(o,a,b),_(o,u,b),_(o,d,b),_(o,p,b),f=!0,h||(m=[U(u,"click",e[49]),U(p,"click",P(e[50]))],h=!0)},p(e,t){const o={};2&t[0]&&(o.data=e[1]),3&t[0]&&(o.onSubmit=e[27]),990&t[0]|2&t[2]&&(o.$$scope={dirty:t,ctx:e}),s.$set(o),(!f||1024&t[0])&&B(r,"hide",e[10]),e[5]?g?(g.p(e,t),32&t[0]&&be(g,1)):(g=Pi(e),g.c(),be(g,1),g.m(n,l)):g&&($e(),ye(g,1,1,(()=>{g=null})),ve()),e[6]?$?($.p(e,t),64&t[0]&&be($,1)):($=ji(e),$.c(),be($,1),$.m(n,c)):$&&($e(),ye($,1,1,(()=>{$=null})),ve()),void 0!==e[9]?v?(v.p(e,t),512&t[0]&&be(v,1)):(v=Mi(e),v.c(),be(v,1),v.m(n,null)):v&&($e(),ye(v,1,1,(()=>{v=null})),ve())},i(e){f||(be(s.$$.fragment,e),be(g),be($),be(v),f=!0)},o(e){ye(s.$$.fragment,e),ye(g),ye($),ye(v),f=!1},d(e){e&&(D(t),D(n),D(a),D(u),D(d),D(p)),Re(s),g&&g.d(),$&&$.d(),v&&v.d(),h=!1,o(m)}}}const Bi=50,Hi=200;function qi(e,t,n){let r,o,s;u(e,Ve,(e=>n(52,r=e))),u(e,Sn,(e=>n(53,o=e))),u(e,Cn,(e=>n(54,s=e)));let{stage:i}=t;if(!s)throw new Error("Inconsistent state, expected to have book data");const l=(c=s,Object.assign(Object.assign({},c),{chapters:c.chapters.map((e=>Object.assign({},e)))}));var c;const a=s;let d,p,f,h,m,g,$=0,v=-1;const b=e=>e+Bi*$,y=e=>{e.displayUrl&&(o.series.type===Vt.GENERIC?e.apiUrl=e.displayUrl:e.apiUrl=Ut(e.displayUrl))};let w={pre:null,pages:[],post:null},x=!1,E=!0;return e.$$set=e=>{"stage"in e&&n(0,i=e.stage)},e.$$.update=()=>{2&e.$$.dirty[0]&&n(3,p=Math.ceil(a.chapters.length/Bi-1)),6&e.$$.dirty[0]&&n(8,f=a.chapters.slice($*Bi,($+1)*Bi)),18&e.$$.dirty[0]&&n(5,h=v>=0?a.chapters[v]:void 0),140&e.$$.dirty[0]&&(n(7,w.pages=((e,t)=>{const n=new Array(t-e+1);for(let r=e;r<=t;r++)n[r-e]=r;return n})(Math.max(0,$-3),Math.min(p,$+3)),w),n(7,w.pre=0!==w.pages[0]?1:null,w),n(7,w.post=w.pages[w.pages.length-1]!==p?p+1:null,w)),32&e.$$.dirty[0]&&h&&y(h),64&e.$$.dirty[0]&&m&&y(m)},[i,a,$,p,v,h,m,w,f,g,x,E,l,b,e=>{e<1||(e===v&&n(4,--v),a.chapters.splice(e-1,2,a.chapters[e],a.chapters[e-1]),n(1,a))},e=>{e>=a.chapters.length||(e===v&&n(4,++v),a.chapters.splice(e,2,a.chapters[e+1],a.chapters[e]),n(1,a))},e=>{n(4,v=-1),a.chapters.splice(e,1),n(1,a)},e=>{if($==e){const t=prompt("New page:",""+($+1)),n=+(t||"");null!==t&&!isNaN(n)&&n>0&&n<=p+1&&(e=n-1)}d=Math.sign(e-$),n(2,$=e)},e=>{(e=>{a.chapters.splice($*Bi,Bi,...e.detail.items),n(1,a)})(e)},y,()=>{window.confirm("Really continue? This will discard all changes!")&&n(1,a.chapters=an(r,a.chapters),a)},()=>{window.confirm("Really continue? This will discard all changes!")&&(n(1,a.chapters=a.chapters.map((e=>Object.assign(Object.assign({},e),{content:void 0,transformedContent:void 0,needsFetching:!0}))),a),i.fetch(a))},()=>{const e=a.chapters.length,t=g.split("\n");n(1,a.chapters=a.chapters.concat(t.map(((t,n)=>({apiUrl:t,id:At(),title:`Chapter ${n+e}`,displayUrl:t})))),a),n(9,g=void 0)},e=>n(4,v=b(e)),()=>{n(6,m={id:At(),title:"",apiUrl:"",displayUrl:""})},()=>{n(9,g="")},()=>n(1,a.chapters=[],a),()=>i.next(a),()=>{y(h),n(4,v=-1)},function(t){e.$$.not_equal(h.title,t)&&(h.title=t,n(5,h),n(4,v),n(1,a))},function(t){e.$$.not_equal(h.transformedContent,t)&&(h.transformedContent=t,n(5,h),n(4,v),n(1,a))},function(t){e.$$.not_equal(h.needsFetching,t)&&(h.needsFetching=t,n(5,h),n(4,v),n(1,a))},function(t){e.$$.not_equal(h.displayUrl,t)&&(h.displayUrl=t,n(5,h),n(4,v),n(1,a))},()=>{n(10,x=!0),n(11,E=!1)},()=>{n(11,E=!0)},()=>{n(10,x=!1)},()=>{if(!m)throw"";y(m),a.chapters.push(m),n(1,a),n(6,m=void 0)},function(t){e.$$.not_equal(m.title,t)&&(m.title=t,n(6,m))},function(t){e.$$.not_equal(m.transformedContent,t)&&(m.transformedContent=t,n(6,m))},function(t){e.$$.not_equal(m.needsFetching,t)&&(m.needsFetching=t,n(6,m))},function(t){e.$$.not_equal(m.displayUrl,t)&&(m.displayUrl=t,n(6,m))},()=>{n(10,x=!0),n(11,E=!1)},()=>{n(11,E=!0)},()=>{n(10,x=!1)},()=>n(9,g=void 0),function(){g=this.value,n(9,g)},()=>{n(10,x=!0),n(11,E=!1)},()=>{n(11,E=!0)},()=>{n(10,x=!1)},()=>i.next(a),()=>i.next(l)]}const Wi=class extends Ie{constructor(e){super(),Le(this,e,qi,Gi,i,{stage:0},null,[-1,-1,-1])}};function Yi(e,t,n){const r=e.slice();return r[19]=t[n],r}function Ki(e){let t,n,r,o;return t=new Ct({props:{error:e[22],retry:e[14]}}),r=new yt({props:{backToSearch:e[2]}}),{c(){Ae(t.$$.fragment),n=F(),Ae(r.$$.fragment)},m(e,s){Ne(t,e,s),_(e,n,s),Ne(r,e,s),o=!0},p(e,n){const o={};16&n&&(o.error=e[22]),16&n&&(o.retry=e[14]),t.$set(o);const s={};4&n&&(s.backToSearch=e[2]),r.$set(s)},i(e){o||(be(t.$$.fragment,e),be(r.$$.fragment,e),o=!0)},o(e){ye(t.$$.fragment,e),ye(r.$$.fragment,e),o=!1},d(e){e&&D(n),Re(t,e),Re(r,e)}}}function Xi(e){let t,n,r,s,i,l,c,a,u,d,p,f,h,m;function g(e,t){return 16&t&&(i=null),null==i&&(i=!!e[18].chapters.find(ll)),i?rl:nl}r=new _i({props:{data:e[18],url:e[1].url,$$slots:{default:[tl]},$$scope:{ctx:e}}});let $=g(e,-1),v=$(e);return p=new yt({props:{backToSearch:e[2]}}),{c(){t=L("Got the following series:\n\n  "),n=N("div"),Ae(r.$$.fragment),s=F(),v.c(),l=F(),c=N("button"),c.textContent="Edit book",a=F(),u=N("button"),u.textContent="Export",d=F(),Ae(p.$$.fragment),M(n,"class","list svelte-1hsynpq")},m(o,i){_(o,t,i),_(o,n,i),Ne(r,n,null),_(o,s,i),v.m(o,i),_(o,l,i),_(o,c,i),_(o,a,i),_(o,u,i),_(o,d,i),Ne(p,o,i),f=!0,h||(m=[U(c,"click",e[12]),U(u,"click",e[13])],h=!0)},p(e,t){const n={};16&t&&(n.data=e[18]),2&t&&(n.url=e[1].url),8388633&t&&(n.$$scope={dirty:t,ctx:e}),r.$set(n),$===($=g(e,t))&&v?v.p(e,t):(v.d(1),v=$(e),v&&(v.c(),v.m(l.parentNode,l)));const o={};4&t&&(o.backToSearch=e[2]),p.$set(o)},i(e){f||(be(r.$$.fragment,e),be(p.$$.fragment,e),f=!0)},o(e){ye(r.$$.fragment,e),ye(p.$$.fragment,e),f=!1},d(e){e&&(D(t),D(n),D(s),D(l),D(c),D(a),D(u),D(d)),Re(r),v.d(e),Re(p,e),h=!1,o(m)}}}function Vi(e){let t;return{c(){t=L("hide")},m(e,n){_(e,t,n)},d(e){e&&D(t)}}}function Ji(e){let t;return{c(){t=L("show")},m(e,n){_(e,t,n)},d(e){e&&D(t)}}}function Zi(e){let t,n,r,o,s,i,l=e[0].newChapters+"";return{c(){t=N("a"),n=L("Found "),r=L(l),o=L(" new"),M(t,"href","#?")},m(l,c){_(l,t,c),S(t,n),S(t,r),S(t,o),s||(i=U(t,"click",P(e[9])),s=!0)},p(e,t){1&t&&l!==(l=e[0].newChapters+"")&&z(r,l)},d(e){e&&D(t),s=!1,i()}}}function Qi(e){let t,n,r,o=[],s=new Map,i=Te(e[18].chapters);const l=e=>e[19].id;for(let t=0;t<i.length;t+=1){let n=Yi(e,i,t),r=l(n);s.set(r,o[t]=el(r,n))}return{c(){t=N("div");for(let e=0;e<o.length;e+=1)o[e].c();M(t,"class","chapter-list svelte-1hsynpq")},m(e,n){_(e,t,n);for(let e=0;e<o.length;e+=1)o[e]&&o[e].m(t,null);r=!0},p(e,n){16&n&&(i=Te(e[18].chapters),o=Oe(o,n,l,1,e,i,s,t,Se,el,null,Yi))},i(e){r||(e&&le((()=>{r&&(n||(n=xe(t,Gt,{},!0)),n.run(1))})),r=!0)},o(e){e&&(n||(n=xe(t,Gt,{},!1)),n.run(0)),r=!1},d(e){e&&D(t);for(let e=0;e<o.length;e+=1)o[e].d();e&&n&&n.end()}}}function el(e,t){let n,r,o,s=t[19].title+"";return{key:e,first:null,c(){n=N("a"),r=L(s),M(n,"href",o=t[19].displayUrl),M(n,"target","_blank"),M(n,"class","small"),this.first=n},m(e,t){_(e,n,t),S(n,r)},p(e,i){t=e,16&i&&s!==(s=t[19].title+"")&&z(r,s),16&i&&o!==(o=t[19].displayUrl)&&M(n,"href",o)},d(e){e&&D(n)}}}function tl(e){let t,n,r,s,i,l,c,a,u,d,p,f,h,m,g=e[18].chapters.length+"";function $(e,t){return e[3]?Vi:Ji}let v=$(e),b=v(e),y="number"==typeof e[0].newChapters&&Zi(e),w=e[3]&&Qi(e);return{c(){t=N("p"),n=L("Found "),r=L(g),s=F(),i=N("a"),b.c(),l=F(),c=N("span"),a=F(),u=N("button"),u.textContent="Find more",d=F(),y&&y.c(),p=F(),w&&w.c(),f=I(),M(i,"href","#show"),M(i,"class","small"),M(c,"class","spacer svelte-1hsynpq"),M(t,"class","no-margin svelte-1hsynpq")},m(o,g){_(o,t,g),S(t,n),S(t,r),S(t,s),S(t,i),b.m(i,null),S(t,l),S(t,c),S(t,a),S(t,u),S(t,d),y&&y.m(t,null),_(o,p,g),w&&w.m(o,g),_(o,f,g),h||(m=[U(i,"click",P(e[7])),U(u,"click",e[8])],h=!0)},p(e,n){16&n&&g!==(g=e[18].chapters.length+"")&&z(r,g),v!==(v=$(e))&&(b.d(1),b=v(e),b&&(b.c(),b.m(i,null))),"number"==typeof e[0].newChapters?y?y.p(e,n):(y=Zi(e),y.c(),y.m(t,null)):y&&(y.d(1),y=null),e[3]?w?(w.p(e,n),8&n&&be(w,1)):(w=Qi(e),w.c(),be(w,1),w.m(f.parentNode,f)):w&&($e(),ye(w,1,1,(()=>{w=null})),ve())},d(e){e&&(D(t),D(p),D(f)),b.d(),y&&y.d(),w&&w.d(e),h=!1,o(m)}}}function nl(t){let n,r,o;return{c(){n=N("button"),n.textContent="Generate EPUB"},m(e,s){_(e,n,s),r||(o=U(n,"click",t[11]),r=!0)},p:e,d(e){e&&D(n),r=!1,o()}}}function rl(t){let n,r,o;return{c(){n=N("button"),n.textContent="Fetch chapter contents"},m(e,s){_(e,n,s),r||(o=U(n,"click",t[10]),r=!0)},p:e,d(e){e&&D(n),r=!1,o()}}}function ol(e){let t,n;return t=new Dt({props:{$$slots:{default:[sl]},$$scope:{ctx:e}}}),{c(){Ae(t.$$.fragment)},m(e,r){Ne(t,e,r),n=!0},p(e,n){const r={};8388608&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(be(t.$$.fragment,e),n=!0)},o(e){ye(t.$$.fragment,e),n=!1},d(e){Re(t,e)}}}function sl(e){let t;return{c(){t=L("Please wait, fetching data...")},m(e,n){_(e,t,n)},d(e){e&&D(t)}}}function il(e){let t,n,r,o={ctx:e,current:null,token:null,hasCatch:!0,pending:ol,then:Xi,catch:Ki,value:18,error:22,blocks:[,,,]};return Ee(n=e[4],o),{c(){t=I(),o.block.c()},m(e,n){_(e,t,n),o.block.m(e,o.anchor=n),o.mount=()=>t.parentNode,o.anchor=t,r=!0},p(t,[r]){e=t,o.ctx=e,16&r&&n!==(n=e[4])&&Ee(n,o)||ke(o,e,r)},i(e){r||(be(o.block),r=!0)},o(e){for(let e=0;e<3;e+=1)ye(o.blocks[e]);r=!1},d(e){e&&D(t),o.block.d(e),o.token=null,o=null}}}const ll=e=>!1!==e.needsFetching&&e.apiUrl;function cl(e,t,n){let r,o,s;u(e,Cn,(e=>n(15,r=e))),u(e,Sn,(e=>n(16,o=e))),u(e,Ve,(e=>n(17,s=e)));let{stage:i}=t,{series:l}=t,{backToSearch:c}=t,a=!1;const d=()=>r?Promise.resolve(r):(async e=>{var t,n,r;const o=await Rt(new URL(e.url)),s=await Qt(e,o);if(!o.ok)throw""+(null!==(n=null!==(t=s.message)&&void 0!==t?t:o.statusText)&&void 0!==n?n:o.status);const i=((e,t)=>{switch(e){case Vt.HFY_SERIES:return(({data:{content_md:e,content_html:t}})=>{var n,r,o,s,i,l;const c=(new DOMParser).parseFromString(jt(t),"text/html").querySelectorAll("a[href]");return{author:null!==(o=null===(r=null===(n=e.match(/\[\*\*(?:Author\s*[-:]\s*)?([^*\]]+)\*\*\]|A Story By \[(?:\*\*)?([^\]]+?)(?:\*\*)?\]/i))||void 0===n?void 0:n.slice(1).find(Boolean))||void 0===r?void 0:r.trim())&&void 0!==o?o:"unknown",title:null!==(l=null===(i=null===(s=e.match(/##?\s*\*\*(.+)\*\*/))||void 0===s?void 0:s[1])||void 0===i?void 0:i.trim())&&void 0!==l?l:"unknown",chapters:Array.from(c).filter((e=>e.getAttribute("href").match(Bt))).map(((e,t)=>{var n,r;const o=e.getAttribute("href").startsWith("http")?e.getAttribute("href"):`https://www.reddit.com${e.getAttribute("href")}`;return{id:At(),title:null!==(r=null===(n=e.textContent)||void 0===n?void 0:n.trim())&&void 0!==r?r:`Chapter ${t}`,apiUrl:Ut(o),displayUrl:o}}))}})(t);case Vt.POST:return(e=>({author:e[0].data.children[0].data.author,title:e[0].data.children[0].data.title,chapters:[Xt(e)]}))(t);case Vt.GENERIC:return(e=>{const t=Mt(e);return{title:t.title,author:"unknown",chapters:Array.from(t.querySelectorAll("ul a, ol a")).map((e=>({displayUrl:e.href,apiUrl:e.href,id:At(),title:e.innerHTML})))}})(t)}throw new Error(`Getting data from source type \`${Vt[e]}\` not supported, this should never happen`)})(e.type,s);if(!(null===(r=null==i?void 0:i.chapters)||void 0===r?void 0:r.length))throw new Error("No chapters found");return i})(l).then((e=>{const t=Object.assign(Object.assign({},e),{chapters:an(s,e.chapters)});return Cn.update((()=>t)),t}));let p=d();const f=async()=>{if(!r)throw new Error("Inconsistent state, expected to have book data");const e=JSON.stringify({bookData:await An(r),series:o.series});gt()(new Blob([e]),`${r.author} - ${r.title}.json`,"application/json")};return e.$$set=e=>{"stage"in e&&n(0,i=e.stage),"series"in e&&n(1,l=e.series),"backToSearch"in e&&n(2,c=e.backToSearch)},[i,l,c,a,p,d,f,()=>n(3,a=!a),()=>i.findMore(),()=>n(0,i.newChapters=void 0,i),()=>i.downloadAll(),()=>i.next(),()=>i.edit(),()=>f(),()=>n(4,p=d())]}const al=class extends Ie{constructor(e){super(),Le(this,e,cl,il,i,{stage:0,series:1,backToSearch:2})}};function ul(e,t,n){const r=e.slice();return r[7]=t[n],r}function dl(e){let t,n;return t=new Ct({props:{error:e[10],retry:e[5]}}),{c(){Ae(t.$$.fragment)},m(e,r){Ne(t,e,r),n=!0},p(e,n){const r={};4&n&&(r.error=e[10]),4&n&&(r.retry=e[5]),t.$set(r)},i(e){n||(be(t.$$.fragment,e),n=!0)},o(e){ye(t.$$.fragment,e),n=!1},d(e){Re(t,e)}}}function pl(t){let n,r,o,s,i,l,c,a,u=Te(t[6]),d=[];for(let e=0;e<u.length;e+=1)d[e]=hl(ul(t,u,e));return{c(){n=N("p"),r=L("The search for '"),o=L(t[1]),s=L("' returned these results:"),i=F(),l=N("ul");for(let e=0;e<d.length;e+=1)d[e].c();c=F(),a=N("p"),a.textContent="Please select one.",M(a,"class","small")},m(e,t){_(e,n,t),S(n,r),S(n,o),S(n,s),_(e,i,t),_(e,l,t);for(let e=0;e<d.length;e+=1)d[e]&&d[e].m(l,null);_(e,c,t),_(e,a,t)},p(e,t){if(2&t&&z(o,e[1]),5&t){let n;for(u=Te(e[6]),n=0;n<u.length;n+=1){const r=ul(e,u,n);d[n]?d[n].p(r,t):(d[n]=hl(r),d[n].c(),d[n].m(l,null))}for(;n<d.length;n+=1)d[n].d(1);d.length=u.length}},i:e,o:e,d(e){e&&(D(n),D(i),D(l),D(c),D(a)),A(d,e)}}}function fl(e){let t,n,r,o,s=e[7].author+"";return{c(){t=L("["),n=N("i"),r=L(s),o=L("]")},m(e,s){_(e,t,s),_(e,n,s),S(n,r),_(e,o,s)},p(e,t){4&t&&s!==(s=e[7].author+"")&&z(r,s)},d(e){e&&(D(t),D(n),D(o))}}}function hl(e){let t,n,r,o,s,i,l,c,a=e[7].title+"";function u(){return e[4](e[7])}let d=e[7].author&&fl(e);return{c(){t=N("li"),n=N("a"),r=L(a),s=F(),d&&d.c(),i=F(),M(n,"href",o=Pt(e[7].url))},m(e,o){_(e,t,o),S(t,n),S(n,r),S(t,s),d&&d.m(t,null),S(t,i),l||(c=U(n,"click",P(u)),l=!0)},p(s,l){e=s,4&l&&a!==(a=e[7].title+"")&&z(r,a),4&l&&o!==(o=Pt(e[7].url))&&M(n,"href",o),e[7].author?d?d.p(e,l):(d=fl(e),d.c(),d.m(t,i)):d&&(d.d(1),d=null)},d(e){e&&D(t),d&&d.d(),l=!1,c()}}}function ml(e){let t,n;return t=new Dt({props:{$$slots:{default:[gl]},$$scope:{ctx:e}}}),{c(){Ae(t.$$.fragment)},m(e,r){Ne(t,e,r),n=!0},p(e,n){const r={};2048&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(be(t.$$.fragment,e),n=!0)},o(e){ye(t.$$.fragment,e),n=!1},d(e){Re(t,e)}}}function gl(e){let t;return{c(){t=L("Please wait, fetching results...")},m(e,n){_(e,t,n)},d(e){e&&D(t)}}}function $l(e){let t,n,r,o={ctx:e,current:null,token:null,hasCatch:!0,pending:ml,then:pl,catch:dl,value:6,error:10,blocks:[,,,]};return Ee(n=e[2],o),{c(){t=I(),o.block.c()},m(e,n){_(e,t,n),o.block.m(e,o.anchor=n),o.mount=()=>t.parentNode,o.anchor=t,r=!0},p(t,[r]){e=t,o.ctx=e,4&r&&n!==(n=e[2])&&Ee(n,o)||ke(o,e,r)},i(e){r||(be(o.block),r=!0)},o(e){for(let e=0;e<3;e+=1)ye(o.blocks[e]);r=!1},d(e){e&&D(t),o.block.d(e),o.token=null,o=null}}}function vl(e,t,n){let{stage:r}=t,{search:o}=t;const s=()=>Yt(o).then((e=>{if(!e.length)throw new Error(`No series matched input \`${o}\``);return e}));let i=s();return e.$$set=e=>{"stage"in e&&n(0,r=e.stage),"search"in e&&n(1,o=e.search)},[r,o,i,s,e=>r.next({url:e.url,type:Vt.HFY_SERIES}),()=>n(2,i=s())]}const bl=class extends Ie{constructor(e){super(),Le(this,e,vl,$l,i,{stage:0,search:1})}};function yl(e,t,n){const r=e.slice();return r[9]=t[n],r}function wl(e){let t,n,r,s,i,l,c,a,u,d,p;return{c(){t=N("form"),n=N("p"),r=L("Import:\n        "),s=N("input"),i=F(),l=N("input"),a=F(),u=N("p"),u.textContent="Please only upload genuine backups, as there is no schema checking currently.",M(s,"id","upload"),M(s,"type","file"),M(s,"accept","application/json,*.json"),M(s,"name","files"),M(s,"size","30"),s.disabled=e[7],M(s,"class","svelte-1hos1p9"),M(l,"type","submit"),l.value="Go",M(l,"class","submit svelte-1hos1p9"),l.disabled=c=void 0===e[6]||e[7],M(n,"class","svelte-1hos1p9"),M(u,"class","small svelte-1hos1p9"),M(t,"class","form svelte-1hos1p9"),M(t,"enctype","multipart/form-data")},m(o,c){_(o,t,c),S(t,n),S(n,r),S(n,s),S(n,i),S(n,l),S(t,a),S(t,u),d||(p=[U(s,"change",e[22]),U(t,"submit",P(e[23]))],d=!0)},p(e,t){128&t&&(s.disabled=e[7]),192&t&&c!==(c=void 0===e[6]||e[7])&&(l.disabled=c)},d(e){e&&D(t),d=!1,o(p)}}}function xl(e){let t,n,r,s,i,l,c,a,u,d,p,f;return{c(){t=N("form"),n=N("p"),n.textContent="Enter list of URLs:",r=F(),s=N("textarea"),i=F(),l=N("p"),l.textContent="One URL per line",c=F(),a=N("p"),u=N("input"),M(n,"class","svelte-1hos1p9"),M(s,"rows","5"),M(s,"placeholder",e[10]),s.disabled=e[7],M(s,"class","svelte-1hos1p9"),M(l,"class","small svelte-1hos1p9"),M(u,"type","submit"),u.value="Go",M(u,"class","submit svelte-1hos1p9"),u.disabled=d=void 0===e[4]||!e[4].trim().length||e[7],M(a,"class","svelte-1hos1p9"),M(t,"class","form svelte-1hos1p9")},m(o,d){_(o,t,d),S(t,n),S(t,r),S(t,s),G(s,e[4]),S(t,i),S(t,l),S(t,c),S(t,a),S(a,u),p||(f=[U(s,"input",e[20]),U(t,"submit",P(e[21]))],p=!0)},p(e,t){128&t&&(s.disabled=e[7]),16&t&&G(s,e[4]),144&t&&d!==(d=void 0===e[4]||!e[4].trim().length||e[7])&&(u.disabled=d)},d(e){e&&D(t),p=!1,o(f)}}}function El(e){let t,n,r,s,i,l,c,a,u,d,p,f,h,m,g,$,v,b=void 0!==e[0]&&!e[0].trim().length,y=e[3]&&kl(e),w=b&&_l(),x=e[3]&&Dl();return{c(){t=N("form"),n=N("p"),r=L("Search:\n        "),s=N("input"),i=F(),l=N("input"),a=F(),y&&y.c(),u=F(),w&&w.c(),d=F(),p=N("div"),x&&x.c(),f=F(),h=N("p"),h.textContent="You can:",m=F(),g=N("ul"),g.innerHTML='<li>Search for a series title on the <a href="https://reddit.com/r/HFY/wiki/series" target="_blank">r/HFY wiki</a></li> <li>Enter a series link to the <a href="https://reddit.com/r/HFY" target="_blank">r/HFY</a> wiki</li> <li>Enter a link to any reddit post, or other link (see <a href="https://github.com/cpiber/hfy-epub/blob/master/docs/other/cors.md" target="_blank">CORS</a>)</li>',M(s,"class","search svelte-1hos1p9"),M(s,"placeholder","Search or URL..."),s.disabled=e[7],M(l,"type","submit"),l.value="Go",M(l,"class","submit svelte-1hos1p9"),l.disabled=c=void 0===e[0]||!e[0].trim().length||e[7],M(n,"class","svelte-1hos1p9"),M(t,"class","form svelte-1hos1p9"),M(h,"class","spaceabove svelte-1hos1p9"),M(p,"class","overlay-wrapper svelte-1hos1p9")},m(o,c){_(o,t,c),S(t,n),S(n,r),S(n,s),G(s,e[0]),S(n,i),S(n,l),S(t,a),y&&y.m(t,null),e[19](t),_(o,u,c),w&&w.m(o,c),_(o,d,c),_(o,p,c),x&&x.m(p,null),S(p,f),S(p,h),S(p,m),S(p,g),$||(v=[U(s,"input",e[16]),U(s,"keyup",e[13]),U(s,"blur",e[11]),U(s,"click",e[13]),U(t,"submit",P(e[18]))],$=!0)},p(e,n){128&n&&(s.disabled=e[7]),1&n&&s.value!==e[0]&&G(s,e[0]),129&n&&c!==(c=void 0===e[0]||!e[0].trim().length||e[7])&&(l.disabled=c),e[3]?y?y.p(e,n):(y=kl(e),y.c(),y.m(t,null)):y&&(y.d(1),y=null),1&n&&(b=void 0!==e[0]&&!e[0].trim().length),b?w||(w=_l(),w.c(),w.m(d.parentNode,d)):w&&(w.d(1),w=null),e[3]?x?8&n&&be(x,1):(x=Dl(),x.c(),be(x,1),x.m(p,f)):x&&($e(),ye(x,1,1,(()=>{x=null})),ve())},d(n){n&&(D(t),D(u),D(d),D(p)),y&&y.d(),e[19](null),w&&w.d(n),x&&x.d(),$=!1,o(v)}}}function kl(e){let t,n,r={ctx:e,current:null,token:null,hasCatch:!1,pending:Ol,then:Sl,catch:Tl,value:24};return Ee(n=e[12](e[9],e[0]??""),r),{c(){t=I(),r.block.c()},m(e,n){_(e,t,n),r.block.m(e,r.anchor=n),r.mount=()=>t.parentNode,r.anchor=t},p(t,o){e=t,r.ctx=e,513&o&&n!==(n=e[12](e[9],e[0]??""))&&Ee(n,r)||ke(r,e,o)},d(e){e&&D(t),r.block.d(e),r.token=null,r=null}}}function Tl(t){return{c:e,m:e,p:e,d:e}}function Sl(e){let t,n=Te(e[24]),r=[];for(let t=0;t<n.length;t+=1)r[t]=Cl(yl(e,n,t));return{c(){t=N("div");for(let e=0;e<r.length;e+=1)r[e].c();M(t,"class","search-results svelte-1hos1p9")},m(e,n){_(e,t,n);for(let e=0;e<r.length;e+=1)r[e]&&r[e].m(t,null)},p(e,o){if(4611&o){let s;for(n=Te(e[24]),s=0;s<n.length;s+=1){const i=yl(e,n,s);r[s]?r[s].p(i,o):(r[s]=Cl(i),r[s].c(),r[s].m(t,null))}for(;s<r.length;s+=1)r[s].d(1);r.length=n.length}},d(e){e&&D(t),A(r,e)}}}function Cl(e){let t,n,r,o,s,i=e[9].title+"";function l(){return e[17](e[9])}return{c(){t=N("a"),n=L(i),M(t,"class","result svelte-1hos1p9"),M(t,"href",r=Pt(e[9].url))},m(e,r){_(e,t,r),S(t,n),o||(s=U(t,"click",P(l)),o=!0)},p(o,s){e=o,513&s&&i!==(i=e[9].title+"")&&z(n,i),513&s&&r!==(r=Pt(e[9].url))&&M(t,"href",r)},d(e){e&&D(t),o=!1,s()}}}function Ol(t){return{c:e,m:e,p:e,d:e}}function _l(e){let t;return{c(){t=N("p"),t.textContent="Please enter a search string",M(t,"class","small error svelte-1hos1p9")},m(e,n){_(e,t,n)},d(e){e&&D(t)}}}function Dl(e){let t,n,r;return{c(){t=N("div"),M(t,"class","overlay svelte-1hos1p9")},m(e,n){_(e,t,n),r=!0},i(e){r||(e&&le((()=>{r&&(n||(n=xe(t,Ls,{duration:100},!0)),n.run(1))})),r=!0)},o(e){e&&(n||(n=xe(t,Ls,{duration:100},!1)),n.run(0)),r=!1},d(e){e&&D(t),e&&n&&n.end()}}}function Al(e){let t,n,r,o,s;function i(t){e[15](t)}let l={options:[{value:e[2].Search,label:"Search"},{value:e[2].List,label:"URLs"},{value:e[2].Import,label:"Import"}],name:"mode",class:"mode-select"};function c(e,t){return e[5]==e[2].Search?El:e[5]==e[2].List?xl:e[5]==e[2].Import?wl:void 0}void 0!==e[5]&&(l.selected=e[5]),t=new He({props:l}),ne.push((()=>De(t,"selected",i)));let a=c(e),u=a&&a(e);return{c(){Ae(t.$$.fragment),r=F(),o=N("div"),u&&u.c(),M(o,"class","mode svelte-1hos1p9")},m(e,n){Ne(t,e,n),_(e,r,n),_(e,o,n),u&&u.m(o,null),s=!0},p(e,[r]){const s={};4&r&&(s.options=[{value:e[2].Search,label:"Search"},{value:e[2].List,label:"URLs"},{value:e[2].Import,label:"Import"}]),!n&&32&r&&(n=!0,s.selected=e[5],ce((()=>n=!1))),t.$set(s),a===(a=c(e))&&u?u.p(e,r):(u&&u.d(1),u=a&&a(e),u&&(u.c(),u.m(o,null)))},i(e){s||(be(t.$$.fragment,e),s=!0)},o(e){ye(t.$$.fragment,e),s=!1},d(e){e&&(D(r),D(o)),Re(t,e),u&&u.d()}}}function Nl(e,t,n){let{stage:r}=t,{search:o}=t;var s;let i;!function(e){e.Search="search",e.List="list",e.Import="import"}(s||(s={}));let l,c,a,u=!1,d=s.Search,p=!1;const f=()=>{n(9,i=i||Yt().finally(f)),n(3,u=!!i&&!!o)},h=async()=>{if(!c)return;n(7,p=!0);const e=new FileReader,t=new Promise(((t,n)=>{e.onload=t,e.onerror=n}));e.readAsText(c),await t,n(7,p=!1);const r=JSON.parse(e.result);return r.bookData=Dn(r.bookData),r};return e.$$set=e=>{"stage"in e&&n(1,r=e.stage),"search"in e&&n(0,o=e.search)},[o,r,s,u,l,d,c,p,a,i,"https://example.com/chapter1\nhttps://example.com/chapter2",e=>n(3,u=!!a&&a.contains(e.relatedTarget)),async(e,t)=>{if(!e)return[];const r=await e,o=t.toLowerCase(),s=r.filter((e=>-1!==e.title.toLowerCase().indexOf(o)));return s.length||n(3,u=!1),s},f,h,function(e){d=e,n(5,d)},function(){o=this.value,n(0,o)},e=>r.next(e.url),()=>r.next(o||""),function(e){ne[e?"unshift":"push"]((()=>{a=e,n(8,a)}))},function(){l=this.value,n(4,l)},()=>r.fromList(l||""),e=>n(6,c=e.currentTarget.files?.[0]),async()=>r.fromJSON(await h())]}const Rl=class extends Ie{constructor(e){super(),Le(this,e,Nl,Al,i,{stage:1,search:0})}};function Ll(t){let n,r,o,s;return{c(){n=R("svg"),r=R("g"),o=R("path"),s=R("path"),M(o,"d","M173.145,73.91c-0.413-2.722-2.29-4.993-4.881-5.912l-13.727-4.881c-0.812-2.3-1.733-4.536-2.754-6.699l6.247-13.146\n\t\tc1.179-2.479,0.899-5.411-0.729-7.628c-5.265-7.161-11.556-13.452-18.698-18.693c-2.219-1.629-5.141-1.906-7.625-0.724\n\t\tl-13.138,6.242c-2.163-1.021-4.402-1.94-6.704-2.752l-4.883-13.729c-0.919-2.586-3.184-4.458-5.9-4.876\n\t\tc-9.65-1.483-16.792-1.483-26.457,0c-2.713,0.418-4.981,2.29-5.9,4.876l-4.883,13.729c-2.302,0.812-4.541,1.731-6.702,2.752\n\t\tl-13.143-6.242c-2.479-1.181-5.406-0.904-7.623,0.724c-7.142,5.241-13.433,11.532-18.698,18.693\n\t\tc-1.629,2.217-1.908,5.148-0.729,7.628l6.247,13.146c-1.021,2.159-1.94,4.4-2.754,6.699L5.982,68.003\n\t\tc-2.589,0.919-4.463,3.189-4.879,5.907c-0.749,4.92-1.099,9.115-1.099,13.219c0,4.098,0.35,8.299,1.099,13.219\n\t\tc0.413,2.722,2.29,4.993,4.881,5.912l13.727,4.881c0.814,2.304,1.736,4.541,2.754,6.704l-6.247,13.141\n\t\tc-1.179,2.479-0.899,5.411,0.727,7.623c5.258,7.156,11.549,13.447,18.7,18.698c2.217,1.629,5.144,1.911,7.625,0.724l13.138-6.242\n\t\tc2.163,1.021,4.402,1.94,6.704,2.752l4.883,13.729c0.919,2.586,3.184,4.458,5.9,4.876c4.828,0.744,9.154,1.104,13.228,1.104\n\t\tc4.074,0,8.401-0.36,13.228-1.104c2.715-0.418,4.981-2.29,5.9-4.876l4.883-13.729c2.302-0.812,4.541-1.731,6.704-2.752\n\t\tl13.138,6.242c2.484,1.186,5.411,0.904,7.628-0.724c7.159-5.26,13.45-11.551,18.698-18.698c1.626-2.212,1.906-5.144,0.727-7.623\n\t\tl-6.247-13.141c1.021-2.163,1.942-4.405,2.754-6.704l13.727-4.881c2.591-0.919,4.468-3.189,4.881-5.912\n\t\tc0.749-4.92,1.099-9.12,1.099-13.219S173.894,78.829,173.145,73.91z M158.949,93.72l-12.878,4.58\n\t\tc-2.251,0.797-3.982,2.625-4.66,4.92c-1.15,3.889-2.664,7.569-4.504,10.943c-1.142,2.1-1.213,4.619-0.187,6.777l5.841,12.285\n\t\tc-2.822,3.389-5.943,6.515-9.337,9.334l-12.283-5.834c-2.161-1.036-4.672-0.953-6.775,0.185c-3.379,1.838-7.061,3.35-10.953,4.502\n\t\tc-2.29,0.676-4.118,2.406-4.917,4.657l-4.582,12.883c-4.677,0.476-8.503,0.476-13.18,0l-4.582-12.883\n\t\tc-0.8-2.246-2.628-3.982-4.917-4.657c-3.894-1.152-7.579-2.664-10.953-4.502c-2.103-1.147-4.619-1.22-6.775-0.185l-12.283,5.839\n\t\tc-3.391-2.825-6.512-5.946-9.337-9.339l5.841-12.285c1.026-2.159,0.955-4.677-0.187-6.777c-1.835-3.364-3.35-7.049-4.504-10.948\n\t\tc-0.678-2.29-2.411-4.118-4.66-4.915l-12.878-4.58c-0.243-2.343-0.36-4.502-0.36-6.592s0.117-4.244,0.36-6.587l12.881-4.584\n\t\tc2.248-0.797,3.979-2.625,4.657-4.915c1.152-3.889,2.667-7.574,4.504-10.953c1.142-2.095,1.213-4.619,0.187-6.772l-5.841-12.285\n\t\tc2.827-3.393,5.948-6.519,9.337-9.339l12.288,5.839c2.151,1.036,4.677,0.953,6.775-0.185c3.372-1.838,7.054-3.35,10.948-4.502\n\t\tc2.29-0.676,4.118-2.411,4.917-4.657l4.582-12.883c4.633-0.481,8.466-0.481,13.18,0l4.582,12.883\n\t\tc0.8,2.246,2.628,3.982,4.917,4.657c3.894,1.152,7.579,2.664,10.953,4.502c2.103,1.147,4.614,1.22,6.775,0.185l12.283-5.839\n\t\tc3.389,2.82,6.51,5.946,9.337,9.339l-5.841,12.285c-1.026,2.154-0.955,4.677,0.187,6.772c1.843,3.389,3.357,7.069,4.504,10.948\n\t\tc0.678,2.295,2.409,4.123,4.66,4.92l12.878,4.58c0.243,2.343,0.36,4.502,0.36,6.592S159.192,91.377,158.949,93.72z"),M(s,"d","M87.124,50.802c-19.062,0-34.571,15.508-34.571,34.571s15.508,34.571,34.571,34.571s34.571-15.508,34.571-34.571\n\t\tS106.186,50.802,87.124,50.802z M87.124,105.009c-10.827,0-19.636-8.809-19.636-19.636s8.809-19.636,19.636-19.636\n\t\ts19.636,8.809,19.636,19.636S97.951,105.009,87.124,105.009z"),M(n,"version","1.1"),M(n,"xmlns","http://www.w3.org/2000/svg"),M(n,"xmlns:xlink","http://www.w3.org/1999/xlink"),M(n,"x","0px"),M(n,"y","0px"),M(n,"viewBox","0 0 174.248 174.248"),M(n,"xml:space","preserve")},m(e,t){_(e,n,t),S(n,r),S(r,o),S(r,s)},p:e,i:e,o:e,d(e){e&&D(n)}}}const Fl=class extends Ie{constructor(e){super(),Le(this,e,null,Ll,i,{})}};function Il(e){let t,n;const r=e[1].default,o=d(r,e,e[0],null);return{c(){t=N("p"),o&&o.c(),M(t,"class","info alert svelte-1mwdlru")},m(e,r){_(e,t,r),o&&o.m(t,null),n=!0},p(e,[t]){o&&o.p&&(!n||1&t)&&h(o,r,e,e[0],n?f(r,e[0],t,null):m(e[0]),null)},i(e){n||(be(o,e),n=!0)},o(e){ye(o,e),n=!1},d(e){e&&D(t),o&&o.d(e)}}}function Ul(e,t,n){let{$$slots:r={},$$scope:o}=t;return e.$$set=e=>{"$$scope"in e&&n(0,o=e.$$scope)},[o,r]}const Pl=class extends Ie{constructor(e){super(),Le(this,e,Ul,Il,i,{})}};function jl(t){let n,r,o;return{c(){n=L("Due to "),r=N("a"),r.textContent="recent API changes on reddit",o=L(', creating ebooks has become limited. If you run into a "Too many requests" error, please wait 10 minutes before trying again.'),M(r,"href","https://www.redditinc.com/blog/apifacts"),M(r,"target","_blank"),M(r,"class","svelte-ntsh7z")},m(e,t){_(e,n,t),_(e,r,t),_(e,o,t)},p:e,d(e){e&&(D(n),D(r),D(o))}}}function Ml(t){let n,r,o,s,i;return{c(){n=L("When generating an ebook via URL, please be aware of "),r=N("code"),r.textContent="NetworkError",o=L("s, see "),s=N("a"),s.textContent="CORS",i=L("."),M(r,"class","svelte-ntsh7z"),M(s,"href","https://github.com/cpiber/hfy-epub/blob/master/docs/other/cors.md"),M(s,"target","_blank"),M(s,"class","svelte-ntsh7z")},m(e,t){_(e,n,t),_(e,r,t),_(e,o,t),_(e,s,t),_(e,i,t)},p:e,d(e){e&&(D(n),D(r),D(o),D(s),D(i))}}}function zl(e){let t,n,r,o,s,i,l;return o=new Pl({props:{$$slots:{default:[jl]},$$scope:{ctx:e}}}),i=new Pl({props:{$$slots:{default:[Ml]},$$scope:{ctx:e}}}),{c(){t=N("header"),n=N("h1"),n.innerHTML='r/HFY epub generator <a class="small svelte-ntsh7z" href="https://github.com/cpiber/hfy-epub/tree/master/docs/index.md" target="_blank">Help</a>',r=F(),Ae(o.$$.fragment),s=F(),Ae(i.$$.fragment),M(n,"class","svelte-ntsh7z"),M(t,"class","svelte-ntsh7z")},m(e,c){_(e,t,c),S(t,n),S(t,r),Ne(o,t,null),S(t,s),Ne(i,t,null),l=!0},p(e,[t]){const n={};1&t&&(n.$$scope={dirty:t,ctx:e}),o.$set(n);const r={};1&t&&(r.$$scope={dirty:t,ctx:e}),i.$set(r)},i(e){l||(be(o.$$.fragment,e),be(i.$$.fragment,e),l=!0)},o(e){ye(o.$$.fragment,e),ye(i.$$.fragment,e),l=!1},d(e){e&&D(t),Re(o),Re(i)}}}const Gl=class extends Ie{constructor(e){super(),Le(this,e,null,zl,i,{})}};function Bl(e){let t,n,r,o,s,i,l,c;return{c(){t=N("p"),n=L("This website ("),r=N("a"),r.textContent="https://cpiber.github.io/hfy-epub",o=L(") does not, and will not, collect any data from its users.\n      Any actions taken on this page are purely in the user's browser; there is no server-side component.\n      No data is ever sent away.\n      For collecting the chapter data, this site contacts "),s=N("code"),s.textContent=`${It}`,i=L(" only. The book is generated in the browser."),M(r,"href","https://cpiber.github.io/hfy-epub"),M(r,"target","_blank"),M(t,"class","small svelte-1f8pws6")},m(e,l){_(e,t,l),S(t,n),S(t,r),S(t,o),S(t,s),S(t,i),c=!0},i(e){c||(e&&le((()=>{c&&(l||(l=xe(t,Gt,{},!0)),l.run(1))})),c=!0)},o(e){e&&(l||(l=xe(t,Gt,{},!1)),l.run(0)),c=!1},d(e){e&&D(t),e&&l&&l.end()}}}function Hl(e){let t,n,r,o,s;return{c(){t=N("label"),n=N("input"),r=L(" Use TinyMCE chapter editor"),M(n,"type","checkbox"),M(n,"aria-label","use TinyMCE editor"),M(n,"class","svelte-1f8pws6"),M(t,"class","small svelte-1f8pws6")},m(i,l){_(i,t,l),S(t,n),n.checked=e[2].useTiny,S(t,r),o||(s=U(n,"change",e[4]),o=!0)},p(e,t){4&t&&(n.checked=e[2].useTiny)},d(e){e&&D(t),o=!1,s()}}}function ql(e){let t,n,r,o,s,i,l,c,a,u,d,p,f,h,m,g=!Tn(e[1].stage,un.SETTINGS),$=e[0]&&Bl(),v=g&&Hl(e);return{c(){t=N("footer"),n=N("p"),r=L("Made by "),o=N("a"),o.textContent="@cpiber",s=L(".\n    Source Code & bug tracker: "),i=N("a"),i.textContent="cpiber/hfy-epub",l=L(".\n    \n    Version "),c=L("0.3.5"),a=L(".\n    "),u=N("a"),u.textContent="Privacy",d=L("."),p=F(),$&&$.c(),f=F(),v&&v.c(),M(o,"href","https://github.com/cpiber"),M(o,"target","_blank"),M(i,"href","https://github.com/cpiber/hfy-epub"),M(i,"target","_blank"),M(u,"href","#privacy"),M(n,"class","small svelte-1f8pws6"),M(t,"class","svelte-1f8pws6")},m(g,b){_(g,t,b),S(t,n),S(n,r),S(n,o),S(n,s),S(n,i),S(n,l),S(n,c),S(n,a),S(n,u),S(n,d),S(t,p),$&&$.m(t,null),S(t,f),v&&v.m(t,null),h||(m=U(u,"click",P(e[3])),h=!0)},p(e,[n]){e[0]?$?1&n&&be($,1):($=Bl(),$.c(),be($,1),$.m(t,f)):$&&($e(),ye($,1,1,(()=>{$=null})),ve()),2&n&&(g=!Tn(e[1].stage,un.SETTINGS)),g?v?v.p(e,n):(v=Hl(e),v.c(),v.m(t,null)):v&&(v.d(1),v=null)},i(e){be($)},o(e){ye($)},d(e){e&&D(t),$&&$.d(),v&&v.d(),h=!1,m()}}}function Wl(e,t,n){let r,o;u(e,Sn,(e=>n(1,r=e))),u(e,Ve,(e=>n(2,o=e)));let s=!1;return[s,r,o,()=>n(0,s=!s),function(){o.useTiny=this.checked,Ve.set(o)}]}const Yl=class extends Ie{constructor(e){super(),Le(this,e,Wl,ql,i,{})}};function Kl(e){let t,n,r,o,s,i;return n=new Us({}),{c(){t=N("a"),Ae(n.$$.fragment),r=L(" home"),M(t,"href","#home"),M(t,"class","homelink svelte-ibaoy7")},m(l,c){_(l,t,c),Ne(n,t,null),S(t,r),o=!0,s||(i=U(t,"click",P(e[6])),s=!0)},i(e){o||(be(n.$$.fragment,e),o=!0)},o(e){ye(n.$$.fragment,e),o=!1},d(e){e&&D(t),Re(n),s=!1,i()}}}function Xl(t){let n,r,o,s,i;return r=new Fl({}),{c(){n=N("a"),Ae(r.$$.fragment),M(n,"href","#settings"),M(n,"class","settingslink svelte-ibaoy7")},m(e,l){_(e,n,l),Ne(r,n,null),o=!0,s||(i=U(n,"click",P(t[3])),s=!0)},p:e,i(e){o||(be(r.$$.fragment,e),o=!0)},o(e){ye(r.$$.fragment,e),o=!1},d(e){e&&D(n),Re(r),s=!1,i()}}}function Vl(t){let n,r,o,s,i,l;return r=new Us({}),{c(){n=N("a"),Ae(r.$$.fragment),o=L(" back"),M(n,"href","#home"),M(n,"class","homelink svelte-ibaoy7")},m(e,c){_(e,n,c),Ne(r,n,null),S(n,o),s=!0,i||(l=U(n,"click",P(t[7])),i=!0)},p:e,i(e){s||(be(r.$$.fragment,e),s=!0)},o(e){ye(r.$$.fragment,e),s=!1},d(e){e&&D(n),Re(r),i=!1,l()}}}function Jl(t){let n,r,o;return{c(){n=N("h2"),n.textContent="Page not found",r=F(),o=N("p"),o.textContent="Sorry, the requested page could not be found"},m(e,t){_(e,n,t),_(e,r,t),_(e,o,t)},p:e,i:e,o:e,d(e){e&&(D(n),D(r),D(o))}}}function Zl(t){let n,r;return n=new ht({}),{c(){Ae(n.$$.fragment)},m(e,t){Ne(n,e,t),r=!0},p:e,i(e){r||(be(n.$$.fragment,e),r=!0)},o(e){ye(n.$$.fragment,e),r=!1},d(e){Re(n,e)}}}function Ql(e){let t,n;return t=new Yn({props:{stage:e[0],backToSearch:e[2]}}),{c(){Ae(t.$$.fragment)},m(e,r){Ne(t,e,r),n=!0},p(e,n){const r={};1&n&&(r.stage=e[0]),4&n&&(r.backToSearch=e[2]),t.$set(r)},i(e){n||(be(t.$$.fragment,e),n=!0)},o(e){ye(t.$$.fragment,e),n=!1},d(e){Re(t,e)}}}function ec(e){let t,n;return t=new dr({props:{stage:e[0]}}),{c(){Ae(t.$$.fragment)},m(e,r){Ne(t,e,r),n=!0},p(e,n){const r={};1&n&&(r.stage=e[0]),t.$set(r)},i(e){n||(be(t.$$.fragment,e),n=!0)},o(e){ye(t.$$.fragment,e),n=!1},d(e){Re(t,e)}}}function tc(e){let t,n;return t=new yr({props:{stage:e[0]}}),{c(){Ae(t.$$.fragment)},m(e,r){Ne(t,e,r),n=!0},p(e,n){const r={};1&n&&(r.stage=e[0]),t.$set(r)},i(e){n||(be(t.$$.fragment,e),n=!0)},o(e){ye(t.$$.fragment,e),n=!1},d(e){Re(t,e)}}}function nc(e){let t,n;return t=new Wi({props:{stage:e[0]}}),{c(){Ae(t.$$.fragment)},m(e,r){Ne(t,e,r),n=!0},p(e,n){const r={};1&n&&(r.stage=e[0]),t.$set(r)},i(e){n||(be(t.$$.fragment,e),n=!0)},o(e){ye(t.$$.fragment,e),n=!1},d(e){Re(t,e)}}}function rc(e){let t,n;return t=new al({props:{stage:e[0],series:e[1].series,backToSearch:e[2]}}),{c(){Ae(t.$$.fragment)},m(e,r){Ne(t,e,r),n=!0},p(e,n){const r={};1&n&&(r.stage=e[0]),2&n&&(r.series=e[1].series),4&n&&(r.backToSearch=e[2]),t.$set(r)},i(e){n||(be(t.$$.fragment,e),n=!0)},o(e){ye(t.$$.fragment,e),n=!1},d(e){Re(t,e)}}}function oc(e){let t,n;return t=new bl({props:{stage:e[0],search:e[1].search}}),{c(){Ae(t.$$.fragment)},m(e,r){Ne(t,e,r),n=!0},p(e,n){const r={};1&n&&(r.stage=e[0]),2&n&&(r.search=e[1].search),t.$set(r)},i(e){n||(be(t.$$.fragment,e),n=!0)},o(e){ye(t.$$.fragment,e),n=!1},d(e){Re(t,e)}}}function sc(e){let t,n;return t=new Rl({props:{stage:e[0],search:e[1].search}}),{c(){Ae(t.$$.fragment)},m(e,r){Ne(t,e,r),n=!0},p(e,n){const r={};1&n&&(r.stage=e[0]),2&n&&(r.search=e[1].search),t.$set(r)},i(e){n||(be(t.$$.fragment,e),n=!0)},o(e){ye(t.$$.fragment,e),n=!1},d(e){Re(t,e)}}}function ic(e){let t,n,r,o,s,i,l,c,a,u,d,p,f,h,m,g,$,v,b,y,w,x,E,k,T=!Tn(e[0],un.INPUT)&&!Tn(e[0],un.SETTINGS),C=T&&Kl(e);const O=[Vl,Xl],A=[];function R(e,t){return 1&t&&(o=null),null==o&&(o=!!Tn(e[0],un.SETTINGS)),o?0:1}s=R(e,-1),i=A[s]=O[s](e),c=new Gl({});const L=[sc,oc,rc,nc,tc,ec,Ql,Zl,Jl],I=[];function U(e,t){return 1&t&&(d=null),1&t&&(p=null),1&t&&(f=null),1&t&&(h=null),1&t&&(m=null),1&t&&(g=null),1&t&&($=null),1&t&&(v=null),1&t&&(b=null),null==d&&(d=!!Tn(e[0],un.INPUT)),d?0:(null==p&&(p=!!Tn(e[0],un.SEARCH)),p?1:(null==f&&(f=!!Tn(e[0],un.BOOK_DATA)),f?2:(null==h&&(h=!!Tn(e[0],un.EDIT_DATA)),h?3:(null==m&&(m=!!Tn(e[0],un.FIND_CHAPTERS)),m?4:(null==g&&(g=!!Tn(e[0],un.DOWNLOAD_CHAPTERS)),g?5:(null==$&&($=!!Tn(e[0],un.RESULT)),$?6:(null==v&&(v=!!Tn(e[0],un.SETTINGS)),v?7:(null==b&&(b=!!Tn(e[0],un._404)),b?8:-1))))))))}return~(y=U(e,-1))&&(w=I[y]=L[y](e)),E=new Yl({}),{c(){t=N("div"),n=N("nav"),C&&C.c(),r=F(),i.c(),l=F(),Ae(c.$$.fragment),a=F(),u=N("main"),w&&w.c(),x=F(),Ae(E.$$.fragment),M(n,"class","mainnav svelte-ibaoy7"),M(u,"class","App-main"),M(t,"class","App svelte-ibaoy7")},m(e,o){_(e,t,o),S(t,n),C&&C.m(n,null),S(n,r),A[s].m(n,null),S(t,l),Ne(c,t,null),S(t,a),S(t,u),~y&&I[y].m(u,null),S(t,x),Ne(E,t,null),k=!0},p(e,[t]){1&t&&(T=!Tn(e[0],un.INPUT)&&!Tn(e[0],un.SETTINGS)),T?C?1&t&&be(C,1):(C=Kl(e),C.c(),be(C,1),C.m(n,r)):C&&($e(),ye(C,1,1,(()=>{C=null})),ve());let o=s;s=R(e,t),s===o?A[s].p(e,t):($e(),ye(A[o],1,1,(()=>{A[o]=null})),ve(),i=A[s],i?i.p(e,t):(i=A[s]=O[s](e),i.c()),be(i,1),i.m(n,null));let l=y;y=U(e,t),y===l?~y&&I[y].p(e,t):(w&&($e(),ye(I[l],1,1,(()=>{I[l]=null})),ve()),~y?(w=I[y],w?w.p(e,t):(w=I[y]=L[y](e),w.c()),be(w,1),w.m(u,null)):w=null)},i(e){k||(be(C),be(i),be(c.$$.fragment,e),be(w),be(E.$$.fragment,e),k=!0)},o(e){ye(C),ye(i),ye(c.$$.fragment,e),ye(w),ye(E.$$.fragment,e),k=!1},d(e){e&&D(t),C&&C.d(),A[s].d(),Re(c),~y&&I[y].d(),Re(E)}}}function lc(e,t,n){let r,o,s,i,l;return u(e,Cn,(e=>n(4,s=e))),u(e,Sn,(e=>n(1,i=e))),u(e,Ve,(e=>n(5,l=e))),e.$$.update=()=>{2&e.$$.dirty&&n(0,r=i.stage),1&e.$$.dirty&&n(2,o=Tn(r.from,un.SEARCH)?()=>xn(hn):void 0),e.$$.dirty,e.$$.dirty,e.$$.dirty,32&e.$$.dirty&&localStorage.setItem("config",JSON.stringify(l)),2&e.$$.dirty&&localStorage.setItem("state",JSON.stringify({data:i.stage.dump(),search:i.search,series:i.series})),16&e.$$.dirty&&(async e=>e?JSON.stringify(await An(e)):"undefined")(s).then((e=>{try{localStorage.setItem("book",e)}catch(e){return e}}),(()=>{localStorage.removeItem("book"),console.error("Data too large! Caution, reloading won't work as expected!")}))},[r,i,o,()=>{r.needsSaving&&!confirm("Unsaved changes. Continue?")||xn(yn)},s,l,()=>xn(fn),()=>r.next()]}(()=>{var e;try{const t=JSON.parse(null!==(e=localStorage.getItem("config"))&&void 0!==e?e:"");Ve.set((e=>{if(!e||""+e!="[object Object]")return Xe;const t=Object.keys(e),n=Object.keys(Xe);for(const r of n)t.includes(r)||(e[r]=Xe[r]),typeof Xe[r]!=typeof e[r]&&(e[r]=Xe[r]);return e})(t))}catch(e){}})(),(()=>{var e;try{const t=(e=>{const t=JSON.parse(e);return Dn(t)})(null!==(e=localStorage.getItem("book"))&&void 0!==e?e:"");Cn.update((()=>t))}catch(e){console.error(e)}})(),window.removeEventListener("popstate",_n),window.addEventListener("popstate",_n),_n();const cc=class extends Ie{constructor(e){super(),Le(this,e,lc,ic,i,{})}};let ac;try{ac=new cc({target:document.body})}catch(e){const t=document.createElement("div");t.className="fatal-error",t.ariaLabel="error",t.appendChild(document.createElement("h1")).textContent="Something went wrong:",t.appendChild(document.createElement("code")).textContent=e,document.body.appendChild(t)}})(),c=l.O(c)})();